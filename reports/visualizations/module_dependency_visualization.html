<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt Module Dependencies Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        h1, h2, h3 {
            color: #333;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            border-radius: 8px;
        }
        .diagram-container {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .module-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .module-card {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 4px;
            background-color: #fafafa;
        }
        .module-card h3 {
            margin-top: 0;
            color: #2196F3;
        }
        .dependency {
            color: #f44336;
            font-weight: bold;
        }
        .shared-data {
            color: #4CAF50;
        }
        .metrics {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .metric-card {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 4px;
            text-align: center;
            min-width: 150px;
            background-color: #e3f2fd;
        }
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #1976D2;
        }
        .metric-label {
            font-size: 0.9em;
            color: #666;
        }
        .legend {
            margin: 10px 0;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 4px;
        }
        .legend-item {
            display: inline-block;
            margin-right: 20px;
        }
        .independent {
            background-color: #e8f5e9;
        }
        .dependent {
            background-color: #ffebee;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Prompt Module Dependencies Analysis</h1>

        <h2>Metrics</h2>
        <div class="metrics">
            <div class="metric-card">
                <div class="metric-value">7</div>
                <div class="metric-label">Total Modules</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">5</div>
                <div class="metric-label">Independent Modules</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">71.4%</div>
                <div class="metric-label">Modularity Score</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">2</div>
                <div class="metric-label">Max Chain Length</div>
            </div>
        </div>

        <h2>Dependency Graph</h2>
        <div class="legend">
            <span class="legend-item">→ Direct dependency</span>
            <span class="legend-item">⋯→ Data flow dependency</span>
        </div>

        <div class="diagram-container">
            <div class="mermaid">
graph TD
    %% Define node styles
    classDef independent fill:#c8e6c9,stroke:#4caf50,stroke-width:2px
    classDef dependent fill:#ffcdd2,stroke:#f44336,stroke-width:2px
    classDef dataProvider fill:#e1f5fe,stroke:#03a9f4,stroke-width:2px

    %% Nodes
    context_awareness[Context Awareness<br/>Sets: org/domain contexts]
    definition_task[Definition Task<br/>Needs: 4 shared data]
    error_prevention[Error Prevention<br/>Needs: org/domain contexts]
    expertise[Expertise<br/>Sets: word_type]
    output_specification[Output Specification<br/>Sets: char_limit_warning]
    quality_rules[Quality Rules<br/>No dependencies]
    semantic_categorisation[Semantic Categorisation<br/>Sets: ontological_category]

    %% Direct dependencies (solid lines)
    definition_task -->|depends on| semantic_categorisation
    error_prevention -->|depends on| context_awareness

    %% Data flow dependencies (dashed lines)
    expertise -.->|word_type| definition_task
    semantic_categorisation -.->|ontological_category| definition_task
    context_awareness -.->|domain_contexts| definition_task
    context_awareness -.->|organization_contexts| definition_task
    context_awareness -.->|domain_contexts| error_prevention
    context_awareness -.->|organization_contexts| error_prevention

    %% Apply styles
    class context_awareness,expertise,output_specification,quality_rules,semantic_categorisation independent
    class definition_task,error_prevention dependent
            </div>
        </div>

        <h2>Module Details</h2>
        <div class="module-info">
            <div class="module-card independent">
                <h3>context_awareness</h3>
                <p><strong>Type:</strong> Independent</p>
                <p><strong>Direct Dependencies:</strong> None</p>
                <p><strong>Provides Data:</strong></p>
                <ul class="shared-data">
                    <li>organization_contexts</li>
                    <li>domain_contexts</li>
                </ul>
                <p><strong>Purpose:</strong> Processes organizational and domain context information</p>
            </div>

            <div class="module-card dependent">
                <h3>definition_task</h3>
                <p><strong>Type:</strong> Dependent</p>
                <p class="dependency">Direct Dependencies: semantic_categorisation</p>
                <p><strong>Needs Data:</strong></p>
                <ul>
                    <li>word_type (from expertise)</li>
                    <li>ontological_category (from semantic_categorisation)</li>
                    <li>organization_contexts (from context_awareness)</li>
                    <li>domain_contexts (from context_awareness)</li>
                </ul>
                <p><strong>Purpose:</strong> Final instructions, checklist, and metadata generation</p>
            </div>

            <div class="module-card dependent">
                <h3>error_prevention</h3>
                <p><strong>Type:</strong> Dependent</p>
                <p class="dependency">Direct Dependencies: context_awareness</p>
                <p><strong>Needs Data:</strong></p>
                <ul>
                    <li>organization_contexts (from context_awareness)</li>
                    <li>domain_contexts (from context_awareness)</li>
                </ul>
                <p><strong>Purpose:</strong> Generates forbidden patterns and error prevention rules</p>
            </div>

            <div class="module-card independent">
                <h3>expertise</h3>
                <p><strong>Type:</strong> Independent</p>
                <p><strong>Direct Dependencies:</strong> None</p>
                <p><strong>Provides Data:</strong></p>
                <ul class="shared-data">
                    <li>word_type</li>
                </ul>
                <p><strong>Purpose:</strong> Expert role definition and basic instructions</p>
            </div>

            <div class="module-card independent">
                <h3>output_specification</h3>
                <p><strong>Type:</strong> Independent</p>
                <p><strong>Direct Dependencies:</strong> None</p>
                <p><strong>Provides Data:</strong></p>
                <ul class="shared-data">
                    <li>character_limit_warning</li>
                </ul>
                <p><strong>Purpose:</strong> Output format specifications and character limits</p>
            </div>

            <div class="module-card independent">
                <h3>quality_rules</h3>
                <p><strong>Type:</strong> Independent</p>
                <p><strong>Direct Dependencies:</strong> None</p>
                <p><strong>Provides/Needs Data:</strong> None</p>
                <p><strong>Purpose:</strong> All validation rules (CON, ESS, INT, SAM, STR, ARAI)</p>
            </div>

            <div class="module-card independent">
                <h3>semantic_categorisation</h3>
                <p><strong>Type:</strong> Independent</p>
                <p><strong>Direct Dependencies:</strong> None</p>
                <p><strong>Provides Data:</strong></p>
                <ul class="shared-data">
                    <li>ontological_category</li>
                </ul>
                <p><strong>Purpose:</strong> ESS-02 ontological category instructions</p>
            </div>
        </div>

        <h2>Analysis Summary</h2>
        <div style="background-color: #f5f5f5; padding: 20px; border-radius: 4px; margin: 20px 0;">
            <h3>Modularity Assessment</h3>
            <ul>
                <li><strong>Good Modularity:</strong> 71.4% of modules (5/7) are independent with no direct dependencies</li>
                <li><strong>Limited Coupling:</strong> Only 2 modules have direct dependencies, creating short dependency chains</li>
                <li><strong>No Circular Dependencies:</strong> No tightly coupled pairs or circular dependency chains detected</li>
                <li><strong>Clear Data Flow:</strong> Data dependencies are unidirectional and well-defined</li>
            </ul>

            <h3>Module Independence Analysis</h3>
            <ul>
                <li><strong>Truly Independent:</strong> quality_rules - can run completely standalone</li>
                <li><strong>Data Providers:</strong> expertise, context_awareness, output_specification, semantic_categorisation - provide data but don't consume</li>
                <li><strong>Data Consumers:</strong> definition_task, error_prevention - depend on data from other modules</li>
            </ul>

            <h3>Potential Issues</h3>
            <ul>
                <li><strong>definition_task</strong> is the most coupled module, depending on data from 4 different modules</li>
                <li><strong>error_prevention</strong> has a direct dependency on context_awareness, limiting its reusability</li>
            </ul>
        </div>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
</body>
</html>
