---
id: US-249
titel: Web‑snippets — lager budget en dedup met contextsectie
status: proposed
priority: P1
owner: architecture
applies_to: definitie-app@v2
canonical: false
last_verified: 2025-09-22
links:
  - EPIC-019
  - EPIC-018
---

# US-019-12 — Web‑snippets budget & dedup

Als team wil ik beperkt aantal web‑snippets (korte quotes) en geen duplicatie wanneer contextsectie bronnen al toont.

## As‑Is
- Augmentatie kan 3+ items invoegen met ruim tokenbudget; duplicatie mogelijk met ContextAwareness.

Bronnen:
- src/services/prompts/prompt_service_v2.py:196 (_maybe_augment_with_web_context)

## To‑Be
- Budget: total ≈120 tokens; max 2 snippets; 40 tokens/snippet.
- Skip augmentatie wanneer `sources_in_prompt=true`.

## Acceptance Criteria
- AC1: Budgetten afgedwongen; geen overschrijding.
- AC2: Geen dubbele bronsecties.

## Implementatie (richting)
1) Pas standaardwaarden aan (total_token_budget=120; max_snippets=2; max_tokens_per_snippet=40).
2) Check metadata `sources_in_prompt` vóór injectie.

## Testplan
- Snapshot: max 2 “Bron X”; korte snippets; geen duplicatie.

## Risks / Mitigations
- Risico: autoritatieve bron weggevallen door sortering
  - Mitigatie: behoud sorteerlogica met autoritaire bronnen eerst.
