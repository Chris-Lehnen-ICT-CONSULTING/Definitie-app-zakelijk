---
id: US-222
epic: EPIC-003
titel: Verwijder enable_cleaning Feature Flag
type: technical-debt
status: open
prioriteit: MEDIUM
story_points: 3
sprint: backlog
aangemaakt: 19-09-2025
bijgewerkt: 19-09-2025
owner: development-team
applies_to: definitie-app@current
canonical: false
last_verified: 19-09-2025
vereisten:
  - REQ-005
  - REQ-007
Afhankelijkheden: []
toegewezen_aan: development-team
---

# US-222: Verwijder enable_cleaning Feature Flag

## Gebruikersverhaal

**Als een** ontwikkelaar
**wil ik** dat text cleaning altijd wordt uitgevoerd zonder feature flag
**zodat** alle definities consistent geformatteerd zijn

## Context

De `enable_cleaning` flag voorkomt text normalisatie wanneer uitgeschakeld:
```python
if not self.config.enable_cleaning:
    return text  # UNCLEANED TEXT met formatting issues!
```

Dit leidt tot inconsistente output met potentiële formatting problemen.

## Acceptatiecriteria

### Criterion 1: Cleaning Altijd Actief
**gegeven** een definitie tekst is gegenereerd
**wanneer** de tekst wordt verwerkt
**dan** wordt cleaning ALTIJD toegepast

### Criterion 2: Configureerbare Rules
**gegeven** cleaning draait altijd
**wanneer** configuratie nodig is
**dan** kunnen specifieke cleaning rules aan/uit gezet worden

### Criterion 3: Performance Impact
**gegeven** cleaning draait altijd
**wanneer** tekst wordt verwerkt
**dan** duurt cleaning maximaal 50ms

## Technische Implementatie

### Te Wijzigen Bestanden

1. **src/services/cleaning_service.py**
   - Regel 24: Verwijder `enable_cleaning: bool = True`
   - Regel 61, 111: Verwijder `if not self.config.enable_cleaning:` checks

2. **src/services/definition_generator_config.py**
   - Regel 124: Verwijder `enable_cleaning: bool = True`

3. **src/services/container.py**
   - Regel 103, 121: Verwijder `enable_cleaning` parameters

### Nieuwe Implementatie

```python
# VOOR:
if not self.config.enable_cleaning:
    return text  # Dirty text!

# NA:
class CleaningService:
    def clean_text(self, text: str, term: str) -> CleaningResult:
        # Cleaning gebeurt ALTIJD
        cleaned = text

        # Configureerbare rules (niet aan/uit voor hele service)
        if self.config.normalize_whitespace:
            cleaned = self._normalize_whitespace(cleaned)

        if self.config.fix_punctuation:
            cleaned = self._fix_punctuation(cleaned)

        if self.config.remove_duplicates:
            cleaned = self._remove_duplicates(cleaned, term)

        return CleaningResult(
            original_text=text,
            cleaned_text=cleaned,
            was_cleaned=(cleaned != text)
        )
```

## Test Coverage Vereisten

### Unit Tests
- Test dat cleaning altijd gebeurt
- Test individuele cleaning rules
- Test performance (<50ms)

### Integration Tests
- Test cleaning in orchestrator flow
- Test dat vuile tekst nooit output wordt

## Definitie van Gereed

- [ ] `enable_cleaning` flag volledig verwijderd
- [ ] Cleaning service draait ALTIJD
- [ ] Configureerbare cleaning rules geïmplementeerd
- [ ] Performance <50ms per cleaning operatie
- [ ] Tests aangepast zonder flag dependencies
- [ ] Documentatie over cleaning rules bijgewerkt

## Impact Analyse

### Positief
- **Consistentie**: Alle output consistent geformatteerd
- **Kwaliteit**: Geen vuile tekst meer mogelijk
- **Simpliciteit**: Minder conditional logic

### Risico's
- **Performance**: Extra processing (mitigatie: <50ms target)
- **Backwards Compatibility**: Code die cleaning uitschakelde werkt niet meer

## Dependencies

- CleaningService moet stabiel zijn
- Performance monitoring voor cleaning operations

---

*Deze story verbetert output consistentie*