---
id: US-443
epic: EPIC-026
titel: SessionStateManager Opsplitsen naar DTO-Adapters
type: refactor
status: Nog te bepalen
prioriteit: HOOG
story_points: 5
sprint: backlog
owner: code-architect
applies_to: definitie-app@current
canonical: false
last_verified: 2025-10-03
vereisten:
  - REQ-091
---

# US-443: SessionStateManager Opsplitsen naar DTO-Adapters

## Gebruikersverhaal
**Als** architect  
**wil ik** de huidige `SessionStateManager`-godclass vervangen door expliciete DTO's en adapters  
**zodat** we de applicatie stateless kunnen maken tijdens de rebuild.

## Acceptatiecriteria
- [ ] Alle businesskritische session-state keys zijn gedocumenteerd in een schema (input, type, default).  
- [ ] Nieuwe DTO's (`GenerationOptions`, `DefinitionDraft`, `ContextSnapshot`, ...) vervangen directe dictionary-toegang.  
- [ ] UI/componenten roepen een adapter aan in plaats van direct `st.session_state`.  
- [ ] Unit-tests dekken serialisatie/deserialisatie en backwards-compatibiliteit.

## Technische Context
- Bron: `src/ui/session_state.py`.  
- Bestaande DEFAULT_VALUES-list bevat 40+ sleutel.  
- Vereist nauwe samenwerking met US-441/US-442 om flowdata te leveren aan services.

## Implementatiestappen
- Inventarisatie en classificatie (UI-only vs business).  
- Ontwerp DTO-structuren + conversielaag.  
- Refactor callers om adapter te gebruiken.  
- Documenteer migratiepad richting API.

## Teststrategie
- Unit-tests voor adapter (set/get/clear).  
- Regressiontests op UI-flows om te valideren dat defaults behouden blijven.  
- Snapshot van session state voor/na refactor vergelijken.

## Risico's en Mitigatie
- **Risico:** vergeten statekeys → **Mitigatie:** lint/checklist bij PR.  
- **Risico:** UI regressies → **Mitigatie:** integratietests die UI-scenario's afspelen.  
- **Risico:** performance overhead → **Mitigatie:** DTO's licht houden en caching toepassen.

## Definition of Done
- [ ] DTO-structuren beschikbaar en gebruikt.  
- [ ] Documentatie bijgewerkt in responsibility maps.  
- [ ] Tests en QA akkoord.  
- [ ] Geen directe `SessionStateManager.`-calls meer in businesskritische delen.
