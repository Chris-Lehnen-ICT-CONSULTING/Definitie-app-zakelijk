---
id: US-447
epic: EPIC-026
titel: RegenerationService State Externaliseren
type: refactor
status: Nog te bepalen
prioriteit: HOOG
story_points: 5
sprint: backlog
owner: code-architect
applies_to: definitie-app@current
canonical: false
last_verified: 2025-10-03
vereisten:
  - REQ-091
---

# US-447: RegenerationService State Externaliseren

## Gebruikersverhaal
**Als** architect  
**wil ik** dat `RegenerationService` zijn context kan serialiseren/deserialiseren naar een persistente laag  
**zodat** regeneratie tijdens de rebuild in een stateless backend kan draaien.

## Acceptatiecriteria
- [ ] `RegenerationService` biedt methodes om context op te slaan en op te vragen via een contract (bijv. repository of cache).  
- [ ] Feedback/opbouw van prompts gebeurt via pure functies zonder directe UI afhankelijkheid.  
- [ ] Unit-tests dekken round-trip (set → persist → restore).  
- [ ] Documentatie beschrijft hoe context gedeeld wordt tussen UI/API.

## Technische Context
- Bron: `src/services/regeneration_service.py`.  
- Huidige implementatie bewaart `_active_context` in memory en voegt feedback samen met prompts.  
- Must align met US-442.

## Implementatiestappen
- Definieer opslaginterface (`RegenerationContextStore`).  
- Refactor service om store te gebruiken (in-memory default).  
- Splits promptverrijking uit in pure functie.  
- Update regeneratiedocumentatie.

## Teststrategie
- Unit-tests voor store-implementaties + fallback.  
- Integratietest met workflowservice (US-442) om regressies te voorkomen.  
- Serialisatie test (JSON/YAML) voor rebuild migratie.

## Risico's en Mitigatie
- **Risico:** contextverlies → **Mitigatie:** fail-safe opslaan + logging.  
- **Risico:** inconsistentie met UI → **Mitigatie:** gezamenlijke contract review.  
- **Risico:** performance → **Mitigatie:** in-memory cache + optionele persist layer.

## Definition of Done
- [ ] Service gebruikt externe store + pure promptfuncties.  
- [ ] Tests en documentatie geüpdatet.  
- [ ] QA bevestigt gelijkwaardige regeneratie-output.  
- [ ] Integratie met workflowservice gevalideerd.
