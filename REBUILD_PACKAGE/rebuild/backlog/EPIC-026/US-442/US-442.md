---
id: US-442
epic: EPIC-026
titel: Regeneratie Orchestrator Service Loskoppelen
type: refactor
status: Nog te bepalen
prioriteit: HOOG
story_points: 8
sprint: backlog
owner: code-architect
applies_to: definitie-app@current
canonical: false
last_verified: 2025-10-03
vereisten:
  - REQ-091
---

# US-442: Regeneratie Orchestrator Service Loskoppelen

## Gebruikersverhaal
**Als** platform engineer  
**wil ik** de categorie-regeneratieflow uit `DefinitionGeneratorTab` extraheren naar een zelfstandige orchestratorservice  
**zodat** de rebuild dezelfde state-machine kan hergebruiken zonder Streamlit-afhankelijkheden.

## Acceptatiecriteria
- [ ] Er bestaat een `RegenerationWorkflowService` die alle paden (direct, manual, keep) ondersteunt.  
- [ ] UI-component `definition_generator_tab.py` bevat enkel presentatielogica; regeneratiebusiness beslissingen leven in de service.  
- [ ] Regeneratiecontext (begrip, oude/nieuwe categorie, prompts) kan worden ingesteld en opgehaald zonder reliance op Streamlit session state.  
- [ ] Tests tonen dat categorie-wijzigingen dezelfde output en logging geven als vóór de refactor.

## Technische Context
- Broncode: `src/ui/components/definition_generator_tab.py:2008-2340`.  
- Afhankelijkheden: `RegenerationService`, `WorkflowService`, `SessionStateManager`, `run_async`.  
- Houd rekening met progressbars, navigatie (switch_page) en foutmeldingen.

## Implementatiestappen
- Modelleer situaties en beslisbomen voor categorieverandering.  
- Bouw een servicecontract dat UI events terugkoppelt (progress, status, navigatiesuggestie).  
- Refactor UI naar dunne handlers die service-responses renderen.  
- Update regeneratie-responsibility map.

## Teststrategie
- Unit-tests voor nieuwe service (alle paden + error).  
- Integratietest die categorie-wijziging simuleert en `last_generation_result` vergelijkt met baseline.  
- Regressiontest voor prompts die regeneratiecontext gebruiken.

## Risico's en Mitigatie
- **Risico:** verlies van prompts of context → **Mitigatie:** snapshot van context vóór/na migratie.  
- **Risico:** UI-functionaliteit (progressbars) stuk → **Mitigatie:** mock UI-callbacks en validation.  
- **Risico:** state-leaks → **Mitigatie:** teardown die context wist en tests afdwingt.

## Definition of Done
- [ ] Service + interface gedocumenteerd.  
- [ ] UI-route gebruikt enkel service.  
- [ ] Tests groen.  
- [ ] Architect/QA review akkoord.
