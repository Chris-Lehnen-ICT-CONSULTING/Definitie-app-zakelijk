---
id: US-444
epic: EPIC-026
titel: Voorbeeldenbeheer Service Uitfasering uit Repository
type: refactor
status: Nog te bepalen
prioriteit: HOOG
story_points: 5
sprint: backlog
owner: code-architect
applies_to: definitie-app@current
canonical: false
last_verified: 2025-10-03
vereisten:
  - REQ-091
---

# US-444: Voorbeeldenbeheer Service Uitfasering uit Repository

## Gebruikersverhaal
**Als** backend engineer  
**wil ik** de businesslogica voor voorbeelden (type-normalisatie, voorkeursterm, guards) verplaatsen naar een aparte service  
**zodat** repositorylaag enkel persistence doet en de rebuild de regels kan hergebruiken.

## Acceptatiecriteria
- [ ] Nieuwe `ExamplesService` handelt normalisatie, deduplicatie en voorkeursterm af.  
- [ ] `definitie_repository.py` bevat enkel CRUD-operaties en roept service aan.  
- [ ] Transactiegrenzen zijn duidelijk gedocumenteerd.  
- [ ] Tests dekken alle voorbeeldtypen en een voorkeurstermscenario.

## Technische Context
- Bron: `src/database/definitie_repository.py:1368-1788`.  
- Complexe mapping van invoerlabels naar canonical waarden (sentence/practical/counter etc.).  
- Voorbeelddata wordt gebruikt door US-441/US-442 flows.

## Implementatiestappen
- Modelleer service-interface (opslaan, bijwerken, verwijderen, beoordelen).  
- Verplaats businesslogica naar service en injecteer in repository.  
- Documenteer exceptions en logging.  
- Update architectuurdiagrammen.

## Teststrategie
- Unit-tests voor service (normalisatie, guards, voorkeursterm).  
- Integratietest met repository om DB-transacties te valideren.  
- Golden dataset om regressies te detecteren.

## Risico's en Mitigatie
- **Risico:** verlies van voorkeursterm → **Mitigatie:** testcases met voorkeursterm + bestaande data.  
- **Risico:** inconsistent schema → **Mitigatie:** contracttests met repository.  
- **Risico:** transacties falen → **Mitigatie:** rollbacktests en logging.

## Definition of Done
- [ ] Service in gebruik door UI/services.  
- [ ] Tests groen.  
- [ ] Documentatie geüpdatet.  
- [ ] QA verifieert opslaan/aanpassen/verwijderen flow.
