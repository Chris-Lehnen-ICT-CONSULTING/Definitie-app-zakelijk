---
id: US-171
epic: EPIC-010
titel: Services async-only enforcement (verwijder sync-bridges)
type: refactor
status: open
prioriteit: HIGH
story_points: 5
sprint: 2025-09
owner: platform-team
applies_to: definitie-app@current
canonical: false
last_verified: 2025-10-02
---

# US-171: Services async-only enforcement (verwijder sync-bridges)

Doel: alle service-API's zijn async-only; geen event-loop bridging in services.

## Scope
- Verwijder sync wrappers en thread/event-loop constructies uit:
  - `src/services/service_factory.py` (genereer_definitie)
  - `src/services/prompts/prompt_service_v2.py` (sync prompt wrapper)
  - `src/services/export_service.py` (validatiegate sync pad)
  - `src/services/definition_edit_service.py` (interne async-bridge)
- UI roept services via `ui/helpers/async_bridge.py` waar sync nodig is.

## Acceptatiecriteria
- `rg -n "(asyncio\.run|run_coroutine_threadsafe|new_event_loop|run_until_complete)" src/services` → 0 matches
- Alle publieke service-methoden die door UI gebruikt worden zijn async.
- End-to-end generatie, validatie en export werken via async paden.

## Taken
1) Markeer bestaande sync-methoden tijdelijk met `NotImplementedError` om callsites te vinden.
2) Pas UI-calls aan naar `ui/helpers/async_bridge.py` waar nodig.
3) Verwijder sync wrappers en thread/event-loop code; gebruik evt. `asyncio.to_thread` voor echte sync-lib calls.
4) Update docstrings en READMEs die sync-paden refereren.

## Testplan
- Unit: services acceptatie regex-test op verboden patronen.
- Unit: `ExportService` validatiegate werkt async; blokkeert bij `is_acceptable=False` met duidelijke foutmelding.
- Integratie: UI smoke voor generate→validate→export via async.

## Risks & Mitigatie
- Breukrisico in UI/tests → gefaseerde cutover met `NotImplementedError` + gerichte smoke-tests.

