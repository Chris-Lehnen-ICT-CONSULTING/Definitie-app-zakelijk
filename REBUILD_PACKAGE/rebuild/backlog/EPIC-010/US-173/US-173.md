---
id: US-173
epic: EPIC-010
titel: CI-gates uitbreiden en scope fixen (legacy/laaggrenzen/async)
type: infra
status: open
prioriteit: HIGH
story_points: 3
sprint: 2025-09
owner: devex-team
applies_to: definitie-app@current
canonical: false
last_verified: 2025-10-02
---

# US-173: CI-gates uitbreiden en scope fixen (legacy/laaggrenzen/async)

Doel: CI voorkomt regressies op async-only services en UI-laaggrenzen, zonder false positives.

## Scope
- Gate: faal op `run_coroutine_threadsafe|new_event_loop|run_until_complete` in `src/services/**`.
- Gate: faal op `import streamlit` en `from ui.|import ui` buiten `src/ui/**` (excl. `src/main.py`).
- Gate: restrict `best_iteration` tot demo-tab; elders geblokkeerd.
- Fix: “deprecated attributes” gate scope/allowlist zodat UI metrics/legacy-demo niet valse failures geeft.

## Acceptatiecriteria
- Nieuwe gates aanwezig in workflow(s) en actief (PRs falen bij overtreding).
- Bestaande code passeert na bijbehorende refactors (US-171/US-172/US-179).

## Taken
1) Update `.github/workflows/epic-010-gates.yml` met extra rg-checks en allowlists.
2) Voeg aparte job toe voor laaggrenzen-checks (UI/Streamlit imports).
3) Documenteer gates in README (korte sectie).

## Testplan
- Simuleer overtreding in tijdelijke branch (lokale run) → gate faalt.
- Normale run in main branch → gates groen.
