---
id: US-323
epic: EPIC-002
status: open
prioriteit: MEDIUM
story_points: 8
sprint: next
owner: frontend
applies_to: definitie-app@current
canonical: false
last_verified: 2025-10-02
created_at: 2025-09-19
dependencies: [US-193, US-321]
---

# US-323 â€” CreÃ«er ValidationDisplayHelper Class voor UI Consistency

## Doel
Centraliseer alle validation display logica in een herbruikbare helper class om consistente weergave van validatie resultaten door de hele UI te garanderen.

## Context
Uit de US-193 multi-agent review (P3-15) blijkt dat validation display logica verspreid is over meerdere UI componenten met inconsistente formatting, kleuren en berichten. Dit leidt tot een verwarrende gebruikerservaring.

## Scope

### In scope
- CreÃ«er `ValidationDisplayHelper` class met alle display logica
- Unificeer severity kleuren en icons
- Standaardiseer validation message formatting
- Centraliseer score visualisatie logica
- Implementeer responsive validation summaries
- Voeg i18n support voor validation messages

### Niet in scope
- Streamlit component redesign
- Custom CSS framework
- Validation business logic (alleen display)

## Acceptance Criteria

### Functioneel
- [ ] Consistente kleuren voor severity levels (high=red, medium=orange, low=yellow)
- [ ] Uniforme icons voor validation states
- [ ] Standaard formatting voor alle validation messages
- [ ] Score visualisatie consistent (progress bars, percentages)
- [ ] Tooltips met uitleg over validation rules

### Technisch
- [ ] Single `ValidationDisplayHelper` class
- [ ] Alle UI componenten gebruiken de helper
- [ ] Geen duplicate display logic meer
- [ ] Type-safe interfaces (gebruik US-321 types)
- [ ] Unit tests voor alle display methods

## Implementatie

### 1. ValidationDisplayHelper Class
```python
# src/ui/helpers/validation_display_helper.py
from typing import Dict, List, Optional, Tuple
from dataclasses import dataclass
import streamlit as st

@dataclass
class SeverityConfig:
    """Configuration for severity display."""
    color: str
    icon: str
    bg_color: str
    text_style: str

class ValidationDisplayHelper:
    """Centralized helper for consistent validation display."""

    # Severity configurations
    SEVERITY_CONFIGS = {
        "high": SeverityConfig(
            color="#FF4B4B",
            icon="ðŸ”´",
            bg_color="#FFE6E6",
            text_style="color: #D32F2F; font-weight: bold;"
        ),
        "medium": SeverityConfig(
            color="#FFA726",
            icon="ðŸŸ ",
            bg_color="#FFF3E0",
            text_style="color: #F57C00; font-weight: medium;"
        ),
        "low": SeverityConfig(
            color="#FFEB3B",
            icon="ðŸŸ¡",
            bg_color="#FFFDE7",
            text_style="color: #F9A825;"
        )
    }

    # Score thresholds and colors
    SCORE_THRESHOLDS = [
        (0.9, "#4CAF50", "Uitstekend"),
        (0.7, "#8BC34A", "Goed"),
        (0.5, "#FFC107", "Voldoende"),
        (0.3, "#FF9800", "Matig"),
        (0.0, "#F44336", "Onvoldoende")
    ]

    @classmethod
    def render_validation_summary(
        cls,
        validation_details: Dict,
        show_details: bool = True
    ) -> None:
        """Render complete validation summary with consistent styling."""
        score = validation_details.get("overall_score", 0.0)
        is_acceptable = validation_details.get("is_acceptable", False)
        violations = validation_details.get("violations", [])

        # Score section
        cls._render_score_section(score, is_acceptable)

        # Statistics
        if show_details:
            cls._render_statistics(validation_details)

        # Violations
        if violations:
            cls._render_violations(violations)
        else:
            st.success("âœ… Geen validatieproblemen gevonden!")

    @classmethod
    def _render_score_section(cls, score: float, is_acceptable: bool) -> None:
        """Render score with visual indicator."""
        color, label = cls.get_score_color_and_label(score)

        col1, col2, col3 = st.columns([2, 3, 1])

        with col1:
            st.metric(
                label="Validatie Score",
                value=f"{score:.1%}",
                delta=label
            )

        with col2:
            st.progress(score, text=f"Score: {score:.1%}")

        with col3:
            if is_acceptable:
                st.success("âœ… Acceptabel")
            else:
                st.error("âŒ Niet acceptabel")

    @classmethod
    def _render_violations(cls, violations: List[Dict]) -> None:
        """Render violations with consistent formatting."""
        st.subheader("ðŸ“‹ Validatieproblemen")

        # Group by severity
        grouped = cls._group_violations_by_severity(violations)

        for severity in ["high", "medium", "low"]:
            if severity in grouped:
                cls._render_severity_group(severity, grouped[severity])

    @classmethod
    def _render_severity_group(
        cls,
        severity: str,
        violations: List[Dict]
    ) -> None:
        """Render a group of violations with same severity."""
        config = cls.SEVERITY_CONFIGS[severity]

        with st.expander(
            f"{config.icon} {severity.title()} ({len(violations)})",
            expanded=(severity == "high")
        ):
            for violation in violations:
                cls._render_single_violation(violation, config)

    @classmethod
    def _render_single_violation(
        cls,
        violation: Dict,
        config: SeverityConfig
    ) -> None:
        """Render single violation with styling."""
        st.markdown(
            f"""
            <div style="
                padding: 10px;
                margin: 5px 0;
                background-color: {config.bg_color};
                border-left: 4px solid {config.color};
                border-radius: 4px;
            ">
                <div style="{config.text_style}">
                    {violation.get('rule_id', 'UNKNOWN')}
                </div>
                <div style="margin-top: 5px;">
                    {violation.get('description', 'Geen beschrijving')}
                </div>
                {cls._format_suggestion(violation.get('suggestion'))}
            </div>
            """,
            unsafe_allow_html=True
        )

    @classmethod
    def _format_suggestion(cls, suggestion: Optional[str]) -> str:
        """Format suggestion text if present."""
        if not suggestion:
            return ""
        return f"""
            <div style="
                margin-top: 8px;
                padding-top: 8px;
                border-top: 1px solid #DDD;
                font-style: italic;
                color: #666;
            ">
                ðŸ’¡ Suggestie: {suggestion}
            </div>
        """

    @classmethod
    def format_violation_message(
        cls,
        violation: Dict,
        include_suggestion: bool = True
    ) -> str:
        """Format violation message for display."""
        parts = [
            f"**{violation.get('rule_id', 'UNKNOWN')}**: ",
            violation.get('description', 'Geen beschrijving')
        ]

        if include_suggestion and violation.get('suggestion'):
            parts.append(f"\nðŸ’¡ *{violation['suggestion']}*")

        return "".join(parts)

    @classmethod
    def get_score_color_and_label(cls, score: float) -> Tuple[str, str]:
        """Get color and label for score value."""
        for threshold, color, label in cls.SCORE_THRESHOLDS:
            if score >= threshold:
                return color, label
        return "#F44336", "Onvoldoende"

    @classmethod
    def render_score_badge(cls, score: float) -> None:
        """Render a score badge with color coding."""
        color, label = cls.get_score_color_and_label(score)
        st.markdown(
            f"""
            <span style="
                background-color: {color};
                color: white;
                padding: 4px 12px;
                border-radius: 20px;
                font-weight: bold;
            ">
                {score:.0%} - {label}
            </span>
            """,
            unsafe_allow_html=True
        )

    @classmethod
    def _group_violations_by_severity(
        cls,
        violations: List[Dict]
    ) -> Dict[str, List[Dict]]:
        """Group violations by severity level."""
        grouped = {}
        for violation in violations:
            severity = violation.get('severity', 'low')
            if severity not in grouped:
                grouped[severity] = []
            grouped[severity].append(violation)
        return grouped

    @classmethod
    def _render_statistics(cls, validation_details: Dict) -> None:
        """Render validation statistics."""
        violations = validation_details.get("violations", [])
        passed_rules = validation_details.get("passed_rules", [])

        col1, col2, col3 = st.columns(3)

        with col1:
            st.metric("Totaal Regels", len(violations) + len(passed_rules))

        with col2:
            st.metric("Geslaagd", len(passed_rules), delta="âœ…")

        with col3:
            st.metric("Gefaald", len(violations), delta="âš ï¸" if violations else "âœ…")
```

### 2. Integration in UI Components
```python
# src/ui/components/definition_generator_tab.py
from ui.helpers.validation_display_helper import ValidationDisplayHelper

def render_validation_results(validation_details: dict) -> None:
    """Render validation results using centralized helper."""
    # Replace all custom display logic with:
    ValidationDisplayHelper.render_validation_summary(
        validation_details,
        show_details=st.checkbox("Toon details", value=True)
    )

def show_validation_score(score: float) -> None:
    """Show validation score badge."""
    ValidationDisplayHelper.render_score_badge(score)
```

### 3. Customization Support
```python
# src/ui/helpers/validation_theme.py
from dataclasses import dataclass
from typing import Dict

@dataclass
class ValidationTheme:
    """Theme configuration for validation display."""
    severity_configs: Dict[str, SeverityConfig]
    score_thresholds: List[Tuple[float, str, str]]
    locale: str = "nl"

    @classmethod
    def default(cls) -> "ValidationTheme":
        """Get default theme."""
        return cls(
            severity_configs=ValidationDisplayHelper.SEVERITY_CONFIGS,
            score_thresholds=ValidationDisplayHelper.SCORE_THRESHOLDS
        )

    @classmethod
    def high_contrast(cls) -> "ValidationTheme":
        """Get high contrast theme for accessibility."""
        # ... modified colors for better contrast
        pass
```

## Migration Plan

### Phase 1: Create Helper (Day 1)
- Implement ValidationDisplayHelper class
- Unit tests for all methods

### Phase 2: Replace in Components (Day 2-3)
- Update definition_generator_tab.py
- Update validation results components
- Update export displays

### Phase 3: Remove Duplicates (Day 4)
- Remove old display logic
- Clean up redundant formatting code

### Phase 4: Enhancement (Day 5)
- Add theming support
- Implement i18n
- Add accessibility features

## Test Strategy

```python
# tests/unit/test_validation_display_helper.py
def test_severity_config():
    """Test severity configurations are complete."""
    for severity in ["high", "medium", "low"]:
        config = ValidationDisplayHelper.SEVERITY_CONFIGS[severity]
        assert config.color
        assert config.icon
        assert config.bg_color

def test_score_thresholds():
    """Test score thresholds cover full range."""
    helper = ValidationDisplayHelper()
    assert helper.get_score_color_and_label(1.0)[1] == "Uitstekend"
    assert helper.get_score_color_and_label(0.0)[1] == "Onvoldoende"

def test_violation_formatting():
    """Test violation message formatting."""
    violation = {
        "rule_id": "TEST-01",
        "description": "Test description",
        "suggestion": "Test suggestion"
    }
    message = ValidationDisplayHelper.format_violation_message(violation)
    assert "TEST-01" in message
    assert "Test description" in message
```

## Metrics

### Before
- Display logic locations: 15+ files
- Inconsistent severity colors: Yes
- Code duplication: ~500 lines
- UI consistency issues: 10+

### After
- Display logic locations: 1 file
- Consistent severity colors: Yes
- Code duplication: 0 lines
- UI consistency issues: 0

## Dependencies
- Streamlit 1.28+
- Python 3.11+
- US-321 (ValidationDetailsDict types)

## Notities
- P3-15 uit US-193 multi-agent review
- Consider component library later
- Coordinate met UX team voor styling
- Support dark mode in future

## Links
- [Streamlit Components](https://docs.streamlit.io/library/components)
- [Material Design Colors](https://material.io/design/color)
- Parent: US-193