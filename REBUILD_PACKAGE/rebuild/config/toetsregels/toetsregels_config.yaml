# Validation Rules System Configuration
# Purpose: Configuration for the validation rules (toetsregels) system
version: "1.0"
created: "2025-10-02"
description: "Configuration for validation rules loading, priority ordering, and category weights"

# Rules loading configuration
loading:
  auto_load: true
  load_on_startup: true
  lazy_load: false

  # Dual format support (JSON + Python)
  formats:
    json:
      enabled: true
      path: "src/toetsregels/regels"
      pattern: "*.json"
      required_fields:
        - "id"
        - "naam"
        - "uitleg"
        - "prioriteit"

    python:
      enabled: true
      path: "src/toetsregels/regels"
      pattern: "*.py"
      base_class: "ToetsregelBase"

  # Consistency checks
  consistency:
    require_both_formats: true
    validate_on_load: true
    check_id_match: true
    check_metadata_sync: true

# Rule categories
categories:
  ARAI:
    label: "AI-Afgeleid"
    description: "Derived AI rules from ASTRA recommendations"
    weight: 1.0
    priority: 1
    color: "#FF6B6B"
    rules:
      - "ARAI-01"
      - "ARAI-02"
      - "ARAI-02SUB1"
      - "ARAI-02SUB2"
      - "ARAI-03"
      - "ARAI-04"
      - "ARAI-04SUB1"
      - "ARAI-05"
      - "ARAI-06"

  CON:
    label: "Consistentie"
    description: "Consistency rules (begrip occurrence, term usage)"
    weight: 1.0
    priority: 2
    color: "#4ECDC4"
    rules:
      - "CON-01"
      - "CON-02"

  ESS:
    label: "EssentiÃ«le Structuur"
    description: "Essential structure rules (definition structure, genre checks)"
    weight: 1.0
    priority: 3
    color: "#95E1D3"
    rules:
      - "ESS-01"
      - "ESS-02"
      - "ESS-03"
      - "ESS-04"
      - "ESS-05"

  INT:
    label: "Integriteit"
    description: "Integrity rules (forbidden words, abbreviations, redundancy)"
    weight: 0.9
    priority: 4
    color: "#F9CA24"
    rules:
      - "INT-01"
      - "INT-02"
      - "INT-03"
      - "INT-04"
      - "INT-06"
      - "INT-07"
      - "INT-08"
      - "INT-09"

  SAM:
    label: "Samenstelling"
    description: "Composition rules (sentence count, length, bullet points)"
    weight: 0.8
    priority: 5
    color: "#6C5CE7"
    rules:
      - "SAM-01"
      - "SAM-04"
      - "SAM-05"
      - "SAM-06"
      - "SAM-07"
      - "SAM-08"

  STR:
    label: "Structuur"
    description: "Structure rules (bullets, lists, formatting)"
    weight: 0.7
    priority: 6
    color: "#A29BFE"
    rules:
      - "STR-01"
      - "STR-02"
      - "STR-03"
      - "STR-04"
      - "STR-05"
      - "STR-06"
      - "STR-07"
      - "STR-08"
      - "STR-09"
      - "STR-ORG-001"
      - "STR-TERM-001"

  VER:
    label: "Verificatie"
    description: "Verification rules (length adequacy, completeness)"
    weight: 1.0
    priority: 7
    color: "#74B9FF"
    rules:
      - "VER-01"

  DUP:
    label: "Duplicaten"
    description: "Duplicate detection"
    weight: 1.0
    priority: 8
    color: "#FD79A8"
    rules:
      - "DUP-01"

# Priority ordering
priority:
  levels:
    high:
      weight: 1.0
      blocking: false
      categories: ["ARAI", "CON", "ESS", "VER"]

    medium:
      weight: 0.8
      blocking: false
      categories: ["INT", "SAM"]

    low:
      weight: 0.5
      blocking: false
      categories: ["STR", "DUP"]

  # Execution order
  execution_order: "category_priority"  # category_priority, rule_priority, alphabetical

# Scoring configuration
scoring:
  algorithm: "weighted_average"
  description: "Calculate weighted average of all rule scores"

  weights:
    by_priority:
      high: 1.0
      medium: 0.8
      low: 0.5

    by_category:
      ARAI: 1.0
      CON: 1.0
      ESS: 1.0
      INT: 0.9
      SAM: 0.8
      STR: 0.7
      VER: 1.0
      DUP: 1.0

  # Score thresholds
  thresholds:
    excellent: 0.95
    good: 0.85
    acceptable: 0.75
    poor: 0.65
    failing: 0.50

  # Ignore baseline internal rules in scoring
  exclude_from_scoring:
    - "VAL-EMP-001"  # Empty check
    - "VAL-LEN-001"  # Min length
    - "VAL-LEN-002"  # Max length
    - "ESS-CONT-001"  # Context check
    - "CON-CIRC-001"  # Circularity
    - "STR-TERM-001"  # Term structure
    - "STR-ORG-001"   # Organization structure

# Validation execution settings
execution:
  parallel: false
  timeout_per_rule_ms: 500
  stop_on_critical: false
  max_retries: 0

  # Error handling
  error_handling:
    strategy: "continue"  # continue, stop, skip_category
    log_errors: true
    return_partial_results: true

# Rule caching
caching:
  enabled: true
  cache_rule_metadata: true
  cache_rule_instances: true
  ttl_seconds: 3600

# Rule validation on load
validation:
  validate_on_load: true
  checks:
    - "id_format"
    - "required_fields"
    - "python_class_exists"
    - "json_python_consistency"

  # Rule ID format validation
  id_format:
    pattern: "^[A-Z]+-[0-9]{2}(SUB[0-9])?$"
    examples:
      - "ARAI-01"
      - "ARAI-02SUB1"
      - "CON-01"

# Generation hints configuration
generation_hints:
  enabled: true
  include_in_prompts: true
  max_hints_per_rule: 5

  # Hint templates
  templates:
    structure: "STRUCTUUR: {hint}"
    content: "INHOUD: {hint}"
    style: "STIJL: {hint}"
    avoid: "VERMIJD: {hint}"

# Rule dependencies
dependencies:
  track_dependencies: true
  validate_order: true

  # Known dependencies
  rules:
    "SAM-01":
      requires: []
      conflicts: []

    "DUP-01":
      requires:
        - "repository"  # Needs database access

# ASTRA compliance
astra:
  enabled: true
  track_compliance: true
  require_astra_links: false

  # ASTRA reference format
  reference_format: "https://astra.justis.nl/..."

# Reporting configuration
reporting:
  generate_reports: true
  report_format: "markdown"

  # What to include in reports
  include:
    - "rule_id"
    - "category"
    - "priority"
    - "result"
    - "score"
    - "message"
    - "reasoning"

# Testing configuration
testing:
  enable_test_mode: false
  test_data_path: "tests/fixtures/validation"

  # Test against baseline
  baseline:
    enabled: true
    definitions_count: 42
    definitions_file: "data/baseline/42_definitions.json"

# Environment-specific overrides
overrides:
  development:
    execution:
      parallel: false
      timeout_per_rule_ms: 1000
    validation:
      validate_on_load: true
    caching:
      ttl_seconds: 300  # 5 minutes in dev
    reporting:
      generate_reports: true

  production:
    execution:
      parallel: false  # Keep sequential for consistency
      timeout_per_rule_ms: 300
      stop_on_critical: false
    caching:
      ttl_seconds: 7200  # 2 hours in prod
    reporting:
      generate_reports: false  # Don't generate in prod

  testing:
    execution:
      timeout_per_rule_ms: 5000  # More time in tests
    caching:
      enabled: false  # Disable cache in tests
    testing:
      enable_test_mode: true
