<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DefinitieAgent 2.1 - Architectuur Visualisatie</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 40px 0;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 20px;
            margin-bottom: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            position: relative;
        }
        
        .version-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #8892b0;
        }
        
        .new-features {
            background: #16213e;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0 40px;
            border-left: 4px solid #00d4ff;
        }
        
        .new-features h3 {
            color: #00d4ff;
            margin-bottom: 10px;
        }
        
        .new-features ul {
            list-style: none;
            padding-left: 20px;
        }
        
        .new-features li:before {
            content: "‚ú® ";
            color: #00d4ff;
        }
        
        .tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
            background: #1a1a2e;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }
        
        .tab {
            padding: 12px 24px;
            background: #16213e;
            border: none;
            color: #8892b0;
            cursor: pointer;
            border-radius: 10px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .tab.new {
            background: linear-gradient(45deg, #16213e, #1a3365);
            border: 1px solid #00d4ff;
        }
        
        .tab.new::after {
            content: "NEW";
            position: absolute;
            top: -5px;
            right: -5px;
            background: #00d4ff;
            color: #0a0a0a;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .tab:before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            transition: left 0.3s ease;
            z-index: -1;
        }
        
        .tab:hover {
            color: #ffffff;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,212,255,0.3);
        }
        
        .tab:hover:before {
            left: 0;
        }
        
        .tab.active {
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            color: #ffffff;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0,212,255,0.5);
        }
        
        .content {
            background: #1a1a2e;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            min-height: 600px;
        }
        
        .diagram-container {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .diagram-container.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .diagram-wrapper {
            background: #0f1419;
            border-radius: 15px;
            padding: 20px;
            overflow-x: auto;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .mermaid {
            text-align: center;
            margin: 0 auto;
        }
        
        .diagram-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #00d4ff;
            text-align: center;
        }
        
        .diagram-description {
            background: #16213e;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 4px solid #00d4ff;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 25px;
            padding: 20px;
            background: #16213e;
            border-radius: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 5px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .stat-card {
            background: #16213e;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,212,255,0.2);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #00d4ff;
        }
        
        .stat-label {
            color: #8892b0;
            margin-top: 5px;
        }
        
        /* Mermaid diagram styling */
        .mermaid svg {
            max-width: 100%;
            height: auto;
        }
        
        /* Custom scrollbar */
        .diagram-wrapper::-webkit-scrollbar {
            height: 8px;
        }
        
        .diagram-wrapper::-webkit-scrollbar-track {
            background: #0f1419;
            border-radius: 4px;
        }
        
        .diagram-wrapper::-webkit-scrollbar-thumb {
            background: #00d4ff;
            border-radius: 4px;
        }
        
        .diagram-wrapper::-webkit-scrollbar-thumb:hover {
            background: #0099cc;
        }
    </style>
    <script>
        // Initialize Mermaid
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'dark',
            themeVariables: {
                darkMode: true,
                background: '#0a0a0a',
                primaryColor: '#00d4ff',
                primaryTextColor: '#fff',
                primaryBorderColor: '#0099cc',
                lineColor: '#5a5a5a',
                secondaryColor: '#1a1a2e',
                tertiaryColor: '#16213e',
                mainBkg: '#1a1a2e',
                secondBkg: '#16213e',
                tertiaryBkg: '#0f1419',
                primaryBkg: '#00d4ff',
                textColor: '#ffffff',
                nodeTextColor: '#ffffff',
                fontSize: '16px'
            }
        });

        // Tab switching function with debugging
        function showDiagram(diagramId) {
            console.log('Switching to diagram:', diagramId);
            
            // Hide all diagrams
            const diagrams = document.querySelectorAll('.diagram-container');
            console.log('Found diagrams:', diagrams.length);
            diagrams.forEach(d => {
                d.classList.remove('active');
                console.log('Hiding:', d.id);
            });
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(t => t.classList.remove('active'));
            
            // Show selected diagram
            const targetDiagram = document.getElementById(diagramId);
            if (targetDiagram) {
                targetDiagram.classList.add('active');
                console.log('Showing diagram:', diagramId);
                console.log('Diagram content preview:', targetDiagram.innerHTML.substring(0, 200) + '...');
            } else {
                console.error('Diagram not found:', diagramId);
                alert('Error: Could not find diagram with id: ' + diagramId);
            }
            
            // Add active class to clicked tab
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            // Re-render Mermaid diagrams after a short delay
            setTimeout(() => {
                if (typeof mermaid !== 'undefined') {
                    mermaid.init(undefined, document.querySelectorAll('.diagram-container.active .mermaid'));
                }
            }, 100);
        }

        // Initialize on page load with debugging
        window.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, initializing...');
            
            // List all diagram containers
            const allDiagrams = document.querySelectorAll('.diagram-container');
            console.log('Available diagrams:');
            allDiagrams.forEach(d => {
                console.log('- ID:', d.id, 'Classes:', d.className);
            });
            
            // Check specifically for database diagram
            const dbDiagram = document.getElementById('database');
            if (dbDiagram) {
                console.log('Database diagram found!');
                console.log('Database diagram HTML length:', dbDiagram.innerHTML.length);
            } else {
                console.error('Database diagram NOT found!');
            }
            
            if (typeof mermaid !== 'undefined') {
                mermaid.init();
            }
        });
    </script>
</head>
<body>
    <div class="container">
        <header>
            <div class="version-badge">v2.1</div>
            <h1>DefinitieAgent 2.1</h1>
            <p class="subtitle">Hybrid Context Enhancement - Architectuur Visualisatie Dashboard</p>
        </header>
        
        <div class="new-features">
            <h3>üöÄ Nieuwe Features in v2.1</h3>
            <ul>
                <li>Document Upload Functionaliteit</li>
                <li>Hybrid Context Verrijking</li>
                <li>Enhanced Web Lookup Integratie</li>
                <li>Document Processing Pipeline</li>
                <li>Intelligente Context Fusie</li>
                <li>Comprehensive Test Infrastructure (Performance, UI, Integration, Security)</li>
                <li>Performance Monitoring & Benchmarks</li>
                <li>Async Security Testing Framework</li>
            </ul>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showDiagram('overview')">üèóÔ∏è Component Overzicht</button>
            <button class="tab" onclick="showDiagram('dataflow')">üîÑ Data Flow</button>
            <button class="tab" onclick="showDiagram('api')">üåê API Structuur</button>
            <button class="tab" onclick="showDiagram('database')">üíæ Database Relaties</button>
            <button class="tab" onclick="showDiagram('deployment')">üöÄ Deployment</button>
            <button class="tab" onclick="showDiagram('cache')">‚ö° Cache & Performance</button>
            <button class="tab" onclick="showDiagram('security')">üîê Security</button>
            <button class="tab" onclick="showDiagram('ai')">ü§ñ AI Integratie</button>
            <button class="tab new" onclick="showDiagram('hybrid')">üîÑ Hybrid Context</button>
            <button class="tab new" onclick="showDiagram('enrichment')">üìä Context Flow</button>
            <button class="tab new" onclick="showDiagram('testing')">üß™ Test Infrastructure</button>
        </div>
        
        <div class="content">
            <!-- Component Overview -->
            <div id="overview" class="diagram-container active">
                <h2 class="diagram-title">Component Overzicht Diagram</h2>
                <div class="diagram-description">
                    <p>Volledig overzicht van alle componenten in de DefinitieAgent 2.1 architectuur, inclusief de nieuwe document processing en hybrid context features.</p>
                </div>
                <div class="diagram-wrapper">
                    <div class="mermaid">
graph TB
    subgraph "üñ•Ô∏è User Interface Layer"
        UI[Streamlit UI]
        TI[Tabbed Interface]
        CTX[Context Selector]
        DGT[Definition Generator Tab]
        ERT[Expert Review Tab]
        HT[History Tab]
        ET[Export Tab]
    end

    subgraph "üß† Business Logic Layer"
        DA[Definitie Agent]
        DG[Definitie Generator]
        DV[Definitie Validator]
        DC[Definitie Checker]
        AI[AI Toetser]
        VB[Voorbeelden Generator]
        DP[Document Processor]
    end

    subgraph "üîß Service Layer"
        DS[Definition Service]
        AS[Async Service]
        WL[Web Lookup Service]
        EX[Export Service]
        DE[Document Extractor]
    end

    subgraph "üíæ Data Layer"
        DR[Definitie Repository]
        DB[(SQLite Database)]
        CH[Cache Manager]
        FS[(File System)]
        DM[Document Metadata Store]
    end

    subgraph "üåê External APIs"
        GPT[OpenAI GPT API]
        WP[Wikipedia API]
        LD[Legal Databases]
        WK[Wiktionary API]
    end

    subgraph "‚öôÔ∏è Infrastructure"
        CF[Config Manager]
        RL[Rate Limiter]
        RES[Resilience Layer]
        LOG[Logging System]
    end

    %% User Interface connections
    UI --> TI
    TI --> CTX
    TI --> DGT
    TI --> ERT
    TI --> HT
    TI --> ET

    %% UI to Business Logic
    DGT --> DC
    DGT --> DA
    DGT --> DP
    ERT --> DR
    HT --> DR
    ET --> EX

    %% Business Logic connections
    DC --> DR
    DA --> DG
    DA --> DV
    DG --> AI
    DG --> VB
    DG --> DP
    AI --> CF
    DP --> DE

    %% Service Layer connections
    DA --> DS
    DG --> AS
    VB --> WL
    DP --> WL
    ET --> EX
    DE --> FS

    %% Data Layer connections
    DS --> DR
    DR --> DB
    AS --> CH
    CH --> FS
    DP --> DM
    DM --> FS

    %% External API connections
    DG --> GPT
    WL --> WP
    WL --> LD
    WL --> WK

    %% Infrastructure connections
    AS --> RL
    AS --> RES
    DS --> LOG
    CF --> LOG

    style UI fill:#e1f5fe
    style DA fill:#f3e5f5
    style DR fill:#e8f5e8
    style GPT fill:#fff3e0
    style CF fill:#fce4ec
    style DP fill:#ffccbc
    style DE fill:#ffccbc
    style DM fill:#ffccbc
                    </div>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #e1f5fe;"></div>
                        <span>User Interface</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #f3e5f5;"></div>
                        <span>Business Logic</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #e8f5e8;"></div>
                        <span>Data Layer</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #fff3e0;"></div>
                        <span>External APIs</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #fce4ec;"></div>
                        <span>Infrastructure</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ffccbc;"></div>
                        <span>Nieuwe v2.1 Componenten</span>
                    </div>
                </div>
            </div>
            
            <!-- Data Flow -->
            <div id="dataflow" class="diagram-container">
                <h2 class="diagram-title">Data Flow - Definitie Generatie met Document Upload</h2>
                <div class="diagram-description">
                    <p>Sequentiediagram dat de complete flow toont van definitie generatie, nu inclusief document upload en hybrid context verrijking.</p>
                </div>
                <div class="diagram-wrapper">
                    <div class="mermaid">
sequenceDiagram
    participant U as User
    participant UI as Streamlit UI
    participant DP as Document Processor
    participant WL as Web Lookup
    participant DC as Definitie Checker
    participant DR as Repository
    participant DA as Definitie Agent
    participant DG as Definitie Generator
    participant GPT as OpenAI API
    participant DV as Definitie Validator
    participant CH as Cache
    participant DB as Database
    participant DM as Document Metadata

    U->>UI: Upload documenten + begrip + context
    
    opt Document Processing
        UI->>DP: process_uploaded_files()
        DP->>DM: extract_text_and_metadata()
        DM-->>DP: extracted_content
        DP->>DP: analyze_keywords_concepts()
        DP->>WL: extract_legal_references()
        WL-->>DP: legal_refs
        DP-->>UI: processed_documents
    end
    
    UI->>DC: generate_with_check()
    
    DC->>DR: check_duplicates()
    DR->>DB: SELECT similar definitions
    DB-->>DR: existing_records
    DR-->>DC: duplicate_check_result
    
    alt No Duplicates Found
        DC->>DA: start_generation()
        
        par Hybrid Context Enrichment
            DA->>DP: get_aggregated_context()
            DP-->>DA: document_context
        and
            DA->>WL: zoek_definitie_combinatie()
            WL-->>DA: web_context
        end
        
        DA->>DG: generate_definition(hybrid_context)
        
        DG->>CH: check_cache()
        CH-->>DG: cache_miss
        
        DG->>GPT: completion_request(enriched_prompt)
        GPT-->>DG: ai_response
        
        DG->>CH: store_result()
        DG-->>DA: generated_definition
        
        DA->>DV: validate_quality()
        DV-->>DA: validation_score
        
        alt Quality Score < Threshold
            DA->>DG: regenerate_with_feedback()
            Note over DA,DG: Iterative improvement loop
        else Quality Score OK
            DA->>DR: save_definition(with_sources)
            DR->>DB: INSERT new definition
            DB-->>DR: saved_record
            DR-->>DA: success
        end
        
        DA-->>DC: generation_result
    else Duplicates Found
        DC-->>UI: duplicate_warning
    end
    
    DC-->>UI: final_result(with_document_attribution)
    UI-->>U: Display enhanced result
                    </div>
                </div>
            </div>
            
            <!-- API Structure -->
            <div id="api" class="diagram-container">
                <h2 class="diagram-title">API Structuur Diagram</h2>
                <div class="diagram-description">
                    <p>Overzicht van alle interne en externe APIs met hun methodes en relaties, inclusief de nieuwe document processing endpoints.</p>
                </div>
                
                <!-- API Cards Grid -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    
                    <!-- Core APIs -->
                    <div style="background: #1e3a5f; border-radius: 15px; padding: 20px; border: 2px solid #2563eb;">
                        <h3 style="color: #60a5fa; margin-bottom: 15px; display: flex; align-items: center;">
                            <span style="background: #2563eb; width: 10px; height: 10px; border-radius: 50%; margin-right: 10px;"></span>
                            Core APIs
                        </h3>
                        
                        <div style="background: #0f1419; border-radius: 10px; padding: 15px; margin-bottom: 10px;">
                            <h4 style="color: #00d4ff; margin-bottom: 8px;">üìã Definition Service</h4>
                            <div style="font-family: monospace; font-size: 0.9rem; color: #8892b0;">
                                <div>GET &nbsp;&nbsp;/api/definitions</div>
                                <div>POST &nbsp;/api/definitions</div>
                                <div>PUT &nbsp;&nbsp;/api/definitions/{id}</div>
                                <div>DELETE /api/definitions/{id}</div>
                            </div>
                        </div>
                        
                        <div style="background: #0f1419; border-radius: 10px; padding: 15px; margin-bottom: 10px;">
                            <h4 style="color: #00d4ff; margin-bottom: 8px;">‚úÖ Validation Service</h4>
                            <div style="font-family: monospace; font-size: 0.9rem; color: #8892b0;">
                                <div>POST /api/validate</div>
                                <div>POST /api/validate/bulk</div>
                                <div>GET &nbsp;/api/validation/rules</div>
                            </div>
                        </div>
                        
                        <div style="background: #0f1419; border-radius: 10px; padding: 15px;">
                            <h4 style="color: #00d4ff; margin-bottom: 8px;">‚ö° Async Service</h4>
                            <div style="font-family: monospace; font-size: 0.9rem; color: #8892b0;">
                                <div>POST /api/async/generate</div>
                                <div>GET &nbsp;/api/async/status/{taskId}</div>
                                <div>POST /api/async/cancel/{taskId}</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Data APIs -->
                    <div style="background: #1e3a5f; border-radius: 15px; padding: 20px; border: 2px solid #10b981;">
                        <h3 style="color: #34d399; margin-bottom: 15px; display: flex; align-items: center;">
                            <span style="background: #10b981; width: 10px; height: 10px; border-radius: 50%; margin-right: 10px;"></span>
                            Data APIs
                        </h3>
                        
                        <div style="background: #0f1419; border-radius: 10px; padding: 15px; margin-bottom: 10px;">
                            <h4 style="color: #00d4ff; margin-bottom: 8px;">üóÑÔ∏è Repository API</h4>
                            <div style="font-family: monospace; font-size: 0.9rem; color: #8892b0;">
                                <div>GET &nbsp;/api/repository/search</div>
                                <div>GET &nbsp;/api/repository/stats</div>
                                <div>POST /api/repository/import</div>
                                <div>POST /api/repository/export</div>
                            </div>
                        </div>
                        
                        <div style="background: #0f1419; border-radius: 10px; padding: 15px; margin-bottom: 10px;">
                            <h4 style="color: #00d4ff; margin-bottom: 8px;">üíæ Cache Manager</h4>
                            <div style="font-family: monospace; font-size: 0.9rem; color: #8892b0;">
                                <div>GET &nbsp;/api/cache/status</div>
                                <div>POST /api/cache/clear</div>
                                <div>GET &nbsp;/api/cache/metrics</div>
                                <div>PUT &nbsp;/api/cache/config</div>
                            </div>
                        </div>
                        
                        <div style="background: #0f1419; border-radius: 10px; padding: 15px;">
                            <h4 style="color: #00d4ff; margin-bottom: 8px;">üìú History Service</h4>
                            <div style="font-family: monospace; font-size: 0.9rem; color: #8892b0;">
                                <div>GET &nbsp;/api/history/{defId}</div>
                                <div>GET &nbsp;/api/history/changes</div>
                                <div>POST /api/history/rollback/{version}</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Integration APIs -->
                    <div style="background: #1e3a5f; border-radius: 15px; padding: 20px; border: 2px solid #f59e0b;">
                        <h3 style="color: #fbbf24; margin-bottom: 15px; display: flex; align-items: center;">
                            <span style="background: #f59e0b; width: 10px; height: 10px; border-radius: 50%; margin-right: 10px;"></span>
                            Integration APIs
                        </h3>
                        
                        <div style="background: #0f1419; border-radius: 10px; padding: 15px; margin-bottom: 10px;">
                            <h4 style="color: #00d4ff; margin-bottom: 8px;">üåê Web Lookup Service</h4>
                            <div style="font-family: monospace; font-size: 0.9rem; color: #8892b0;">
                                <div>GET &nbsp;/api/lookup/wikipedia/{term}</div>
                                <div>GET &nbsp;/api/lookup/wiktionary/{term}</div>
                                <div>GET &nbsp;/api/lookup/legal/{term}</div>
                                <div>POST /api/lookup/batch</div>
                            </div>
                        </div>
                        
                        <div style="background: #0f1419; border-radius: 10px; padding: 15px; margin-bottom: 10px;">
                            <h4 style="color: #00d4ff; margin-bottom: 8px;">ü§ñ AI Integration</h4>
                            <div style="font-family: monospace; font-size: 0.9rem; color: #8892b0;">
                                <div>POST /api/ai/complete</div>
                                <div>POST /api/ai/embeddings</div>
                                <div>GET &nbsp;/api/ai/models</div>
                                <div>GET &nbsp;/api/ai/usage</div>
                            </div>
                        </div>
                        
                        <div style="background: #0f1419; border-radius: 10px; padding: 15px; margin-bottom: 10px;">
                            <h4 style="color: #00d4ff; margin-bottom: 8px;">üìÑ Document Processor <span style="background: #00d4ff; color: #0a0a0a; font-size: 0.7rem; padding: 2px 6px; border-radius: 5px; margin-left: 10px;">v2.1</span></h4>
                            <div style="font-family: monospace; font-size: 0.9rem; color: #8892b0;">
                                <div>POST /api/documents/upload</div>
                                <div>GET &nbsp;/api/documents/{docId}</div>
                                <div>POST /api/documents/process</div>
                                <div>GET &nbsp;/api/documents/context/{defId}</div>
                            </div>
                        </div>
                        
                        <div style="background: #0f1419; border-radius: 10px; padding: 15px;">
                            <h4 style="color: #00d4ff; margin-bottom: 8px;">üí° Example Generator</h4>
                            <div style="font-family: monospace; font-size: 0.9rem; color: #8892b0;">
                                <div>POST /api/examples/generate</div>
                                <div>GET &nbsp;/api/examples/{defId}</div>
                                <div>POST /api/examples/validate</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- External APIs -->
                    <div style="background: #1e3a5f; border-radius: 15px; padding: 20px; border: 2px solid #ef4444;">
                        <h3 style="color: #f87171; margin-bottom: 15px; display: flex; align-items: center;">
                            <span style="background: #ef4444; width: 10px; height: 10px; border-radius: 50%; margin-right: 10px;"></span>
                            External APIs
                        </h3>
                        
                        <div style="background: #0f1419; border-radius: 10px; padding: 15px; margin-bottom: 10px;">
                            <h4 style="color: #00d4ff; margin-bottom: 8px;">üß† OpenAI Services</h4>
                            <div style="font-family: monospace; font-size: 0.9rem; color: #8892b0;">
                                <div>POST /v1/chat/completions (GPT-4)</div>
                                <div>POST /v1/chat/completions (GPT-3.5)</div>
                                <div>POST /v1/embeddings</div>
                            </div>
                        </div>
                        
                        <div style="background: #0f1419; border-radius: 10px; padding: 15px;">
                            <h4 style="color: #00d4ff; margin-bottom: 8px;">üìö Reference Sources</h4>
                            <div style="font-family: monospace; font-size: 0.9rem; color: #8892b0;">
                                <div>Wikipedia API</div>
                                <div>Wiktionary API</div>
                                <div>Wetten.nl API</div>
                                <div>Overheid.nl API</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Connection Flow Diagram -->
                <div class="diagram-wrapper">
                    <div class="mermaid">
graph LR
    subgraph "üéØ Frontend"
        UI[Streamlit UI]
    end
    
    subgraph "üíô Core Services"
        DS[Definition<br/>Service]
        VS[Validation<br/>Service]
        AS[Async<br/>Service]
    end
    
    subgraph "üíö Data Services"
        DR[Repository]
        CM[Cache]
        HS[History]
    end
    
    subgraph "üß° Integration Layer"
        WL[Web Lookup]
        AI[AI Service]
        DP[Documents]
        EG[Examples]
    end
    
    subgraph "üî¥ External"
        GPT[OpenAI]
        REF[Reference<br/>APIs]
    end
    
    subgraph "üíæ Storage"
        DB[(Database)]
        FS[(Files)]
    end
    
    UI ==> DS
    UI ==> VS
    UI ==> AS
    UI ==> DP
    
    DS ==> DR
    DS ==> AI
    DS ==> VS
    DS ==> DP
    
    VS ==> AI
    VS ==> WL
    
    AS ==> CM
    AS ==> DS
    
    DR ==> DB
    DR ==> CM
    
    DP ==> FS
    DP ==> AI
    DP ==> WL
    
    AI ==> GPT
    AI ==> CM
    
    WL ==> REF
    
    EG ==> AI
    EG ==> DR
    
    HS ==> DB
    
    CM ==> FS
    
    style UI fill:#e1f5fe,stroke:#00d4ff,stroke-width:3px
    style DS fill:#2563eb,stroke:#60a5fa,color:#fff
    style VS fill:#2563eb,stroke:#60a5fa,color:#fff
    style AS fill:#2563eb,stroke:#60a5fa,color:#fff
    style DR fill:#10b981,stroke:#34d399,color:#fff
    style CM fill:#10b981,stroke:#34d399,color:#fff
    style HS fill:#10b981,stroke:#34d399,color:#fff
    style WL fill:#f59e0b,stroke:#fbbf24,color:#fff
    style AI fill:#f59e0b,stroke:#fbbf24,color:#fff
    style DP fill:#f59e0b,stroke:#fbbf24,color:#fff
    style EG fill:#f59e0b,stroke:#fbbf24,color:#fff
    style GPT fill:#ef4444,stroke:#f87171,color:#fff
    style REF fill:#ef4444,stroke:#f87171,color:#fff
    style DB fill:#8b5cf6,stroke:#a78bfa,color:#fff
    style FS fill:#8b5cf6,stroke:#a78bfa,color:#fff
                    </div>
                </div>
                
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number">10</div>
                        <div class="stat-label">Interne API Services</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">7</div>
                        <div class="stat-label">Externe APIs</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">50+</div>
                        <div class="stat-label">API Endpoints</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">30+</div>
                        <div class="stat-label">API Verbindingen</div>
                    </div>
                </div>
            </div>
            
            <!-- Database Relations -->
            <div id="database" class="diagram-container">
                <h2 class="diagram-title">Database Relaties Diagram</h2>
                <div class="diagram-description">
                    <p>Entity Relationship Diagram van de complete database structuur, nu inclusief document metadata en source tracking.</p>
                </div>
                
                <!-- Simple Test Content -->
                <div style="background: red; color: white; padding: 50px; text-align: center; font-size: 24px; margin: 20px 0;">
                    TEST - KUN JE DIT ZIEN? DATABASE DIAGRAM TEST
                </div>
                
                <!-- Basic Table List -->
                <div style="background: yellow; color: black; padding: 20px; margin: 20px 0;">
                    <h3>Database Tabellen:</h3>
                    <ul>
                        <li>DEFINITIES (hoofdtabel)</li>
                        <li>DEFINITIE_GESCHIEDENIS</li>
                        <li>DEFINITIE_VOORBEELDEN</li>
                        <li>DEFINITIE_TAGS</li>
                        <li>DOCUMENT_METADATA (v2.1)</li>
                        <li>DOCUMENT_SOURCES (v2.1)</li>
                        <li>IMPORT_EXPORT_LOGS</li>
                        <li>CACHE_METADATA</li>
                    </ul>
                </div>
                
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number">8</div>
                        <div class="stat-label">Database Tabellen</div>
                    </div>
                </div>
            </div>
            
            <!-- Deployment Architecture -->
            <div id="deployment" class="diagram-container">
                <h2 class="diagram-title">Deployment Architectuur</h2>
                <div class="diagram-description">
                    <p>Complete deployment setup voor development, testing en productie omgevingen, inclusief document storage.</p>
                </div>
                <div class="diagram-wrapper">
                    <div class="mermaid">
graph TB
    subgraph "üíª Local Development"
        DEV[Development Environment]
        subgraph "Dev Stack"
            DAPP[Streamlit App :8501]
            DDB[(SQLite Database)]
            DCACHE[File Cache]
            DLOG[Local Logs]
        end
    end

    subgraph "üß™ Testing Environment"
        TEST[Testing Environment]
        subgraph "Test Stack"
            TAPP[Test Streamlit :8502]
            TDB[(Test Database)]
            TCACHE[Test Cache]
            TLOG[Test Logs]
        end
    end

    subgraph "üöÄ Production Environment"
        PROD[Production Environment]
        subgraph "Prod Stack"
            PAPP[Production App :80]
            PDB[(Production Database)]
            PCACHE[Production Cache]
            PLOG[Production Logs]
            PMON[Monitoring]
        end
    end

    subgraph "‚òÅÔ∏è External Services"
        OPENAI[OpenAI API]
        WIKI[Wikipedia API]
        LEGAL[Legal Databases]
        BACKUP[Backup Storage]
    end

    subgraph "üìÅ File System Structure"
        FS[File System]
        subgraph "Directory Structure"
            SRC[/src - Source Code]
            CONF[/config - Configuration]
            DATA[/data - Database Files]
            CACHE_DIR[/cache - Cache Files]
            EXPORT[/exports - Generated Exports]
            LOG_DIR[/log - Application Logs]
            DOC_DIR[/data/uploaded_documents - Document Storage]
        end
    end

    subgraph "‚öôÔ∏è Configuration Management"
        CONFIG[Configuration System]
        subgraph "Config Files"
            YAML_DEF[config_default.yaml]
            YAML_DEV[config_development.yaml]
            YAML_TEST[config_testing.yaml]
            YAML_PROD[config_production.yaml]
            ENV[Environment Variables]
        end
    end

    %% Environment connections
    DEV --> DAPP
    DAPP --> DDB
    DAPP --> DCACHE
    DAPP --> DLOG

    TEST --> TAPP
    TAPP --> TDB
    TAPP --> TCACHE
    TAPP --> TLOG

    PROD --> PAPP
    PAPP --> PDB
    PAPP --> PCACHE
    PAPP --> PLOG
    PAPP --> PMON

    %% External service connections
    DAPP --> OPENAI
    TAPP --> OPENAI
    PAPP --> OPENAI

    DAPP --> WIKI
    TAPP --> WIKI
    PAPP --> WIKI

    DAPP --> LEGAL
    TAPP --> LEGAL
    PAPP --> LEGAL

    PDB --> BACKUP

    %% File system connections
    DAPP --> FS
    TAPP --> FS
    PAPP --> FS

    FS --> SRC
    FS --> CONF
    FS --> DATA
    FS --> CACHE_DIR
    FS --> EXPORT
    FS --> LOG_DIR
    FS --> DOC_DIR

    %% Configuration connections
    DAPP --> CONFIG
    TAPP --> CONFIG
    PAPP --> CONFIG

    CONFIG --> YAML_DEF
    CONFIG --> YAML_DEV
    CONFIG --> YAML_TEST
    CONFIG --> YAML_PROD
    CONFIG --> ENV

    style DEV fill:#e8f5e8
    style TEST fill:#fff3e0
    style PROD fill:#ffebee
    style OPENAI fill:#e3f2fd
    style CONFIG fill:#f3e5f5
    style DOC_DIR fill:#ffccbc
                    </div>
                </div>
            </div>
            
            <!-- Cache & Performance -->
            <div id="cache" class="diagram-container">
                <h2 class="diagram-title">Cache & Performance Architectuur</h2>
                <div class="diagram-description">
                    <p>Performance optimalisatie strategie met caching, rate limiting en resilience patterns.</p>
                </div>
                <div class="diagram-wrapper">
                    <div class="mermaid">
graph TB
    subgraph "üöÄ Performance Layer"
        subgraph "Request Flow"
            REQ[Incoming Request]
            VAL[Input Validation]
            CACHE_CHECK[Cache Check]
            PROC[Process Request]
            CACHE_STORE[Cache Result]
            RESP[Return Response]
        end

        subgraph "üóÑÔ∏è Caching System"
            MEM[Memory Cache]
            FILE[File Cache]
            META[Cache Metadata]
            CLEAN[Cache Cleanup]
        end

        subgraph "‚ö° Rate Limiting"
            RL[Smart Rate Limiter]
            BUCKET[Token Bucket]
            QUOTA[API Quota Manager]
            BACKOFF[Backoff Strategy]
        end

        subgraph "üõ°Ô∏è Resilience"
            CB[Circuit Breaker]
            RETRY[Retry Logic]
            FALLBACK[Fallback Cache]
            DLQ[Dead Letter Queue]
        end
    end

    subgraph "üìä Monitoring"
        METRICS[Performance Metrics]
        HEALTH[Health Checks]
        ALERTS[Alert System]
        DASHBOARD[Monitoring Dashboard]
    end

    %% Request flow
    REQ --> VAL
    VAL --> CACHE_CHECK
    CACHE_CHECK -->|Hit| RESP
    CACHE_CHECK -->|Miss| PROC
    PROC --> CACHE_STORE
    CACHE_STORE --> RESP

    %% Cache system
    CACHE_CHECK --> MEM
    CACHE_CHECK --> FILE
    FILE --> META
    META --> CLEAN

    %% Rate limiting
    PROC --> RL
    RL --> BUCKET
    RL --> QUOTA
    RL --> BACKOFF

    %% Resilience
    PROC --> CB
    CB --> RETRY
    RETRY --> FALLBACK
    FALLBACK --> DLQ

    %% Monitoring
    PROC --> METRICS
    CB --> HEALTH
    HEALTH --> ALERTS
    METRICS --> DASHBOARD

    style REQ fill:#e3f2fd
    style CACHE_CHECK fill:#e8f5e8
    style CB fill:#fff3e0
    style METRICS fill:#f3e5f5
                    </div>
                </div>
            </div>
            
            <!-- Security & Compliance -->
            <div id="security" class="diagram-container">
                <h2 class="diagram-title">Security & Compliance Diagram</h2>
                <div class="diagram-description">
                    <p>Security maatregelen en compliance requirements voor data bescherming.</p>
                </div>
                <div class="diagram-wrapper">
                    <div class="mermaid">
graph TB
    subgraph "üîê Security Layer"
        subgraph "Input Security"
            SANITIZE[Input Sanitization]
            VALIDATE[Input Validation]
            ESCAPE[HTML/SQL Escaping]
        end

        subgraph "API Security"
            API_KEY[API Key Management]
            RATE_LIMIT[Rate Limiting]
            TIMEOUT[Request Timeouts]
        end

        subgraph "Data Security"
            ENCRYPT[Data Encryption]
            BACKUP[Secure Backups]
            AUDIT[Audit Logging]
        end
    end

    subgraph "üìã Compliance"
        GDPR[GDPR Compliance]
        DATA_MIN[Data Minimization]
        RETENTION[Data Retention]
        CONSENT[User Consent]
    end

    subgraph "üîç Monitoring"
        LOG_MON[Security Logging]
        ANOMALY[Anomaly Detection]
        INCIDENT[Incident Response]
    end

    %% Security connections
    SANITIZE --> VALIDATE
    VALIDATE --> ESCAPE
    API_KEY --> RATE_LIMIT
    RATE_LIMIT --> TIMEOUT
    ENCRYPT --> BACKUP
    BACKUP --> AUDIT

    %% Compliance connections
    GDPR --> DATA_MIN
    DATA_MIN --> RETENTION
    RETENTION --> CONSENT

    %% Monitoring connections
    AUDIT --> LOG_MON
    LOG_MON --> ANOMALY
    ANOMALY --> INCIDENT

    style SANITIZE fill:#ffebee
    style API_KEY fill:#e8f5e8
    style GDPR fill:#e3f2fd
    style LOG_MON fill:#fff3e0
                    </div>
                </div>
            </div>
            
            <!-- AI Integration -->
            <div id="ai" class="diagram-container">
                <h2 class="diagram-title">AI Integratie Architectuur</h2>
                <div class="diagram-description">
                    <p>Complete AI service architectuur met GPT modellen, prompt management en de nieuwe document enhancement features.</p>
                </div>
                <div class="diagram-wrapper">
                    <div class="mermaid">
graph TB
    subgraph "ü§ñ AI Services Layer"
        subgraph "Generation Services"
            DEF_GEN[Definition Generator]
            EX_GEN[Example Generator]
            FEEDBACK[Feedback Generator]
        end

        subgraph "Validation Services"
            RULE_VAL[Rule Validator]
            QUALITY[Quality Checker]
            COMPLIANCE[Compliance Checker]
        end

        subgraph "Enhancement Services"
            SYNONYM[Synonym Generator]
            TRANSLATION[Translation Service]
            SUMMARY[Summary Generator]
            DOC_ENHANCE[Document Enhancement]
            HYBRID_CTX[Hybrid Context Builder]
        end
    end

    subgraph "üß† AI Models"
        GPT4[GPT-4 Turbo]
        GPT35[GPT-3.5 Turbo]
        EMBEDDING[Text Embeddings]
        CUSTOM[Custom Models]
    end

    subgraph "üìù Prompt Management"
        TEMPLATES[Prompt Templates]
        CONTEXT[Context Builder]
        OPTIMIZER[Prompt Optimizer]
    end

    subgraph "‚ö° Performance"
        CACHE_AI[AI Response Cache]
        BATCH[Batch Processing]
        ASYNC_AI[Async Processing]
    end

    %% AI Service connections
    DEF_GEN --> GPT4
    EX_GEN --> GPT35
    FEEDBACK --> GPT4
    RULE_VAL --> GPT35
    QUALITY --> GPT4
    COMPLIANCE --> GPT4
    SYNONYM --> GPT35
    TRANSLATION --> GPT4
    SUMMARY --> GPT35
    DOC_ENHANCE --> GPT35
    HYBRID_CTX --> GPT4

    %% Embedding connections
    RULE_VAL --> EMBEDDING
    QUALITY --> EMBEDDING

    %% Prompt management
    DEF_GEN --> TEMPLATES
    TEMPLATES --> CONTEXT
    CONTEXT --> OPTIMIZER

    %% Performance
    DEF_GEN --> CACHE_AI
    EX_GEN --> BATCH
    FEEDBACK --> ASYNC_AI

    style DEF_GEN fill:#e3f2fd
    style GPT4 fill:#ffebee
    style TEMPLATES fill:#e8f5e8
    style CACHE_AI fill:#fff3e0
    style DOC_ENHANCE fill:#ffccbc
    style HYBRID_CTX fill:#ffccbc
                    </div>
                </div>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number">11</div>
                        <div class="stat-label">AI Services</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">4</div>
                        <div class="stat-label">AI Models</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">4</div>
                        <div class="stat-label">Nieuwe v2.1 Services</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">100%</div>
                        <div class="stat-label">Test Coverage voor AI</div>
                    </div>
                </div>
            </div>
            
            <!-- Hybrid Context Architecture (NEW) -->
            <div id="hybrid" class="diagram-container">
                <h2 class="diagram-title">Hybride Context Verrijking Architectuur</h2>
                <div class="diagram-description">
                    <p>Geavanceerde architectuur voor het combineren van document intelligence met web lookup voor optimale context generatie.</p>
                </div>
                <div class="diagram-wrapper">
                    <div class="mermaid">
graph TB
    subgraph "üìÑ Document Processing Pipeline"
        subgraph "Upload & Extraction"
            UP[Document Upload]
            EXT[Text Extraction]
            META[Metadata Analysis]
        end
        
        subgraph "Content Analysis"
            KW[Keyword Extraction]
            CONC[Concept Identification]
            LEG[Legal Reference Detection]
            HINT[Context Hints Generation]
        end
        
        subgraph "Document Intelligence"
            CLASS[Document Classification]
            TOPIC[Topic Modeling]
            REL[Relevance Scoring]
        end
    end

    subgraph "üåê Web Lookup Integration"
        subgraph "Source Selection"
            SMART[Smart Source Selector]
            PRIO[Priority Engine]
            FILTER[Context Filter]
        end
        
        subgraph "Enhanced Lookup"
            WIKI[Wikipedia Enhanced]
            LEGAL_WEB[Legal Databases Enhanced]
            GOV[Government Sources Enhanced]
            DICT[Dictionary Enhanced]
        end
        
        subgraph "Result Enhancement"
            MERGE[Result Merger]
            DEDUP[Deduplication]
            RANK[Relevance Ranking]
        end
    end

    subgraph "üîÑ Hybrid Context Engine"
        subgraph "Context Fusion"
            AGG[Context Aggregator]
            WEIGHT[Weighted Combination]
            VALIDATE[Cross-Validation]
        end
        
        subgraph "Intelligence Layer"
            MATCH[Document-Web Matching]
            CONFLICT[Conflict Resolution]
            CONFIDENCE[Confidence Scoring]
        end
        
        subgraph "Output Generation"
            UNIFIED[Unified Context]
            SOURCES[Source Attribution]
            ENRICHED[Enriched Prompt]
        end
    end

    subgraph "üéØ Definition Generation"
        GPT_ENHANCED[GPT with Hybrid Context]
        QUALITY_CHECK[Enhanced Quality Check]
        RESULT[Enhanced Definition]
    end

    %% Document Processing Flow
    UP --> EXT
    EXT --> META
    META --> KW
    META --> CONC
    META --> LEG
    KW --> HINT
    CONC --> HINT
    LEG --> HINT
    
    %% Document Intelligence
    HINT --> CLASS
    CLASS --> TOPIC
    TOPIC --> REL

    %% Web Lookup Enhancement
    CLASS --> SMART
    TOPIC --> PRIO
    REL --> FILTER
    
    SMART --> WIKI
    SMART --> LEGAL_WEB
    SMART --> GOV
    SMART --> DICT
    
    WIKI --> MERGE
    LEGAL_WEB --> MERGE
    GOV --> MERGE
    DICT --> MERGE
    
    MERGE --> DEDUP
    DEDUP --> RANK

    %% Hybrid Context Generation
    HINT --> AGG
    RANK --> AGG
    AGG --> WEIGHT
    WEIGHT --> VALIDATE
    VALIDATE --> MATCH
    MATCH --> CONFLICT
    CONFLICT --> CONFIDENCE
    CONFIDENCE --> UNIFIED
    UNIFIED --> SOURCES
    SOURCES --> ENRICHED

    %% Final Generation
    ENRICHED --> GPT_ENHANCED
    GPT_ENHANCED --> QUALITY_CHECK
    QUALITY_CHECK --> RESULT

    style UP fill:#e3f2fd
    style SMART fill:#e8f5e8
    style AGG fill:#fff3e0
    style GPT_ENHANCED fill:#ffebee
                    </div>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #e3f2fd;"></div>
                        <span>Document Processing</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #e8f5e8;"></div>
                        <span>Web Lookup</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #fff3e0;"></div>
                        <span>Context Engine</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ffebee;"></div>
                        <span>AI Generation</span>
                    </div>
                </div>
            </div>
            
            <!-- Context Enrichment Flow (NEW) -->
            <div id="enrichment" class="diagram-container">
                <h2 class="diagram-title">Context Enrichment Data Flow</h2>
                <div class="diagram-description">
                    <p>Gedetailleerd sequentiediagram van de complete hybrid context enrichment flow met parallelle processing.</p>
                </div>
                <div class="diagram-wrapper">
                    <div class="mermaid">
sequenceDiagram
    participant U as User
    participant UI as Interface
    participant DP as Document Processor
    participant WE as Web Enhancer
    participant HCE as Hybrid Context Engine
    participant AI as AI Generator
    participant R as Repository

    U->>UI: Upload docs + request definition
    
    par Document Analysis
        UI->>DP: analyze_documents()
        DP->>DP: extract_keywords()
        DP->>DP: identify_concepts()
        DP->>DP: detect_legal_refs()
        DP->>DP: classify_content()
        DP-->>UI: document_intelligence
    and Web Lookup Preparation
        UI->>WE: prepare_enhanced_lookup()
        WE->>WE: select_relevant_sources()
        WE->>WE: prioritize_by_context()
        WE-->>UI: source_strategy
    end
    
    UI->>HCE: create_hybrid_context()
    
    par Context Integration
        HCE->>DP: get_document_context()
        DP-->>HCE: structured_doc_context
    and Enhanced Web Lookup
        HCE->>WE: execute_enhanced_lookup()
        WE->>WE: query_prioritized_sources()
        WE->>WE: filter_by_document_keywords()
        WE->>WE: rank_by_relevance()
        WE-->>HCE: enhanced_web_context
    end
    
    HCE->>HCE: merge_contexts()
    HCE->>HCE: resolve_conflicts()
    HCE->>HCE: calculate_confidence()
    HCE->>HCE: generate_unified_context()
    HCE-->>UI: hybrid_context
    
    UI->>AI: generate_with_hybrid_context()
    AI->>AI: build_enriched_prompt()
    AI->>AI: call_gpt_with_context()
    AI->>AI: validate_against_sources()
    AI-->>UI: enhanced_definition
    
    UI->>R: save_with_source_attribution()
    R-->>UI: saved_with_lineage
    
    UI-->>U: display_enhanced_result()
                    </div>
                </div>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number">3</div>
                        <div class="stat-label">Parallelle Processen</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">15+</div>
                        <div class="stat-label">Processing Steps</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">100%</div>
                        <div class="stat-label">Source Attribution</div>
                    </div>
                </div>
            </div>
            
            <!-- Test Infrastructure Architecture (NEW) -->
            <div id="testing" class="diagram-container">
                <h2 class="diagram-title">Test Infrastructure Architectuur</h2>
                <div class="diagram-description">
                    <p>Comprehensive testing framework met performance monitoring, UI testing, integration tests en async security testing voor optimale code kwaliteit.</p>
                </div>
                <div class="diagram-wrapper">
                    <div class="mermaid">
graph TB
    subgraph "üß™ Test Framework Layer"
        subgraph "Core Testing"
            PYTEST[PyTest Framework]
            ASYNC[Pytest-Asyncio]
            MOCK[Mock Framework]
            FIXTURES[Test Fixtures]
        end
        
        subgraph "Coverage & Reporting"
            COV[Coverage.py]
            HTML_REPORT[HTML Reports]
            TERM_REPORT[Terminal Reports]
            METRICS[Test Metrics]
        end
        
        subgraph "Test Data Management"
            DUTCH_DATA[Nederlandse Test Data]
            MOCK_DOCS[Mock Documents]
            SEC_THREATS[Security Threat Simulation]
            BENCH_DATA[Benchmark Datasets]
        end
    end

    subgraph "üöÄ Performance Testing Suite"
        subgraph "System Performance"
            PERF_MON[Performance Monitor]
            AI_PERF[AI Toetser Performance]
            CACHE_PERF[Cache Performance]
            CONFIG_PERF[Configuration Performance]
        end
        
        subgraph "Load Testing"
            BATCH_TEST[Batch Validation Tests]
            CONCURRENT[Concurrent Processing]
            MEMORY_TEST[Memory Usage Testing]
            THROUGHPUT[Throughput Analysis]
        end
        
        subgraph "Regression Testing"
            BASELINE[Performance Baselines]
            REGRESSION[Regression Detection]
            BENCHMARK[Benchmark Comparison]
        end
    end

    subgraph "üñ•Ô∏è UI Testing Suite"
        subgraph "Streamlit Testing"
            MOCK_ST[Mock Streamlit Framework]
            SESSION_TEST[Session State Testing]
            WIDGET_TEST[Widget Testing]
            TAB_TEST[Tabbed Interface Testing]
        end
        
        subgraph "User Workflow"
            USER_SIM[User Interaction Simulation]
            UPLOAD_TEST[File Upload Testing]
            EXPORT_TEST[Export Functionality Testing]
            ERROR_UI[UI Error Handling]
        end
        
        subgraph "UI Performance"
            RENDER_SPEED[Rendering Speed Tests]
            LARGE_DATA[Large Data Handling]
            CONCURRENT_UI[Concurrent User Simulation]
        end
    end

    subgraph "üîó Integration Testing Suite"
        subgraph "End-to-End Workflows"
            E2E_TEST[Complete Definition Workflow]
            DOC_WORKFLOW[Document Upload Workflow]
            HYBRID_WORKFLOW[Hybrid Context Workflow]
        end
        
        subgraph "Component Integration"
            CROSS_COMP[Cross-Component Testing]
            DATA_FLOW[Data Flow Integrity]
            STATE_MGMT[State Management Testing]
        end
        
        subgraph "Real-World Scenarios"
            GOV_TERMS[Dutch Government Terminology]
            BULK_PROC[Bulk Processing Scenarios]
            ERROR_CASCADE[Error Cascading Tests]
        end
    end

    subgraph "üîê Security Testing Suite"
        subgraph "Async Security"
            ASYNC_SEC[Async Security Harness]
            RATE_LIMIT_TEST[Rate Limiting Tests]
            THREAT_DET[Threat Detection Tests]
            CONCURRENCY_SEC[High-Concurrency Security]
        end
        
        subgraph "Input Validation"
            XSS_TEST[XSS Protection Tests]
            SQL_INJ_TEST[SQL Injection Tests]
            PATH_TRAV[Path Traversal Tests]
            INPUT_SAN[Input Sanitization Tests]
        end
        
        subgraph "Performance Security"
            SEC_PERF[Security Performance Tests]
            LATENCY_DIST[Security Latency Distribution]
            ADAPTIVE_RESP[Adaptive Threat Response]
        end
    end

    subgraph "üìä Test Orchestration"
        subgraph "Test Execution"
            TEST_RUNNER[Test Runner]
            PARALLEL_EXEC[Parallel Execution]
            TEST_SCHED[Test Scheduling]
        end
        
        subgraph "Result Analysis"
            RESULT_AGG[Result Aggregation]
            TREND_ANALYSIS[Trend Analysis]
            ALERT_SYSTEM[Test Alert System]
        end
        
        subgraph "CI/CD Integration"
            PIPELINE[Test Pipeline]
            AUTO_RUN[Automated Test Runs]
            QUALITY_GATE[Quality Gates]
        end
    end

    %% Framework Connections
    PYTEST --> ASYNC
    PYTEST --> MOCK
    PYTEST --> FIXTURES
    COV --> HTML_REPORT
    COV --> TERM_REPORT
    
    %% Performance Testing Connections
    PERF_MON --> AI_PERF
    PERF_MON --> CACHE_PERF
    PERF_MON --> CONFIG_PERF
    BATCH_TEST --> CONCURRENT
    CONCURRENT --> MEMORY_TEST
    MEMORY_TEST --> THROUGHPUT
    BASELINE --> REGRESSION
    REGRESSION --> BENCHMARK
    
    %% UI Testing Connections
    MOCK_ST --> SESSION_TEST
    MOCK_ST --> WIDGET_TEST
    MOCK_ST --> TAB_TEST
    USER_SIM --> UPLOAD_TEST
    UPLOAD_TEST --> EXPORT_TEST
    EXPORT_TEST --> ERROR_UI
    RENDER_SPEED --> LARGE_DATA
    LARGE_DATA --> CONCURRENT_UI
    
    %% Integration Testing Connections
    E2E_TEST --> DOC_WORKFLOW
    DOC_WORKFLOW --> HYBRID_WORKFLOW
    CROSS_COMP --> DATA_FLOW
    DATA_FLOW --> STATE_MGMT
    GOV_TERMS --> BULK_PROC
    BULK_PROC --> ERROR_CASCADE
    
    %% Security Testing Connections
    ASYNC_SEC --> RATE_LIMIT_TEST
    RATE_LIMIT_TEST --> THREAT_DET
    THREAT_DET --> CONCURRENCY_SEC
    XSS_TEST --> SQL_INJ_TEST
    SQL_INJ_TEST --> PATH_TRAV
    PATH_TRAV --> INPUT_SAN
    SEC_PERF --> LATENCY_DIST
    LATENCY_DIST --> ADAPTIVE_RESP
    
    %% Orchestration Connections
    TEST_RUNNER --> PARALLEL_EXEC
    PARALLEL_EXEC --> TEST_SCHED
    RESULT_AGG --> TREND_ANALYSIS
    TREND_ANALYSIS --> ALERT_SYSTEM
    PIPELINE --> AUTO_RUN
    AUTO_RUN --> QUALITY_GATE
    
    %% Cross-Suite Integration
    PERF_MON --> RESULT_AGG
    MOCK_ST --> RESULT_AGG
    E2E_TEST --> RESULT_AGG
    ASYNC_SEC --> RESULT_AGG
    
    COV --> QUALITY_GATE
    METRICS --> TREND_ANALYSIS

    style PYTEST fill:#e3f2fd
    style PERF_MON fill:#e8f5e8
    style MOCK_ST fill:#fff3e0
    style E2E_TEST fill:#f3e5f5
    style ASYNC_SEC fill:#ffebee
    style COV fill:#fce4ec
    style TEST_RUNNER fill:#e0f2f1
                    </div>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #e3f2fd;"></div>
                        <span>Test Framework</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #e8f5e8;"></div>
                        <span>Performance Testing</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #fff3e0;"></div>
                        <span>UI Testing</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #f3e5f5;"></div>
                        <span>Integration Testing</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ffebee;"></div>
                        <span>Security Testing</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #fce4ec;"></div>
                        <span>Coverage & Metrics</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #e0f2f1;"></div>
                        <span>Test Orchestration</span>
                    </div>
                </div>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number">4</div>
                        <div class="stat-label">Test Suite Types</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">37+</div>
                        <div class="stat-label">Slagende Tests</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">14%</div>
                        <div class="stat-label">Code Coverage</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">3000+</div>
                        <div class="stat-label">Lines of Test Code</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>