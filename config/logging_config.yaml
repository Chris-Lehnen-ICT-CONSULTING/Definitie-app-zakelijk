# Logging Configuration
# Purpose: Logging levels, formats, file rotation, and module-specific settings
version: "1.0"
created: "2025-10-02"
description: "Application-wide logging configuration for file, console, and structured logging"

# Global logging settings
global:
  enabled: true
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR, CRITICAL
  propagate: true

# Console logging
console:
  enabled: true
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  date_format: "%Y-%m-%d %H:%M:%S"
  colorized: true

  # Color scheme for different log levels
  colors:
    DEBUG: "cyan"
    INFO: "green"
    WARNING: "yellow"
    ERROR: "red"
    CRITICAL: "red,bold"

# File logging
file:
  enabled: true
  level: "DEBUG"
  log_file: "logs/definitie_agent.log"
  format: "%(asctime)s - %(name)s - %(levelname)s - [%(filename)s:%(lineno)d] - %(message)s"
  date_format: "%Y-%m-%d %H:%M:%S"

  # File rotation settings
  rotation:
    enabled: true
    max_bytes: 10485760  # 10 MB
    backup_count: 5
    when: "midnight"  # For TimedRotatingFileHandler: midnight, H, D, W0-W6
    interval: 1
    encoding: "utf-8"

  # Archive old logs
  archive:
    enabled: true
    compress: true
    archive_dir: "logs/archive"
    retention_days: 30

# Structured logging (JSON format)
structured:
  enabled: false  # Enable for production/monitoring integration
  format: "json"
  file: "logs/definitie_agent_structured.json"

  # Fields to include in structured logs
  fields:
    - "timestamp"
    - "level"
    - "logger"
    - "message"
    - "module"
    - "function"
    - "line"
    - "thread"
    - "process"
    - "trace_id"

# Module-specific log levels
# Extracted from config_development.yaml
module_levels:
  # Application modules
  definitie_agent: "DEBUG"

  # Service layers
  "services.ai_service_v2": "INFO"
  "services.definition_generator": "DEBUG"
  "services.validation": "DEBUG"
  "services.modern_web_lookup_service": "INFO"

  # UI layers
  "ui.tabbed_interface": "INFO"
  "ui.components": "INFO"

  # Database
  "database.definitie_repository": "INFO"
  "database.migrations": "INFO"

  # External libraries (reduce noise)
  openai: "INFO"
  requests: "INFO"
  urllib3: "INFO"
  httpx: "WARNING"
  httpcore: "WARNING"

  # Streamlit
  streamlit: "WARNING"

  # Other utilities
  "utils": "INFO"

# Log filtering
filters:
  # Filter out sensitive information
  sensitive_data:
    enabled: true
    patterns:
      - pattern: "api[_-]?key"
        replacement: "***REDACTED***"
      - pattern: "password"
        replacement: "***REDACTED***"
      - pattern: "secret"
        replacement: "***REDACTED***"
      - pattern: "token"
        replacement: "***REDACTED***"

  # Filter out noisy logs
  noise_reduction:
    enabled: true
    suppress:
      - "GET /healthz"
      - "Connection pool is full"
      - "Retrying request"

# Performance logging
performance:
  enabled: true
  log_slow_operations: true
  slow_threshold_seconds: 1.0

  # What to track
  track:
    - "api_calls"
    - "database_queries"
    - "validation_execution"
    - "definition_generation"

# Error logging
error:
  enabled: true
  log_file: "logs/errors.log"
  level: "ERROR"
  include_traceback: true
  max_traceback_depth: 10

  # Error notification
  notify:
    enabled: false
    on_critical: true
    methods: []  # email, slack, etc.

# Request/Response logging
request_logging:
  enabled: false  # Enable for debugging
  log_file: "logs/requests.log"

  log_request:
    headers: false
    body: true
    body_max_length: 1000

  log_response:
    headers: false
    body: true
    body_max_length: 1000
    status_code: true
    duration: true

# Audit logging
audit:
  enabled: true
  log_file: "logs/audit.log"
  format: "json"

  # Events to audit
  events:
    - "definition_created"
    - "definition_updated"
    - "definition_deleted"
    - "status_changed"
    - "validation_executed"
    - "config_changed"

  # Fields to include
  fields:
    - "timestamp"
    - "event_type"
    - "user_id"
    - "resource_id"
    - "action"
    - "old_value"
    - "new_value"
    - "ip_address"

# API call logging
api_logging:
  enabled: true
  log_file: "logs/api_calls.json"
  format: "json"

  # What to log
  log:
    - "model"
    - "temperature"
    - "max_tokens"
    - "prompt_length"
    - "response_length"
    - "duration"
    - "cost"
    - "timestamp"

# Debug logging
debug:
  enabled: false  # Enable temporarily for debugging
  log_file: "logs/debug.log"
  level: "DEBUG"
  verbose: true

  # Debug categories
  categories:
    validation_rules: false
    prompt_building: false
    category_determination: false
    web_lookup: false

# Log aggregation
aggregation:
  enabled: false
  service: null  # elasticsearch, splunk, datadog, etc.
  endpoint: null
  api_key: null

# Log sampling (reduce volume in production)
sampling:
  enabled: false
  rate: 0.1  # Log 10% of INFO messages
  levels:
    DEBUG: 0.01  # 1% of DEBUG
    INFO: 0.1    # 10% of INFO
    WARNING: 1.0  # 100% of WARNING
    ERROR: 1.0    # 100% of ERROR
    CRITICAL: 1.0 # 100% of CRITICAL

# Log buffering
buffering:
  enabled: false
  buffer_size: 100
  flush_interval: 5  # seconds
  flush_on_error: true

# Environment-specific overrides
overrides:
  development:
    global:
      level: "DEBUG"
    console:
      enabled: true
      level: "DEBUG"
      colorized: true
    file:
      level: "DEBUG"
      log_file: "logs/definitie_agent_dev.log"
    module_levels:
      definitie_agent: "DEBUG"
      "services": "DEBUG"
      "ui": "DEBUG"
    debug:
      enabled: true
      categories:
        validation_rules: true
        prompt_building: true
        category_determination: true
    performance:
      slow_threshold_seconds: 0.5

  production:
    global:
      level: "INFO"
    console:
      enabled: true
      level: "WARNING"
      colorized: false
    file:
      level: "INFO"
      log_file: "logs/definitie_agent_prod.log"
      rotation:
        max_bytes: 52428800  # 50 MB
        backup_count: 10
    structured:
      enabled: true
    module_levels:
      definitie_agent: "INFO"
      "services": "INFO"
      openai: "WARNING"
      streamlit: "ERROR"
    sampling:
      enabled: true
      rate: 0.1
    performance:
      slow_threshold_seconds: 2.0
    audit:
      enabled: true

  testing:
    global:
      level: "WARNING"
    console:
      enabled: false  # Suppress console in tests
    file:
      enabled: true
      level: "ERROR"
      log_file: "logs/test.log"
    module_levels:
      definitie_agent: "ERROR"
    performance:
      enabled: false
    audit:
      enabled: false
