<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Handover Document: Voorbeelden UI Display Fix</title>
  <link rel="stylesheet" href="../portal.css" />
  <style>
    .doc { max-width: 900px; margin: 16px auto 48px auto; padding: 0 16px; }
    .doc h1,.doc h2,.doc h3,.doc h4{ color:#223 }
    .doc p{ line-height:1.6; color:#222 }
    .doc a{ color:#1d4ed8; text-decoration: underline; }
    .doc pre{ background:#0b1020; color:#e6edf3; padding:12px; overflow:auto; border-radius:8px }
    .doc code{ background:#f0f2f5; padding:2px 6px; border-radius:4px }
    .back{ display:inline-block; margin:12px 0; padding:6px 10px; border:1px solid #ccd; border-radius:6px; text-decoration:none; color:#223; background:#f8f9fb }
  </style>
</head>
<body>
  <div class="doc">
    <a class="back" href="../../index.html">‚Üê Terug naar Portal</a>
    <h1>Handover Document: Voorbeelden UI Display Fix</h1>

<h2>üî¥ CRITICAL ISSUE</h2>
<p><strong>De daadwerkelijke voorbeelden/tegenvoorbeelden worden NIET getoond in de UI - alleen de prompts zijn zichtbaar!</strong></p>

<h2>Context & Achtergrond</h2>

<h3>Wat is er gedaan (Phases 1-2 Completed)</h3>
<ol>
<li>**V2 Canonical Dict-Only Contract Ge√Ømplementeerd**</li>
</ol>
<ul>
<li>  - TypedDicts toegevoegd in `src/services/interfaces.py`</li>
<li>  - Normalisatie functies in `src/services/service_factory.py`</li>
<li>  - Verwijderd: best_iteration, is_valid mapping</li>
<li>  - Tests aangepast en passing</li>
</ul>

<ol>
<li>**Metadata Fix in V2 Orchestrator**</li>
</ol>
<ul>
<li>  - `src/services/orchestrators/definition_orchestrator_v2.py` (lines 447-451)</li>
<li>  - Voorbeelden worden nu toegevoegd aan generation_metadata</li>
<li>  - Prompt text wordt correct opgeslagen</li>
</ul>

<ol>
<li>**UI Label Fixes**</li>
</ol>
<ul>
<li>  - English keys behouden (sentence, practical, counter)</li>
<li>  - Nederlandse labels in UI ("Toelichting" i.p.v. "Explanation")</li>
</ul>

<h3>Huidige Situatie</h3>
<p>‚úÖ Prompts worden correct gegenereerd en getoond</p>
<p>‚úÖ Definitie wordt gegenereerd</p>
<p>‚úÖ Metadata bevat voorbeelden dictionary</p>
<p>‚ùå <strong>PROBLEEM: Daadwerkelijke voorbeelden content wordt NIET getoond in UI</strong></p>

<h2>Probleem Analyse</h2>

<h3>Symptomen</h3>
<ol>
<li>In debug sectie zie je de prompts voor:</li>
</ol>
<ul>
<li>  - üìÑ Voorbeeldzinnen</li>
<li>  - üíº Praktijkvoorbeelden</li>
<li>  - ‚ùå Tegenvoorbeelden</li>
<li>  - üîÑ Synoniemen</li>
<li>  - ‚ÜîÔ∏è Antoniemen</li>
<li>  - üí° Toelichting</li>
</ul>

<ol>
<li>MAAR: De gegenereerde content zelf (de voorbeelden) verschijnt nergens</li>
</ol>

<h3>Vermoedelijke Oorzaak</h3>
<p>De voorbeelden worden WEL gegenereerd (API calls naar GPT gebeuren), maar:</p>
<ul>
<li>Ofwel: Ze worden niet correct doorgegeven van orchestrator ‚Üí UI</li>
<li>Ofwel: Ze worden niet correct gerenderd in de UI componenten</li>
</ul>

<h2>Waar te Zoeken</h2>

<h3>1. Check Definition Generator Tab</h3>
<pre><code># Hoofdcomponent voor definitie generatie UI
src/ui/components/definition_generator_tab.py</code></pre>
<ul>
<li>Kijk naar `_handle_voorbeelden_generation()`</li>
<li>Check hoe voorbeelden uit response worden gehaald</li>
<li>Verifieer SessionStateManager.set_value() calls</li>
</ul>

<h3>2. Check Voorbeelden Display Component</h3>
<pre><code># Component dat voorbeelden moet tonen
src/ui/components/voorbeelden_display.py</code></pre>
<ul>
<li>Check render() methode</li>
<li>Verifieer of het data uit session state haalt</li>
<li>Kijk of het correct voorbeelden dict parsed</li>
</ul>

<h3>3. Trace Data Flow</h3>
<pre><code># In definition_orchestrator_v2.py
voorbeelden = await self._generate_voorbeelden(...)  # Line ~380
# Check: Bevat 'voorbeelden' de juiste data?

# Dan in generation_metadata
"voorbeelden": voorbeelden if voorbeelden else {},  # Line 449
# Check: Wordt dit correct doorgegeven?

# In service_factory.py to_ui_response()
"voorbeelden": generation_metadata.get("voorbeelden", {})
# Check: Komt het hier aan?

# In definition_generator_tab.py
voorbeelden = response.get("voorbeelden", {})
# Check: Wordt het correct uit response gehaald?

# SessionStateManager
SessionStateManager.set_value("voorbeelden", voorbeelden)
# Check: Wordt het in session state gezet?</code></pre>

<h3>4. Debug Tips</h3>
<pre><code># Voeg logging toe op kritieke punten:
import logging
logger = logging.getLogger(__name__)

# In orchestrator na voorbeelden generatie:
logger.info(f"Generated voorbeelden: {voorbeelden}")

# In UI component:
logger.info(f"Received voorbeelden: {voorbeelden}")
st.write("DEBUG voorbeelden:", voorbeelden)  # Tijdelijk voor debugging</code></pre>

<h2>Test Scenario</h2>

<ol>
<li>Start app: `OPENAI_API_KEY="$OPENAI_API_KEY_PROD" streamlit run src/main.py`</li>
<li>Vul begrip in: "test"</li>
<li>Genereer definitie</li>
<li>Check:</li>
</ol>
<ul>
<li>  - Worden API calls gemaakt? (check logs)</li>
<li>  - Staat voorbeelden data in session state?</li>
<li>  - Wordt VoorbeeldenDisplay.render() aangeroepen?</li>
</ul>

<h2>Verwachte Fix</h2>

<p>Het probleem zit waarschijnlijk in een van deze gebieden:</p>

<ol>
<li>**VoorbeeldenDisplay component rendert niet correct**</li>
</ol>
<ul>
<li>  - Mogelijk kijkt het naar verkeerde session state keys</li>
<li>  - Of parsed het de voorbeelden dict niet goed</li>
</ul>

<ol>
<li>**Session state wordt niet correct gevuld**</li>
</ol>
<ul>
<li>  - Check of voorbeelden dict de juiste structuur heeft</li>
<li>  - Verifieer dat keys matchen (sentence/practical/counter)</li>
</ul>

<ol>
<li>**UI tabs/sections missen render call**</li>
</ol>
<ul>
<li>  - Mogelijk wordt VoorbeeldenDisplay.render() niet aangeroepen</li>
<li>  - Of wordt het overschreven door andere UI updates</li>
</ul>

<h2>Belangrijke Files</h2>

<pre><code># Core files voor dit probleem:
src/ui/components/definition_generator_tab.py  # Hoofdcomponent
src/ui/components/voorbeelden_display.py       # Voorbeelden rendering
src/services/orchestrators/definition_orchestrator_v2.py  # Data generatie
src/services/service_factory.py                # Response formatting
src/voorbeelden/unified_voorbeelden.py         # Voorbeelden generator

# Session state management:
src/ui/session_state_manager.py</code></pre>

<h2>Commando's voor Debugging</h2>

<pre><code># Start app met debug logging
OPENAI_API_KEY="$OPENAI_API_KEY_PROD" PYTHONPATH=. streamlit run src/main.py --logger.level=debug

# Grep voor voorbeelden handling
grep -r "voorbeelden" src/ui/components/ --include="*.py"
grep -r "SessionStateManager.get_value.*voorbeelden" src/

# Check voor render calls
grep -r "VoorbeeldenDisplay" src/ui/</code></pre>

<h2>Next Steps</h2>

<ol>
<li>**PRIORITEIT 1**: Find waar voorbeelden content verloren gaat</li>
<li>Check of UnifiedExamplesGenerator daadwerkelijk content returnt</li>
<li>Verifieer complete data flow van generator ‚Üí orchestrator ‚Üí UI</li>
<li>Fix rendering in VoorbeeldenDisplay component</li>
</ol>

<h2>Laatste Status</h2>

<ul>
<li>Gebruiker meldt: "dit zijn dus alleen de prompts! de daadwerkelijke voorbeelden etc. zijn nog steeds niet in de UI zichtbaar"</li>
<li>Labels zijn correct (behalve Explanation ‚Üí Toelichting, nu gefixed)</li>
<li>Prompts worden getoond in debug sectie</li>
<li>Definitie wordt wel gegenereerd en getoond</li>
<li>**PROBLEEM: Voorbeelden content mist volledig**</li>
</ul>

<h2>Git Status</h2>
<pre><code>Branch: main
Modified:
- data/definities.db
- docs/backlog/bugs/CFR-BUG-003-generation-result-import.md</code></pre>

<p>Recent commits show V2 contract implementation and various bug fixes.</p>

<p>---</p>

<p><strong>Start hier met debuggen van het voorbeelden display probleem!</strong></p>

  </div>
</body>
</html>