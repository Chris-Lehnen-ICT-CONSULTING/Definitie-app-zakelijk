<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Business Validation Rules — DefinitieAgent (V2)</title>
  <link rel="stylesheet" href="../portal.css" />
  <style>
    .doc { max-width: 900px; margin: 16px auto 48px auto; padding: 0 16px; }
    .doc h1,.doc h2,.doc h3,.doc h4{ color:#223 }
    .doc p{ line-height:1.6; color:#222 }
    .doc a{ color:#1d4ed8; text-decoration: underline; }
    .doc pre{ background:#0b1020; color:#e6edf3; padding:12px; overflow:auto; border-radius:8px }
    .doc code{ background:#f0f2f5; padding:2px 6px; border-radius:4px }
    .back{ display:inline-block; margin:12px 0; padding:6px 10px; border:1px solid #ccd; border-radius:6px; text-decoration:none; color:#223; background:#f8f9fb }
  </style>
</head>
<body>
  <div class="doc">
    <a class="back" href="../../index.html">← Terug naar Portal</a>
    <p>---</p>
<p>aangemaakt: '08-09-2025'</p>
<p>applies_to: definitie-app@v2</p>
<p>bijgewerkt: '08-09-2025'</p>
<p>canonical: true</p>
<p>last_verified: 02-09-2025</p>
<p>owner: validation</p>
<p>prioriteit: medium</p>
<p>status: active</p>
<p>---</p>



<h1>Business Validation Rules — DefinitieAgent (V2)</h1>

<p>Doel: enkel de zakelijke (business) regels en acceptatiecriteria vastleggen, met verwijzingen naar canonieke bronnen en testartefacten.</p>

<h2>Core Acceptatiecriteria</h2>

<ul>
<li>Overall score moet ≥ 0.75 voor acceptatie.</li>
<li>Lege definities zijn altijd onacceptabel.</li>
<li>Circulaire definities (bijv. “Belasting is belasting”) zijn onacceptabel/major violation.</li>
</ul>

<p>Bronnen:</p>
<ul>
<li>Config: `src/config/validation_rules.yaml` (thresholds/weights leidend)</li>
<li>Golden dataset: `tests/fixtures/golden_definitions.yaml` (≥10–20 cases, incl. edge cases)</li>
</ul>

<h2>Validation Weights & Impact (bron: YAML)</h2>

<p>| Rule Code     | Beschrijving              | Weight | Impact    |</p>
<p>|---------------|---------------------------|--------|-----------|</p>
<p>| VAL-EMP-001   | Empty text                | 1.0    | Critical  |</p>
<p>| ESS-CONT-001  | Essential content         | 1.0    | Critical  |</p>
<p>| CON-CIRC-001  | Circular definition       | 0.8    | Major     |</p>
<p>| VAL-LEN-001   | Minimum length            | 0.9    | Major     |</p>
<p>| STR-ORG-001   | Structure                 | 0.7    | Moderate  |</p>

<p>Toelichting: dit is een representatieve tabel; de exacte set en waarden staan in de YAML‑config en zijn de bron van waarheid.</p>

<h2>Validation Rules Details (harde drempels)</h2>

<ul>
<li>VAL-LEN-001 (te kort): minder dan 5 woorden of minder dan 15 karakters → fail (0.0) met violation VAL-LEN-001.</li>
<li>VAL-LEN-002 (te lang): meer dan 80 woorden of meer dan 600 karakters → fail (0.0) met violation VAL-LEN-002.</li>
<li>ESS-CONT-001 (essentie ontbreekt): minder dan 6 woorden → fail (0.0) met ESS-CONT-001.</li>
<li>CON-CIRC-001 (circulair): begrip komt (case-insensitive) in de definitietekst voor → major violation.</li>
<li>STR-TERM-001/STR-ORG-001 (terminologie/structuur): structurele/terminologie‑issues met impact conform YAML‑gewichten.</li>
</ul>

<p>NB: berichtteksten zijn implementatie‑details; drempels en codes borgen het beleid.</p>

<h2>Resultaatcontract‑invarianten (ValidationResult)</h2>

<ul>
<li>Verplichte velden: version, overall_score, is_acceptable, violations, passed_rules, detailed_scores, system.</li>
<li>system.correlation_id: altijd aanwezig; UUID (gegenereerd indien niet meegegeven).</li>
<li>Violations: deterministisch gesorteerd (stabiele volgorde).</li>
<li>is_acceptable: afgeleid van thresholds/weights; overall_accept (YAML) = 0.75.</li>
</ul>

<h2>Determinisme</h2>

<ul>
<li>V2‑validatie is deterministisch: bij identieke input/parameters blijft score/violations/detailed_scores gelijk.</li>
<li>Golden cases moeten identieke resultaten geven bij herhaalde runs (geen randomness in regels/aggregatie).</li>
</ul>

<h2>Quality Thresholds</h2>

<ul>
<li>Perfect: ≥ 0.80</li>
<li>Acceptable: 0.75–0.80</li>
<li>Borderline: 0.60–0.75</li>
<li>Unacceptable: < 0.75</li>
</ul>

<h2>Domeinregels (NL overheid)</h2>

<ul>
<li>Gebruik overheidsterminologie; geen mixed‑language in NL definities.</li>
<li>Goedgekeurde definities (established) zijn immutable; wijzigingen via nieuwe versieflow.</li>
</ul>

<p>NB: Taalregels (LANG‑…) zijn config‑afhankelijk. In de standaard YAML zijn deze niet geactiveerd; golden cases met taal‑mix gelden alleen wanneer de betreffende regels enabled zijn.</p>

<h2>Duplicate Detection Policy (samenvatting)</h2>

<ul>
<li>Exact: begrip + context (organisatorisch/juridisch) exact gelijk (case‑insensitive) → duplicaat.</li>
<li>Fuzzy: Jaccard‑similarity op woordsets van begrip met threshold ≥ 0.7.</li>
<li>Statusfilter: definitions met status 'archived' worden uitgesloten.</li>
<li>Risicobuckets: high (≥ 0.9), medium (≥ 0.8), low (anders).</li>
</ul>

<p>Voorbeelden:</p>
<ul>
<li>Exact: ("Belasting", context="OM|Strafrecht") ↔ ("Belasting", context="OM|Strafrecht").</li>
<li>Fuzzy medium: ("Inspectierapport" ↔ "Rapport inspectie") ≈ 0.8.</li>
<li>Geen match: lege of totaal afwijkende begrippen.</li>
</ul>

<h2>Artefacten en Tests</h2>

<ul>
<li>YAML configuratie: `src/config/validation_rules.yaml`.</li>
<li>Golden dataset: `tests/fixtures/golden_definitions.yaml` (cases met expected score/acceptabel/violations).</li>
<li>V2 smoke test: `tests/smoke/test_validation_v2_smoke.py` (offline, CI).</li>
<li>(Optioneel) V2 unit tests: aggregatie/determinisme en loader‑fallback.</li>
</ul>

<h2>Regression Prevention</h2>

<ul>
<li>Elke businessregel wordt gedekt door ten minste één golden case.</li>
<li>Nieuwe/gewijzigde regels: update zowel YAML (weights/thresholds) als golden cases.</li>
<li>Breaking changes: duidelijk documenteren (changelog) en via feature flag/afgesproken gate.</li>
</ul>

<h2>Legacy Mapping (indicatief)</h2>

<p>| Legacy testbestand                                   | Status            | Geborgd in                                 |</p>
<p>|------------------------------------------------------|-------------------|--------------------------------------------|</p>
<p>| tests/integration/test_story_2_4_interface_migration.py | SAFE_TO_DELETE    | (Puur technisch; geen businessregels)      |</p>
<p>| tests/test_unified_service_v2.py                     | SAFE_TO_DELETE    | (Puur technisch; geen businessregels)      |</p>
<p>| tests/test_db_compatibility.py                       | SAFE_TO_DELETE    | (Puur technisch; geen businessregels)      |</p>
<p>| tests/test_ab_testing_framework.py                   | SAFE_TO_DELETE    | (Puur technisch; geen businessregels)      |</p>
<p>| tests/integration/test_simple_integration.py         | SAFE_TO_DELETE    | (Puur technisch; geen businessregels)      |</p>
<p>| …                                                    | …                 | …                                          |</p>

<p>NB: Voor legacy tests met impliciete businessregels (bijv. prompts/validatoren) geldt: regel/edge‑case vastleggen in golden cases + hierboven, vervolgens test verwijderen.</p>

  </div>
</body>
</html>