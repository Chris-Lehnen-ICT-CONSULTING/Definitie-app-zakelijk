<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Semantic Clusters voor Juridische Synoniemen</title>
  <link rel="stylesheet" href="../portal.css" />
  <style>
    .doc { max-width: 900px; margin: 16px auto 48px auto; padding: 0 16px; }
    .doc h1,.doc h2,.doc h3,.doc h4{ color:#223 }
    .doc p{ line-height:1.6; color:#222 }
    .doc a{ color:#1d4ed8; text-decoration: underline; }
    .doc pre{ background:#0b1020; color:#e6edf3; padding:12px; overflow:auto; border-radius:8px }
    .doc code{ background:#f0f2f5; padding:2px 6px; border-radius:4px }
    .back{ display:inline-block; margin:12px 0; padding:6px 10px; border:1px solid #ccd; border-radius:6px; text-decoration:none; color:#223; background:#f8f9fb }
  </style>
</head>
<body>
  <div class="doc">
    <a class="back" href="../../index.html">← Terug naar Portal</a>
    <h1>Semantic Clusters voor Juridische Synoniemen</h1>

<p><strong>Status</strong>: ✅ Implemented</p>
<p><strong>Versie</strong>: 1.0</p>
<p><strong>Datum</strong>: 2025-10-09</p>

<h2>Overzicht</h2>

<p>Semantic clusters groeperen <strong>gerelateerde (maar NIET synonieme)</strong> juridische begrippen om de recall van web lookups te verbeteren en contextueel verwante suggesties te bieden.</p>

<h3>Verschil tussen Synoniemen en Clusters</h3>

<p>| Aspect | Synoniemen | Clusters |</p>
<p>|--------|-----------|----------|</p>
<p>| <strong>Relatie</strong> | Identieke of zeer vergelijkbare betekenis | Gerelateerd semantisch domein |</p>
<p>| <strong>Voorbeeld</strong> | "hoger beroep" ↔ "appel" | "hoger beroep" + "cassatie" + "verzet" |</p>
<p>| <strong>Uitwisselbaarheid</strong> | Ja (bidirectioneel) | Nee (complementair) |</p>
<p>| <strong>Gebruik</strong> | Query expansion (precision) | Cascade fallback (recall) |</p>

<p><strong>Voorbeeld</strong>:</p>
<ul>
<li>**Synoniemen** van "hoger beroep": appel, appelprocedure</li>
<li>**Cluster** "rechtsmiddelen": hoger_beroep, cassatie, verzet, rechtsmiddel, herziening</li>
</ul>

<h2>YAML Configuratie</h2>

<h3>Format</h3>

<p>Clusters worden gedefinieerd in een speciale <code>_clusters</code> sectie in <code>config/juridische_synoniemen.yaml</code>:</p>

<pre><code># Reguliere synoniemen (zoals voorheen)
hoger_beroep:
  - appel
  - appelprocedure

cassatie:
  - hogere voorziening
  - cassatieberoep

# Semantic clusters (NIEUW)
_clusters:
  # Cluster naam → lijst van gerelateerde termen
  rechtsmiddelen:
    - rechtsmiddel
    - hoger_beroep
    - cassatie
    - verzet
    - herziening

  straffen:
    - gevangenisstraf
    - taakstraf
    - geldboete
    - voorwaardelijke_straf</code></pre>

<h3>Regels</h3>

<ol>
<li>**Exclusief lidmaatschap**: Een term kan slechts in ÉÉN cluster voorkomen</li>
<li>**Geen synoniemen**: Cluster termen zijn gerelateerd, niet synoniem</li>
<li>**Descriptieve namen**: Gebruik beschrijvende cluster namen (bijv. "rechtsmiddelen" niet "cluster1")</li>
<li>**Optioneel**: Clusters zijn backward compatible - oude configs zonder `_clusters` werken nog steeds</li>
<li>**Normalisatie**: Termen worden genormaliseerd (lowercase, underscores → spaces)</li>
</ol>

<h2>Beschikbare Clusters</h2>

<p>De volgende 8 semantic clusters zijn gedefinieerd in <code>config/juridische_synoniemen.yaml</code>:</p>

<h3>1. **rechtsmiddelen** - Legal Remedies and Appeal Procedures</h3>
<p>Rechtsmiddelen waarmee beslissingen kunnen worden aangevochten.</p>

<p><strong>Termen</strong>: rechtsmiddel, hoger_beroep, cassatie, verzet, herziening</p>

<p><strong>Use case</strong>: Als zoeken naar "hoger beroep" geen resultaten oplevert, probeer "cassatie" of "rechtsmiddel"</p>

<p>---</p>

<h3>2. **straffen** - Criminal Penalties and Sanctions</h3>
<p>Verschillende vormen van strafrechtelijke sancties.</p>

<p><strong>Termen</strong>: gevangenisstraf, taakstraf, geldboete, voorwaardelijke_straf, jeugddetentie</p>

<p><strong>Use case</strong>: Geef suggesties voor gerelateerde strafsoorten</p>

<p>---</p>

<h3>3. **procedureel_strafrecht** - Criminal Procedure Concepts</h3>
<p>Procedurele begrippen in strafzaken.</p>

<p><strong>Termen</strong>: voorlopige_hechtenis, aanhouding, schorsing, dagvaarding, wraking</p>

<p><strong>Use case</strong>: Context expansion voor procesmatige vraagstukken</p>

<p>---</p>

<h3>4. **partijen_strafrecht** - Criminal Procedure Parties</h3>
<p>Betrokken partijen in strafprocedures.</p>

<p><strong>Termen</strong>: verdachte, getuige, advocaat, rechter, openbaar_ministerie</p>

<p><strong>Use case</strong>: Related suggestions voor procespartijen</p>

<p>---</p>

<h3>5. **bestuursrecht_procedures** - Administrative Law Procedures</h3>
<p>Bestuursrechtelijke procedures en concepten.</p>

<p><strong>Termen</strong>: beschikking, bezwaar, beroep, horen, belanghebbende</p>

<p><strong>Use case</strong>: Cascade fallback voor bestuursrechtelijke begrippen</p>

<p>---</p>

<h3>6. **burgerlijk_procedures** - Civil Law Procedures and Concepts</h3>
<p>Civielrechtelijke procedures en verbintenissen.</p>

<p><strong>Termen</strong>: overeenkomst, wanprestatie, schadevergoeding, vonnis, onrechtmatige_daad</p>

<p><strong>Use case</strong>: Context expansion voor civiele zaken</p>

<p>---</p>

<h3>7. **juridische_bewijsvoering** - Evidence and Proof Concepts</h3>
<p>Begrippen rondom bewijsvoering.</p>

<p><strong>Termen</strong>: bewijs, getuige, procesdossier</p>

<p><strong>Use case</strong>: Related suggestions voor bewijsrecht</p>

<p>---</p>

<h3>8. **strafrechtelijke_verantwoordelijkheid** - Criminal Liability Concepts</h3>
<p>Concepten rondom strafrechtelijke aansprakelijkheid.</p>

<p><strong>Termen</strong>: schuldig, strafbaar_feit, opzet, schuld, recidive, medeplegen</p>

<p><strong>Use case</strong>: Context expansion voor schuldvraagstukken</p>

<h2>API Reference</h2>

<h3>`JuridischeSynoniemlService` - Cluster Methods</h3>

<h4>`get_related_terms(term: str) -> list[str]`</h4>

<p>Haal gerelateerde termen op uit dezelfde semantic cluster.</p>

<p><strong>Parameters</strong>:</p>
<ul>
<li>`term`: Zoekterm (wordt genormaliseerd)</li>
</ul>

<p><strong>Returns</strong>: Lijst van gerelateerde termen (exclusief de term zelf), of lege lijst</p>

<p><strong>Voorbeeld</strong>:</p>
<pre><code>service = JuridischeSynoniemlService()

# Get related terms
related = service.get_related_terms("hoger beroep")
# → ['rechtsmiddel', 'cassatie', 'verzet', 'herziening']

# Term niet in cluster
related = service.get_related_terms("onbekende term")
# → []</code></pre>

<p>---</p>

<h4>`get_cluster_name(term: str) -> str | None`</h4>

<p>Haal cluster naam op voor een term.</p>

<p><strong>Parameters</strong>:</p>
<ul>
<li>`term`: Zoekterm</li>
</ul>

<p><strong>Returns</strong>: Cluster naam, of <code>None</code> als term niet in cluster zit</p>

<p><strong>Voorbeeld</strong>:</p>
<pre><code>cluster = service.get_cluster_name("hoger beroep")
# → 'rechtsmiddelen'

cluster = service.get_cluster_name("onbekende term")
# → None</code></pre>

<p>---</p>

<h4>`expand_with_related(term: str, max_synonyms: int = 3, max_related: int = 2) -> list[str]`</h4>

<p>Expand term met ZOWEL synoniemen als gerelateerde cluster termen.</p>

<p>Combineert synonym expansion (precision) met cluster expansion (recall).</p>

<p><strong>Parameters</strong>:</p>
<ul>
<li>`term`: Originele zoekterm</li>
<li>`max_synonyms`: Maximum aantal synoniemen (default: 3)</li>
<li>`max_related`: Maximum aantal gerelateerde cluster termen (default: 2)</li>
</ul>

<p><strong>Returns</strong>: Lijst met <code>[originele_term, synonyms..., related_terms...]</code></p>

<p><strong>Voorbeeld</strong>:</p>
<pre><code>expanded = service.expand_with_related(
    "hoger beroep",
    max_synonyms=2,
    max_related=2
)
# → ['hoger beroep', 'appel', 'appelprocedure', 'cassatie', 'rechtsmiddel']
#     ^original      ^synonyms (precision)    ^related (recall)</code></pre>

<p>---</p>

<h4>`get_stats() -> dict[str, int]`</h4>

<p>Haal statistieken op (inclusief cluster info).</p>

<p><strong>Returns</strong>: Dict met statistieken</p>

<p><strong>Voorbeeld</strong>:</p>
<pre><code>stats = service.get_stats()
# → {
#     'hoofdtermen': 85,
#     'totaal_synoniemen': 320,
#     'unieke_synoniemen': 315,
#     'gemiddeld_per_term': 3.76,
#     'clusters': 8,              # NEW
#     'termen_in_clusters': 35    # NEW
# }</code></pre>

<h2>Use Cases</h2>

<h3>1. Cascade Fallback</h3>

<p><strong>Probleem</strong>: Zoeken naar "hoger beroep" levert geen Wikipedia resultaten op.</p>

<p><strong>Oplossing</strong>: Probeer gerelateerde termen uit cluster.</p>

<pre><code>service = JuridischeSynoniemlService()

# Primary search
results = wikipedia_search("hoger beroep")

if not results:
    # Fallback: try synonyms first (high precision)
    synonyms = service.get_synoniemen("hoger beroep")
    for syn in synonyms[:3]:
        results = wikipedia_search(syn)
        if results:
            break

if not results:
    # Fallback: try related cluster terms (high recall)
    related = service.get_related_terms("hoger beroep")
    for term in related[:2]:
        results = wikipedia_search(term)
        if results:
            break</code></pre>

<p>---</p>

<h3>2. Related Suggestions</h3>

<p><strong>Probleem</strong>: Gebruiker zoekt naar "hoger beroep", maar misschien is "cassatie" relevanter.</p>

<p><strong>Oplossing</strong>: Toon gerelateerde suggesties.</p>

<pre><code>related = service.get_related_terms("hoger beroep")

# UI suggestie
print(f"Je zou ook kunnen zoeken naar: {', '.join(related[:3])}")
# → "Je zou ook kunnen zoeken naar: cassatie, verzet, rechtsmiddel"</code></pre>

<p>---</p>

<h3>3. Context Expansion (Prompt Enrichment)</h3>

<p><strong>Probleem</strong>: GPT-4 prompt mist context over gerelateerde rechtsmiddelen.</p>

<p><strong>Oplossing</strong>: Voeg cluster context toe aan prompt.</p>

<pre><code>term = "hoger beroep"
cluster_name = service.get_cluster_name(term)
related = service.get_related_terms(term)

prompt = f"""
Definieer het juridische begrip '{term}'.

Context: Dit begrip behoort tot de categorie '{cluster_name}'.
Gerelateerde begrippen: {', '.join(related)}.
"""</code></pre>

<p>---</p>

<h3>4. Combined Expansion (Best of Both Worlds)</h3>

<p><strong>Probleem</strong>: Balans tussen precision (synoniemen) en recall (cluster termen).</p>

<p><strong>Oplossing</strong>: Gebruik <code>expand_with_related()</code>.</p>

<pre><code># Get 2 synonyms (precision) + 2 related terms (recall)
expanded = service.expand_with_related(
    "hoger beroep",
    max_synonyms=2,
    max_related=2
)

# Try all terms in sequence
for term in expanded:
    results = search(term)
    if results:
        break</code></pre>

<h2>Validatie</h2>

<h3>Automatische Validatie</h3>

<p>Run <code>scripts/validate_synonyms.py</code> om clusters te valideren:</p>

<pre><code>python scripts/validate_synonyms.py</code></pre>

<p><strong>Checks</strong>:</p>
<ol>
<li>✅ Empty cluster lists</li>
<li>✅ Duplicate terms binnen cluster</li>
<li>✅ Cross-cluster contamination (term in meerdere clusters)</li>
<li>⚠️  Terms die zowel hoofdterm als cluster term zijn</li>
</ol>

<p><strong>Voorbeeld output</strong>:</p>
<pre><code>[7/7] Validating semantic clusters...
  ✓ All 8 clusters are valid

Validation Summary
==================
  Clusters: 8
  Terms in clusters: 35
  ✓ All validations passed!</code></pre>

<h3>Cluster Validation Rules</h3>

<p>| Rule | Severity | Description |</p>
<p>|------|----------|-------------|</p>
<p>| Empty cluster | ❌ Error | Cluster heeft geen termen |</p>
<p>| Duplicate within cluster | ❌ Error | Zelfde term 2x in cluster |</p>
<p>| Cross-cluster contamination | ❌ Error | Term in meerdere clusters |</p>
<p>| Term is also hoofdterm | ⚠️ Warning | Kan verwarring veroorzaken |</p>

<h2>Integration met Web Lookup</h2>

<h3>SRU Service Integration (Future)</h3>

<p><strong>Optioneel</strong>: SRU service kan cluster-based cascade gebruiken.</p>

<pre><code># config/web_lookup_defaults.yaml
providers:
  sru:
    use_cluster_fallback: true  # Enable cascade fallback
    max_related_terms: 2</code></pre>

<p><strong>Gedrag</strong>:</p>
<ol>
<li>Probeer hoofdterm</li>
<li>Probeer synoniemen (max 3)</li>
<li>Probeer cluster termen (max 2)</li>
</ol>

<h3>Modern Web Lookup Service</h3>

<p><strong>Huidige integratie</strong>: <code>ModernWebLookupService</code> gebruikt al <code>synonym_service</code>, maar nog geen clusters.</p>

<p><strong>Toekomstige enhancement</strong>:</p>
<pre><code># In ModernWebLookupService
if not results:
    # Try related cluster terms
    related = self.synonym_service.get_related_terms(term)
    for related_term in related[:2]:
        results = self._query_provider(related_term)
        if results:
            break</code></pre>

<h2>Testing</h2>

<h3>Test Coverage</h3>

<p>Alle cluster functionaliteit is gedekt door tests in <code>tests/services/web_lookup/test_semantic_clusters.py</code>:</p>

<p><strong>Test classes</strong>:</p>
<ul>
<li>`TestClusterLoading` - YAML loading en parsing</li>
<li>`TestGetRelatedTerms` - get_related_terms() functionaliteit</li>
<li>`TestGetClusterName` - get_cluster_name() functionaliteit</li>
<li>`TestExpandWithRelated` - expand_with_related() functionaliteit</li>
<li>`TestClusterValidation` - Duplicate/cross-contamination checks</li>
<li>`TestClusterStatistics` - get_stats() cluster info</li>
<li>`TestRealWorldClusters` - Integration tests met echte config</li>
</ul>

<h3>Running Tests</h3>

<pre><code># Run all cluster tests
pytest tests/services/web_lookup/test_semantic_clusters.py -v

# Run specific test class
pytest tests/services/web_lookup/test_semantic_clusters.py::TestExpandWithRelated -v

# Run with coverage
pytest tests/services/web_lookup/test_semantic_clusters.py --cov=src.services.web_lookup.synonym_service</code></pre>

<h2>Backward Compatibility</h2>

<p><strong>Volledig backward compatible</strong>:</p>

<p>✅ Oude configs zonder <code>_clusters</code> werken nog steeds</p>
<p>✅ Cluster methods retourneren lege lijsten voor oude configs</p>
<p>✅ Synoniemen functionaliteit onveranderd</p>
<p>✅ Geen breaking changes in API</p>

<p><strong>Migration</strong>: Geen migratie nodig - clusters zijn optioneel.</p>

<h2>Performance</h2>

<h3>Memory Overhead</h3>

<p><strong>Cluster data</strong>: ~35 termen × 8 clusters = ~280 entries</p>

<p><strong>Memory impact</strong>: Verwaarloosbaar (<1KB extra)</p>

<h3>Lookup Performance</h3>

<p><strong>get_related_terms()</strong>: O(1) - dict lookup in <code>term_to_cluster</code> + <code>clusters</code></p>

<p><strong>get_cluster_name()</strong>: O(1) - dict lookup in <code>term_to_cluster</code></p>

<p><strong>expand_with_related()</strong>: O(n + m) waar n=synoniemen, m=related terms</p>

<p><strong>Impact</strong>: Verwaarloosbaar (<1ms per lookup)</p>

<h2>Future Enhancements</h2>

<h3>1. Dynamic Cluster Suggestions</h3>

<p><strong>Idee</strong>: Gebruik cluster membership om automatisch suggesties te genereren in UI.</p>

<pre><code># In Streamlit UI
cluster = service.get_cluster_name(user_term)
if cluster:
    related = service.get_related_terms(user_term)
    st.info(f"Gerelateerde begrippen ({cluster}): {', '.join(related[:3])}")</code></pre>

<p>---</p>

<h3>2. Cluster-Based Ranking</h3>

<p><strong>Idee</strong>: Boost resultaten die uit dezelfde cluster komen.</p>

<pre><code># In ranking function
if result_term in same_cluster:
    score *= 1.2  # Boost cluster-related results</code></pre>

<p>---</p>

<h3>3. Cross-Cluster Navigation</h3>

<p><strong>Idee</strong>: Suggereer termen uit andere relevante clusters.</p>

<pre><code># Suggest related clusters
# E.g., "rechtsmiddelen" → "procedureel_strafrecht"</code></pre>

<p>---</p>

<h3>4. Hierarchical Clusters</h3>

<p><strong>Idee</strong>: Nested clusters voor fijnmazigere semantische groepering.</p>

<pre><code>_clusters:
  rechtsmiddelen:
    _meta:
      parent: strafprocesrecht
    members:
      - hoger_beroep
      - cassatie</code></pre>

<h2>Troubleshooting</h2>

<h3>Cluster Validation Errors</h3>

<p><strong>Error</strong>: <code>Cross-cluster contamination: term 'X' appears in multiple clusters</code></p>

<p><strong>Fix</strong>: Verwijder term uit één van de clusters (kies meest specifieke cluster)</p>

<p>---</p>

<p><strong>Error</strong>: <code>Duplicate term in cluster 'X'</code></p>

<p><strong>Fix</strong>: Verwijder duplicate entry uit YAML</p>

<p>---</p>

<p><strong>Warning</strong>: <code>Term 'X' in cluster 'Y' is also a hoofdterm</code></p>

<p><strong>Fix</strong>: Dit is meestal OK (term kan zowel synoniemen als cluster membership hebben). Check dat het logisch is.</p>

<h3>Runtime Issues</h3>

<p><strong>Issue</strong>: <code>get_related_terms()</code> retourneert lege lijst</p>

<p><strong>Check</strong>:</p>
<ol>
<li>Is term correct genormaliseerd? (lowercase, geen underscores in query)</li>
<li>Zit term in een cluster? → gebruik `get_cluster_name()` om te checken</li>
<li>Is `_clusters` sectie correct geladen? → check `service.clusters`</li>
</ol>

<p>---</p>

<p><strong>Issue</strong>: <code>expand_with_related()</code> bevat duplicates</p>

<p><strong>Fix</strong>: Dit zou niet moeten gebeuren (duplicates worden gefilterd). Rapporteer als bug.</p>

<h2>References</h2>

<p><strong>Gerelateerde documentatie</strong>:</p>
<ul>
<li>`docs/technisch/web_lookup_config.md` - Web lookup configuratie</li>
<li>`config/juridische_synoniemen.yaml` - YAML configuratie bestand</li>
<li>`src/services/web_lookup/synonym_service.py` - Service implementatie</li>
<li>`scripts/validate_synonyms.py` - Validatie script</li>
<li>`tests/services/web_lookup/test_semantic_clusters.py` - Tests</li>
</ul>

<p><strong>Gerelateerde issues/epics</strong>:</p>
<ul>
<li>US-XXX: Implement semantic clusters (deze story)</li>
<li>EPIC-XXX: Web lookup improvements</li>
</ul>

<p>---</p>

<p><strong>Auteur</strong>: Claude Code</p>
<p><strong>Laatst bijgewerkt</strong>: 2025-10-09</p>
<p><strong>Versie</strong>: 1.0</p>

  </div>
</body>
</html>