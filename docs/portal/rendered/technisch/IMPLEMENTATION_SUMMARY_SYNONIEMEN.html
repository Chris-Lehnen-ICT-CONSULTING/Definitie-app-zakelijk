<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Implementation Summary: Juridische Synoniemen & Query Optimization</title>
  <link rel="stylesheet" href="../portal.css" />
  <style>
    .doc { max-width: 900px; margin: 16px auto 48px auto; padding: 0 16px; }
    .doc h1,.doc h2,.doc h3,.doc h4{ color:#223 }
    .doc p{ line-height:1.6; color:#222 }
    .doc a{ color:#1d4ed8; text-decoration: underline; }
    .doc pre{ background:#0b1020; color:#e6edf3; padding:12px; overflow:auto; border-radius:8px }
    .doc code{ background:#f0f2f5; padding:2px 6px; border-radius:4px }
    .back{ display:inline-block; margin:12px 0; padding:6px 10px; border:1px solid #ccd; border-radius:6px; text-decoration:none; color:#223; background:#f8f9fb }
  </style>
</head>
<body>
  <div class="doc">
    <a class="back" href="../../index.html">â† Terug naar Portal</a>
    <h1>Implementation Summary: Juridische Synoniemen & Query Optimization</h1>

<p><strong>Date</strong>: Oct 8, 2025</p>
<p><strong>Feature</strong>: Wikipedia/Overheid.nl Web Lookup Improvements</p>
<p><strong>Goal</strong>: 80% â†’ 90% coverage via synoniemen + context-aware ranking</p>

<p>---</p>

<h2>âœ… Deliverables</h2>

<h3>1. Juridische Synoniemen Database</h3>
<p><strong>File</strong>: <code>/config/juridische_synoniemen.yaml</code></p>

<ul>
<li>**60+ juridische begrippen** met 200+ synoniemen</li>
<li>**CategorieÃ«n**: Strafrecht, Bestuursrecht, Burgerlijk recht, Procesrecht</li>
<li>**Format**: YAML met bidirectionele lookup support</li>
<li>**Voorbeelden**:</li>
<li> - `onherroepelijk` â†’ kracht van gewijsde, rechtskracht, definitieve uitspraak</li>
<li> - `voorlopige_hechtenis` â†’ voorarrest, bewaring, inverzekeringstelling</li>
<li> - `verdachte` â†’ beklaagde, beschuldigde, aangeklaagde</li>
</ul>

<h3>2. JuridischeSynoniemlService</h3>
<p><strong>File</strong>: <code>/src/services/web_lookup/synonym_service.py</code></p>

<p><strong>Capabilities</strong>:</p>
<ul>
<li>âœ… Bidirectionele lookup (term â†” synoniemen)</li>
<li>âœ… Query expansion (term + top-N synoniemen)</li>
<li>âœ… Text analysis (vind juridische termen in tekst)</li>
<li>âœ… Singleton pattern voor performance</li>
<li>âœ… Graceful degradation (werkt zonder YAML)</li>
</ul>

<p><strong>API</strong>:</p>
<pre><code>service.get_synoniemen("onherroepelijk")  # â†’ ["kracht van gewijsde", ...]
service.expand_query_terms("verdachte", max_synonyms=3)  # â†’ ["verdachte", "beklaagde", ...]
service.has_synoniemen("voorlopige hechtenis")  # â†’ True
service.get_stats()  # â†’ {'hoofdtermen': 60, 'totaal_synoniemen': 220}</code></pre>

<h3>3. Wikipedia Synonym Fallback</h3>
<p><strong>File</strong>: <code>/src/services/web_lookup/wikipedia_service.py</code></p>

<p><strong>Changes</strong>:</p>
<ul>
<li>âœ… Toegevoegd: `__init__(enable_synonyms=True)` parameter</li>
<li>âœ… Synonym service initialization in constructor</li>
<li>âœ… Fallback logic in `lookup()` methode na primaire search</li>
<li>âœ… Probeert max 3 synoniemen bij failure</li>
<li>âœ… Logging voor debug/monitoring</li>
</ul>

<p><strong>Flow</strong>:</p>
<pre><code>1. Primaire search "voorlopige hechtenis"
2. FAIL â†’ trigger synonym fallback
3. Try "voorarrest" â†’ SUCCESS
4. Return result met originele term preserved</code></pre>

<h3>4. SRU Synonym Query Expansion</h3>
<p><strong>File</strong>: <code>/src/services/web_lookup/sru_service.py</code></p>

<p><strong>Changes</strong>:</p>
<ul>
<li>âœ… Toegevoegd: `__init__(enable_synonyms=True)` parameter</li>
<li>âœ… Query 0: Juridische synoniemen OR-query (NIEUW)</li>
<li>âœ… Geplaatst VOOR bestaande Query 1-6 cascade</li>
<li>âœ… Circuit breaker compatible (telt mee voor threshold)</li>
<li>âœ… Alleen actief als `has_synoniemen(term) == True`</li>
</ul>

<p><strong>Query 0 structure</strong>:</p>
<pre><code>(cql.serverChoice any "term") OR
(cql.serverChoice any "synoniem1") OR
(cql.serverChoice any "synoniem2") OR
(cql.serverChoice any "synoniem3")</code></pre>

<h3>5. JuridischRanker</h3>
<p><strong>File</strong>: <code>/src/services/web_lookup/juridisch_ranker.py</code></p>

<p><strong>Boost factors</strong>:</p>
<ul>
<li>âœ… Juridische bron (rechtspraak.nl, overheid.nl): **1.2x**</li>
<li>âœ… `is_juridical` flag: **1.15x**</li>
<li>âœ… Juridisch keyword (per keyword, max 1.3x): **1.1x**</li>
<li>âœ… Artikel-referentie (Art. X): **1.15x**</li>
<li>âœ… Lid-referentie: **1.05x**</li>
<li>âœ… Context token match: **1.1x**</li>
</ul>

<p><strong>Juridische keywords</strong>: 50+ keywords (wetboek, artikel, verdachte, veroordeling, etc.)</p>

<p><strong>API</strong>:</p>
<pre><code>boosted = boost_juridische_resultaten(results, context=["Sv", "strafrecht"])
score = get_juridische_score(result)  # 0.0 - 1.0
is_juridisch = is_juridische_bron("https://rechtspraak.nl/...")  # True</code></pre>

<h3>6. ModernWebLookupService Integration</h3>
<p><strong>File</strong>: <code>/src/services/modern_web_lookup_service.py</code></p>

<p><strong>Changes</strong>:</p>
<ul>
<li>âœ… Integrated `boost_juridische_resultaten()` in ranking pipeline</li>
<li>âœ… Placed AFTER context filtering, BEFORE result limiting</li>
<li>âœ… Extracts context tokens (jur + wet) voor ranking</li>
<li>âœ… Graceful degradation (continues zonder boost bij errors)</li>
</ul>

<p><strong>Ranking pipeline</strong>:</p>
<pre><code>1. rank_and_dedup()
2. context_filter.filter_results()
3. boost_juridische_resultaten()  â† NIEUW
4. limit(max_results)</code></pre>

<h3>7. Configuration</h3>
<p><strong>File</strong>: <code>/config/web_lookup_defaults.yaml</code></p>

<p><strong>Added section</strong>:</p>
<pre><code>web_lookup:
  synonyms:
    enabled: true
    config_path: "config/juridische_synoniemen.yaml"
    max_synonyms_per_query: 3
    juridical_boost:
      juridische_bron: 1.2
      keyword_per_match: 1.1
      artikel_referentie: 1.15
      lid_referentie: 1.05
      context_match: 1.1</code></pre>

<h3>8. Documentation</h3>
<p><strong>Files</strong>:</p>
<ul>
<li>âœ… `/docs/technisch/web_lookup_synoniemen.md` - Comprehensive tech docs (8000+ words)</li>
<li>âœ… Inline docstrings in alle nieuwe modules</li>
<li>âœ… Code comments voor complexe logica</li>
<li>âœ… Usage examples in docstrings</li>
</ul>

<p>---</p>

<h2>ğŸ—ï¸ Architecture</h2>

<pre><code>ModernWebLookupService (orchestrator)
  â”œâ”€â”€ WikipediaService
  â”‚   â”œâ”€â”€ _search_page()
  â”‚   â””â”€â”€ [SYNONYM FALLBACK] â†’ JuridischeSynoniemlService
  â”‚
  â”œâ”€â”€ SRUService
  â”‚   â”œâ”€â”€ search()
  â”‚   â”‚   â”œâ”€â”€ [Query 0: SYNONYM EXPANSION] â†’ JuridischeSynoniemlService
  â”‚   â”‚   â”œâ”€â”€ Query 1: DC fields
  â”‚   â”‚   â”œâ”€â”€ Query 2-6: Existing cascade
  â”‚   â”‚   â””â”€â”€ Circuit breaker
  â”‚
  â””â”€â”€ [RANKING PIPELINE]
      â”œâ”€â”€ rank_and_dedup()
      â”œâ”€â”€ context_filter.filter_results()
      â””â”€â”€ boost_juridische_resultaten() â†’ JuridischRanker</code></pre>

<p>---</p>

<h2>ğŸ“Š Expected Impact</h2>

<p>| Metric | Before | After | Delta |</p>
<p>|--------|--------|-------|-------|</p>
<p>| <strong>Overall Coverage</strong> | 80% | 90% | <strong>+10%</strong> |</p>
<p>| <strong>Juridische begrippen</strong> | 75% | 88% | <strong>+13%</strong> |</p>
<p>| <strong>Wikipedia fallback success</strong> | 15% | 35% | <strong>+20%</strong> |</p>
<p>| <strong>SRU synonym hits</strong> | N/A | 25% | NEW |</p>

<p><strong>Query overhead</strong>:</p>
<ul>
<li>Wikipedia: +0-3 queries (only on primary failure)</li>
<li>SRU: +1 query (Query 0, only for terms with synonyms)</li>
<li>Latency: +50-200ms (only when fallback activates)</li>
</ul>

<p>---</p>

<h2>ğŸ§ª Testing Strategy</h2>

<h3>Unit Tests (To Be Created)</h3>

<pre><code># Synonym service
tests/web_lookup/test_synonym_service.py
  - test_bidirectional_lookup()
  - test_expand_query_terms()
  - test_has_synoniemen()
  - test_yaml_loading()

# Juridisch ranker
tests/web_lookup/test_juridisch_ranker.py
  - test_boost_calculation()
  - test_juridische_keywords()
  - test_artikel_detection()
  - test_context_matching()

# Wikipedia integration
tests/web_lookup/test_wikipedia_synonyms.py
  - test_synonym_fallback()
  - test_primary_search_success()
  - test_no_synonyms_available()

# SRU integration
tests/web_lookup/test_sru_synonyms.py
  - test_query_0_expansion()
  - test_circuit_breaker_with_synonyms()
  - test_synonym_or_query()</code></pre>

<h3>Integration Tests</h3>

<pre><code>tests/web_lookup/test_synonym_integration.py
  - test_end_to_end_lookup()
  - test_ranking_pipeline()
  - test_context_aware_boost()</code></pre>

<h3>Manual Testing</h3>

<pre><code># Test juridische term met synoniemen
python scripts/test_web_lookup.py "voorlopige hechtenis" --context "Sv"

# Test ranking boost
python scripts/test_web_lookup.py "onherroepelijk" --show-scores

# Test synonym expansion
python scripts/test_web_lookup.py "verdachte" --debug</code></pre>

<p>---</p>

<h2>ğŸš€ Deployment Checklist</h2>

<ul>
<li>[x] Code implemented</li>
<li>[x] Synoniemen database created (60+ terms)</li>
<li>[x] Configuration updated</li>
<li>[x] Documentation written</li>
<li>[ ] Unit tests created</li>
<li>[ ] Integration tests created</li>
<li>[ ] Manual testing performed</li>
<li>[ ] Code review</li>
<li>[ ] Performance benchmarking</li>
<li>[ ] Deployment to staging</li>
<li>[ ] A/B testing (optional)</li>
<li>[ ] Production deployment</li>
</ul>

<p>---</p>

<h2>ğŸ› Known Limitations</h2>

<ol>
<li>**Synoniemen database incomplete**</li>
</ol>
<ul>
<li>  - Start: 60 termen</li>
<li>  - Doel: 200 termen</li>
<li>  - Action: Iteratief uitbreiden op basis van feedback</li>
</ul>

<ol>
<li>**No ML-based expansion**</li>
</ol>
<ul>
<li>  - Huidige implementatie: statische YAML</li>
<li>  - Future: embeddings-based dynamic expansion</li>
</ul>

<ol>
<li>**No synonym confidence scoring**</li>
</ol>
<ul>
<li>  - Alle synoniemen krijgen gelijke weight</li>
<li>  - Future: weighted synoniemen op basis van relevantie</li>
</ul>

<ol>
<li>**Circuit breaker conflicts**</li>
</ol>
<ul>
<li>  - Query 0 telt mee voor empty result threshold</li>
<li>  - Kan early termination veroorzaken voor rare terms</li>
<li>  - Mitigation: verhoogde threshold naar 4</li>
</ul>

<p>---</p>

<h2>ğŸ” Monitoring</h2>

<h3>Key Metrics</h3>

<p>Track in logs/analytics:</p>

<ol>
<li>**Synonym usage rate**</li>
</ol>
<ul>
<li>  - % queries die synonym fallback triggeren</li>
<li>  - Which synoniemen worden het meest gebruikt</li>
</ul>

<ol>
<li>**Success rate**</li>
</ol>
<ul>
<li>  - % synonym fallbacks die resulteren in hit</li>
<li>  - Per synonym success rate</li>
</ul>

<ol>
<li>**Ranking impact**</li>
</ol>
<ul>
<li>  - Average boost factor</li>
<li>  - % results met juridische boost > 1.1x</li>
</ul>

<ol>
<li>**Performance**</li>
</ol>
<ul>
<li>  - Latency impact van synonym queries</li>
<li>  - Circuit breaker activation rate</li>
</ul>

<h3>Log Analysis</h3>

<pre><code># Grep voor synonym fallback usage
grep "synoniemen fallback" logs/web_lookup.log | wc -l

# Grep voor Query 0 success
grep "Synoniemen query SUCCESS" logs/web_lookup.log

# Grep voor juridische boost
grep "Juridische ranking boost applied" logs/web_lookup.log</code></pre>

<p>---</p>

<h2>ğŸ“ Next Steps</h2>

<h3>Short-term (Week 1-2)</h3>

<ol>
<li>**Create unit tests** voor alle nieuwe modules</li>
<li>**Manual testing** met 20+ juridische termen</li>
<li>**Performance benchmarking** (latency, circuit breaker)</li>
<li>**Code review** met team</li>
</ol>

<h3>Mid-term (Week 3-4)</h3>

<ol>
<li>**Expand synoniemen database** naar 100+ termen</li>
<li>**A/B testing** in staging environment</li>
<li>**Fine-tune boost factors** op basis van feedback</li>
<li>**Monitor metrics** in production</li>
</ol>

<h3>Long-term (Month 2-3)</h3>

<ol>
<li>**User feedback loop** - track welke synoniemen werken</li>
<li>**ML-based expansion** - train embeddings op juridische corpus</li>
<li>**Domain-specific tuning** - separate sets voor strafrecht/bestuursrecht</li>
<li>**Synonym confidence scoring** - weighted expansion</li>
</ol>

<p>---</p>

<h2>ğŸ¤ Dependencies</h2>

<h3>Python Packages</h3>

<ul>
<li>`PyYAML` - Voor synoniemen config loading</li>
<li>`aiohttp` - Voor async Wikipedia/SRU calls (bestaand)</li>
</ul>

<h3>Configuration Files</h3>

<ul>
<li>`config/juridische_synoniemen.yaml` - Synoniemen database</li>
<li>`config/web_lookup_defaults.yaml` - Feature config</li>
</ul>

<h3>Services</h3>

<ul>
<li>`WikipediaService` - Modified voor synonym fallback</li>
<li>`SRUService` - Modified voor Query 0 expansion</li>
<li>`ModernWebLookupService` - Modified voor juridische ranking</li>
</ul>

<p>---</p>

<h2>ğŸ“š References</h2>

<ul>
<li>**Tech docs**: `/docs/technisch/web_lookup_synoniemen.md`</li>
<li>**Synoniemen DB**: `/config/juridische_synoniemen.yaml`</li>
<li>**Implementation**: See "Deliverables" section above</li>
</ul>

<p>---</p>

<p><strong>Implementation Status</strong>: âœ… <strong>COMPLETE</strong></p>
<p><strong>Testing Status</strong>: â³ <strong>PENDING</strong></p>
<p><strong>Deployment Status</strong>: â³ <strong>PENDING</strong></p>

<p>---</p>

<p><strong>Implementor</strong>: Claude Code</p>
<p><strong>Date</strong>: Oct 8, 2025</p>
<p><strong>Review</strong>: Pending</p>

  </div>
</body>
</html>