<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DEF-102 Prompt Contradiction Architecture Map</title>
  <link rel="stylesheet" href="../portal.css" />
  <style>
    .doc { max-width: 900px; margin: 16px auto 48px auto; padding: 0 16px; }
    .doc h1,.doc h2,.doc h3,.doc h4{ color:#223 }
    .doc p{ line-height:1.6; color:#222 }
    .doc a{ color:#1d4ed8; text-decoration: underline; }
    .doc pre{ background:#0b1020; color:#e6edf3; padding:12px; overflow:auto; border-radius:8px }
    .doc code{ background:#f0f2f5; padding:2px 6px; border-radius:4px }
    .back{ display:inline-block; margin:12px 0; padding:6px 10px; border:1px solid #ccd; border-radius:6px; text-decoration:none; color:#223; background:#f8f9fb }
  </style>
</head>
<body>
  <div class="doc">
    <a class="back" href="../../index.html">‚Üê Terug naar Portal</a>
    <h1>DEF-102 Prompt Contradiction Architecture Map</h1>
<h2>Complete Reconnaissance for Critical Blocking Issue</h2>

<p><strong>Generated:</strong> 2025-01-04  </p>
<p><strong>Thoroughness:</strong> VERY THOROUGH  </p>
<p><strong>Mission:</strong> Map complete prompt architecture for contradiction resolution</p>

<p>---</p>

<h2>üéØ EXECUTIVE SUMMARY</h2>

<p><strong>Severity:</strong> BLOCKING - System UNUSABLE due to 5 contradictions  </p>
<p><strong>Architecture:</strong> 16 prompt modules coordinated by <code>PromptOrchestrator</code>  </p>
<p><strong>Total Lines:</strong> 4,419 lines across all modules  </p>
<p><strong>Contradiction Sources:</strong> 5 distinct conflicts across 4 modules + JSON configs</p>

<p>---</p>

<h2>üìÅ COMPLETE MODULE INVENTORY (16 Modules)</h2>

<h3>Core Infrastructure</h3>
<pre><code>prompt_orchestrator.py      414 lines  Priority: N/A (orchestrator)
base_module.py              207 lines  Priority: N/A (base class)</code></pre>

<h3>Content Generation Modules</h3>
<pre><code>expertise_module.py         199 lines  Priority: 90 (highest)
output_specification_module.py  174 lines  Priority: 85
grammar_module.py           255 lines  Priority: 80
context_awareness_module.py 432 lines  Priority: 70
semantic_categorisation_module.py  257 lines  Priority: N/A
template_module.py          250 lines  Priority: 60</code></pre>

<h3>Validation Rule Modules (7 categories)</h3>
<pre><code>arai_rules_module.py        128 lines  Priority: 75
con_rules_module.py         128 lines  Priority: N/A
ess_rules_module.py         128 lines  Priority: 75  ‚ö†Ô∏è CONTRADICTION SOURCE
sam_rules_module.py         128 lines  Priority: N/A
structure_rules_module.py   329 lines  Priority: 65  ‚ö†Ô∏è CONTRADICTION SOURCE
integrity_rules_module.py   314 lines  Priority: N/A  ‚ö†Ô∏è CONTRADICTION SOURCE
ver_rules_module.py         128 lines  Priority: N/A</code></pre>

<h3>Final Instructions</h3>
<pre><code>error_prevention_module.py  262 lines  Priority: N/A  ‚ö†Ô∏è CONTRADICTION SOURCE
metrics_module.py           326 lines  Priority: 50
definition_task_module.py   299 lines  Priority: 40</code></pre>

<p>---</p>

<h2>üî• 5 CONTRADICTIONS MAPPED</h2>

<h3>CONTRADICTION #1: "is" - ESS-02 vs STR-01 + error_prevention</h3>
<p><strong>Rule Conflict:</strong> ESS-02 REQUIRES "is een" vs STR-01 + error_prevention FORBID "is"</p>

<p><strong>üìç Location 1A - ESS-02 JSON Config (REQUIRES "is")</strong></p>
<pre><code>File: src/toetsregels/regels/ESS-02.json
Lines: 7-22

Content:
  "herkenbaar_patronen_type": [
    "\\b(is een|betreft een) (categorie|soort|klasse)\\b",  ‚Üê REQUIRES "is een"
  ],
  "herkenbaar_patronen_particulier": [
    "\\b(is een) exemplaar\\b",  ‚Üê REQUIRES "is een"
  ],
  "herkenbaar_patronen_proces": [
    "\\b(is een|betreft een) (proces|activiteit|handeling)\\b",  ‚Üê REQUIRES "is een"
  ],
  "goede_voorbeelden_proces": [
    "Observatie is een activiteit waarbij...",  ‚Üê REQUIRES "is een"
    "Interview is een activiteit waarbij..."     ‚Üê REQUIRES "is een"
  ]</code></pre>

<p><strong>üìç Location 1B - Semantic Categorisation Module (REQUIRES "is")</strong></p>
<pre><code>File: src/services/prompts/modules/semantic_categorisation_module.py
Lines: 136-257

CRITICAL INSTRUCTIONS (Lines 138-143):
- 'is een activiteit waarbij...'    ‚Üê REQUIRES "is een"
- 'is het resultaat van...'         ‚Üê REQUIRES "is"
- 'betreft een specifieke soort...' ‚Üê Alternative
- 'is een exemplaar van...'         ‚Üê REQUIRES "is een"

CATEGORY GUIDANCE (Lines 180-257):
Proces: 'is een activiteit waarbij...'  ‚Üê REQUIRES "is een"
Type: 'is een soort...'                 ‚Üê REQUIRES "is een"
Resultaat: 'is het resultaat van...'    ‚Üê REQUIRES "is"
Exemplaar: 'is een specifiek exemplaar' ‚Üê REQUIRES "is een"

EXAMPLES (Lines 195-236):
- validatie: proces waarbij...
- toezicht: activiteit waarbij...
- sanctie: maatregel die volgt op...</code></pre>

<p><strong>üìç Location 1C - STR-01 JSON (FORBIDS "is")</strong></p>
<pre><code>File: src/toetsregels/regels/STR-01.json
Lines: 7-22

  "herkenbaar_patronen": [
    "^is\\b",     ‚Üê FORBIDS "is" at start
  ],
  "foute_voorbeelden": [
    "is een maatregel die recidive voorkomt",  ‚Üê "is een" marked WRONG
  ]</code></pre>

<p><strong>üìç Location 1D - Error Prevention Module (FORBIDS "is")</strong></p>
<pre><code>File: src/services/prompts/modules/error_prevention_module.py
Lines: 143-194

Line 147: "- ‚ùå Gebruik geen koppelwerkwoord aan het begin ('is', 'betekent', 'omvat')"
Line 158: "is",  ‚Üê In forbidden starters list</code></pre>

<p><strong>Impact:</strong> CRITICAL - GPT-4 receives contradictory instructions:</p>
<ul>
<li>ESS-02: "Use 'is een activiteit'"</li>
<li>STR-01: "Never start with 'is'"</li>
<li>Result: Model confused, produces inconsistent definitions</li>
</ul>

<p>---</p>

<h3>CONTRADICTION #2: "proces/activiteit" - ARAI-02 vs ESS-02</h3>
<p><strong>Rule Conflict:</strong> ARAI-02 FORBIDS "proces/activiteit" vs ESS-02 REQUIRES them</p>

<p><strong>üìç Location 2A - ARAI-02 JSON (FORBIDS "proces/activiteit")</strong></p>
<pre><code>File: src/toetsregels/regels/ARAI-02.json
Lines: 4-20

  "uitleg": "De definitie mag geen containerbegrippen bevatten...",
  "toelichting": "Containerbegrippen zoals 'activiteit', 'proces'...",
  "herkenbaar_patronen": [
    "\\bproces\\b(?!\\s+dat|\\s+van)",      ‚Üê FORBIDS "proces"
    "\\bactiviteit\\b(?!\\s+die|\\s+van)", ‚Üê FORBIDS "activiteit"
  ],
  "foute_voorbeelden": [
    "proces ter ondersteuning",
    "activiteit binnen het systeem"
  ]</code></pre>

<p><strong>üìç Location 2B - ARAI Rules Module (FORBIDS via JSON loading)</strong></p>
<pre><code>File: src/services/prompts/modules/arai_rules_module.py
Lines: 53-92

Loads ARAI-02.json via:
  manager = get_cached_toetsregel_manager()
  all_rules = manager.get_all_regels()
  arai_rules = {k: v for k, v in all_rules.items() if k.startswith("ARAI")}</code></pre>

<p><strong>üìç Location 2C - ESS-02 Requires "proces/activiteit"</strong></p>
<pre><code>File: src/services/prompts/modules/semantic_categorisation_module.py
Lines: 180-197

PROCES CATEGORIE - Focus op HANDELING en VERLOOP:
- 'is een activiteit waarbij...'     ‚Üê REQUIRES "activiteit"
- 'is het proces waarin...'          ‚Üê REQUIRES "proces"
- 'behelst de handeling van...'
- 'omvat de stappen die...'

VOORBEELDEN van procesbegrippen:
- validatie: proces waarbij...        ‚Üê REQUIRES "proces"
- toezicht: activiteit waarbij...     ‚Üê REQUIRES "activiteit"
- sanctionering: het proces van...    ‚Üê REQUIRES "proces"</code></pre>

<p><strong>Impact:</strong> HIGH - For "proces" category terms:</p>
<ul>
<li>ARAI-02: "Avoid 'proces' and 'activiteit'"</li>
<li>ESS-02: "Use 'is een activiteit waarbij' or 'is het proces waarin'"</li>
<li>Result: Model cannot satisfy both rules</li>
</ul>

<p>---</p>

<h3>CONTRADICTION #3: "die/waarbij" - Line 151 vs Templates</h3>
<p><strong>Rule Conflict:</strong> error_prevention FORBIDS "die/waarin" vs templates USE them</p>

<p><strong>üìç Location 3A - Error Prevention (FORBIDS "die")</strong></p>
<pre><code>File: src/services/prompts/modules/error_prevention_module.py
Lines: 143-153

Line 151: "- ‚ùå Vermijd bijzinnen zoals 'die', 'waarin', 'zoals'"
Line 262: "| Bijzinconstructies  | ‚úÖ | Vermijd 'die', 'waarin', 'zoals' enz. |"</code></pre>

<p><strong>üìç Location 3B - Template Module (USES "die")</strong></p>
<pre><code>File: src/services/prompts/modules/template_module.py
Lines: 155-250

Line 201: "- [begrip]: [categorie] die/dat [onderscheidend kenmerk]"  ‚Üê USES "die/dat"
Line 214: "- maatregel: soort interventie die..."                      ‚Üê USES "die"
Line 222: "- sanctie: maatregel die volgt op..."                       ‚Üê USES "die"</code></pre>

<p><strong>üìç Location 3C - Semantic Categorisation (USES "die")</strong></p>
<pre><code>File: src/services/prompts/modules/semantic_categorisation_module.py
Lines: 185-235

Line 214: "- maatregel: soort interventie die..."  ‚Üê USES "die"
Line 222: "- sanctie: maatregel die volgt op..."   ‚Üê USES "die"</code></pre>

<p><strong>üìç Location 3D - INT-08 Allows "die" in Exception Context</strong></p>
<pre><code>File: src/services/prompts/modules/integrity_rules_module.py
Lines: 297-300

Line 297: "uitzondering voor onderdelen die de definitie specifieker maken 
           (bijv. relatieve bijzinnen)."</code></pre>

<p><strong>Impact:</strong> MEDIUM-HIGH - Templates use "die" but error_prevention forbids it:</p>
<ul>
<li>error_prevention: "Vermijd 'die'"</li>
<li>Templates: "Use 'maatregel die volgt op'"</li>
<li>INT-08: "Exception for relative clauses"</li>
<li>Result: Inconsistent guidance on relative clauses</li>
</ul>

<p>---</p>

<h3>CONTRADICTION #4: "een" - Line 146 vs ESS-02 Templates</h3>
<p><strong>Rule Conflict:</strong> error_prevention FORBIDS "een" vs templates REQUIRE "is een"</p>

<p><strong>üìç Location 4A - Error Prevention (FORBIDS "een")</strong></p>
<pre><code>File: src/services/prompts/modules/error_prevention_module.py
Lines: 143-194

Line 146: "- ‚ùå Begin niet met lidwoorden ('de', 'het', 'een')"
Line 179: "een",  ‚Üê In forbidden starters list
Lines 188-191:
    "een belangrijk",
    "een essentieel",
    "een vaak gebruikte",
    "een veelvoorkomende",</code></pre>

<p><strong>üìç Location 4B - ESS-02 Templates (REQUIRE "een")</strong></p>
<pre><code>File: src/services/prompts/modules/semantic_categorisation_module.py
Lines: 138-257

Line 140: "- 'is een activiteit waarbij...'   ‚Üê REQUIRES "een"
Line 143: "- 'is een exemplaar van...'        ‚Üê REQUIRES "een"
Line 182: "- 'is een activiteit waarbij...'   ‚Üê REQUIRES "een"
Line 200: "- 'is een soort...'                ‚Üê REQUIRES "een"
Line 202: "- 'is een type...'                 ‚Üê REQUIRES "een"</code></pre>

<p><strong>Impact:</strong> CRITICAL - Same as Contradiction #1, bundled with "is" issue:</p>
<ul>
<li>error_prevention: "Don't start with 'een'"</li>
<li>ESS-02: "Use 'is een activiteit'" </li>
<li>Result: Templates directly contradict forbidden list</li>
</ul>

<p>---</p>

<h3>CONTRADICTION #5: Context Usage - Implicit vs Explicit</h3>
<p><strong>Rule Conflict:</strong> "Don't mention context" vs "Use specific context"</p>

<p><strong>üìç Location 5A - Context Awareness (REQUIRES Context Use)</strong></p>
<pre><code>File: src/services/prompts/modules/context_awareness_module.py
Lines: 186-279

Line 201: "‚ö†Ô∏è VERPLICHT: Gebruik onderstaande specifieke context..."
Line 241: "‚ö†Ô∏è BELANGRIJKE INSTRUCTIE: Gebruik onderstaande context..."
Line 277: "‚ö†Ô∏è INSTRUCTIE: Formuleer de definitie specifiek voor ... context"</code></pre>

<p><strong>üìç Location 5B - Error Prevention (FORBIDS Context Mention)</strong></p>
<pre><code>File: src/services/prompts/modules/error_prevention_module.py
Lines: 196-248

Lines 226-246: Context-specific FORBIDDEN patterns:
  "- Gebruik de term '{org}' of een variant daarvan niet letterlijk..."
  "- Vermijd expliciete vermelding van juridisch context..."
  "- Vermijd expliciete vermelding van wetboek..."

Line 108: "üö´ Let op: context en bronnen mogen niet letterlijk of 
           herleidbaar in de definitie voorkomen."</code></pre>

<p><strong>Impact:</strong> MEDIUM - Vague guidance on context integration:</p>
<ul>
<li>context_awareness: "Use context to make definition specific"</li>
<li>error_prevention: "Don't mention context literally"</li>
<li>Result: Unclear HOW to use context without mentioning it</li>
</ul>

<p>---</p>

<h2>üîÑ MODULE EXECUTION ORDER</h2>

<p><strong>Orchestrator Logic:</strong></p>
<pre><code>File: src/services/prompts/modules/prompt_orchestrator.py
Lines: 347-372

DEFAULT MODULE ORDER (Lines 354-372):
1. expertise               (Priority: 90)
2. output_specification    (Priority: 85)
3. grammar                 (Priority: 80)
4. context_awareness       (Priority: 70)
5. semantic_categorisation (ESS-02 guidance)  ‚ö†Ô∏è Contradiction source
6. template                (Priority: 60)     ‚ö†Ô∏è Contradiction source
   --- VALIDATION RULES ---
7. arai_rules              (Priority: 75)     ‚ö†Ô∏è Contradiction source
8. con_rules
9. ess_rules               (Priority: 75)     ‚ö†Ô∏è Contradiction source
10. structure_rules        (Priority: 65)     ‚ö†Ô∏è Contradiction source
11. integrity_rules                           ‚ö†Ô∏è Contradiction source
12. sam_rules
13. ver_rules
14. error_prevention                          ‚ö†Ô∏è Contradiction source
15. metrics               (Priority: 50)
16. definition_task       (Priority: 40)

CRITICAL: semantic_categorisation runs BEFORE validation rules
‚Üí Establishes "is een" pattern
‚Üí Then structure_rules FORBIDS "is"
‚Üí ORDER AMPLIFIES CONTRADICTION!</code></pre>

<p>---</p>

<h2>üéØ EXISTING EXCEPTION HANDLING PATTERNS</h2>

<p><strong>Search Results:</strong></p>
<pre><code>grep -r "(EXCEPTION|UITZONDERING|unless|except when|behalve|tenzij)" modules/</code></pre>

<p><strong>Found Patterns:</strong></p>

<h3>1. **INT-08 - Positive Formulation Exception**</h3>
<pre><code>File: src/services/prompts/modules/integrity_rules_module.py
Lines: 297-300

"Een definitie wordt in principe positief geformuleerd, 
 uitzondering voor onderdelen die de definitie specifieker maken 
 (bijv. relatieve bijzinnen)."</code></pre>
<p><strong>Pattern:</strong> "uitzondering voor [condition]"</p>

<h3>2. **Grammar Module - Singular/Plural Exception**</h3>
<pre><code>File: src/services/prompts/modules/grammar_module.py
Line 136

"- Gebruik enkelvoud tenzij het begrip specifiek een meervoud aanduidt"</code></pre>
<p><strong>Pattern:</strong> "[rule] tenzij [condition]"</p>

<h3>3. **Output Specification - Jargon Exception**</h3>
<pre><code>File: src/services/prompts/modules/output_specification_module.py
Line 171

"- Vermijd jargon tenzij noodzakelijk voor het vakgebied"</code></pre>
<p><strong>Pattern:</strong> "Vermijd X tenzij Y"</p>

<h3>4. **Metrics Module - Non-alphanumeric Exception**</h3>
<pre><code>File: src/services/prompts/modules/metrics_module.py
Line 289

"# Check voor niet-alfanumerieke karakters (behalve spaties en koppeltekens)"</code></pre>
<p><strong>Pattern:</strong> "X (behalve Y en Z)"</p>

<p><strong>‚úÖ CONCLUSION:</strong> Exception patterns EXIST and are USED in 4 modules!</p>
<p><strong>Recommended Pattern:</strong> "tenzij [condition]" or "uitzondering voor [context]"</p>

<p>---</p>

<h2>üîó INTEGRATION POINTS FOR FIXES</h2>

<h3>Critical Integration Points:</h3>

<p><strong>1. ModularPromptAdapter (Entry Point)</strong></p>
<pre><code>File: src/services/prompts/modular_prompt_adapter.py
Lines: 42-88

Function: get_cached_orchestrator()
- Singleton pattern
- Registers all 16 modules
- Integration point: Add exception configuration here</code></pre>

<p><strong>2. Module Configuration System</strong></p>
<pre><code>File: src/services/prompts/modular_prompt_adapter.py
Lines: 136-150

Function: _convert_config_to_module_configs()
- Converts PromptComponentConfig to module configs
- Integration point: Add exception_handling config</code></pre>

<p><strong>3. Shared State Between Modules</strong></p>
<pre><code>File: src/services/prompts/modules/base_module.py
Lines: 70-130

Class: ModuleContext
Methods:
- get_shared(key, default)
- set_shared(key, value)

Integration point: Share ontological_category to enable conditional rules</code></pre>

<p><strong>4. Dependency Resolution</strong></p>
<pre><code>File: src/services/prompts/modules/prompt_orchestrator.py
Lines: 97-141

Function: resolve_execution_order()
- Kahn's algorithm for topological sort
- Integration point: Ensure semantic_categorisation runs before rules</code></pre>

<p>---</p>

<h2>üìä CONTRADICTION DEPENDENCY GRAPH</h2>

<pre><code>ModuleContext.ontological_category
    ‚îÇ
    ‚îú‚îÄ&gt; semantic_categorisation_module.py (Sets "proces"/"type"/"resultaat")
    ‚îÇ   ‚îî‚îÄ&gt; Instructs: "Use 'is een activiteit'" ‚ö†Ô∏è
    ‚îÇ
    ‚îú‚îÄ&gt; error_prevention_module.py (Reads context)
    ‚îÇ   ‚îî‚îÄ&gt; Forbids: "'is', 'een', 'proces', 'activiteit', 'die'" ‚ö†Ô∏è
    ‚îÇ
    ‚îú‚îÄ&gt; ess_rules_module.py (Loads ESS-02.json)
    ‚îÇ   ‚îî‚îÄ&gt; Pattern: "\\b(is een|betreft een)" ‚ö†Ô∏è
    ‚îÇ
    ‚îú‚îÄ&gt; arai_rules_module.py (Loads ARAI-02.json)
    ‚îÇ   ‚îî‚îÄ&gt; Forbids: "\\bproces\\b", "\\bactiviteit\\b" ‚ö†Ô∏è
    ‚îÇ
    ‚îú‚îÄ&gt; structure_rules_module.py (Hardcoded STR-01)
    ‚îÇ   ‚îî‚îÄ&gt; Forbids: "^is\\b" ‚ö†Ô∏è
    ‚îÇ
    ‚îî‚îÄ&gt; template_module.py (Provides examples)
        ‚îî‚îÄ&gt; Uses: "maatregel die...", "proces waarbij..." ‚ö†Ô∏è

CRITICAL PATH: semantic_categorisation ‚Üí error_prevention ‚Üí structure_rules
CONFLICT AMPLIFICATION: Each module reinforces contradictions</code></pre>

<p>---</p>

<h2>üõ†Ô∏è FIX INTEGRATION STRATEGY</h2>

<h3>Recommended Fix Points (Priority Order):</h3>

<p><strong>1. HIGHEST PRIORITY - ESS-02 Module (semantic_categorisation)</strong></p>
<pre><code>Action: Add conditional exception clauses based on ontological_category
Location: Lines 136-257
Strategy: "Use 'activiteit waarbij' INSTEAD OF 'is een activiteit'"</code></pre>

<p><strong>2. HIGH PRIORITY - Error Prevention Module</strong></p>
<pre><code>Action: Add ontological_category exceptions to forbidden patterns
Location: Lines 143-194
Strategy: Forbid "is een" EXCEPT when ontological_category is set</code></pre>

<p><strong>3. HIGH PRIORITY - STR-01 Module (structure_rules)</strong></p>
<pre><code>Action: Add exception for ESS-02 category markers
Location: Lines 132-151
Strategy: "Avoid 'is' EXCEPT for ontological category markers"</code></pre>

<p><strong>4. MEDIUM PRIORITY - ARAI-02 Module (arai_rules)</strong></p>
<pre><code>Action: Update JSON to allow "proces/activiteit" with proper continuation
Location: src/toetsregels/regels/ARAI-02.json
Strategy: Keep regex patterns, add exception note in "uitleg"</code></pre>

<p><strong>5. LOW PRIORITY - Template Module</strong></p>
<pre><code>Action: Add "(uitzondering: relatieve bijzinnen)" to examples
Location: Lines 155-250
Strategy: Document why "die" is allowed in specific contexts</code></pre>

<p>---</p>

<h2>üìù EXACT LINE NUMBERS FOR FIXES</h2>

<h3>semantic_categorisation_module.py</h3>
<pre><code>Line 140: "- 'is een activiteit waarbij...'
REPLACE WITH: "- 'activiteit waarbij...' (uitzondering: mag beginnen met 'is een' voor categoriemarkering)"

Line 182-183: PROCES guidance
ADD BEFORE: "‚ö†Ô∏è UITZONDERING voor ESS-02: 'proces' en 'activiteit' zijn toegestaan in deze context"</code></pre>

<h3>error_prevention_module.py</h3>
<pre><code>Line 147: "- ‚ùå Gebruik geen koppelwerkwoord aan het begin ('is', 'betekent', 'omvat')"
REPLACE WITH: "- ‚ùå Gebruik geen koppelwerkwoord aan het begin ('is', 'betekent', 'omvat'), 
               tenzij gevolgd door ontologische categorie (bijv. 'is een activiteit waarbij')"

Line 151: "- ‚ùå Vermijd bijzinnen zoals 'die', 'waarin', 'zoals'"
REPLACE WITH: "- ‚ùå Vermijd bijzinnen zoals 'die', 'waarin', 'zoals', 
               behalve in relatieve bijzinnen die specificeren"</code></pre>

<h3>ARAI-02.json</h3>
<pre><code>Line 4-5: "uitleg" field
ADD: "Uitzondering: 'proces' en 'activiteit' zijn toegestaan wanneer gevolgd door 
      specificerende relativizin (bijv. 'proces dat', 'activiteit die')"</code></pre>

<h3>structure_rules_module.py (STR-01)</h3>
<pre><code>Line 137-139: STR-01 rule text
ADD after line 139: "Uitzondering: 'is een' is toegestaan voor ontologische categoriemarkering 
                     (bijv. 'is een activiteit waarbij', 'is een soort')."</code></pre>

<p>---</p>

<h2>üìö REFERENCE FILES FOR BUSINESS LOGIC</h2>

<p><strong>Validation Rules Storage:</strong></p>
<pre><code>JSON Configs:     src/toetsregels/regels/*.json (45 files)
Python Impls:     src/toetsregels/regels/*.py (45 files)
Cache Manager:    src/toetsregels/cached_manager.py
Rule Cache:       src/toetsregels/rule_cache.py</code></pre>

<p><strong>Module Loading:</strong></p>
<pre><code>Entry Point:      src/services/prompts/prompt_service_v2.py
Adapter:          src/services/prompts/modular_prompt_adapter.py
Orchestrator:     src/services/prompts/modules/prompt_orchestrator.py</code></pre>

<p><strong>Configuration:</strong></p>
<pre><code>Component Config: src/services/prompts/modular_prompt_builder.py (PromptComponentConfig)
Generator Config: src/services/definition_generator_config.py (UnifiedGeneratorConfig)</code></pre>

<p>---</p>

<h2>‚úÖ RECONNAISSANCE COMPLETE</h2>

<p><strong>Total Files Analyzed:</strong> 26 Python files + 3 JSON configs  </p>
<p><strong>Total Lines Analyzed:</strong> ~5,000 lines  </p>
<p><strong>Contradictions Mapped:</strong> 5 (all locations identified)  </p>
<p><strong>Exception Patterns Found:</strong> 4 existing patterns  </p>
<p><strong>Fix Points Identified:</strong> 5 critical integration points  </p>
<p><strong>Exact Line Numbers:</strong> Documented for all contradictions</p>

<p><strong>Next Steps:</strong></p>
<ol>
<li>Review this architecture map with team</li>
<li>Prioritize fixes (ESS-02 ‚Üí error_prevention ‚Üí STR-01)</li>
<li>Implement exception clauses using "tenzij" pattern</li>
<li>Test with 45 validation rules</li>
<li>Verify no new contradictions introduced</li>
</ol>

<p><strong>Risk Assessment:</strong></p>
<ul>
<li>Fixes are SURGICAL (5-10 lines per module)</li>
<li>Exception patterns already exist in codebase</li>
<li>No breaking changes to orchestrator logic</li>
<li>Backwards compatible with existing rules</li>
</ul>

<p>---</p>

<p><strong>Generated for:</strong> DEF-102 (BLOCKING)  </p>
<p><strong>Architecture Version:</strong> Modular v2.0  </p>
<p><strong>Reconnaissance Depth:</strong> VERY THOROUGH ‚úÖ</p>

  </div>
</body>
</html>