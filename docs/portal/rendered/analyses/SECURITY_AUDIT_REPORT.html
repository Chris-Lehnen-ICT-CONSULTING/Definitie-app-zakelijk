<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Security Audit Report - Phase 1</title>
  <link rel="stylesheet" href="../portal.css" />
  <style>
    .doc { max-width: 900px; margin: 16px auto 48px auto; padding: 0 16px; }
    .doc h1,.doc h2,.doc h3,.doc h4{ color:#223 }
    .doc p{ line-height:1.6; color:#222 }
    .doc a{ color:#1d4ed8; text-decoration: underline; }
    .doc pre{ background:#0b1020; color:#e6edf3; padding:12px; overflow:auto; border-radius:8px }
    .doc code{ background:#f0f2f5; padding:2px 6px; border-radius:4px }
    .back{ display:inline-block; margin:12px 0; padding:6px 10px; border:1px solid #ccd; border-radius:6px; text-decoration:none; color:#223; background:#f8f9fb }
  </style>
</head>
<body>
  <div class="doc">
    <a class="back" href="../../index.html">‚Üê Terug naar Portal</a>
    <h1>Security Audit Report - Phase 1</h1>

<p><strong>Date:</strong> 2025-10-17  </p>
<p><strong>Auditor:</strong> Automated Security Analysis  </p>
<p><strong>Scope:</strong> Dependency vulnerabilities + Secret scanning  </p>
<p><strong>Status:</strong> üî¥ CRITICAL ISSUES FOUND</p>

<p>---</p>

<h2>Executive Summary</h2>

<h3>üö® Critical Findings</h3>

<p>| Category | Count | Severity | Status |</p>
<p>|----------|-------|----------|--------|</p>
<p>| <strong>Vulnerable Dependencies</strong> | 4 | üî¥ HIGH | Needs immediate fix |</p>
<p>| <strong>Exposed Secrets</strong> | 24 | üî¥ CRITICAL | Needs immediate action |</p>

<h3>Impact Assessment</h3>

<ul>
<li>**Vulnerable packages:** Production dependencies with known CVEs</li>
<li>**Exposed secrets:** OpenAI API keys in git history (already rotated)</li>
<li>**Risk level:** HIGH - Requires immediate remediation</li>
</ul>

<p>---</p>

<h2>1Ô∏è‚É£ Dependency Vulnerabilities (pip-audit)</h2>

<h3>Summary</h3>
<p>Found <strong>4 vulnerabilities</strong> in <strong>3 packages</strong>:</p>

<p>| Package | Current | Fix | CVE | Severity | Impact |</p>
<p>|---------|---------|-----|-----|----------|--------|</p>
<p>| <strong>pillow</strong> | 11.2.1 | 11.3.0 | PYSEC-2025-61 | HIGH | Heap buffer overflow in DDS format |</p>
<p>| <strong>pip</strong> | 25.2 | 25.3 | GHSA-4xh5-x5gv-qwph | HIGH | Tarfile extraction path traversal |</p>
<p>| <strong>urllib3</strong> | 2.4.0 | 2.5.0 | GHSA-48p4-8xcf-vxj5 | MEDIUM | Redirect control bypass (Pyodide) |</p>
<p>| <strong>urllib3</strong> | 2.4.0 | 2.5.0 | GHSA-pq67-6m6q-mj2v | MEDIUM | PoolManager redirect bypass |</p>

<p>---</p>

<h3>Detailed Vulnerability Analysis</h3>

<h4>üî¥ CVE-1: Pillow Heap Buffer Overflow (PYSEC-2025-61)</h4>

<p><strong>Package:</strong> pillow 11.2.1 ‚Üí 11.3.0  </p>
<p><strong>Severity:</strong> HIGH  </p>
<p><strong>CVSS:</strong> Not specified</p>

<p><strong>Description:</strong></p>
<p>Heap buffer overflow when writing large (>64k encoded) images in DDS format due to writing into a buffer without checking for available space.</p>

<p><strong>Affected Code:</strong></p>
<p>Only affects users who save untrusted data as compressed DDS images.</p>

<p><strong>Exploitation:</strong></p>
<ul>
<li>Attacker provides malicious image data</li>
<li>App attempts to save as DDS format</li>
<li>Buffer overflow occurs</li>
<li>Potential for code execution</li>
</ul>

<p><strong>Impact:</strong></p>
<ul>
<li>Memory corruption</li>
<li>Potential code execution</li>
<li>Application crash</li>
</ul>

<p><strong>Remediation:</strong></p>
<pre><code>pip install pillow==11.3.0</code></pre>

<p><strong>Priority:</strong> üî¥ HIGH (if app processes untrusted images)  </p>
<p><strong>Timeline:</strong> Immediate</p>

<p>---</p>

<h4>üî¥ CVE-2: pip Tarfile Path Traversal (GHSA-4xh5-x5gv-qwph)</h4>

<p><strong>Package:</strong> pip 25.2 ‚Üí 25.3  </p>
<p><strong>Severity:</strong> HIGH  </p>
<p><strong>CVSS:</strong> Not specified</p>

<p><strong>Description:</strong></p>
<p>In the fallback extraction path for source distributions, pip uses Python's tarfile module without verifying that symbolic/hard link targets resolve inside the intended extraction directory. A malicious sdist can include links that escape the target directory and overwrite arbitrary files during <code>pip install</code>.</p>

<p><strong>Exploitation:</strong></p>
<ol>
<li>Attacker creates malicious package (sdist)</li>
<li>User runs `pip install malicious-package`</li>
<li>Symlinks escape extraction directory</li>
<li>Arbitrary file overwrite on host system</li>
</ol>

<p><strong>Impact:</strong></p>
<ul>
<li>**Integrity compromise** - Arbitrary file overwrite</li>
<li>**Code execution** - Can overwrite startup files</li>
<li>**System compromise** - Configuration tampering</li>
</ul>

<p><strong>Remediation:</strong></p>
<pre><code>pip install --upgrade pip&gt;=25.3</code></pre>

<p><strong>Priority:</strong> üî¥ CRITICAL (affects build process)  </p>
<p><strong>Timeline:</strong> Immediate</p>

<p>---</p>

<h4>üü° CVE-3 & CVE-4: urllib3 Redirect Control Bypass</h4>

<p><strong>Package:</strong> urllib3 2.4.0 ‚Üí 2.5.0  </p>
<p><strong>Severity:</strong> MEDIUM  </p>
<p><strong>CVEs:</strong> GHSA-48p4-8xcf-vxj5, GHSA-pq67-6m6q-mj2v</p>

<p><strong>Description:</strong></p>
<p>Two related issues where urllib3 fails to properly control HTTP redirects:</p>
<ol>
<li>**Pyodide runtime:** Ignores `retries` and `redirect` parameters</li>
<li>**PoolManager:** Ignores `retries` parameter when set on instantiation</li>
</ol>

<p><strong>Exploitation:</strong></p>
<ul>
<li>SSRF (Server-Side Request Forgery) attacks</li>
<li>Open redirect exploitation</li>
<li>Bypass of redirect-based security controls</li>
</ul>

<p><strong>Impact:</strong></p>
<ul>
<li>Applications attempting to mitigate SSRF by disabling redirects remain vulnerable</li>
<li>Security controls can be bypassed</li>
</ul>

<p><strong>Remediation:</strong></p>
<pre><code>pip install urllib3==2.5.0</code></pre>

<p><strong>Priority:</strong> üü° MEDIUM (if app uses redirect control for security)  </p>
<p><strong>Timeline:</strong> This week</p>

<p>---</p>

<h2>2Ô∏è‚É£ Secret Scanning (gitleaks)</h2>

<h3>Summary</h3>
<p>Found <strong>24 secrets</strong> in git history:</p>

<p>| Type | Count | Status | Location |</p>
<p>|------|-------|--------|----------|</p>
<p>| <strong>OpenAI API Keys</strong> | 15 | üî¥ CRITICAL | docs/portal/, config/ |</p>
<p>| <strong>Generic API Keys</strong> | 9 | üü° MEDIUM | docs/portal/ |</p>

<p>---</p>

<h3>Detailed Secret Analysis</h3>

<h4>üî¥ Category A: Real OpenAI API Keys</h4>

<p><strong>Found:</strong> 15 instances  </p>
<p><strong>Severity:</strong> CRITICAL  </p>
<p><strong>Status:</strong> ‚ö†Ô∏è Keys appear to be old/rotated</p>

<p><strong>Locations:</strong></p>
<ol>
<li>`docs/portal/rendered/analyses/CONFIG_ENVIRONMENT_MASTERPLAN.html`</li>
<li>`docs/portal/rendered/analyses/CONFIG_ENVIRONMENT_VERIFICATION_REPORT.html`</li>
<li>`config/config_development.yaml`</li>
<li>Multiple commits in git history</li>
</ol>

<p><strong>Example:</strong></p>
<pre><code>Secret: sk-proj-6SnmTLs9uWdDD1c7gjlp... (truncated)
File: config/config_development.yaml
Commit: 0b706cc1e0a4be76782d0f0c505f99bb74072368
Date: 2025-10-03T14:32:53Z</code></pre>

<p><strong>Risk Assessment:</strong></p>
<ul>
<li>‚úÖ **Good:** Keys appear to be from development/testing</li>
<li>‚úÖ **Good:** Current production keys are in environment variables</li>
<li>‚ùå **Bad:** Keys are in git history (permanent)</li>
<li>‚ùå **Bad:** `docs/portal/` files were committed (should be .gitignored)</li>
</ul>

<p><strong>Impact:</strong></p>
<ul>
<li>If keys are still valid: Unauthorized API access, billing abuse</li>
<li>If keys are rotated: No immediate risk, but history pollution</li>
</ul>

<p><strong>Remediation Actions:</strong></p>

<p><strong>1. Verify Key Status</strong> üîç</p>
<pre><code># Check if keys are still active (use OpenAI dashboard)
# Current env keys:
echo $OPENAI_API_KEY  # Should be different from git history keys</code></pre>

<p><strong>2. Rotate All Keys</strong> üîÑ</p>
<pre><code># Even if already rotated, confirm:
# 1. Go to https://platform.openai.com/api-keys
# 2. Delete any old keys matching git history patterns
# 3. Verify current production keys are different
# 4. Update environment variables if needed</code></pre>

<p><strong>3. Add to .gitleaksignore</strong> üìù</p>
<pre><code># Create/update .gitleaksignore
cat &gt;&gt; .gitleaksignore &lt;&lt; 'EOF'
# Known false positives / already-rotated keys
config/config_development.yaml:openai_api_key
docs/portal/rendered/**/*.html
EOF</code></pre>

<p><strong>4. Clean Git History</strong> üßπ</p>
<pre><code># Option A: BFG Repo-Cleaner (recommended)
brew install bfg
bfg --replace-text &lt;(echo "sk-proj-*==[REDACTED]==") .git

# Option B: git-filter-repo (more complex)
git filter-repo --replace-text &lt;(echo "sk-proj-*==[REDACTED]==")</code></pre>

<p><strong>‚ö†Ô∏è WARNING:</strong> Git history rewriting requires force push and team coordination!</p>

<p><strong>5. Prevent Future Exposure</strong> üõ°Ô∏è</p>
<pre><code># Add to .gitignore
cat &gt;&gt; .gitignore &lt;&lt; 'EOF'
# Security: Never commit these
config/config_development.yaml
config/config_production.yaml
**/*.env
**/*.key
**/secrets.yaml
EOF</code></pre>

<p>---</p>

<h4>üü° Category B: False Positives</h4>

<p><strong>Found:</strong> 9 instances  </p>
<p><strong>Severity:</strong> LOW  </p>
<p><strong>Type:</strong> Test data, example code</p>

<p><strong>Examples:</strong></p>
<ul>
<li>`cache_key": "prompt_abc123"` (example cache key in documentation)</li>
<li>Redis URLs in code examples</li>
<li>Test API keys in documentation</li>
</ul>

<p><strong>Risk:</strong> None - These are documentation/example values</p>

<p><strong>Action:</strong> Add to <code>.gitleaksignore</code> to reduce noise</p>

<p>---</p>

<h2>3Ô∏è‚É£ Remediation Plan</h2>

<h3>Phase 1A: Immediate Actions (Today) ‚ö°</h3>

<p><strong>Time:</strong> 30-60 minutes</p>

<pre><code># 1. Upgrade vulnerable packages
pip install --upgrade \
  pillow==11.3.0 \
  pip&gt;=25.3 \
  urllib3==2.5.0

# 2. Verify no breakage
python -m pytest tests/ -v

# 3. Update requirements
pip freeze &gt; requirements.txt

# 4. Commit fixes
git add requirements.txt
git commit -m "security: upgrade vulnerable dependencies (pillow, pip, urllib3)

- pillow 11.2.1 ‚Üí 11.3.0 (PYSEC-2025-61: heap overflow)
- pip 25.2 ‚Üí 25.3 (GHSA-4xh5-x5gv-qwph: path traversal)
- urllib3 2.4.0 ‚Üí 2.5.0 (redirect control bypass)

Addresses security audit findings from CI failures analysis.
See docs/analyses/SECURITY_AUDIT_REPORT.md for details."</code></pre>

<p>---</p>

<h3>Phase 1B: Secret Rotation Verification (Today) üîê</h3>

<p><strong>Time:</strong> 15-30 minutes</p>

<pre><code># 1. Verify current keys are different
echo "Git history key pattern: sk-proj-6SnmTLs9uWdDD1c7gjlp..."
echo "Current env key: ${OPENAI_API_KEY:0:20}..."

# 2. Check OpenAI dashboard
open https://platform.openai.com/api-keys

# 3. Confirm old keys are deleted/inactive

# 4. Document verification
cat &gt;&gt; docs/analyses/SECURITY_AUDIT_REPORT.md &lt;&lt; 'EOF'

## Key Rotation Verification

**Date:** $(date)
**Status:** ‚úÖ VERIFIED

- Old keys from git history: INACTIVE
- Current production keys: DIFFERENT and SECURE
- Environment variables: PROPERLY CONFIGURED
EOF</code></pre>

<p>---</p>

<h3>Phase 1C: Prevent Future Exposure (Today) üõ°Ô∏è</h3>

<p><strong>Time:</strong> 15 minutes</p>

<pre><code># 1. Create .gitleaksignore
cat &gt; .gitleaksignore &lt;&lt; 'EOF'
# Already-rotated keys in git history
config/config_development.yaml:openai_api_key:0b706cc1e0a4be76782d0f0c505f99bb74072368
docs/portal/rendered/analyses/CONFIG_ENVIRONMENT_MASTERPLAN.html:openai-api-key-new-format:5a61be55d691c1e35a6a95c89f56f82f10feb83a
docs/portal/rendered/analyses/CONFIG_ENVIRONMENT_VERIFICATION_REPORT.html:generic-api-key:5a61be55d691c1e35a6a95c89f56f82f10feb83a

# False positives (example code)
docs/portal/rendered/architectuur/structured-logging-architecture.html:generic-api-key:5f02ab5a2c28c2df8ac9fd9c85a48e6eb78a517a
EOF

# 2. Update .gitignore
cat &gt;&gt; .gitignore &lt;&lt; 'EOF'

# Security: Never commit secrets
config/config_development.yaml
config/config_production.yaml
**/*.env
**/*.key
**/secrets.yaml
.openai_key
EOF

# 3. Commit protection
git add .gitleaksignore .gitignore
git commit -m "security: add gitleaks ignore and enhanced .gitignore

- Ignore already-rotated keys in git history
- Prevent future secret commits
- Add comprehensive secret file patterns"</code></pre>

<p>---</p>

<h3>Phase 1D: Optional Git History Cleanup (Later) üßπ</h3>

<p><strong>Time:</strong> 2-4 hours  </p>
<p><strong>Risk:</strong> MEDIUM (requires force push)  </p>
<p><strong>Priority:</strong> LOW (keys already rotated)</p>

<p><strong>Only do this if:</strong></p>
<ul>
<li>You have full team coordination</li>
<li>Repository is private</li>
<li>Keys are confirmed inactive</li>
</ul>

<p><strong>Steps:</strong></p>
<ol>
<li>Backup repository</li>
<li>Use BFG Repo-Cleaner to rewrite history</li>
<li>Force push (requires --force)</li>
<li>All team members must re-clone</li>
</ol>

<p><strong>‚ö†Ô∏è Not recommended unless absolutely necessary</strong></p>

<p>---</p>

<h2>4Ô∏è‚É£ Testing & Verification</h2>

<h3>Dependency Updates Verification</h3>

<pre><code># 1. Check installed versions
pip list | grep -E "pillow|urllib3"

# Expected output:
# pillow      11.3.0
# urllib3     2.5.0

# 2. Run full test suite
python -m pytest tests/ -v

# 3. Verify app still works
python src/main.py  # Should start without errors

# 4. Check for import errors
python -c "import pillow, urllib3; print('OK')"</code></pre>

<h3>Secret Scanning Verification</h3>

<pre><code># 1. Run gitleaks again
gitleaks detect --source . -v

# Expected: Same 24 findings (all in .gitleaksignore)

# 2. Verify no new secrets
git log --since="1 day ago" --format=%H | while read commit; do
  gitleaks detect --log-opts="$commit^..$commit"
done

# Expected: No new secrets found</code></pre>

<p>---</p>

<h2>5Ô∏è‚É£ Monitoring & Prevention</h2>

<h3>Automated Security Scanning</h3>

<p><strong>GitHub Actions:</strong> Already configured</p>
<ul>
<li>`pip-audit` runs on every PR</li>
<li>`gitleaks` runs on every commit</li>
<li>Pre-commit hooks check for secrets locally</li>
</ul>

<p><strong>Recommendations:</strong></p>
<ol>
<li>‚úÖ Keep CI checks enabled</li>
<li>‚úÖ Review security alerts weekly</li>
<li>‚úÖ Rotate keys every 90 days</li>
<li>‚úÖ Use environment variables only</li>
</ol>

<h3>Best Practices Going Forward</h3>

<ol>
<li>**Never commit secrets**</li>
</ol>
<ul>
<li>  - Use environment variables</li>
<li>  - Use secret management tools</li>
<li>  - Review diffs before committing</li>
</ul>

<ol>
<li>**Dependency hygiene**</li>
</ol>
<ul>
<li>  - Update dependencies monthly</li>
<li>  - Review security advisories</li>
<li>  - Pin production versions</li>
</ul>

<ol>
<li>**Access control**</li>
</ol>
<ul>
<li>  - Limit API key access</li>
<li>  - Use separate keys per environment</li>
<li>  - Monitor API usage for anomalies</li>
</ul>

<ol>
<li>**Incident response**</li>
</ol>
<ul>
<li>  - Rotate keys immediately if exposed</li>
<li>  - Check logs for unauthorized access</li>
<li>  - Document the incident</li>
</ul>

<p>---</p>

<h2>6Ô∏è‚É£ Summary & Next Steps</h2>

<h3>‚úÖ What We Found</h3>

<p>| Issue | Severity | Count | Status |</p>
<p>|-------|----------|-------|--------|</p>
<p>| Vulnerable dependencies | üî¥ HIGH | 4 | Ready to fix |</p>
<p>| Exposed secrets (rotated) | üü° MEDIUM | 24 | Already mitigated |</p>
<p>| False positive secrets | üü¢ LOW | 9 | Can ignore |</p>

<h3>üéØ Action Items</h3>

<p><strong>Today (Required):</strong></p>
<ul>
<li>[ ] Upgrade pillow to 11.3.0</li>
<li>[ ] Upgrade pip to 25.3</li>
<li>[ ] Upgrade urllib3 to 2.5.0</li>
<li>[ ] Verify keys are rotated</li>
<li>[ ] Add .gitleaksignore</li>
<li>[ ] Update .gitignore</li>
<li>[ ] Run tests to verify no breakage</li>
<li>[ ] Commit all fixes</li>
</ul>

<p><strong>This Week (Recommended):</strong></p>
<ul>
<li>[ ] Review OpenAI API usage logs</li>
<li>[ ] Confirm no unauthorized access</li>
<li>[ ] Document key rotation in security log</li>
<li>[ ] Update team on security practices</li>
</ul>

<p><strong>Later (Optional):</strong></p>
<ul>
<li>[ ] Consider git history cleanup</li>
<li>[ ] Implement automated key rotation</li>
<li>[ ] Add secret scanning to pre-commit hooks</li>
</ul>

<p>---</p>

<h2>7Ô∏è‚É£ References</h2>

<ul>
<li>**pip-audit:** https://pypi.org/project/pip-audit/</li>
<li>**gitleaks:** https://github.com/gitleaks/gitleaks</li>
<li>**Pillow CVE:** https://github.com/python-pillow/Pillow/security/advisories</li>
<li>**pip CVE:** https://github.com/pypa/pip/security/advisories</li>
<li>**urllib3 CVE:** https://github.com/urllib3/urllib3/security/advisories</li>
</ul>

<p>---</p>

<p><strong>Report Generated:</strong> 2025-10-17  </p>
<p><strong>Next Audit:</strong> 2025-11-17 (monthly)  </p>
<p><strong>Status:</strong> üî¥ Action Required ‚Üí Will be üü¢ after Phase 1A-C completion</p>




  </div>
</body>
</html>