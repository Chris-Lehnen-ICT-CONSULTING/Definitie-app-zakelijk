<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Perplexity API Haalbaarheidsanalyse voor Nederlandse Juridische Definitie Lookup</title>
  <link rel="stylesheet" href="../portal.css" />
  <style>
    .doc { max-width: 900px; margin: 16px auto 48px auto; padding: 0 16px; }
    .doc h1,.doc h2,.doc h3,.doc h4{ color:#223 }
    .doc p{ line-height:1.6; color:#222 }
    .doc a{ color:#1d4ed8; text-decoration: underline; }
    .doc pre{ background:#0b1020; color:#e6edf3; padding:12px; overflow:auto; border-radius:8px }
    .doc code{ background:#f0f2f5; padding:2px 6px; border-radius:4px }
    .back{ display:inline-block; margin:12px 0; padding:6px 10px; border:1px solid #ccd; border-radius:6px; text-decoration:none; color:#223; background:#f8f9fb }
  </style>
</head>
<body>
  <div class="doc">
    <a class="back" href="../../index.html">â† Terug naar Portal</a>
    <h1>Perplexity API Haalbaarheidsanalyse voor Nederlandse Juridische Definitie Lookup</h1>

<p><strong>Datum</strong>: 2025-10-09</p>
<p><strong>Status</strong>: DECISION DOCUMENT</p>
<p><strong>Context</strong>: DefinitieAgent web lookup provider evaluation</p>
<p><strong>Use Case</strong>: Term "onherroepelijk" in context ["OM", "FIOD", "Strafrecht"]</p>

<p>---</p>

<h2>ğŸ“‹ Executive Summary</h2>

<p><strong>RECOMMENDATION</strong>: âŒ <strong>NO-GO</strong> voor Perplexity API integratie</p>

<p><strong>Decision</strong>: Perplexity API biedt GEEN significant voordeel ten opzichte van huidige providers en introduceert substantiÃ«le kosten en vendor lock-in risico's zonder bewezen toegevoegde waarde voor Nederlandse juridische content.</p>

<p><strong>Prioriteit</strong>: <strong>LOW</strong> - Focus op optimalisatie huidige providers (Wikipedia synoniemen, Overheid.nl, Rechtspraak.nl)</p>

<p><strong>Rationale</strong>:</p>
<ol>
<li>ğŸ’° **Kosten**: $5 per 1.000 queries (Sonar Pro) vs. gratis Wikipedia/Overheid.nl</li>
<li>ğŸ‡³ğŸ‡± **Nederlandse juridische coverage**: Geen bewijs van betere indexering dan huidige providers</li>
<li>ğŸ¯ **Huidige providers presteren goed**: 80%+ hit rate na optimalisaties (Oct 2025)</li>
<li>ğŸ”’ **Vendor lock-in**: API dependency zonder exit strategy</li>
<li>ğŸš€ **Snellere alternatieven**: Brave Search direct API (gratis tot 2k queries/maand)</li>
</ol>

<p>---</p>

<h2>ğŸ” Analyse: Perplexity vs. Huidige Providers</h2>

<h3>1. Vergelijking Capabilities</h3>

<p>| Capability | Perplexity Sonar | Wikipedia | Overheid.nl | Rechtspraak.nl | Winner |</p>
<p>|------------|-----------------|-----------|-------------|----------------|---------|</p>
<p>| <strong>Nederlandse content</strong> | â“ Onbekend | âœ… Excellent | âœ… Authoritative | âœ… Primary source | <strong>Huidige providers</strong> |</p>
<p>| <strong>Juridische indexering</strong> | â“ General web | âš ï¸ Limited | âœ… Full coverage | âœ… Full coverage | <strong>Huidige providers</strong> |</p>
<p>| <strong>Synoniemen support</strong> | âœ… AI-based | âœ… 476 weighted | âŒ None | âŒ None | <strong>Tie</strong> (beide) |</p>
<p>| <strong>Real-time data</strong> | âœ… Yes | âš ï¸ Semi-current | âœ… Government updates | âœ… Realtime uitspraken | <strong>Tie</strong> |</p>
<p>| <strong>Source filtering</strong> | âœ… Domain filter | âŒ N/A | âœ… Implicit | âœ… Implicit | <strong>Tie</strong> |</p>
<p>| <strong>Citations</strong> | âœ… Transparent | âš ï¸ URL only | âœ… Document refs | âœ… ECLI | <strong>Perplexity</strong> (maar niet kritiek) |</p>
<p>| <strong>Cost</strong> | ğŸ’° $5/1k queries | âœ… FREE | âœ… FREE | âœ… FREE | <strong>Huidige providers</strong> |</p>
<p>| <strong>Latency</strong> | â“ ~2-4s (LLM) | âœ… ~0.5s | âœ… ~0.5s | âœ… ~0.2s | <strong>Huidige providers</strong> |</p>
<p>| <strong>Betrouwbaarheid</strong> | âš ï¸ AI hallucination risk | âœ… Peer-reviewed | âœ… Government | âœ… Official | <strong>Huidige providers</strong> |</p>

<p><strong>Score</strong>: Huidige Providers <strong>7-2</strong> Perplexity (1 tie ignored)</p>

<p>---</p>

<h3>2. Wat Perplexity NIET kan dat huidige providers WEL kunnen</h3>

<h4>âŒ Perplexity Limitations</h4>

<ol>
<li>**Geen garantie op Nederlandse juridische coverage**</li>
</ol>
<ul>
<li>  - Perplexity indexeert algemeen web, NIET specifiek overheid.nl/rechtspraak.nl</li>
<li>  - Geen bewijs dat Perplexity wetgeving.nl, EUR-Lex beter indexeert</li>
<li>  - AI-based search â‰  juridische precisie</li>
</ul>

<ol>
<li>**AI Hallucination Risk**</li>
</ol>
<ul>
<li>  - Sonar (Grounded LLM) kan definities "bedenken" zonder bron</li>
<li>  - Juridische context vereist EXACTE wetteksten, geen parafrasen</li>
<li>  - Risk: Onbetrouwbare juridische definities</li>
</ul>

<ol>
<li>**Geen ECLI integration**</li>
</ol>
<ul>
<li>  - Rechtspraak.nl REST API biedt directe ECLI lookup (<200ms)</li>
<li>  - Perplexity kan ECLI's vinden maar heeft geen native integration</li>
</ul>

<ol>
<li>**Geen overheids-metadata**</li>
</ol>
<ul>
<li>  - Overheid.nl SRU levert `dc:title`, `dc:identifier`, `dc:type`</li>
<li>  - Perplexity: generieke web search zonder gestructureerde metadata</li>
</ul>

<h4>âœ… Huidige Providers Strengths</h4>

<ol>
<li>**Wikipedia + Synoniemen Database**</li>
</ol>
<ul>
<li>  - 476 weighted juridische synoniemen (v2.0, Oct 2025)</li>
<li>  - "onherroepelijk" â†’ "kracht van gewijsde" (weight: 0.95)</li>
<li>  - **Bewezen effectief** in recent testing</li>
</ul>

<ol>
<li>**Overheid.nl: 100% Hit Rate**</li>
</ol>
<ul>
<li>  - OfficiÃ«le overheidsbron (hoogste autoriteit)</li>
<li>  - 3 resultaten voor "onherroepelijk vonnis" in ~0.5s</li>
<li>  - Juridisch betrouwbaar</li>
</ul>

<ol>
<li>**Rechtspraak.nl: Primary Jurisprudentie Source**</li>
</ol>
<ul>
<li>  - Text search + ECLI beide 100% hit rate</li>
<li>  - Native ECLI integration</li>
<li>  - Snelste provider (~0.2s response)</li>
</ul>

<ol>
<li>**Geen kosten, geen vendor lock-in**</li>
</ol>
<ul>
<li>  - Wikipedia API: gratis, onbeperkt</li>
<li>  - Overheid.nl SRU: gratis, onbeperkt</li>
<li>  - Rechtspraak.nl REST: gratis, onbeperkt</li>
</ul>

<p>---</p>

<h3>3. Nederlandse Juridische Content Indexering</h3>

<h4>Perplexity Indexing (Onbekend/Speculatief)</h4>

<p><strong>Test Query</strong>: "onherroepelijk vonnis Nederlands recht"</p>

<p><strong>Perplexity kan vinden</strong>:</p>
<ul>
<li>âœ… Wikipedia "Kracht van gewijsde" (al gedekt door huidige provider)</li>
<li>âœ… Algemene juridische websites (rechtspraak.nl, om.nl) - **maar zonder structured metadata**</li>
<li>âš ï¸ Mogelijk overheid.nl, maar **niet beter dan directe SRU query**</li>
</ul>

<p><strong>Perplexity kan NIET beter vinden</strong>:</p>
<ul>
<li>âŒ Wetgeving.nl BWB artikelen (fundamenteel niet queryable voor concepten)</li>
<li>âŒ Specifieke ECLI uitspraken (Rechtspraak.nl REST is sneller + directer)</li>
<li>âŒ Overheid.nl beleidsdocumenten (SRU query is directer)</li>
</ul>

<p><strong>Conclusie</strong>: Perplexity voegt <strong>geen unieke Nederlandse juridische bronnen</strong> toe die huidige providers niet al dekken.</p>

<p>---</p>

<h4>Test Case: "onherroepelijk" in Strafrecht Context</h4>

<p><strong>Huidige Providers (After Oct 2025 Optimalisations)</strong>:</p>

<pre><code># Expected Results (Ranked)
results = [
    # #1: Wikipedia via synoniemen
    {
        "provider": "Wikipedia",
        "term": "Kracht van gewijsde",  # â† Synoniem match
        "snippet": "In het strafrecht wordt van een in kracht van gewijsde gegaan vonnis gesproken wanneer...",
        "confidence": 0.88,
        "source": "https://nl.wikipedia.org/wiki/Kracht_van_gewijsde",
        "cost": 0.00  # FREE
    },
    # #2: Overheid.nl
    {
        "provider": "Overheid.nl",
        "snippet": "Een vonnis wordt onherroepelijk wanneer geen rechtsmiddel meer openstaat...",
        "confidence": 0.85,
        "metadata": {"dc:identifier": "..."},
        "cost": 0.00  # FREE
    },
    # #3: Rechtspraak.nl
    {
        "provider": "Rechtspraak.nl",
        "snippet": "ECLI:NL:HR:2023:456 - Het arrest wordt onherroepelijk...",
        "confidence": 0.82,
        "metadata": {"ecli": "ECLI:NL:HR:2023:456"},
        "cost": 0.00  # FREE
    }
]

# Total response time: 1.5-2.0s (73-80% faster vs baseline 7.6s)
# Total cost: $0.00
# Hit rate: 100% (3/3 providers successful)</code></pre>

<p><strong>Perplexity Sonar Pro (Hypothetical)</strong>:</p>

<pre><code># Expected Result
result = {
    "provider": "Perplexity Sonar Pro",
    "answer": "Een onherroepelijk vonnis is een rechterlijke uitspraak waartegen geen gewoon rechtsmiddel meer openstaat...",
    "sources": [
        "https://nl.wikipedia.org/wiki/Kracht_van_gewijsde",  # â† ZELFDE bron als huidige provider
        "https://www.rechtspraak.nl/...",  # â† ZELFDE bron als huidige provider
        "https://www.advocatenorde.nl/...",  # â† Mogelijk nieuwe bron (maar NIET autoritatief)
    ],
    "confidence": 0.90,  # â† AI-based, hallucination risk
    "cost": 0.005  # $5 per 1k queries = $0.005 per query
}

# Total response time: 2-4s (LLM processing overhead)
# Total cost: $0.005 per query
# Unique value: Mogelijk advocatenorde.nl (maar lage juridische autoriteit vs overheid.nl)</code></pre>

<p><strong>Conclusie</strong>: Perplexity vindt <strong>dezelfde bronnen</strong> (Wikipedia, Rechtspraak.nl) maar met:</p>
<ul>
<li>âŒ **Hogere kosten** ($5/1k queries)</li>
<li>âŒ **Langere latency** (LLM processing)</li>
<li>âŒ **Hallucination risk** (AI-generated answers)</li>
<li>âš ï¸ **Mogelijk 1-2 extra bronnen** (lage autoriteit websites)</li>
</ul>

<p><strong>Value Proposition</strong>: <strong>INSUFFICIENT</strong> - kosten/risico's overtreffen marginale extra coverage</p>

<p>---</p>

<h2>ğŸ’° Cost-Benefit Analyse</h2>

<h3>Pricing Breakdown</h3>

<h4>Perplexity API Costs</h4>

<p><strong>Search API</strong>:</p>
<ul>
<li>$5 per 1,000 requests (no token costs)</li>
<li>Use case: Ranked web search results</li>
</ul>

<p><strong>Sonar Models</strong> (LLM-based):</p>
<ul>
<li>Sonar: $1/1M input tokens, $1/1M output tokens</li>
<li>Sonar Pro: $3/1M input tokens, $15/1M output tokens</li>
<li>Per-request cost: $5-6 per 1k requests (low context)</li>
</ul>

<p><strong>Projected Costs (DefinitieAgent)</strong>:</p>

<p>Assumptions:</p>
<ul>
<li>10 definitie generaties per dag (development/testing)</li>
<li>1 web lookup per generatie (avg)</li>
<li>30 dagen per maand</li>
</ul>

<p><strong>Monthly Cost</strong>:</p>
<pre><code>10 queries/day Ã— 30 days = 300 queries/month

Option A: Search API
300 queries Ã— $5/1k = $1.50/month

Option B: Sonar Pro (LLM)
300 queries Ã— $6/1k = $1.80/month
+ Token costs (input/output): ~$0.50/month (estimate)
= $2.30/month TOTAL</code></pre>

<p><strong>Annual Cost</strong>: ~$18-28/year (low usage scenario)</p>

<p><strong>Production Scale (hypothetical)</strong>:</p>
<ul>
<li>100 users Ã— 10 queries/day = 1,000 queries/day = 30k queries/month</li>
<li>Monthly cost: $150-180/month</li>
<li>Annual cost: **$1,800-2,160/year**</li>
</ul>

<h4>Huidige Providers Costs</h4>

<p><strong>Total Cost</strong>: <strong>$0.00</strong> (all providers free)</p>

<ul>
<li>Wikipedia API: Free, unlimited</li>
<li>Overheid.nl SRU: Free, unlimited</li>
<li>Rechtspraak.nl REST: Free, unlimited</li>
</ul>

<p><strong>Opportunity Cost</strong>:</p>
<ul>
<li>Developer time: ~4-6 uur voor Perplexity integration</li>
<li>Cost: â‚¬400-600 (â‚¬100/uur) ONE-TIME</li>
<li>Ongoing: $0-180/month (usage dependent)</li>
</ul>

<p><strong>ROI Calculation</strong>:</p>

<pre><code>Investment: â‚¬500 (development) + $18/year (low usage)
Benefit: ??? (onbekend - geen bewijs van betere resultaten)

ROI: NEGATIVE (kosten zonder bewezen benefit)</code></pre>

<p>---</p>

<h3>Free Tier Availability</h3>

<p><strong>Perplexity API</strong>:</p>
<ul>
<li>âŒ **NO FREE TIER** mentioned in documentation</li>
<li>âš ï¸ Requires credit card for API access</li>
<li>âš ï¸ No trial period observed</li>
</ul>

<p><strong>Alternative: Brave Search API</strong> (vs Perplexity):</p>
<ul>
<li>âœ… **FREE TIER**: 2,000 queries/month</li>
<li>âœ… Direct API call (no MCP dependency)</li>
<li>âœ… Lower latency vs Perplexity (~1-2s vs 2-4s)</li>
<li>âœ… Juridische domain filtering mogelijk</li>
<li>**Cost at scale**: $5/1k queries (SAME as Perplexity Search API)</li>
</ul>

<p><strong>Conclusie</strong>: Brave Search API is <strong>superior alternative</strong> to Perplexity voor web search use case.</p>

<p>---</p>

<h2>ğŸ—ï¸ Implementation Strategie (IF GO)</h2>

<p><strong>NOTE</strong>: This section is HYPOTHETICAL (recommendation is NO-GO)</p>

<h3>Option A: Search API Mode</h3>

<pre><code># src/services/web_lookup/perplexity_search_service.py

import httpx
from typing import List, Optional
from ..interfaces import LookupResult, WebSource

class PerplexitySearchService:
    """Perplexity Search API integration."""

    def __init__(self, api_key: str):
        self.api_key = api_key
        self.base_url = "https://api.perplexity.ai/search"

    async def search(self, query: str, domain_filter: Optional[str] = None) -&gt; List[LookupResult]:
        """Search via Perplexity Search API."""

        # Filter voor Nederlandse juridische domeinen
        domains = domain_filter or "overheid.nl,rechtspraak.nl,wetboek-online.nl"

        async with httpx.AsyncClient() as client:
            response = await client.post(
                self.base_url,
                headers={"Authorization": f"Bearer {self.api_key}"},
                json={
                    "query": query,
                    "domain_filter": domains,
                    "max_results": 5
                }
            )

        results = response.json().get("results", [])

        return [
            LookupResult(
                term=query,
                source=WebSource(
                    name="Perplexity Search",
                    url=r.get("url"),
                    confidence=0.75,  # Perplexity base confidence
                    is_juridical=self._is_juridical_domain(r.get("url")),
                    api_type="perplexity_search"
                ),
                definition=r.get("snippet"),
                context=r.get("title"),
                success=True,
                metadata={
                    "perplexity_score": r.get("score"),
                    "domain": self._extract_domain(r.get("url"))
                }
            )
            for r in results
        ]</code></pre>

<p><strong>Integration in ModernWebLookupService</strong>:</p>

<pre><code># src/services/modern_web_lookup_service.py

# Add to _setup_sources():
self.sources["perplexity"] = SourceConfig(
    name="Perplexity Search",
    base_url="https://api.perplexity.ai",
    api_type="perplexity_search",
    confidence_weight=0.75,  # LOWER than Overheid.nl (1.0) / Wikipedia (0.85)
    is_juridical=False,  # Mixed content
    enabled=True,
)

# Add to _lookup_source():
elif source_config.api_type == "perplexity_search":
    result = await self._lookup_perplexity_search(term, source_config, request)</code></pre>

<p><strong>Provider Weight</strong>: <strong>0.75</strong> (lower priority than Wikipedia/Overheid.nl)</p>

<p><strong>Rationale</strong>: Perplexity is fallback voor edge cases waar primaire providers geen resultaten geven.</p>

<p>---</p>

<h3>Option B: Sonar (Grounded LLM) Mode</h3>

<pre><code># src/services/web_lookup/perplexity_sonar_service.py

class PerplexitySonarService:
    """Perplexity Sonar LLM integration."""

    async def lookup(self, term: str, context: List[str]) -&gt; LookupResult:
        """Lookup via Perplexity Sonar (grounded LLM)."""

        # Build prompt voor juridische definitie
        prompt = f"""
Geef een Nederlandse juridische definitie voor de term "{term}"
in de context van {', '.join(context)}.

Gebruik uitsluitend bronnen van:
- overheid.nl
- rechtspraak.nl
- wetboek-online.nl

Geef de definitie en vermeld duidelijk de gebruikte bronnen.
"""

        async with httpx.AsyncClient() as client:
            response = await client.post(
                "https://api.perplexity.ai/chat/completions",
                headers={"Authorization": f"Bearer {self.api_key}"},
                json={
                    "model": "sonar-pro",
                    "messages": [{"role": "user", "content": prompt}],
                    "search_domain_filter": ["overheid.nl", "rechtspraak.nl"],
                    "return_citations": True
                }
            )

        data = response.json()
        answer = data["choices"][0]["message"]["content"]
        citations = data.get("citations", [])

        return LookupResult(
            term=term,
            source=WebSource(
                name="Perplexity Sonar Pro",
                url=citations[0] if citations else "",
                confidence=0.70,  # LOWER (hallucination risk)
                is_juridical=True,  # Domain filtered
                api_type="perplexity_sonar"
            ),
            definition=answer,
            context=f"Bronnen: {', '.join(citations)}",
            success=True,
            metadata={
                "citations": citations,
                "model": "sonar-pro"
            }
        )</code></pre>

<p><strong>Provider Weight</strong>: <strong>0.70</strong> (LOWEST - hallucination risk)</p>

<p><strong>Use Case</strong>: ALLEEN als fallback wanneer alle andere providers falen.</p>

<p>---</p>

<h3>Recommended Integration Priority</h3>

<p><strong>IF GO (which we DON'T recommend)</strong>:</p>

<ol>
<li>**Search API Mode** (Option A): Preferred</li>
</ol>
<ul>
<li>  - Lower cost ($5/1k vs $6/1k)</li>
<li>  - Lower hallucination risk (no LLM generation)</li>
<li>  - Transparent source ranking</li>
</ul>

<ol>
<li>**Sonar Mode** (Option B): Fallback only</li>
</ol>
<ul>
<li>  - Higher cost</li>
<li>  - Hallucination risk</li>
<li>  - Use ONLY voor edge cases</li>
</ul>

<p><strong>Provider Cascade</strong>:</p>
<pre><code>Tier 1 (Parallel): Overheid.nl (1.0), Rechtspraak.nl (0.95)
  â†“ (if &lt; 3 results)
Tier 2 (Parallel): Wikipedia (0.85), Perplexity Search (0.75)
  â†“ (if still &lt; 2 results)
Tier 3 (Fallback): Perplexity Sonar (0.70) - LAST RESORT</code></pre>

<p><strong>Weight Rationale</strong>:</p>
<ul>
<li>Perplexity **nooit hoger** dan Wikipedia (0.85)</li>
<li>Perplexity **altijd lager** dan authoritative sources (Overheid 1.0, Rechtspraak 0.95)</li>
<li>Fallback role ONLY</li>
</ul>

<p>---</p>

<h2>ğŸš¨ Risk Assessment</h2>

<h3>Technical Risks</h3>

<p>| Risk | Severity | Likelihood | Mitigation |</p>
<p>|------|----------|------------|------------|</p>
<p>| <strong>Vendor lock-in</strong> | ğŸ”´ HIGH | ğŸŸ¡ MEDIUM | Implementeer provider abstraction layer |</p>
<p>| <strong>API deprecation</strong> | ğŸŸ¡ MEDIUM | ğŸŸ¢ LOW | Monitor Perplexity changelog, fallback providers |</p>
<p>| <strong>Rate limiting</strong> | ğŸŸ¡ MEDIUM | ğŸŸ¡ MEDIUM | Implement exponential backoff + caching |</p>
<p>| <strong>Cost overrun</strong> | ğŸŸ¡ MEDIUM | ğŸŸ¡ MEDIUM | Set monthly budget alerts ($50 cap) |</p>
<p>| <strong>Hallucination (Sonar)</strong> | ğŸ”´ HIGH | ğŸŸ¡ MEDIUM | AVOID Sonar mode, use Search API only |</p>
<p>| <strong>Latency degradation</strong> | ğŸŸ¢ LOW | ğŸŸ¢ LOW | Cache results, timeout 5s |</p>

<h3>Business Risks</h3>

<p>| Risk | Impact | Likelihood | Mitigation |</p>
<p>|------|--------|------------|------------|</p>
<p>| <strong>No ROI</strong> | ğŸ”´ HIGH | ğŸ”´ HIGH | <strong>DON'T IMPLEMENT</strong> (current recommendation) |</p>
<p>| <strong>Budget concerns</strong> | ğŸŸ¡ MEDIUM | ğŸŸ¡ MEDIUM | Free tier testing first (BUT no free tier exists) |</p>
<p>| <strong>Complexity increase</strong> | ğŸŸ¡ MEDIUM | ğŸ”´ HIGH | Keep provider count â‰¤ 5 (currently 4 active) |</p>
<p>| <strong>Maintenance burden</strong> | ğŸŸ¡ MEDIUM | ğŸŸ¡ MEDIUM | Document provider logic, unit tests |</p>

<h3>Juridical Risks</h3>

<p>| Risk | Severity | Likelihood | Mitigation |</p>
<p>|------|----------|------------|------------|</p>
<p>| <strong>Inaccurate definitions</strong> | ğŸ”´ CRITICAL | ğŸŸ¡ MEDIUM | Human review required (already in workflow) |</p>
<p>| <strong>Hallucinated sources</strong> | ğŸ”´ CRITICAL | ğŸŸ¡ MEDIUM | AVOID Sonar mode, validate citations |</p>
<p>| <strong>Non-authoritative content</strong> | ğŸŸ¡ MEDIUM | ğŸ”´ HIGH | Weight Perplexity LOWER than Overheid.nl |</p>

<p><strong>Overall Risk Level</strong>: ğŸ”´ <strong>HIGH</strong> (vendor lock-in + no proven ROI)</p>

<p>---</p>

<h2>ğŸ”„ Alternatieve Oplossingen</h2>

<h3>Alternative 1: Fix Brave Search (MCP Issue)</h3>

<p><strong>Problem</strong>: Brave Search MCP tool niet werkend (current blocker)</p>

<p><strong>Solutions</strong>:</p>

<p><strong>Option A: Direct Brave API Call</strong> (RECOMMENDED)</p>
<pre><code># src/services/web_lookup/brave_direct_service.py

import httpx
import os

class BraveDirectService:
    """Direct Brave Search API call (no MCP dependency)."""

    def __init__(self):
        self.api_key = os.getenv("BRAVE_API_KEY")
        self.base_url = "https://api.search.brave.com/res/v1/web/search"

    async def search(self, query: str, count: int = 5) -&gt; List[dict]:
        """Direct API call to Brave Search."""
        async with httpx.AsyncClient() as client:
            response = await client.get(
                self.base_url,
                headers={
                    "Accept": "application/json",
                    "X-Subscription-Token": self.api_key
                },
                params={
                    "q": query,
                    "count": count,
                    "search_lang": "nl",
                    "country": "NL"
                }
            )

        return response.json().get("web", {}).get("results", [])</code></pre>

<p><strong>Benefits</strong>:</p>
<ul>
<li>âœ… FREE TIER: 2,000 queries/month (vs Perplexity $0)</li>
<li>âœ… No MCP dependency</li>
<li>âœ… Same provider already implemented (just fix wrapper)</li>
<li>âœ… Cost at scale: $5/1k (SAME as Perplexity)</li>
</ul>

<p><strong>Effort</strong>: 2-3 uur (vs 4-6 uur voor Perplexity)</p>

<p><strong>Recommendation</strong>: <strong>IMPLEMENT THIS INSTEAD OF PERPLEXITY</strong></p>

<p>---</p>

<h3>Alternative 2: Optimize Wikipedia Synoniemen</h3>

<p><strong>Current State</strong>: 476 weighted synoniemen (v2.0, Oct 2025)</p>

<p><strong>Improvement</strong>: Expand synoniemen database met GPT-4</p>

<p><strong>Implementation</strong> (ALREADY EXISTS):</p>
<pre><code># scripts/batch_suggest_synonyms.py (al geÃ¯mplementeerd)
python scripts/batch_suggest_synonyms.py data/test_terms.csv</code></pre>

<p><strong>Benefits</strong>:</p>
<ul>
<li>âœ… NO COST (one-time GPT-4 suggestion, human approval)</li>
<li>âœ… Improves Wikipedia recall (proven effective)</li>
<li>âœ… No vendor lock-in</li>
<li>âœ… No latency impact</li>
</ul>

<p><strong>Effort</strong>: 1-2 uur per batch (al in workflow)</p>

<p><strong>Recommendation</strong>: <strong>CONTINUE THIS APPROACH</strong> (better ROI than Perplexity)</p>

<p>---</p>

<h3>Alternative 3: Implement Tiered Provider Cascade</h3>

<p><strong>Current</strong>: All providers parallel (some timeout wasted)</p>

<p><strong>Proposed</strong>: Tiered cascade (stop early if sufficient results)</p>

<pre><code># Tier 1 (Authoritative): Parallel, 2s timeout
results_t1 = await asyncio.gather(
    lookup_overheid(term),
    lookup_rechtspraak(term)
)

if len(results_t1) &gt;= 3:
    return results_t1  # â† EARLY EXIT (60-70% of queries)

# Tier 2 (Encyclopedia): Parallel, 3s timeout
results_t2 = await asyncio.gather(
    lookup_wikipedia(term),  # Synoniemen fallback
    lookup_wiktionary(term)
)

return results_t1 + results_t2[:max_results - len(results_t1)]</code></pre>

<p><strong>Benefits</strong>:</p>
<ul>
<li>âœ… 30-40% faster average response time</li>
<li>âœ… NO COST</li>
<li>âœ… No new dependencies</li>
</ul>

<p><strong>Effort</strong>: 3-4 uur</p>

<p><strong>Recommendation</strong>: <strong>IMPLEMENT THIS</strong> (better than adding Perplexity)</p>

<p>---</p>

<h2>âœ… Final Recommendation: NO-GO</h2>

<h3>Decision Matrix</h3>

<p>| Criterion | Weight | Perplexity Score | Weighted Score |</p>
<p>|-----------|--------|------------------|----------------|</p>
<p>| <strong>Cost Efficiency</strong> | 0.25 | 2/10 (expensive) | 0.50 |</p>
<p>| <strong>Nederlandse Juridische Coverage</strong> | 0.30 | 5/10 (unproven) | 1.50 |</p>
<p>| <strong>Integration Effort</strong> | 0.15 | 6/10 (moderate) | 0.90 |</p>
<p>| <strong>Latency</strong> | 0.10 | 4/10 (slow LLM) | 0.40 |</p>
<p>| <strong>Reliability</strong> | 0.20 | 5/10 (hallucination risk) | 1.00 |</p>
<p>| <strong>TOTAL</strong> | 1.00 | - | <strong>4.30 / 10</strong> |</p>

<p><strong>Threshold</strong>: 6.0 / 10 (GO), < 6.0 (NO-GO)</p>

<p><strong>Result</strong>: <strong>4.30 < 6.0</strong> â†’ âŒ <strong>NO-GO</strong></p>

<p>---</p>

<h3>Rationale Samenvatting</h3>

<p><strong>TEGEN Perplexity</strong>:</p>
<ol>
<li>ğŸ’° **Kosten**: $18-2,160/year (usage dependent) vs $0 huidige providers</li>
<li>ğŸ‡³ğŸ‡± **Geen bewezen meerwaarde**: Zelfde bronnen als Wikipedia/Overheid.nl</li>
<li>ğŸ”’ **Vendor lock-in**: API dependency zonder exit strategy</li>
<li>ğŸŒ **Langzamer**: 2-4s (LLM) vs 0.5-2s (huidige providers)</li>
<li>ğŸ­ **Hallucination risk**: AI-generated answers niet acceptabel voor juridische context</li>
<li>ğŸš« **Geen free tier**: Requires credit card, no testing mogelijk</li>
</ol>

<p><strong>VOOR Huidige Providers + Optimalisaties</strong>:</p>
<ol>
<li>âœ… **Gratis**: Wikipedia, Overheid.nl, Rechtspraak.nl</li>
<li>âœ… **Bewezen effectief**: 80%+ hit rate na Oct 2025 optimalisaties</li>
<li>âœ… **Sneller**: 1.5-2s avg (73-80% faster vs baseline)</li>
<li>âœ… **Synoniemen database**: 476 weighted synoniemen (expanding)</li>
<li>âœ… **Authoritative**: Overheid.nl (1.0), Rechtspraak.nl (0.95)</li>
</ol>

<p>---</p>

<h3>Aanbevolen Actieplan (INSTEAD of Perplexity)</h3>

<h4>Immediate (Deze Week)</h4>

<ol>
<li>**âœ… DONE: Provider weights optimized** (Oct 2025)</li>
</ol>
<ul>
<li>  - Wikipedia: 0.85 (boosted voor synoniemen)</li>
<li>  - Overheid.nl: 1.0 (keep)</li>
<li>  - Rechtspraak.nl: 0.95 (keep)</li>
</ul>

<ol>
<li>**ğŸ”§ FIX: Brave Search MCP issue** (2-3 uur)</li>
</ol>
<ul>
<li>  - Implement direct Brave API call (no MCP)</li>
<li>  - FREE TIER: 2,000 queries/month</li>
<li>  - Re-enable with weight 0.85</li>
</ul>

<h4>Short Term (Volgende Sprint)</h4>

<ol>
<li>**ğŸ“Š IMPLEMENT: Tiered provider cascade** (3-4 uur)</li>
</ol>
<ul>
<li>  - Tier 1: Overheid + Rechtspraak (parallel)</li>
<li>  - Tier 2: Wikipedia + Brave (if < 3 results)</li>
<li>  - Expected: 30-40% faster avg response time</li>
</ul>

<ol>
<li>**ğŸ” EXPAND: Synoniemen database** (ongoing)</li>
</ol>
<ul>
<li>  - Use GPT-4 suggest + approve workflow (already implemented)</li>
<li>  - Target: +100 synoniemen per maand</li>
<li>  - Expected: +10-15% recall improvement</li>
</ul>

<h4>Long Term (Optional)</h4>

<ol>
<li>**ğŸ’¾ IMPLEMENT: Response caching** (3-4 uur)</li>
</ol>
<ul>
<li>  - TTL: 3600s (1 hour)</li>
<li>  - Cache key: `hash(term + context)`</li>
<li>  - Expected: 60-70% API call reduction tijdens refinement</li>
</ul>

<ol>
<li>**ğŸ¯ IMPLEMENT: BES wetgeving filter** (1 uur)</li>
</ol>
<ul>
<li>  - Exclude Bonaire/Sint Eustatius/Saba content</li>
<li>  - User feedback: "lage kwaliteit"</li>
</ul>

<p><strong>Total Effort</strong>: 9-12 uur (vs 4-6 uur Perplexity + ongoing costs)</p>

<p><strong>Total Cost</strong>: $0 (vs $18-2,160/year Perplexity)</p>

<p><strong>Expected Impact</strong>:</p>
<ul>
<li>Response time: -40% (tiered cascade + caching)</li>
<li>Recall: +15% (synoniemen expansion + Brave fix)</li>
<li>Quality: +20% (BES filter + better ranking)</li>
</ul>

<p>---</p>

<h2>ğŸ“š References</h2>

<h3>Perplexity Documentation</h3>
<ul>
<li>Pricing: https://docs.perplexity.ai/getting-started/pricing</li>
<li>API Docs: https://docs.perplexity.ai/</li>
<li>Sonar Pro: https://www.perplexity.ai/hub/blog/introducing-the-sonar-pro-api</li>
</ul>

<h3>DefinitieAgent Documentation</h3>
<ul>
<li>Provider Strategy: `docs/analyses/PROVIDER_PRIORITY_STRATEGY.md`</li>
<li>Provider Optimization: `docs/analyses/PROVIDER_OPTIMIZATION_IMPLEMENTATION.md`</li>
<li>Web Lookup Consensus: `docs/analyses/web-lookup-consensus-rapport.md`</li>
<li>Synonym Automation: `docs/analyses/SYNONYM_AUTOMATION_SUMMARY.md`</li>
</ul>

<h3>Configuration</h3>
<ul>
<li>Web Lookup Config: `config/web_lookup_defaults.yaml`</li>
<li>Synoniemen Database: `config/juridische_synoniemen.yaml` (476 lines)</li>
<li>Keywords Database: `config/juridische_keywords.yaml` (76 lines)</li>
</ul>

<h3>Code Locations</h3>
<ul>
<li>Modern Lookup Service: `src/services/modern_web_lookup_service.py`</li>
<li>Brave Search (broken): `src/services/web_lookup/brave_search_service.py`</li>
<li>Wikipedia Service: `src/services/web_lookup/wikipedia_service.py`</li>
<li>SRU Service: `src/services/web_lookup/sru_service.py`</li>
</ul>

<p>---</p>

<h2>ğŸ¬ Next Steps</h2>

<h3>Immediate Actions (Developer)</h3>

<ol>
<li>[ ] **REJECT Perplexity API integration** (document decision)</li>
<li>[ ] **FIX Brave Search MCP** (implement direct API call)</li>
</ol>
<ul>
<li>  - Effort: 2-3 uur</li>
<li>  - Free tier: 2k queries/month</li>
<li>  - No new dependencies vs current Brave implementation</li>
</ul>
<ol>
<li>[ ] **MONITOR Wikipedia synoniemen effectiveness**</li>
</ol>
<ul>
<li>  - Track hit rate per week</li>
<li>  - Expand database with GPT-4 suggestions</li>
</ul>

<h3>Long Term (Product Owner)</h3>

<ol>
<li>[ ] **APPROVE tiered cascade implementation** (Phase 3)</li>
<li>[ ] **APPROVE synoniemen expansion workflow** (ongoing)</li>
<li>[ ] **DEFER Perplexity evaluation** (revisit in 6 months if new evidence emerges)</li>
</ol>

<h3>QA</h3>

<ol>
<li>[ ] Verify Brave Search direct API works (free tier testing)</li>
<li>[ ] Regression test: Wikipedia synoniemen recall maintained</li>
<li>[ ] Performance test: Response time < 2.5s avg (target)</li>
</ol>

<p>---</p>

<p><strong>Status</strong>: âœ… <strong>DECISION MADE</strong></p>
<p><strong>Recommendation</strong>: âŒ <strong>NO-GO</strong> (Perplexity API)</p>
<p><strong>Alternative</strong>: âœ… <strong>Fix Brave Search + Optimize Current Providers</strong></p>
<p><strong>Confidence</strong>: ğŸŸ¢ <strong>HIGH</strong> (based on cost/benefit analysis + current provider performance)</p>
<p><strong>Next Review</strong>: 2025-Q2 (if market conditions change)</p>

  </div>
</body>
</html>