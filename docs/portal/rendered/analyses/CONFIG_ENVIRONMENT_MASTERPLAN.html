<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Configuration & Environment: Complete Analysis & Remediation Plan</title>
  <link rel="stylesheet" href="../portal.css" />
  <style>
    .doc { max-width: 900px; margin: 16px auto 48px auto; padding: 0 16px; }
    .doc h1,.doc h2,.doc h3,.doc h4{ color:#223 }
    .doc p{ line-height:1.6; color:#222 }
    .doc a{ color:#1d4ed8; text-decoration: underline; }
    .doc pre{ background:#0b1020; color:#e6edf3; padding:12px; overflow:auto; border-radius:8px }
    .doc code{ background:#f0f2f5; padding:2px 6px; border-radius:4px }
    .back{ display:inline-block; margin:12px 0; padding:6px 10px; border:1px solid #ccd; border-radius:6px; text-decoration:none; color:#223; background:#f8f9fb }
  </style>
</head>
<body>
  <div class="doc">
    <a class="back" href="../../index.html">â† Terug naar Portal</a>
    <h1>Configuration & Environment: Complete Analysis & Remediation Plan</h1>

<p><strong>Datum</strong>: 2025-10-07</p>
<p><strong>Auteur</strong>: Multi-Agent Analysis (4x parallel agents)</p>
<p><strong>Status</strong>: ğŸ”´ KRITIEKE ISSUES GEVONDEN</p>

<p>---</p>

<h2>Executive Summary</h2>

<p>Na grondige analyse met 4 gespecialiseerde agents zijn <strong>kritieke inconsistenties</strong> gevonden in het environment management systeem:</p>

<ol>
<li>ğŸ”´ **Twee conflicterende environment systemen** (ConfigManager vs ServiceContainer)</li>
<li>ğŸ”´ **ConfigManager hardcoded naar DEVELOPMENT** (negeert APP_ENV)</li>
<li>ğŸ” **Security breach**: Hardcoded API key in git</li>
<li>ğŸ’€ **Dead code**: 3 van 5 config waarden ongebruikt</li>
<li>ğŸ¤· **Development config heeft geen effect** in normale operatie</li>
</ol>

<p>---</p>

<h2>1. Het Dubbele Environment Probleem</h2>

<h3>Huidige Situatie</h3>

<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Application Start                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â–¼                 â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ ConfigManager    â”‚  â”‚ ServiceContainerâ”‚
              â”‚ (DEVELOPMENT)    â”‚  â”‚ (APP_ENV)       â”‚
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚                       â”‚
                     â–¼                       â–¼
           config_development.yaml   ContainerConfigs.production()
                     â”‚                       â”‚
                     â–¼                       â–¼
              [API: gpt-4o-mini]    [Features: production]
              [Temp: 0.9]           [Monitoring: enabled]
              [Log: DEBUG]          [Ontology: enabled]</code></pre>

<p><strong>Probleem</strong>: Twee onafhankelijke systemen laden verschillende configs.</p>

<h3>System 1: ConfigManager (Broken)</h3>

<p><strong>Locatie</strong>: <code>src/config/config_manager.py</code></p>

<p><strong>Gedrag</strong>:</p>
<pre><code># Regel 395: Altijd geforceerd naar DEVELOPMENT
self.environment = Environment.DEVELOPMENT

# Regel 669: Negeert meegegeven environment
_config_manager = ConfigManager(Environment.DEVELOPMENT)</code></pre>

<p><strong>Laadt</strong>:</p>
<ul>
<li>`config/config_default.yaml` (basis)</li>
<li>`config/config_development.yaml` (overrides) â† **ALTIJD**</li>
<li>Environment variables (als override)</li>
</ul>

<p><strong>Gebruikt voor</strong>:</p>
<ul>
<li>API configuratie (model, temperature, timeout)</li>
<li>Logging instellingen</li>
<li>Cache TTLs</li>
<li>Rate limiting</li>
</ul>

<h3>System 2: ServiceContainer (Works)</h3>

<p><strong>Locatie</strong>: <code>src/services/container.py</code>, <code>src/utils/container_manager.py</code></p>

<p><strong>Gedrag</strong>:</p>
<pre><code># Regel 50: Leest APP_ENV correct
env = os.getenv("APP_ENV", "production")  # Default: production

if env == "development":
    config = ContainerConfigs.development()
elif env == "testing":
    config = ContainerConfigs.testing()
else:
    config = ContainerConfigs.production()</code></pre>

<p><strong>Gebruikt voor</strong>:</p>
<ul>
<li>Service initialisatie</li>
<li>Database selectie (`:memory:` in testing)</li>
<li>Feature toggles (monitoring, ontology, etc.)</li>
</ul>

<p><strong>Default</strong>: Zonder <code>APP_ENV</code> draait het in <strong>production mode</strong>.</p>

<p>---</p>

<h2>2. ConfigManager Technical Debt</h2>

<h3>Issue 2.1: Missing Enum Values</h3>

<pre><code># src/config/config_manager.py:23-30
class Environment(Enum):
    """Omgevingstype (vast: development)."""
    DEVELOPMENT = "development"
    # PRODUCTION bestaat niet!
    # TESTING bestaat niet!</code></pre>

<h3>Issue 2.2: Broken Helper Functions</h3>

<pre><code># Regel 749-762: Dead code met AttributeError
def is_production() -&gt; bool:
    return get_config_manager().environment == Environment.PRODUCTION  # â† Crash!

def is_testing() -&gt; bool:
    return get_config_manager().environment == Environment.TESTING  # â† Crash!</code></pre>

<p><strong>Status</strong>: Deze functies worden <strong>nergens gebruikt</strong> (grep: 0 matches).</p>

<h3>Issue 2.3: Ignored Environment Variable</h3>

<pre><code># Regel 474: Expliciet genegeerd
def _load_config_file(self, env_override: str | None = None) -&gt; dict[str, Any]:
    """ENVIRONMENT var wordt expliciet genegeerd."""
    # ...</code></pre>

<p>---</p>

<h2>3. ğŸ” SECURITY BREACH: Hardcoded API Key</h2>

<h3>Locatie</h3>

<p><strong>Bestand</strong>: <code>config/config_development.yaml:15</code></p>

<pre><code>api:
  openai_api_key: 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</code></pre>

<h3>Impact</h3>

<ul>
<li>âœ… Key is **gecommit naar git** (sinds 5 sept 2025)</li>
<li>âœ… Staat in **git history** (niet verwijderbaar zonder rebase)</li>
<li>âš ï¸ Als repo ooit publiek/gedeeld wordt â†’ key compromised</li>
<li>âš ï¸ OpenAI usage kan getraceerd worden naar deze key</li>
</ul>

<h3>Immediate Action Required</h3>

<ol>
<li>**Roteer de key** bij OpenAI dashboard</li>
<li>**Verwijder hardcoded key** uit config files</li>
<li>**Gebruik alleen env variables**: `OPENAI_API_KEY` of `OPENAI_API_KEY_PROD`</li>
<li>**Voeg pre-commit hook toe** om future leaks te voorkomen</li>
</ol>

<p>---</p>

<h2>4. Dead Code: Unused Configuration Values</h2>

<p>Van de 5 <code>ContainerConfigs</code> parameters:</p>

<h3>âœ… GEBRUIKT (3 parameters)</h3>

<p>| Parameter | Gebruikt in | Functie |</p>
<p>|-----------|------------|---------|</p>
<p>| <code>enable_monitoring</code> | <code>ServiceContainer.__init__()</code> | MonitoringConfig toggle |</p>
<p>| <code>enable_ontology</code> | <code>ServiceContainer.__init__()</code> | QualityConfig toggle |</p>
<p>| <code>use_json_rules</code> | <code>ServiceContainer.orchestrator()</code> | Test-only internal rules |</p>

<h3>âŒ ONGEBRUIKT (5 parameters)</h3>

<p>| Parameter | Gedefinieerd | Grep Results | Impact |</p>
<p>|-----------|--------------|--------------|--------|</p>
<p>| <code>enable_auto_save</code> | <code>ContainerConfigs.*()</code> | 0 matches | <strong>GEEN</strong> |</p>
<p>| <code>min_quality_score</code> | <code>ContainerConfigs.*()</code> | 0 matches | <strong>GEEN</strong> |</p>
<p>| <code>enable_all_rules</code> | <code>ContainerConfigs.*()</code> | 0 matches | <strong>GEEN</strong> |</p>
<p>| <code>enable_validation</code> | <code>ContainerConfigs.testing()</code> | 0 matches | <strong>GEEN</strong> |</p>
<p>| <code>enable_enrichment</code> | <code>ContainerConfigs.testing()</code> | 0 matches | <strong>GEEN</strong> |</p>

<p><strong>Conclusie</strong>: De verschillen tussen development/production config zijn <strong>grotendeels illusoir</strong>.</p>

<p>---</p>

<h2>5. Configuration File Analysis</h2>

<h3>Inventory (16 files)</h3>

<h4>Environment-Specific (4 files)</h4>
<ul>
<li>`config_default.yaml` (9,042 bytes) - Basis defaults</li>
<li>`config_development.yaml` (4,565 bytes) - **ALTIJD gebruikt**</li>
<li>`config_production.yaml` (3,048 bytes) - **NOOIT gebruikt**</li>
<li>`config_testing.yaml` (2,876 bytes) - **NOOIT gebruikt**</li>
</ul>

<h4>Feature-Specific (12 files)</h4>
<ul>
<li>`approval_gate.yaml`, `cache_config.yaml`, `logging_config.yaml`, etc.</li>
</ul>

<h3>Meaningful Differences (Development vs Production)</h3>

<p>| Setting | Default | Development | Production | Impact |</p>
<p>|---------|---------|-------------|------------|--------|</p>
<p>| <strong>Model</strong> | gpt-4.1 | <strong>gpt-4o-mini</strong> | gpt-4.1 | ğŸŸ¢ Cost & speed |</p>
<p>| <strong>Temperature</strong> | 0.0 | <strong>0.9</strong> | 0.01 | ğŸŸ¢ Creativity |</p>
<p>| <strong>Timeout</strong> | 30s | <strong>60s</strong> | 30s | ğŸŸ¡ Patience |</p>
<p>| <strong>Max Retries</strong> | 3 | <strong>5</strong> | 3 | ğŸŸ¡ Resilience |</p>
<p>| <strong>Log Level</strong> | INFO | <strong>DEBUG</strong> | INFO | ğŸŸ¢ Verbosity |</p>
<p>| <strong>Rate Limit</strong> | 60 RPM | <strong>120 RPM</strong> | 30 RPM | ğŸŸ¢ Throughput |</p>
<p>| <strong>Cache TTL</strong> | 3600s | <strong>600s</strong> | 3600s | ğŸŸ¡ Freshness |</p>
<p>| <strong>Max Cache Size</strong> | 1000 | <strong>500</strong> | 2000 | ğŸŸ¡ Memory |</p>

<p>ğŸŸ¢ = High value difference</p>
<p>ğŸŸ¡ = Low value difference</p>

<p>---</p>

<h2>6. Current Reality vs Intended Behavior</h2>

<h3>Wat Je Denkt Dat Er Gebeurt</h3>

<pre><code># APP_ENV=production â†’ Stricte production configuratie
api:
  default_model: gpt-4.1
  default_temperature: 0.01
logging:
  level: INFO
rate_limiting:
  requests_per_minute: 30</code></pre>

<h3>Wat Er Echt Gebeurt</h3>

<pre><code># ConfigManager: ALTIJD development (genegeerd APP_ENV)
api:
  default_model: gpt-4o-mini      # â† Goedkoop model
  default_temperature: 0.9         # â† Creatief
logging:
  level: DEBUG                     # â† Verbose
rate_limiting:
  requests_per_minute: 120        # â† Relaxed

# ServiceContainer: Production (APP_ENV default)
enable_monitoring: true           # â† Enabled
enable_ontology: true             # â† Enabled
# Maar deze doen niets:
enable_auto_save: true            # â† Dead code
min_quality_score: 0.7            # â† Dead code</code></pre>

<p><strong>Resultaat</strong>: Je draait een <strong>hybride configuratie</strong> zonder het te weten.</p>

<p>---</p>

<h2>7. Remediation Options</h2>

<h3>Option A: Simplify (RECOMMENDED)</h3>

<p><strong>Strategie</strong>: Verwijder environment abstractie, eenvoudige single-mode app.</p>

<p><strong>Rationale</strong>:</p>
<ul>
<li>CLAUDE.md zegt: "single-user application, NOT in production"</li>
<li>APP_ENV wordt nooit gezet in normale operatie</li>
<li>Development config heeft geen effect</li>
<li>Reduceert complexiteit en verwarring</li>
</ul>

<p><strong>Changes</strong>:</p>
<ol>
<li>Verwijder `Environment` enum uit `config_manager.py`</li>
<li>Verwijder `is_production()`, `is_testing()` functions (dead code)</li>
<li>Hernoem `config_development.yaml` â†’ `config.yaml`</li>
<li>Verwijder `config_production.yaml`, `config_testing.yaml`</li>
<li>Update `ServiceContainer` om 1 configuratie te gebruiken</li>
<li>Behoud testing overrides in `conftest.py` (pytest fixtures)</li>
</ol>

<p><strong>Impact</strong>:</p>
<ul>
<li>âœ… Simpeler, duidelijker</li>
<li>âœ… Geen verwarring over environments</li>
<li>âœ… Verwijdert 3 config files</li>
<li>âœ… Verwijdert dead code</li>
<li>âš ï¸ Toekomstige production deployment vereist herontwerp</li>
</ul>

<h3>Option B: Fix Environment Handling</h3>

<p><strong>Strategie</strong>: Maak environment systeem consistent en werkend.</p>

<p><strong>Rationale</strong>:</p>
<ul>
<li>Voorbereid op toekomstige production deployment</li>
<li>Proper separation of concerns</li>
<li>Development/testing configs hebben theoretisch waarde</li>
</ul>

<p><strong>Changes</strong>:</p>
<ol>
<li>**Fix ConfigManager**:</li>
<pre><code>   class Environment(Enum):
       DEVELOPMENT = "development"
       PRODUCTION = "production"
       TESTING = "testing"

   def __init__(self, environment: Environment | None = None, ...):
       env_name = os.getenv("APP_ENV", "development").lower()
       self.environment = Environment(env_name) if environment is None else environment</code></pre>
</ol>

<ol>
<li>**Unify environment detection**:</li>
</ol>
<ul>
<li>  - ConfigManager en ServiceContainer gebruiken beide `APP_ENV`</li>
<li>  - Zelfde default waarde ("development" of "production")</li>
<li>  - EÃ©n waarheid</li>
</ul>

<ol>
<li>**Remove dead code**:</li>
</ol>
<ul>
<li>  - Verwijder ongebruikte config parameters (`enable_auto_save`, etc.)</li>
<li>  - Of implementeer ze daadwerkelijk</li>
</ul>

<ol>
<li>**Document environment behavior**:</li>
</ol>
<ul>
<li>  - Wanneer gebruik je welke environment?</li>
<li>  - Hoe switch je tussen environments?</li>
<li>  - Wat zijn de verschillen?</li>
</ul>

<p><strong>Impact</strong>:</p>
<ul>
<li>âœ… Proper environment handling</li>
<li>âœ… Future-proof voor production</li>
<li>âš ï¸ Meer complexiteit</li>
<li>âš ï¸ Vereist documentatie en testing</li>
</ul>

<h3>Option C: Hybrid Approach (PRAGMATIC)</h3>

<p><strong>Strategie</strong>: Fix de bugs, behoud structure voor toekomst.</p>

<p><strong>Changes</strong>:</p>
<ol>
<li>**Fix security issue** (IMMEDIATE):</li>
</ol>
<ul>
<li>  - Verwijder hardcoded API key</li>
<li>  - Roteer key bij OpenAI</li>
<li>  - Add pre-commit hook</li>
</ul>

<ol>
<li>**Fix ConfigManager** (HIGH):</li>
</ol>
<ul>
<li>  - Herstel enum values (add PRODUCTION, TESTING)</li>
<li>  - Respect APP_ENV environment variable</li>
<li>  - Fix `is_production()` / `is_testing()` functions</li>
</ul>

<ol>
<li>**Remove dead code** (MEDIUM):</li>
</ol>
<ul>
<li>  - Verwijder ongebruikte config parameters</li>
<li>  - Update documentatie</li>
</ul>

<ol>
<li>**Document current behavior** (MEDIUM):</li>
</ol>
<ul>
<li>  - Leg uit dat app default "production" draait</li>
<li>  - Documenteer hybride configuratie</li>
<li>  - Add troubleshooting guide</li>
</ul>

<ol>
<li>**Keep structure** (LOW):</li>
</ol>
<ul>
<li>  - Behoud environment configs (klaar voor toekomst)</li>
<li>  - Maar mark production/testing als "unused"</li>
</ul>

<p><strong>Impact</strong>:</p>
<ul>
<li>âœ… Fixes critical bugs</li>
<li>âœ… Maintains flexibility</li>
<li>âœ… Minimal behavior change</li>
<li>âš ï¸ Keeps some complexity</li>
</ul>

<p>---</p>

<h2>8. Recommended Action Plan</h2>

<h3>Phase 1: Critical Security Fix (IMMEDIATE)</h3>

<p><strong>Deadline</strong>: Vandaag</p>

<ol>
<li>Roteer API key bij OpenAI:</li>
</ol>
<ul>
<li>  - Log in op https://platform.openai.com/api-keys</li>
<li>  - Revoke: `sk-proj-6SnmTLs9uW...`</li>
<li>  - Generate new key</li>
<li>  - Update lokale `.env` file</li>
</ul>

<ol>
<li>Remove hardcoded key:</li>
<pre><code>   # Edit config/config_development.yaml
   # Remove line 15: openai_api_key: sk-proj-...</code></pre>
</ol>

<ol>
<li>Add pre-commit hook:</li>
<pre><code>   # .pre-commit-config.yaml
   - repo: local
     hooks:
       - id: check-api-keys
         name: Check for hardcoded API keys
         entry: bash -c 'if grep -r "sk-proj-" config/; then exit 1; fi'
         language: system
         pass_filenames: false</code></pre>
</ol>

<ol>
<li>Git commit:</li>
<pre><code>   git add config/config_development.yaml .pre-commit-config.yaml
   git commit -m "security: remove hardcoded API key from config"</code></pre>
</ol>

<p><strong>Risk</strong>: LOW (env variable override works al)</p>

<p>---</p>

<h3>Phase 2: Fix ConfigManager (HIGH PRIORITY)</h3>

<p><strong>Deadline</strong>: Deze week</p>

<p><strong>Option</strong>: Kies tussen A, B, of C hierboven.</p>

<p><strong>Recommended</strong>: <strong>Option C (Hybrid)</strong> - fixes bugs, behoud flexibility.</p>

<p><strong>Implementation</strong>:</p>

<ol>
<li>**Restore Environment enum**:</li>
<pre><code>   # src/config/config_manager.py
   class Environment(Enum):
       DEVELOPMENT = "development"
       PRODUCTION = "production"
       TESTING = "testing"</code></pre>
</ol>

<ol>
<li>**Respect APP_ENV**:</li>
<pre><code>   def __init__(self, environment: Environment | None = None, config_dir: str = "config"):
       if environment is None:
           env_name = os.getenv("APP_ENV", "production").lower()
           environment = Environment(env_name)
       self.environment = environment  # Remove hardcoded override</code></pre>
</ol>

<ol>
<li>**Update get_config_manager**:</li>
<pre><code>   def get_config_manager(environment: Environment | None = None) -&gt; ConfigManager:
       global _config_manager
       if _config_manager is None:
           _config_manager = ConfigManager(environment)
       return _config_manager</code></pre>
</ol>

<ol>
<li>**Test behavior**:</li>
<pre><code>   # Test development mode
   APP_ENV=development python -c "from config.config_manager import get_config_manager; print(get_config_manager().environment)"

   # Test production mode
   APP_ENV=production python -c "from config.config_manager import get_config_manager; print(get_config_manager().environment)"</code></pre>
</ol>

<ol>
<li>**Update tests** in `tests/config/test_config_manager.py`</li>
</ol>

<p><strong>Risk</strong>: MEDIUM (config loading verandert, maar env variable override blijft werken)</p>

<p>---</p>

<h3>Phase 3: Remove Dead Code (MEDIUM PRIORITY)</h3>

<p><strong>Deadline</strong>: Volgende sprint</p>

<ol>
<li>**Remove unused config parameters** from `ContainerConfigs`:</li>
<pre><code>   # src/services/container.py
   @staticmethod
   def production() -&gt; dict[str, Any]:
       return {
           "db_path": "data/definities.db",
           "enable_monitoring": True,
           "enable_ontology": True,
           # REMOVED: enable_auto_save (unused)
           # REMOVED: min_quality_score (unused)
           # REMOVED: enable_all_rules (unused)
       }</code></pre>
</ol>

<ol>
<li>**Grep verification**:</li>
<pre><code>   # Verify these are truly unused
   grep -r "enable_auto_save" src/
   grep -r "min_quality_score" src/
   grep -r "enable_all_rules" src/</code></pre>
</ol>

<ol>
<li>**Update documentation** in `CLAUDE.md`</li>
</ol>

<p><strong>Risk</strong>: LOW (verified unused)</p>

<p>---</p>

<h3>Phase 4: Documentation (LOW PRIORITY)</h3>

<p><strong>Deadline</strong>: Volgende sprint</p>

<ol>
<li>Create `config/README.md`:</li>
<pre><code>   # Configuration Files

   ## Environment Selection

   Set `APP_ENV` environment variable:
   - `development` - Local development (relaxed settings)
   - `production` - Production deployment (strict settings)
   - `testing` - Automated tests (minimal overhead)

   Default: `production`

   ## File Structure

   - `config_default.yaml` - Base defaults
   - `config_development.yaml` - Development overrides
   - `config_production.yaml` - Production overrides
   - `config_testing.yaml` - Test overrides

   ## Key Differences

   | Setting | Development | Production |
   |---------|-------------|------------|
   | Model | gpt-4o-mini | gpt-4.1 |
   | Temperature | 0.9 | 0.01 |
   | Log Level | DEBUG | INFO |
   | Rate Limit | 120 RPM | 30 RPM |</code></pre>
</ol>

<ol>
<li>Update `CLAUDE.md` sectie "Environment Variabelen"</li>
</ol>

<ol>
<li>Add troubleshooting guide voor environment issues</li>
</ol>

<p><strong>Risk</strong>: NONE (documentation only)</p>

<p>---</p>

<h2>9. Test Plan</h2>

<h3>Unit Tests</h3>

<pre><code># tests/config/test_environment.py
def test_environment_enum_values():
    """Verify all environment enum values exist."""
    assert hasattr(Environment, "DEVELOPMENT")
    assert hasattr(Environment, "PRODUCTION")
    assert hasattr(Environment, "TESTING")

def test_config_manager_respects_app_env(monkeypatch):
    """ConfigManager should respect APP_ENV."""
    monkeypatch.setenv("APP_ENV", "production")
    cm = ConfigManager()
    assert cm.environment == Environment.PRODUCTION

def test_is_production_helper():
    """is_production() should work without AttributeError."""
    # Should not crash
    result = is_production()
    assert isinstance(result, bool)</code></pre>

<h3>Integration Tests</h3>

<pre><code># tests/integration/test_config_consistency.py
def test_config_manager_and_container_use_same_environment():
    """ConfigManager and ServiceContainer should use same environment."""
    import os
    os.environ["APP_ENV"] = "development"

    # Clear singletons
    clear_config_manager()
    clear_container_cache()

    cm = get_config_manager()
    container = get_cached_container()

    # Both should be in development mode
    assert cm.environment == Environment.DEVELOPMENT
    assert container.config["enable_monitoring"] == True  # dev setting</code></pre>

<h3>Manual Testing</h3>

<pre><code># Test 1: Development mode
export APP_ENV=development
streamlit run src/main.py
# Verify: DEBUG logging, gpt-4o-mini model

# Test 2: Production mode
export APP_ENV=production
streamlit run src/main.py
# Verify: INFO logging, gpt-4.1 model

# Test 3: Default (no APP_ENV)
unset APP_ENV
streamlit run src/main.py
# Verify: Defaults to production</code></pre>

<p>---</p>

<h2>10. Risk Assessment</h2>

<p>| Change | Risk Level | Mitigation |</p>
<p>|--------|-----------|------------|</p>
<p>| Remove hardcoded API key | ğŸŸ¢ LOW | Env variable override al werkend |</p>
<p>| Fix ConfigManager enum | ğŸŸ¡ MEDIUM | Uitgebreide tests, gradual rollout |</p>
<p>| Respect APP_ENV | ğŸŸ¡ MEDIUM | Default blijft hetzelfde (production) |</p>
<p>| Remove dead code | ğŸŸ¢ LOW | Verified unused via grep |</p>
<p>| Update documentation | ğŸŸ¢ NONE | Documentation only |</p>

<p>---</p>

<h2>11. Success Criteria</h2>

<h3>Must Have (MVP)</h3>
<ul>
<li>[ ] Hardcoded API key verwijderd</li>
<li>[ ] API key geroteerd bij OpenAI</li>
<li>[ ] Pre-commit hook toegevoegd</li>
<li>[ ] ConfigManager enum compleet (PRODUCTION, TESTING)</li>
<li>[ ] ConfigManager respecteert APP_ENV</li>
<li>[ ] `is_production()` / `is_testing()` werken zonder crash</li>
</ul>

<h3>Should Have</h3>
<ul>
<li>[ ] Dead code verwijderd uit ContainerConfigs</li>
<li>[ ] Beide environment systemen gebruiken APP_ENV</li>
<li>[ ] Tests toegevoegd voor environment handling</li>
<li>[ ] Documentation updated</li>
</ul>

<h3>Nice to Have</h3>
<ul>
<li>[ ] `config/README.md` toegevoegd</li>
<li>[ ] Troubleshooting guide</li>
<li>[ ] Architecture diagram updated</li>
</ul>

<p>---</p>

<h2>12. Conclusies</h2>

<h3>Beantwoording Oorspronkelijke Vraag</h3>

<blockquote>**"Wat is het voordeel van de development config?"**</blockquote>

<p><strong>Theoretisch</strong>:</p>
<ul>
<li>âœ… Goedkoper model (gpt-4o-mini vs gpt-4.1)</li>
<li>âœ… Snellere iteratie (hogere rate limits, langer timeout)</li>
<li>âœ… Uitgebreidere logging (DEBUG vs INFO)</li>
<li>âœ… Experimenteerdere temperature (0.9 vs 0.01)</li>
</ul>

<p><strong>Praktisch (huidige situatie)</strong>:</p>
<ul>
<li>âŒ ConfigManager laadt altijd development config (hardcoded)</li>
<li>âŒ APP_ENV staat niet ingesteld â†’ container draait production</li>
<li>âŒ Hybride configuratie zonder het te weten</li>
<li>âŒ Meeste config verschillen zijn dead code (unused)</li>
</ul>

<p><strong>Na fixes</strong>:</p>
<ul>
<li>âœ… Development config wordt bruikbaar</li>
<li>âœ… Proper environment separation</li>
<li>âœ… Voorspelbaar gedrag</li>
<li>âœ… Toekomstbestendig</li>
</ul>

<h3>Key Takeaways</h3>

<ol>
<li>**Er zijn TWEE environment systemen** die niet met elkaar praten</li>
<li>**ConfigManager is stuk** (hardcoded dev, missing enums)</li>
<li>**Security issue**: Hardcoded API key moet geroteerd</li>
<li>**Dead code**: 60% van config parameters doet niets</li>
<li>**Development config heeft potentieel** maar werkt niet zoals bedoeld</li>
</ol>

<h3>Recommended Next Steps</h3>

<ol>
<li>**IMMEDIATE**: Fix security breach (API key)</li>
<li>**THIS WEEK**: Fix ConfigManager (restore enums, respect APP_ENV)</li>
<li>**NEXT SPRINT**: Remove dead code</li>
<li>**NEXT SPRINT**: Update documentation</li>
</ol>

<p>---</p>

<h2>Appendix A: File Locations</h2>

<h3>Configuration Files</h3>
<ul>
<li>`config/config_default.yaml` - Base defaults</li>
<li>`config/config_development.yaml` - Development overrides (âš ï¸ heeft hardcoded API key)</li>
<li>`config/config_production.yaml` - Production overrides (unused)</li>
<li>`config/config_testing.yaml` - Testing overrides (unused)</li>
</ul>

<h3>Source Files</h3>
<ul>
<li>`src/config/config_manager.py` - ConfigManager class (ğŸ”´ hardcoded dev)</li>
<li>`src/services/container.py` - ServiceContainer + ContainerConfigs</li>
<li>`src/utils/container_manager.py` - Container singleton + APP_ENV detection</li>
</ul>

<h3>Analysis Documents</h3>
<ul>
<li>`docs/analyses/CONFIG_MANAGER_ENVIRONMENT_ANALYSIS.md` - Agent 1 output</li>
<li>`docs/analyses/CONTAINER_CONFIGS_ANALYSIS.md` - Agent 2 output</li>
<li>`docs/analyses/APP_ENV_USAGE_ANALYSIS.md` - Agent 3 output</li>
<li>`docs/analyses/CONFIG_FILES_COMPARISON.md` - Agent 4 output</li>
</ul>

<p>---</p>

<h2>Appendix B: References</h2>

<ul>
<li>**CLAUDE.md**: Project instructions</li>
<li>**UNIFIED_INSTRUCTIONS.md**: Cross-project rules</li>
<li>**US-202**: Container caching optimization (completed Oct 7, 2025)</li>
<li>**EPIC-016**: ApprovalGatePolicy configuration management</li>
</ul>

<p>---</p>

<p><strong>Generated by</strong>: Multi-agent analysis (4x parallel agents)</p>
<p><strong>Date</strong>: 2025-10-07</p>
<p><strong>Tools used</strong>: ConfigManager analysis, ContainerConfigs analysis, APP_ENV grep, Config file comparison</p>

  </div>
</body>
</html>