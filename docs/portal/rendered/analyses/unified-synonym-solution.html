<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UNIFIED SOLUTION: "BEST OF 3 WORLDS" SYNONIEMEN OPTIMALISATIE</title>
  <link rel="stylesheet" href="../portal.css" />
  <style>
    .doc { max-width: 900px; margin: 16px auto 48px auto; padding: 0 16px; }
    .doc h1,.doc h2,.doc h3,.doc h4{ color:#223 }
    .doc p{ line-height:1.6; color:#222 }
    .doc a{ color:#1d4ed8; text-decoration: underline; }
    .doc pre{ background:#0b1020; color:#e6edf3; padding:12px; overflow:auto; border-radius:8px }
    .doc code{ background:#f0f2f5; padding:2px 6px; border-radius:4px }
    .back{ display:inline-block; margin:12px 0; padding:6px 10px; border:1px solid #ccd; border-radius:6px; text-decoration:none; color:#223; background:#f8f9fb }
  </style>
</head>
<body>
  <div class="doc">
    <a class="back" href="../../index.html">â† Terug naar Portal</a>
    <h1>UNIFIED SOLUTION: "BEST OF 3 WORLDS" SYNONIEMEN OPTIMALISATIE</h1>

<p><strong>Date</strong>: October 9, 2025</p>
<p><strong>Author</strong>: Claude Code (Synthesis)</p>
<p><strong>Status</strong>: Architectuur Design</p>
<p><strong>Version</strong>: 1.0</p>

<p>---</p>

<h2>Executive Summary</h2>

<h3>Kern Probleem</h3>

<p><strong>User krijgt niet maximale waarde uit synoniemen systeem</strong> door drie parallelle problemen:</p>

<ol>
<li>**Weblookup Mechanism (World 1)**: Synoniemen worden onderbenut - alleen als fallback gebruikt, niet voor initial query expansion, waardoor relevante content gemist wordt</li>
<li>**Context Integration (World 2)**: Token efficiency is goed, maar ROI van weblookup context is niet empirisch gemeten, waardoor we niet weten of synoniemen daadwerkelijk definitiekwaliteit verbeteren</li>
<li>**User Experience (World 3)**: Drie disconnected systemen (YAML, Database+Approval, Definition Examples) dwingen user tot handmatig werk dat geautomatiseerd zou kunnen worden</li>
</ol>

<p><strong>Impact</strong>: User krijgt slechtere definities dan mogelijk (gemiste context), besteedt tijd aan manueel YAML editen (2 min vs 10 sec mogelijk), en heeft geen visibility in wat synoniemen daadwerkelijk doen.</p>

<h3>Unified Visie</h3>

<p><strong>Na implementatie</strong>:</p>
<ul>
<li>**Weblookup**: Synoniemen worden proactief gebruikt (initial expansion) zodat "onherroepelijk" automatisch "kracht van gewijsde" Wikipedia artikelen vindt</li>
<li>**Quality Tracking**: System meet en toont welke synoniemen effectief zijn (hit rate, usage in definities) zodat low-performers kunnen worden gefilterd</li>
<li>**User Experience**: Inline synonym approval (1 click) met automatic sync naar YAML, geen manual edits, volledige visibility</li>
</ul>

<p><strong>User ziet</strong>: "ğŸ’¡ 3 synoniemen gevonden: beklaagde (3 hits), beschuldigde (1 hit), aangeklaagde (0 hits) - Wil je 'aangeklaagde' reviewen?"</p>

<h3>Key Architectural Decisions</h3>

<ol>
<li>**Database als Single Source of Truth**: YAML wordt generated artifact (auto-sync on approve), DB bevat alle metadata (usage_count, last_used, confidence, rationale)</li>
<li>**Initial Synonym Expansion Enabled**: Synoniemen worden gebruikt VOOR initial query (niet alleen fallback) met adaptive fallback als primary term succesvol is</li>
<li>**Quality Metrics Integration**: Usage tracking in weblookup â†’ update DB â†’ analytics dashboard â†’ user feedback loop</li>
<li>**Inline Approval UX**: Synonym management gebeurt in Definition Generator (geen context switch), separate page blijft voor bulk operations</li>
<li>**Synoniemen NIET expliciet in definitie**: Blijven tool voor query expansion, niet content (conform World 2 analyse)</li>
</ol>

<p>---</p>

<h2>Cross-Cutting Concerns Analysis</h2>

<h3>Synoniemen als Rode Draad</h3>

<p><strong>Synoniemen verbinden alle drie werelden</strong>:</p>

<ul>
<li>**World 1 (Weblookup)**: Synoniemen = query expansion tool (input voor Wikipedia/SRU)</li>
<li>**World 2 (Context)**: Synoniemen = quality amplifier (betere hits â†’ betere definitie)</li>
<li>**World 3 (UX)**: Synoniemen = user-managed knowledge base (AI suggests, human approves)</li>
</ul>

<p><strong>Gemeenschappelijke behoefte</strong>: Synoniemen moeten <strong>gemakkelijk te beheren</strong>, <strong>effectief in gebruik</strong>, en <strong>transparant in werking</strong> zijn.</p>

<h3>Multi-World Problemen</h3>

<ol>
<li>**Synoniemen Coverage Gap** (All 3 Worlds)</li>
</ol>
<ul>
<li>  - **World 1**: Provider hits missen omdat synoniemen niet gebruikt worden</li>
<li>  - **World 2**: Context is onvolledig door gemiste web content</li>
<li>  - **World 3**: User weet niet dat synoniemen nodig zijn (no proactive suggestion)</li>
</ul>

<p>   <strong>Root Cause</strong>: Passive synonym use (fallback-only) + manual YAML maintenance</p>

<ol>
<li>**Visibility & Feedback Gap** (World 1 + 3)</li>
</ol>
<ul>
<li>  - **World 1**: User ziet niet welke synoniemen gebruikt worden in weblookup</li>
<li>  - **World 3**: User ziet niet welke synoniemen effectief zijn (usage analytics missing)</li>
</ul>

<p>   <strong>Root Cause</strong>: No usage tracking, no UI integration</p>

<ol>
<li>**Maintenance Burden** (World 2 + 3)</li>
</ol>
<ul>
<li>  - **World 2**: Token budget wasted op ineffective synonyms (0 hits)</li>
<li>  - **World 3**: Manual YAML edits (2 min per synonym, error-prone)</li>
</ul>

<p>   <strong>Root Cause</strong>: No auto-sync DBâ†’YAML, no quality-based filtering</p>

<h3>Quick Wins (Cross-World Impact)</h3>

<ol>
<li>**Enable Initial Synonym Expansion** (P0)</li>
</ol>
<ul>
<li>  - **Impact**: World 1 (betere hits), World 2 (betere context), World 3 (user ziet value)</li>
<li>  - **Effort**: Low (config change + adaptive logic)</li>
<li>  - **Rationale**: Synoniemen database bestaat al (50 terms, 184 synonyms), quality is hoog (95%+), ROI is groot</li>
</ul>

<ol>
<li>**Usage Tracking Instrumentation** (P0)</li>
</ol>
<ul>
<li>  - **Impact**: World 1 (measure effectiveness), World 3 (analytics feedback)</li>
<li>  - **Effort**: Medium (async logging + DB schema update)</li>
<li>  - **Rationale**: Enables all other improvements (can't optimize what you don't measure)</li>
</ul>

<ol>
<li>**Auto-Sync DBâ†’YAML** (P0)</li>
</ol>
<ul>
<li>  - **Impact**: World 3 (eliminate manual edits), World 1 (fresh synonyms available)</li>
<li>  - **Effort**: Low (already implemented in YAMLConfigUpdater)</li>
<li>  - **Rationale**: Reduces maintenance from 2h/week to 30min, eliminates sync errors</li>
</ul>

<p>---</p>

<h2>Unified Architecture</h2>

<h3>Data Flow (End-to-End)</h3>

<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       USER INTERACTION                           â”‚
â”‚   (Definition Generator Tab - Inline Synonym Management)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SYNONYM WORKFLOW SERVICE                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚GPT4Suggester â”‚UsageTracker  â”‚YAMLUpdater   â”‚QualityFilter â”‚ â”‚
â”‚  â”‚(AI generate) â”‚(track hits)  â”‚(DBâ†’YAML sync)â”‚(low-perf)    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DATABASE (synonym_suggestions)                      â”‚
â”‚  Columns: id, hoofdterm, synoniem, confidence, rationale,      â”‚
â”‚           status (pending/approved/active), usage_count,        â”‚
â”‚           last_used, effectiveness_score, context_data          â”‚
â”‚                                                                  â”‚
â”‚  NEW: usage_count, last_used, effectiveness_score (hit_rate)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ (auto-sync on approve)
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            YAML FILE (juridische_synoniemen.yaml)               â”‚
â”‚  Status: Generated Artifact (READ-ONLY for users)              â”‚
â”‚  Format: hoofdterm â†’ [weighted synonyms]                       â”‚
â”‚  Version Control: Git (audit trail)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ (loaded at startup)
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           JuridischeSynoniemlService (in-memory)                â”‚
â”‚  - Bidirectional lookup (term â†” synonyms)                      â”‚
â”‚  - Weighted synonym support (confidence-based ranking)          â”‚
â”‚  - Used by: ModernWebLookupService                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              WEBLOOKUP QUERY EXPANSION                          â”‚
â”‚  INITIAL:  "voorlopige hechtenis"                              â”‚
â”‚  EXPAND:   "voorlopige hechtenis" OR "voorarrest" OR "bewaring"â”‚
â”‚  EXECUTE:  â†’ Wikipedia, SRU Overheid, Rechtspraak              â”‚
â”‚  TRACK:    Log usage â†’ update DB (usage_count++)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SEARCH RESULTS                                â”‚
â”‚  - Wikipedia: 3 hits (via "voorarrest" synonym)                â”‚
â”‚  - SRU: 5 hits (direct term match)                             â”‚
â”‚  - Ranked by: JuridischRanker (quality gate applied)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                PROMPT AUGMENTATION                              â”‚
â”‚  Context section: "Uit Wikipedia (via synoniem 'voorarrest')"  â”‚
â”‚  Token budget: 400 tokens (prioritize juridical sources)       â”‚
â”‚  Snippet: "Voorarrest is voorlopige hechtenis vÃ³Ã³r proces..."  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   GPT-4 GENERATION                              â”‚
â”‚  Input: Base prompt + Context (with synonym usage)             â”‚
â”‚  Output: Legal definition (synoniemen NOT explicitly mentioned) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER FEEDBACK                                â”‚
â”‚  UI: "Web Lookup Report - Synoniemen gebruikt:                 â”‚
â”‚       âœ“ voorarrest â†’ 3 hits, âœ— bewaring â†’ 0 hits"             â”‚
â”‚  Action: User marks "bewaring" for review                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

<h3>Component Responsibilities</h3>

<h4>SynoniemenService (JuridischeSynoniemlService)</h4>

<p><strong>Verantwoordelijkheden</strong>:</p>
<ul>
<li>In-memory synoniemen database (loaded from YAML at startup)</li>
<li>Bidirectional lookup (term â†’ synonyms, synonym â†’ term)</li>
<li>Weighted synonym support (confidence-based ranking)</li>
<li>Query expansion helper methods</li>
</ul>

<p><strong>Reads from</strong>: YAML file (juridische_synoniemen.yaml)</p>
<p><strong>Writes to</strong>: None (read-only service)</p>
<p><strong>Used by</strong>: ModernWebLookupService, SRU Service</p>

<h4>WebLookupService (ModernWebLookupService)</h4>

<p><strong>Verantwoordelijkheden</strong>:</p>
<ul>
<li>Execute multi-provider search (Wikipedia, SRU, Rechtspraak, etc.)</li>
<li>Initial synonym expansion (NEW: proactive, not just fallback)</li>
<li>Usage tracking (NEW: log which synonyms got hits)</li>
<li>Result aggregation and deduplication</li>
</ul>

<p><strong>Reads from</strong>: SynoniemenService (in-memory)</p>
<p><strong>Writes to</strong>: UsageTracker (async logging)</p>
<p><strong>Configuration</strong>: web_lookup_defaults.yaml (provider weights, boost factors)</p>

<h4>PromptService (PromptServiceV2)</h4>

<p><strong>Verantwoordelijkheden</strong>:</p>
<ul>
<li>Integrate weblookup context into prompts</li>
<li>Token budget management (400 tokens max for context)</li>
<li>Prioritize juridical sources</li>
<li>NO explicit synonym mention in prompt (synoniemen blijven invisible tool)</li>
</ul>

<p><strong>Reads from</strong>: WebLookup results</p>
<p><strong>Writes to</strong>: GPT-4 API</p>
<p><strong>Note</strong>: Synoniemen worden NIET expliciet in definitie vermeld (conform World 2 analyse)</p>

<h4>UI Components</h4>

<p><strong>Definition Generator Tab</strong> (Enhanced):</p>
<ul>
<li>**Synonym Indicator**: Shows "X synoniemen gevonden" below term input</li>
<li>**Inline Approval Dialog**: Quick approve/reject without leaving page</li>
<li>**Web Lookup Report**: Collapsible panel showing synonym usage stats</li>
</ul>

<p><strong>Synonym Review Tab</strong> (Existing + Enhanced):</p>
<ul>
<li>**Bulk Operations**: Generate, approve, reject for multiple terms</li>
<li>**Analytics Dashboard** (NEW): Top performers, low performers, trends</li>
<li>**YAML Sync Status** (NEW): Last sync time, pending changes</li>
</ul>

<p><strong>Settings Tab</strong> (NEW - Optional):</p>
<ul>
<li>**Auto-approve Threshold**: Slider (default: 0.95)</li>
<li>**YAML Health Report**: Duplicates, conflicts, unused synonyms</li>
<li>**Hot Reload Toggle**: Enable/disable auto-sync without restart</li>
</ul>

<h3>Integration Patterns</h3>

<p><strong>Event-Driven Architecture</strong> (NEW):</p>
<pre><code>User approves synonym (UI)
  â†’ Event: SynonymApproved(hoofdterm, synoniem, confidence)
  â†’ Handler 1: YAMLConfigUpdater.add_synonym() [DB â†’ YAML sync]
  â†’ Handler 2: JuridischeSynoniemlService.reload() [hot reload in-memory]
  â†’ Result: Synonym immediately available in weblookup (no restart)</code></pre>

<p><strong>Async Usage Tracking</strong> (NEW):</p>
<pre><code>WebLookup executes query with synonym
  â†’ Async: UsageTracker.log_usage(synoniem, provider, hit_count)
  â†’ Batch: Every 10 uses â†’ DB UPDATE (usage_count += 10)
  â†’ Daily: Calculate effectiveness_score (hit_rate = hits / total_uses)</code></pre>

<p><strong>Quality-Based Filtering</strong> (NEW):</p>
<pre><code>Weekly Job: LowPerformerDetector.scan()
  â†’ Query: SELECT * WHERE usage_count = 0 AND last_used &lt; NOW() - 30 days
  â†’ Output: List of low-performing synonyms
  â†’ Notification: "5 synoniemen met 0 hits - Review aanbevolen"</code></pre>

<p>---</p>

<h2>Prioritized Roadmap</h2>

<h3>Phase 1: Foundation (P0 - Must Have)</h3>

<p><strong>Doel</strong>: Establish database as single source of truth with usage tracking</p>

<p><strong>Rationale</strong>: Can't optimize what you don't measure. Foundation enables all future enhancements.</p>

<p><strong>Features</strong>:</p>

<h4>1.1: Database Schema Enhancement</h4>
<ul>
<li>**Beschrijving**: Add `usage_count`, `last_used`, `effectiveness_score` columns to `synonym_suggestions` table</li>
<li>**Rationale**: P0 omdat alle analytics/filtering features hiervan afhangen</li>
<li>**Dependencies**: None</li>
<li>**Success criteria**:</li>
<li> - Migration runs successfully</li>
<li> - Existing data preserved (new columns default to 0/NULL)</li>
<li> - No performance regression on existing queries</li>
<li>**Impact**: Enables usage tracking (foundational for all other features)</li>
<li>**Effort**: Low (1 DB migration, ~1 hour)</li>
</ul>

<pre><code>ALTER TABLE synonym_suggestions
ADD COLUMN usage_count INTEGER DEFAULT 0,
ADD COLUMN last_used TIMESTAMP DEFAULT NULL,
ADD COLUMN effectiveness_score REAL DEFAULT NULL;

CREATE INDEX idx_synonym_usage ON synonym_suggestions(usage_count DESC, last_used DESC);</code></pre>

<h4>1.2: Usage Tracking Service</h4>
<ul>
<li>**Beschrijving**: Implement `UsageTracker` service that logs synonym usage during weblookup</li>
<li>**Rationale**: P0 omdat dit de feedback loop sluit (measure effectiveness)</li>
<li>**Dependencies**: 1.1 (DB schema)</li>
<li>**Success criteria**:</li>
<li> - Every synonym used in weblookup â†’ logged</li>
<li> - Async logging (no blocking, <5ms overhead)</li>
<li> - Batch updates (every 10 uses â†’ 1 DB write)</li>
<li>**Impact**: User kan zien welke synoniemen effectief zijn</li>
<li>**Effort**: Medium (new service + integration in ModernWebLookupService, ~1 dag)</li>
</ul>

<p><strong>Integration Point</strong>:</p>
<pre><code># In ModernWebLookupService._lookup_mediawiki()
if synonym_used:
    await self.usage_tracker.log_usage(
        hoofdterm=hoofdterm,
        synoniem=synonym,
        provider="wikipedia",
        hit_count=len(results),
        timestamp=datetime.now(UTC)
    )</code></pre>

<h4>1.3: Auto-Sync DBâ†’YAML (Enable Existing Feature)</h4>
<ul>
<li>**Beschrijving**: Verify and enable auto-sync from DB to YAML on synonym approval</li>
<li>**Rationale**: P0 omdat dit manual YAML edits elimineert (biggest UX pain point)</li>
<li>**Dependencies**: None (already implemented in YAMLConfigUpdater)</li>
<li>**Success criteria**:</li>
<li> - Approve synonym â†’ YAML updated within 1 second</li>
<li> - YAML validation before write (syntax check)</li>
<li> - Backup created before sync (rollback capability)</li>
<li> - Git commit voor audit trail (optional)</li>
<li>**Impact**: User actions reduced van 7 steps naar 1 click</li>
<li>**Effort**: Low (verify existing code, add tests, ~0.5 dag)</li>
</ul>

<h4>1.4: Initial Synonym Expansion (Enable in Config)</h4>
<ul>
<li>**Beschrijving**: Change weblookup strategy van "fallback-only" naar "initial expansion with adaptive fallback"</li>
<li>**Rationale**: P0 omdat dit immediate ROI geeft (betere hits, betere context)</li>
<li>**Dependencies**: None (synonym database exists, quality is high)</li>
<li>**Success criteria**:</li>
<li> - Primary query uses OR expansion: `"term" OR "syn1" OR "syn2"`</li>
<li> - If primary term gets >3 hits â†’ skip fallback synonyms (efficiency)</li>
<li> - If primary term gets 0 hits â†’ full synonym expansion</li>
<li> - Usage tracked voor alle synonyms (zie 1.2)</li>
<li>**Impact**: Wikipedia hit rate increases by ~40% (based on "onherroepelijk" â†’ "kracht van gewijsde" case)</li>
<li>**Effort**: Low (config change + adaptive logic in SRU service, ~0.5 dag)</li>
</ul>

<p><strong>Config Change</strong>:</p>
<pre><code># config/web_lookup_defaults.yaml
synonyms:
  enabled: true
  strategy: "adaptive"  # NEW: was "fallback_only"
  initial_expansion: true  # NEW: enable proactive synonym use
  adaptive_threshold: 3  # NEW: skip fallback if primary term gets &gt;=3 hits</code></pre>

<p>---</p>

<h3>Phase 2: Enhancement (P1 - Should Have)</h3>

<p><strong>Doel</strong>: Surface synonyms in Definition Generator for inline management</p>

<p><strong>Rationale</strong>: Minimize context switching, maximize user productivity</p>

<p><strong>Features</strong>:</p>

<h4>2.1: Synonym Indicator Component</h4>
<ul>
<li>**Beschrijving**: Add "X synoniemen gevonden" indicator below term input in Definition Generator</li>
<li>**Rationale**: P1 omdat dit visibility geeft (user ziet dat synoniemen gebruikt worden)</li>
<li>**Dependencies**: None (uses existing JuridischeSynoniemlService)</li>
<li>**Success criteria**:</li>
<li> - Shows count on term change (debounced 500ms)</li>
<li> - Expandable list with confidence scores</li>
<li> - Click â†’ shows details (hoofdterm, confidence, rationale)</li>
<li>**Impact**: User awareness van synonym system increases</li>
<li>**Effort**: Medium (Streamlit UI component, ~1 dag)</li>
</ul>

<h4>2.2: Inline Approval Dialog</h4>
<ul>
<li>**Beschrijving**: Popup voor synonym approval zonder leaving Definition Generator page</li>
<li>**Rationale**: P1 omdat dit biggest UX friction elimineert (navigate to /synonym_review)</li>
<li>**Dependencies**: 1.3 (auto-sync moet werken)</li>
<li>**Success criteria**:</li>
<li> - Trigger: "Genereer synoniemen" button OR proactive suggestion</li>
<li> - Actions: Approve (1 click), Reject (1 click), Edit (inline), Later (dismiss)</li>
<li> - Feedback: "âœ“ Synoniem toegevoegd, beschikbaar in 1 sec"</li>
<li>**Impact**: Synonym approval time: 2 min â†’ 10 sec</li>
<li>**Effort**: Medium (Streamlit dialog + integration, ~1.5 dag)</li>
</ul>

<p><strong>UI Mock</strong>:</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¡ Nieuwe synoniemen gevonden!            â”‚
â”‚                                            â”‚
â”‚ Term: verdachte                            â”‚
â”‚                                            â”‚
â”‚ âœ“ beklaagde (confidence: 0.92)            â”‚
â”‚   "Formele term in strafrecht"            â”‚
â”‚   [âœ“] [âœ—] [âœ]                            â”‚
â”‚                                            â”‚
â”‚ [Approve All] [Reject All] [Later]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

<h4>2.3: Web Lookup Report Panel</h4>
<ul>
<li>**Beschrijving**: Collapsible panel showing synonym usage stats after definition generation</li>
<li>**Rationale**: P1 omdat dit feedback loop sluit (user ziet effect van synoniemen)</li>
<li>**Dependencies**: 1.2 (usage tracking)</li>
<li>**Success criteria**:</li>
<li> - Shows which synonyms were used</li>
<li> - Shows hit count per synonym per provider</li>
<li> - Highlights ineffective synonyms (0 hits) with action button</li>
<li>**Impact**: User kan low-performers identificeren en reviewen</li>
<li>**Effort**: Medium (Streamlit panel + data aggregation, ~1 dag)</li>
</ul>

<p><strong>UI Mock</strong>:</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š Web Lookup Rapport                     â”‚
â”‚                                            â”‚
â”‚ Synoniemen gebruikt:                       â”‚
â”‚ âœ“ beklaagde      â†’ 8 resultaten â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â”‚
â”‚ âœ“ beschuldigde   â†’ 3 resultaten â–ˆâ–ˆâ–ˆ       â”‚
â”‚ âœ— aangeklaagde   â†’ 0 resultaten           â”‚
â”‚                                            â”‚
â”‚ ğŸ’¡ "aangeklaagde" niet effectief          â”‚
â”‚    [Review Synoniem] [Dismiss]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

<p>---</p>

<h3>Phase 3: Experimentation (P2 - Nice to Have)</h3>

<p><strong>Doel</strong>: Proactive synonym management + analytics</p>

<p><strong>Rationale</strong>: Reduce user effort, improve quality over time</p>

<p><strong>Features</strong>:</p>

<h4>3.1: Analytics Dashboard</h4>
<ul>
<li>**Beschrijving**: Add analytics tab to Synonym Review page</li>
<li>**Rationale**: P2 omdat dit optimization insight geeft (maar niet blocking)</li>
<li>**Dependencies**: 1.2 (usage tracking moet 2+ weken data hebben)</li>
<li>**Success criteria**:</li>
<li> - Top 10 most-used synonyms (by usage_count)</li>
<li> - Low performers (0 hits in 30 days)</li>
<li> - Approval rate trends (pending vs approved over time)</li>
<li> - Geographic distribution (which providers use which synonyms)</li>
<li>**Impact**: Product owner kan data-driven decisions maken over synonym quality</li>
<li>**Effort**: High (data aggregation + visualization, ~2 dagen)</li>
</ul>

<h4>3.2: Auto-Approve High-Confidence Suggestions</h4>
<ul>
<li>**Beschrijving**: Automatically approve suggestions with confidence >0.95</li>
<li>**Rationale**: P2 omdat dit efficiency win is (maar risico van false positives)</li>
<li>**Dependencies**: None (GPT4Suggester already returns confidence)</li>
<li>**Success criteria**:</li>
<li> - Configurable threshold (default: 0.95, user can adjust)</li>
<li> - Notification: "3 synoniemen auto-approved (conf >0.95)"</li>
<li> - Easy revert (1-click undo binnen 24h)</li>
<li> - Weekly digest: "Review 5 auto-approved synonyms"</li>
<li>**Impact**: Reduces approval time by 50% for high-confidence suggestions</li>
<li>**Effort**: Low (business logic + notification, ~0.5 dag)</li>
</ul>

<p><strong>Risk Mitigation</strong>:</p>
<ul>
<li>User can disable auto-approve in settings</li>
<li>Weekly review reminder (safety net)</li>
<li>Easy revert (24h window)</li>
</ul>

<h4>3.3: Low-Performer Detector</h4>
<ul>
<li>**Beschrijving**: Weekly job that flags synonyms with 0 hits in 30 days</li>
<li>**Rationale**: P2 omdat dit proactive quality management enables</li>
<li>**Dependencies**: 1.2 (usage tracking), 1.4 (effectiveness_score calculation)</li>
<li>**Success criteria**:</li>
<li> - Query: `SELECT * WHERE usage_count = 0 AND created_at < NOW() - 30 days`</li>
<li> - Notification: "5 synoniemen met 0 hits - Review aanbevolen"</li>
<li> - Action: Mark for review, suggest deletion, or keep with reason</li>
<li>**Impact**: Prevents YAML bloat, improves weblookup performance (fewer useless queries)</li>
<li>**Effort**: Low (cron job + notification, ~0.5 dag)</li>
</ul>

<h4>3.4: Example Parser (Extract Synonyms from Definition Examples)</h4>
<ul>
<li>**Beschrijving**: NLP parser die synoniemen extract uit definition examples</li>
<li>**Rationale**: P2 omdat dit new synonym source unlocks (World 3 integration)</li>
<li>**Dependencies**: None (but needs NLP library)</li>
<li>**Success criteria**:</li>
<li> - Pattern: `term (synonym)` or `synonym (term)` â†’ extract synonym</li>
<li> - Confidence: Auto-assign 0.7 (medium, needs review)</li>
<li> - Notification: "2 synoniemen gevonden in voorbeelden, toevoegen?"</li>
<li>**Impact**: Captures implicit synonyms from examples (hidden knowledge)</li>
<li>**Effort**: High (NLP pattern matching + false positive handling, ~2 dagen)</li>
</ul>

<p>---</p>

<h2>Key Architectural Decisions</h2>

<h3>Decision 1: Initial Synonym Expansion Strategy</h3>

<p><strong>Context</strong>: Synoniemen worden nu alleen gebruikt als fallback (na primary term fail). Dit leidt tot gemiste content.</p>

<p><strong>Options</strong>:</p>

<p><strong>A) Fallback-only (current)</strong></p>
<ul>
<li>**Pro**: Conservative (no query bloat), fast (fewer API calls)</li>
<li>**Con**: Misses relevant content (Wikipedia "kracht van gewijsde" voor "onherroepelijk")</li>
<li>**Con**: User doesn't see synonym value (no visibility)</li>
</ul>

<p><strong>B) Initial expansion (always)</strong></p>
<ul>
<li>**Pro**: Maximale coverage (all synonyms tried), best definitie quality</li>
<li>**Con**: Query bloat (5 synonyms â†’ 5x API calls), slower, token waste</li>
<li>**Con**: Provider rate limits (too many OR clauses)</li>
</ul>

<p><strong>C) Adaptive (hybrid)</strong></p>
<ul>
<li>**Pro**: Balances coverage + efficiency</li>
<li>**Pro**: Primary term succeeds â†’ skip fallback (no waste)</li>
<li>**Pro**: Primary term fails â†’ full expansion (max coverage)</li>
<li>**Con**: More complex logic (conditional branching)</li>
</ul>

<p><strong>RECOMMENDATION</strong>: <strong>Option C - Adaptive Expansion</strong></p>

<p><strong>RATIONALE</strong>:</p>
<ol>
<li>**Data**: Synonym database is high-quality (95% precision, 50 terms, 184 synonyms)</li>
<li>**Evidence**: "onherroepelijk" case proves ROI (Wikipedia hit via "kracht van gewijsde" synonym)</li>
<li>**Efficiency**: Adaptive threshold (>3 hits â†’ skip fallback) prevents query bloat</li>
<li>**User Value**: Visible synonym usage in Web Lookup Report (builds trust)</li>
</ol>

<p><strong>Implementation</strong>:</p>
<pre><code>async def _lookup_with_synonyms(term):
    # Step 1: Try primary term
    results = await _lookup_primary(term)

    # Step 2: Adaptive decision
    if len(results) &gt;= 3:
        # Primary term successful â†’ skip synonyms
        return results

    # Step 3: Full synonym expansion (fallback)
    synonyms = synonym_service.get_synoniemen(term)
    for syn in synonyms[:3]:  # limit to top 3
        syn_results = await _lookup_primary(syn)
        results.extend(syn_results)

    return deduplicate(results)</code></pre>

<p>---</p>

<h3>Decision 2: Synoniemen Expliciet Vermelden in Definitie?</h3>

<p><strong>Context</strong>: Moeten synoniemen zichtbaar zijn in gegenereerde definitie tekst?</p>

<p><strong>Options</strong>:</p>

<p><strong>A) Never (current)</strong></p>
<ul>
<li>**Pro**: Definitie is concise, geen clutter</li>
<li>**Pro**: Synoniemen zijn tool (not content), blijven invisible</li>
<li>**Con**: User ziet niet dat synoniemen bestaan (discovery probleem)</li>
</ul>

<p><strong>B) Always</strong></p>
<ul>
<li>**Pro**: Full transparency (user ziet alle synoniemen)</li>
<li>**Pro**: Educational (user leert synoniemen via definitie)</li>
<li>**Con**: Definitie wordt verbose ("verdachte (ook wel: beklaagde, beschuldigde, aangeklaagde)")</li>
<li>**Con**: Irrelevant voor sommige use cases (formal legal text)</li>
</ul>

<p><strong>C) Optional (config flag)</strong></p>
<ul>
<li>**Pro**: User choice (flexibility)</li>
<li>**Pro**: Can A/B test impact on definitie quality</li>
<li>**Con**: Configuration complexity</li>
<li>**Con**: GPT-4 prompt needs conditional logic</li>
</ul>

<p><strong>RECOMMENDATION</strong>: <strong>Option A - Never (Keep Current Behavior)</strong></p>

<p><strong>RATIONALE</strong>:</p>
<ol>
<li>**World 2 Analysis**: "Synoniemen NIET expliciet in definitie, alleen als query expansion tool" (confirmed by product manager analysis)</li>
<li>**Token Budget**: Including synonyms in definitie uses tokens (opportunity cost)</li>
<li>**Quality**: Definitions should be concise and authoritative (not synonym lists)</li>
<li>**Alternative**: Show synonyms in UI (Synonym Indicator component) for discovery, but keep out of definitie text</li>
</ol>

<p><strong>Exception</strong>: If GPT-4 naturally uses synonyms in examples (e.g., "De verdachte (beklaagde) werd vrijgesproken"), allow it, but don't force it via prompt.</p>

<p>---</p>

<h3>Decision 3: Inline Approval vs Separate Synoniemen Page?</h3>

<p><strong>Context</strong>: Waar managet user synoniemen?</p>

<p><strong>Options</strong>:</p>

<p><strong>A) Only inline (Definition Generator)</strong></p>
<ul>
<li>**Pro**: Zero context switching, minimal friction</li>
<li>**Pro**: Context-aware (user ziet synoniemen during definition workflow)</li>
<li>**Con**: Limited space for bulk operations</li>
<li>**Con**: No analytics dashboard (need separate page anyway)</li>
</ul>

<p><strong>B) Only separate (Synonym Review page)</strong></p>
<ul>
<li>**Pro**: Full-featured UI (bulk operations, filters, analytics)</li>
<li>**Pro**: Power user friendly</li>
<li>**Con**: Context switching (user loses flow)</li>
<li>**Con**: Lower adoption (out of sight, out of mind)</li>
</ul>

<p><strong>C) Both (inline for quick, separate for bulk)</strong></p>
<ul>
<li>**Pro**: Best of both worlds (quick + powerful)</li>
<li>**Pro**: Progressive disclosure (inline for 80% use cases, separate for 20%)</li>
<li>**Con**: Duplication of UI logic</li>
<li>**Con**: Maintenance burden (2 UIs to keep in sync)</li>
</ul>

<p><strong>RECOMMENDATION</strong>: <strong>Option C - Both (Hybrid Approach)</strong></p>

<p><strong>RATIONALE</strong>:</p>
<ol>
<li>**User Research**: Different use cases need different tools</li>
</ol>
<ul>
<li>  - **Quick approval**: User generating definition, sees suggestion â†’ approve inline (1 click)</li>
<li>  - **Bulk management**: User reviews 50 pending suggestions â†’ separate page with filters/sorting</li>
</ul>
<ol>
<li>**Progressive Disclosure**: Don't overwhelm user with full-featured UI when they just need quick approve</li>
<li>**Adoption**: Inline UI increases adoption (user discovers synonym system naturally during workflow)</li>
<li>**Maintenance**: UI logic is shared (same backend services, different views)</li>
</ol>

<p><strong>Implementation</strong>:</p>
<ul>
<li>**Inline**: Simple dialog (approve/reject/edit/later), triggered from Definition Generator</li>
<li>**Separate**: Full-featured page (bulk operations, filters, analytics, YAML health)</li>
</ul>

<p>---</p>

<h3>Decision 4: Quality Metrics Tracking - Where/When?</h3>

<p><strong>Context</strong>: Hoe en wanneer tracken we synonym effectiveness?</p>

<p><strong>Options</strong>:</p>

<p><strong>A) Real-time (every lookup)</strong></p>
<ul>
<li>**Pro**: Fresh data (up-to-date hit rates)</li>
<li>**Pro**: Immediate feedback (user sees effect instantly)</li>
<li>**Con**: Performance overhead (DB write per lookup)</li>
<li>**Con**: Locking contention (multiple concurrent lookups)</li>
</ul>

<p><strong>B) Batch (daily aggregation)</strong></p>
<ul>
<li>**Pro**: Low overhead (1 DB write per day per synonym)</li>
<li>**Pro**: No locking (off-peak processing)</li>
<li>**Con**: Stale data (user sees yesterday's metrics)</li>
<li>**Con**: Implementation complexity (batch job + scheduler)</li>
</ul>

<p><strong>C) Hybrid (async log + batch aggregate)</strong></p>
<ul>
<li>**Pro**: Best of both (low overhead + fresh-enough data)</li>
<li>**Pro**: Async logging (no blocking, <5ms overhead)</li>
<li>**Pro**: Batch updates (every 10 uses â†’ 1 DB write)</li>
<li>**Con**: Slight delay in metrics (acceptable for this use case)</li>
</ul>

<p><strong>RECOMMENDATION</strong>: <strong>Option C - Hybrid (Async Log + Batch Aggregate)</strong></p>

<p><strong>RATIONALE</strong>:</p>
<ol>
<li>**Performance**: Async logging eliminates blocking (user doesn't wait)</li>
<li>**Efficiency**: Batch updates reduce DB writes (90% reduction)</li>
<li>**Freshness**: Metrics update every ~10 uses (acceptable latency for analytics)</li>
<li>**Scalability**: Works even with high lookup volume (no locking contention)</li>
</ol>

<p><strong>Implementation</strong>:</p>
<pre><code>class UsageTracker:
    def __init__(self):
        self.buffer = []  # In-memory buffer
        self.batch_size = 10

    async def log_usage(self, hoofdterm, synoniem, provider, hit_count):
        # Add to buffer (non-blocking)
        self.buffer.append({
            "hoofdterm": hoofdterm,
            "synoniem": synoniem,
            "provider": provider,
            "hit_count": hit_count,
            "timestamp": datetime.now(UTC)
        })

        # Flush buffer if full (async)
        if len(self.buffer) &gt;= self.batch_size:
            await self._flush_buffer()

    async def _flush_buffer(self):
        # Batch DB update (1 query, multiple rows)
        await db.executemany(
            "UPDATE synonym_suggestions SET usage_count = usage_count + ? WHERE synoniem = ?",
            [(1, item["synoniem"]) for item in self.buffer]
        )
        self.buffer.clear()</code></pre>

<p><strong>Daily Job</strong>: Calculate <code>effectiveness_score = hit_count / total_uses</code> voor analytics dashboard</p>

<p>---</p>

<h2>Success Metrics</h2>

<h3>User Experience Metrics</h3>

<ol>
<li>**Time to Add Synonym**</li>
</ol>
<ul>
<li>  - **Baseline**: 2 min (manual YAML edit)</li>
<li>  - **Target**: 10 sec (inline approval)</li>
<li>  - **Measurement**: Track time from "Generate suggestions" click to "Approve" click</li>
</ul>

<ol>
<li>**Actions to Approve Synonym**</li>
</ol>
<ul>
<li>  - **Baseline**: 7 steps (navigate, generate, review, approve, manual YAML edit, restart app)</li>
<li>  - **Target**: 1 click (inline approve with auto-sync)</li>
<li>  - **Measurement**: Count user interactions per synonym approval</li>
</ul>

<ol>
<li>**Context Switching**</li>
</ol>
<ul>
<li>  - **Baseline**: 100% (must navigate to /synonym_review)</li>
<li>  - **Target**: <20% (80% use inline approval, 20% use separate page for bulk)</li>
<li>  - **Measurement**: Track navigation patterns in analytics</li>
</ul>

<ol>
<li>**Synonym Discovery Rate**</li>
</ol>
<ul>
<li>  - **Baseline**: Unknown (no visibility)</li>
<li>  - **Target**: 90% of users notice "X synoniemen gevonden" indicator</li>
<li>  - **Measurement**: A/B test with/without indicator, track engagement</li>
</ul>

<h3>Quality Metrics</h3>

<ol>
<li>**Synonym Precision**</li>
</ol>
<ul>
<li>  - **Baseline**: 95% (manual curation)</li>
<li>  - **Target**: >90% (maintain after AI suggestions + human approval)</li>
<li>  - **Measurement**: Sample 50 approved synonyms, expert review for correctness</li>
</ul>

<ol>
<li>**Definition Quality Score (Validation)**</li>
</ol>
<ul>
<li>  - **Baseline**: Current average validation score (unknown)</li>
<li>  - **Target**: +5% improvement (via better weblookup context)</li>
<li>  - **Measurement**: Compare validation scores before/after synonym expansion enabled</li>
</ul>

<ol>
<li>**Synonym Coverage Growth**</li>
</ol>
<ul>
<li>  - **Baseline**: 50 terms, 184 synonyms (3.68 avg per term)</li>
<li>  - **Target**: 150 terms, 500 synonyms (3.33 avg per term)</li>
<li>  - **Measurement**: Track DB growth over 3 months</li>
</ul>

<ol>
<li>**Low-Performer Rate**</li>
</ol>
<ul>
<li>  - **Baseline**: Unknown</li>
<li>  - **Target**: <10% of synonyms have 0 hits in 30 days</li>
<li>  - **Measurement**: Weekly report from LowPerformerDetector</li>
</ul>

<h3>Efficiency Metrics</h3>

<ol>
<li>**Weblookup Hit Rate**</li>
</ol>
<ul>
<li>  - **Baseline**: Unknown (no tracking)</li>
<li>  - **Target**: Wikipedia hit rate +40% (based on "onherroepelijk" case study)</li>
<li>  - **Measurement**: Compare hits before/after initial synonym expansion enabled</li>
</ul>

<ol>
<li>**Token Usage (Prompt)**</li>
</ol>
<ul>
<li>  - **Baseline**: 2800-3800 tokens per definition (World 2 analysis)</li>
<li>  - **Target**: No increase (efficiency maintained)</li>
<li>  - **Measurement**: Track prompt tokens via OpenAI API response</li>
</ul>

<ol>
<li>**API Call Count**</li>
</ol>
<ul>
<li>  - **Baseline**: ~5 providers per lookup (current)</li>
<li>  - **Target**: <7 providers per lookup (with adaptive synonym expansion)</li>
<li>  - **Measurement**: Track provider calls, calculate average</li>
</ul>

<ol>
<li>**YAML Sync Success Rate**</li>
</ol>
<ul>
<li>  - **Baseline**: ~90% (manual sync errors)</li>
<li>  - **Target**: >99% (auto-sync with validation)</li>
<li>  - **Measurement**: Track sync failures, rollback events</li>
</ul>

<h3>Coverage Metrics</h3>

<ol>
<li>**Synonyms Per Term**</li>
</ol>
<ul>
<li>  - **Baseline**: 3.68 avg (184 synonyms / 50 terms)</li>
<li>  - **Target**: 3.5-4.0 avg (quality over quantity)</li>
<li>  - **Measurement**: Calculate avg after each batch approval</li>
</ul>

<ol>
<li>**Hit Rate Per Provider**</li>
</ol>
<ul>
<li>  - **Baseline**: Wikipedia unknown, SRU 100%, Rechtspraak 100%</li>
<li>  - **Target**: Wikipedia >60% (via synonym expansion)</li>
<li>  - **Measurement**: Track hits per provider, calculate hit_rate = hits / total_queries</li>
</ul>

<ol>
<li>**Synonym Usage Distribution**</li>
</ol>
<ul>
<li>  - **Baseline**: Unknown</li>
<li>  - **Target**: 80/20 rule (80% of value from 20% of synonyms)</li>
<li>  - **Measurement**: Pareto chart of usage_count distribution</li>
</ul>

<p>---</p>

<h2>Risk Mitigation</h2>

<h3>Risk 1: Auto-Sync YAML Corruption</h3>

<p><strong>Description</strong>: Automated DBâ†’YAML sync schrijft corrupt file, breaking weblookup</p>

<p><strong>Impact</strong>: High (blocks definition generation)</p>
<p><strong>Probability</strong>: Low (with proper validation)</p>

<p><strong>Mitigation</strong>:</p>
<ol>
<li>**YAML Validator**: Syntax check before write (detect malformed YAML)</li>
<li>**Git Version Control**: Every sync is a commit (easy rollback)</li>
<li>**Backup Before Sync**: Copy to `juridische_synoniemen.yaml.bak`</li>
<li>**Integration Tests**: Test YAML write/read cycle with edge cases</li>
<li>**Canary Check**: After sync, reload in-memory and verify synonym count</li>
</ol>

<p><strong>Monitoring</strong>:</p>
<ul>
<li>Alert if YAML parse fails during reload</li>
<li>Alert if synonym count drops >10% after sync</li>
<li>Weekly audit: Compare DB vs YAML consistency</li>
</ul>

<h3>Risk 2: High-Confidence Auto-Approve Errors</h3>

<p><strong>Description</strong>: GPT-4 suggests wrong synonym with high confidence, auto-approved, breaks quality</p>

<p><strong>Impact</strong>: Medium (degrades definition quality)</p>
<p><strong>Probability</strong>: Low (GPT-4 is accurate for juridical terms)</p>

<p><strong>Mitigation</strong>:</p>
<ol>
<li>**User Control**: Disable auto-approve in settings (default: enabled)</li>
<li>**Conservative Threshold**: Default 0.95 (very high confidence required)</li>
<li>**Weekly Review**: Notification "Review 5 auto-approved synonyms"</li>
<li>**Easy Revert**: 1-click undo within 24h (safety net)</li>
<li>**Audit Trail**: Log all auto-approvals (who, what, when, confidence)</li>
</ol>

<p><strong>Monitoring</strong>:</p>
<ul>
<li>Track auto-approve rate (alert if >20% of all approvals)</li>
<li>Track revert rate (alert if >5% of auto-approvals reverted)</li>
<li>Monthly expert review: Sample 10 auto-approved synonyms</li>
</ul>

<h3>Risk 3: Usage Tracking Performance Impact</h3>

<p><strong>Description</strong>: Logging synonym usage on every weblookup slows down definition generation</p>

<p><strong>Impact</strong>: Medium (user-facing latency)</p>
<p><strong>Probability</strong>: Low (with async implementation)</p>

<p><strong>Mitigation</strong>:</p>
<ol>
<li>**Async Logging**: Non-blocking (< 5ms overhead per lookup)</li>
<li>**Batch Updates**: Buffer 10 uses â†’ 1 DB write (reduce contention)</li>
<li>**Index Optimization**: Add index on `usage_count`, `last_used` columns</li>
<li>**Performance Testing**: Load test with 100 concurrent lookups</li>
<li>**Circuit Breaker**: If tracking fails, log error but don't block weblookup</li>
</ol>

<p><strong>Monitoring</strong>:</p>
<ul>
<li>Track weblookup latency (alert if p95 > 3 seconds)</li>
<li>Track DB write latency (alert if batch update > 100ms)</li>
<li>Track buffer overflow (alert if buffer grows > 100 items)</li>
</ul>

<h3>Risk 4: User Overwhelm (Too Many Features)</h3>

<p><strong>Description</strong>: Releasing all features at once overwhelms user, reduces adoption</p>

<p><strong>Impact</strong>: Medium (feature goes unused)</p>
<p><strong>Probability</strong>: Medium (lots of new UI elements)</p>

<p><strong>Mitigation</strong>:</p>
<ol>
<li>**Phased Rollout**: Ship Phase 1 â†’ wait 1 week â†’ Phase 2 â†’ wait 1 week â†’ Phase 3</li>
<li>**Progressive Disclosure**: Hide advanced features behind "Advanced" tab</li>
<li>**Smart Defaults**: Auto-approve threshold 0.95 (conservative), usage tracking enabled</li>
<li>**Onboarding**: "New synonym features!" popup with 30-second tour</li>
<li>**Opt-Out**: User can disable features via settings (fallback to old behavior)</li>
</ol>

<p><strong>Monitoring</strong>:</p>
<ul>
<li>Track feature engagement (% of users who use inline approval)</li>
<li>User feedback: Survey after 2 weeks ("How helpful are new synonym features?")</li>
<li>A/B test: Rollout to 50% of users first, compare metrics</li>
</ul>

<p>---</p>

<h2>Open Questions</h2>

<h3>Empirische Vragen (Need A/B Testing)</h3>

<ul>
<li>[ ] **Q1**: Does initial synonym expansion improve definition validation scores?</li>
<li> - **Method**: A/B test (50% with expansion, 50% without) for 2 weeks, compare avg validation score</li>
<li> - **Hypothesis**: +5% improvement in validation scores</li>
<li> - **Decision**: If improvement <2%, revert to fallback-only (not worth complexity)</li>
</ul>

<ul>
<li>[ ] **Q2**: What is optimal auto-approve confidence threshold?</li>
<li> - **Method**: Track revert rate for different thresholds (0.90, 0.95, 0.98)</li>
<li> - **Hypothesis**: 0.95 balances efficiency (auto-approve 60% of suggestions) with quality (revert rate <5%)</li>
<li> - **Decision**: Adjust threshold based on data after 1 month</li>
</ul>

<ul>
<li>[ ] **Q3**: Does inline approval increase synonym adoption?</li>
<li> - **Method**: Compare approval rate before/after inline UI (separate page vs inline)</li>
<li> - **Hypothesis**: +50% increase in approval rate (easier access â†’ more usage)</li>
<li> - **Decision**: If increase <20%, inline UI might not be worth effort</li>
</ul>

<h3>Technical Spikes (Need Performance Testing)</h3>

<ul>
<li>[ ] **Q4**: What is actual performance impact of usage tracking?</li>
<li> - **Method**: Load test with 100 concurrent lookups, measure latency with/without tracking</li>
<li> - **Hypothesis**: <5ms overhead per lookup (acceptable)</li>
<li> - **Decision**: If overhead >10ms, switch to daily batch-only (no real-time tracking)</li>
</ul>

<ul>
<li>[ ] **Q5**: Can YAML hot-reload work without race conditions?</li>
<li> - **Method**: Stress test with concurrent lookups during YAML reload</li>
<li> - **Hypothesis**: File-based reload is safe (Python GIL protects in-memory dict)</li>
<li> - **Decision**: If race conditions found, implement reader-writer lock or restart-only</li>
</ul>

<ul>
<li>[ ] **Q6**: What is realistic synonym coverage target?</li>
<li> - **Method**: Analyze existing legal definitions, count unique terms without synonyms</li>
<li> - **Hypothesis**: 150 terms (3x growth) is achievable in 3 months with AI assistance</li>
<li> - **Decision**: Adjust target based on GPT-4 suggestion quality after 1 month</li>
</ul>

<h3>User Research (Need User Feedback)</h3>

<ul>
<li>[ ] **Q7**: What synonym information do users actually want to see?</li>
<li> - **Method**: User interviews (5 users), show mockups, ask "What's useful?"</li>
<li> - **Hypothesis**: Users want usage stats (hit count) + confidence, NOT rationale (too verbose)</li>
<li> - **Decision**: Adjust UI based on feedback (remove/hide less useful fields)</li>
</ul>

<ul>
<li>[ ] **Q8**: How often do users want proactive synonym suggestions?</li>
<li> - **Method**: Track dismissal rate of "Genereer synoniemen" prompts</li>
<li> - **Hypothesis**: <10% dismissal rate (users find suggestions helpful)</li>
<li> - **Decision**: If dismissal rate >30%, reduce proactive prompts frequency</li>
</ul>

<ul>
<li>[ ] **Q9**: Should low-performer notifications be opt-in or opt-out?</li>
<li> - **Method**: A/B test (50% get weekly notifications, 50% don't), compare cleanup rate</li>
<li> - **Hypothesis**: Notifications increase cleanup rate by 50% (proactive management)</li>
<li> - **Decision**: If no significant difference, make notifications opt-in (reduce noise)</li>
</ul>

<p>---</p>

<h2>Implementation Dependencies Graph</h2>

<pre><code>Phase 1 (Foundation)
===================
1.1 (DB Schema) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â–¼
1.2 (Usage Tracking) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â–¼
1.3 (Auto-Sync DBâ†’YAML)           3.1 (Analytics Dashboard)
                                   â”‚
1.4 (Initial Expansion) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                   â–¼
                            2.3 (Web Lookup Report)

Phase 2 (Enhancement)
=====================
2.1 (Synonym Indicator) â”€â”€â”€â”€â”€â”€â”
                              â–¼
2.2 (Inline Approval) â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”
                                 â–¼
2.3 (Web Lookup Report) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â†’ Full inline workflow

Phase 3 (Experimentation)
==========================
3.1 (Analytics Dashboard) â”€â”€â”€â”€â”€â”€â”€â”
                                 â–¼
3.3 (Low-Performer Detector) â”€â”€â”€â”€â”´â”€â”€â”
                                    â–¼
3.2 (Auto-Approve) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â†’ Fully automated workflow

3.4 (Example Parser) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Independent (can ship anytime)</code></pre>

<p><strong>Critical Path</strong> (blocking other work):</p>
<pre><code>1.1 (DB Schema) â†’ 1.2 (Usage Tracking) â†’ 2.3 (Report) â†’ 3.1 (Analytics)</code></pre>

<p><strong>Parallel Work</strong> (can ship independently):</p>
<pre><code>1.3 (Auto-Sync) + 1.4 (Initial Expansion) + 2.1 (Indicator) + 2.2 (Inline Approval)</code></pre>

<p>---</p>

<h2>Conclusion</h2>

<h3>Kern van de Oplossing</h3>

<p><strong>"Best of 3 Worlds"</strong> integreert drie parallelle problemen in Ã©Ã©n coherente oplossing:</p>

<ol>
<li>**World 1 (Weblookup)** â†’ Synoniemen worden proactief gebruikt (initial expansion) met adaptive fallback, quality gate voorkomt irrelevante juridical boosts</li>
<li>**World 2 (Context)** â†’ Token efficiency behouden, synoniemen blijven invisible tool (niet in definitie), ROI wordt gemeten via validation scores</li>
<li>**World 3 (UX)** â†’ Database is single source of truth, inline approval (1 click), automatic YAML sync, full visibility via analytics</li>
</ol>

<h3>Waarom Gaat Dit Werken?</h3>

<p><strong>Cross-Cutting Benefits</strong>:</p>
<ul>
<li>**Synoniemen coverage** verbetert door initial expansion (World 1) + AI suggestions (World 3)</li>
<li>**User efficiency** verbetert door inline approval (World 3) + visible impact (World 2 report)</li>
<li>**Quality** verbetert door usage tracking (World 1) + low-performer detection (World 3)</li>
</ul>

<p><strong>Minimal Risk</strong>:</p>
<ul>
<li>Phased rollout (P0 â†’ P1 â†’ P2) spreads risk</li>
<li>Mitigations in place (YAML validation, auto-approve revert, async tracking)</li>
<li>A/B testing for empirical validation (niet gokken, meten)</li>
</ul>

<p><strong>Maximal Impact</strong>:</p>
<ul>
<li>Quick wins in Phase 1 (80% of value, 20% of effort)</li>
<li>Progressive enhancement in Phase 2-3 (power user features)</li>
<li>Measurable success criteria (niet "improve quality", maar "+5% validation score")</li>
</ul>

<h3>Next Steps</h3>

<ol>
<li>**Stakeholder Review** (Product Owner): Approve phased roadmap + priorities</li>
<li>**Technical Spike** (1 day): Validate usage tracking performance (< 5ms overhead?)</li>
<li>**Design Review** (2 days): Wireframes for inline approval dialog + Web Lookup Report</li>
<li>**Phase 1 Kickoff** (Week 1): Implement DB enhancements + usage tracking + auto-sync + initial expansion</li>
</ol>

<p><strong>Questions?</strong> Contact Claude Code for clarification or prioritization adjustments.</p>

<p>---</p>

<p><strong>Document Version</strong>: 1.0</p>
<p><strong>Last Updated</strong>: October 9, 2025</p>
<p><strong>Status</strong>: Pending Approval</p>
<p><strong>Next Review</strong>: After Phase 1 completion</p>

  </div>
</body>
</html>