<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Data Loss Analyse: Voorbeelden Verlies 2025-10-30</title>
  <link rel="stylesheet" href="../portal.css" />
  <style>
    .doc { max-width: 900px; margin: 16px auto 48px auto; padding: 0 16px; }
    .doc h1,.doc h2,.doc h3,.doc h4{ color:#223 }
    .doc p{ line-height:1.6; color:#222 }
    .doc a{ color:#1d4ed8; text-decoration: underline; }
    .doc pre{ background:#0b1020; color:#e6edf3; padding:12px; overflow:auto; border-radius:8px }
    .doc code{ background:#f0f2f5; padding:2px 6px; border-radius:4px }
    .back{ display:inline-block; margin:12px 0; padding:6px 10px; border:1px solid #ccd; border-radius:6px; text-decoration:none; color:#223; background:#f8f9fb }
  </style>
</head>
<body>
  <div class="doc">
    <a class="back" href="../../index.html">‚Üê Terug naar Portal</a>
    <h1>Data Loss Analyse: Voorbeelden Verlies 2025-10-30</h1>

<p><strong>Status:</strong> ‚úÖ OPGELOST</p>
<p><strong>Datum incident:</strong> 2025-10-30 15:43</p>
<p><strong>Datum herstel:</strong> 2025-10-30 17:00</p>
<p><strong>Impact:</strong> 10 definities, 130 voorbeelden tijdelijk verloren</p>

<h2>üìã Executive Summary</h2>

<p>Op 30 oktober 2025 om 15:43 zijn bij 10 recent aangemaakte definities (ID's 79-91) alle voorbeelden verloren gegaan, behalve de "sentence" voorbeelden. Dit betrof:</p>
<ul>
<li>Praktijkvoorbeelden</li>
<li>Tegenvoorbeelden</li>
<li>Synoniemen</li>
<li>Antoniemen</li>
<li>Toelichtingen</li>
</ul>

<p><strong>Root cause:</strong> Git branch switch terwijl database nog in git tracking zat, waardoor database werd overschreven met oudere versie.</p>

<p><strong>Recovery:</strong> Succesvol hersteld uit TXT export bestanden (130 voorbeelden).</p>

<h2>üîç Timeline</h2>

<p>| Tijd | Event | Details |</p>
<p>|------|-------|---------|</p>
<p>| <strong>10:10-12:55</strong> | Definities aangemaakt | ID's 79-91 aangemaakt met volledige voorbeelden |</p>
<p>| <strong>15:43</strong> | ‚ö†Ô∏è <strong>Data loss</strong> | Git checkout van <code>feature/DEF-54</code> ‚Üí <code>main</code> overschrijft database |</p>
<p>| <strong>15:50-16:32</strong> | Gedeeltelijke regeneratie | Alleen "sentence" voorbeelden opnieuw gegenereerd |</p>
<p>| <strong>16:28-16:46</strong> | Preventie ge√Ømplementeerd | Database uit git gehaald (.gitignore) |</p>
<p>| <strong>17:00</strong> | ‚úÖ <strong>Recovery compleet</strong> | 130 voorbeelden hersteld uit export files |</p>

<h2>üî¨ Root Cause Analysis</h2>

<h3>Directe Oorzaak</h3>

<pre><code># Git reflog toont:
HEAD@{2025-10-30 15:43:22 +0100}: checkout: moving from feature/DEF-54 to main</code></pre>

<p>De database <code>data/definities.db</code> zat op dat moment nog in git tracking. Bij de branch switch werd het bestand overschreven met de versie van <code>main</code>, die <strong>alleen "sentence" voorbeelden</strong> bevatte voor deze definities.</p>

<h3>Onderliggende Problemen</h3>

<ol>
<li>**Database in Git**</li>
</ol>
<ul>
<li>  - `data/definities.db` werd getrackt in repository</li>
<li>  - Branch switches overschrijven lokale database wijzigingen</li>
<li>  - Geen warning bij data loss</li>
</ul>

<ol>
<li>**Incomplete Export tijdens Ontwikkeling**</li>
</ol>
<ul>
<li>  - Geen automatische backup voor elke definitie save</li>
<li>  - TXT exports waren wel aanwezig, maar handmatig</li>
</ul>

<ol>
<li>**Geen Validatie op Voorbeelden Compleetheid**</li>
</ol>
<ul>
<li>  - Geen check of alle 6 voorbeeld typen aanwezig zijn</li>
<li>  - Geen alerting bij ontbrekende voorbeelden</li>
</ul>

<h2>üìä Impact Analysis</h2>

<h3>Betroffen Definities</h3>

<p>| ID | Begrip | Aangemaakt | Verloren Voorbeelden |</p>
<p>|----|--------|------------|---------------------|</p>
<p>| 79 | biografisch identiteitskenmerk | 2025-10-29 10:27 | 13 |</p>
<p>| 82 | biometrie | 2025-10-29 11:54 | 13 |</p>
<p>| 83 | biometrisch identiteitskenmerk | 2025-10-29 12:10 | 13 |</p>
<p>| 84 | digitaal identiteitsmiddel | 2025-10-29 12:21 | 13 |</p>
<p>| 85 | digitaal identiteitsbewijs | 2025-10-29 12:35 | 13 |</p>
<p>| 86 | digitaal identiteitsbewijs | 2025-10-29 12:37 | 13 |</p>
<p>| 87 | identiteit vaststellen | 2025-10-29 12:50 | 13 |</p>
<p>| 88 | identiteit vaststellen | 2025-10-29 12:55 | 13 |</p>
<p>| 90 | identiteit bepalen | 2025-10-30 09:49 | 13 |</p>
<p>| 91 | identiteit verifi√´ren en verrijken | 2025-10-30 10:10 | 13 |</p>
<p>| <strong>TOTAAL</strong> | <strong>10 definities</strong> | | <strong>130 voorbeelden</strong> |</p>

<h3>Voorbeeld Type Breakdown (per definitie)</h3>

<ul>
<li>**Sentence examples:** 3 (‚úÖ behouden)</li>
<li>**Practical examples:** 1 (‚ùå verloren, ‚úÖ hersteld)</li>
<li>**Counter examples:** 1 (‚ùå verloren, ‚úÖ hersteld)</li>
<li>**Synonyms:** 5 (‚ùå verloren, ‚úÖ hersteld)</li>
<li>**Antonyms:** 5 (‚ùå verloren, ‚úÖ hersteld)</li>
<li>**Explanation:** 1 (‚ùå verloren, ‚úÖ hersteld)</li>
</ul>

<h2>üîß Recovery Process</h2>

<h3>1. Detection</h3>

<pre><code>-- Identificeer definities zonder alle voorbeeld typen
SELECT d.id, d.begrip,
       GROUP_CONCAT(DISTINCT v.voorbeeld_type) as types_present
FROM definities d
LEFT JOIN definitie_voorbeelden v ON d.id = v.definitie_id
WHERE d.created_at &gt;= '2025-10-29'
GROUP BY d.id
HAVING COUNT(DISTINCT v.voorbeeld_type) &lt; 6;</code></pre>

<h3>2. Recovery Script</h3>

<p>Nieuw script: <code>scripts/recover_voorbeelden.py</code></p>

<p><strong>Features:</strong></p>
<ul>
<li>Parse ALLE voorbeeld typen uit TXT export format</li>
<li>Dry-run mode voor verificatie</li>
<li>Detectie van bestaande voorbeelden (geen duplicates)</li>
<li>Detailed progress logging</li>
</ul>

<p><strong>Resultaat:</strong></p>
<pre><code>‚úÖ RECOVERY COMPLEET!
   Hersteld: 130 voorbeelden</code></pre>

<h3>3. Verification</h3>

<pre><code>-- Verificatie: alle definities hebben 6 voorbeeld typen
SELECT definitie_id, COUNT(DISTINCT voorbeeld_type) as type_count
FROM definitie_voorbeelden
WHERE definitie_id IN (79, 82, 83, 84, 85, 86, 87, 88, 90, 91)
GROUP BY definitie_id;
-- Result: Alle definities hebben type_count = 6 ‚úÖ</code></pre>

<h2>üõ°Ô∏è Preventie Maatregelen</h2>

<h3>Ge√Ømplementeerd (2025-10-30)</h3>

<ol>
<li>**Database uit Git** ‚úÖ</li>
<pre><code>   # Commit bbac2a71: "fix: stop tracking data/definities.db"
   echo "data/definities.db" &gt;&gt; .gitignore
   git rm --cached data/definities.db</code></pre>
</ol>

<ol>
<li>**Auto-Backup Systeem** ‚úÖ (EPIC-016, commit 82e6a256)</li>
</ol>
<ul>
<li>  - Automatische backups bij elke definitie save</li>
<li>  - Locatie: `data/backups/auto/`</li>
<li>  - Rolling backup met symlink naar `latest.db`</li>
</ul>

<h3>Aanbevolen Verbeteringen</h3>

<ol>
<li>**Voorbeelden Compleetheid Check** (TODO)</li>
<pre><code>   # Pre-save validatie: check alle 6 voorbeeld typen aanwezig
   REQUIRED_EXAMPLE_TYPES = {'sentence', 'practical', 'counter',
                              'synonyms', 'antonyms', 'explanation'}

   def validate_voorbeelden_complete(definitie_id: int) -&gt; bool:
       present_types = get_voorbeeld_types(definitie_id)
       missing = REQUIRED_EXAMPLE_TYPES - present_types
       if missing:
           logger.warning(f"Definitie {definitie_id} mist: {missing}")
           return False
       return True</code></pre>
</ol>

<ol>
<li>**Database Integrity Check** (TODO)</li>
</ol>
<ul>
<li>  - Pre-commit hook: check database niet in staging area</li>
<li>  - Startup check: verify database file timestamp > last commit</li>
<li>  - Alert bij onverwachte database resets</li>
</ul>

<ol>
<li>**Export Enhancement** (TODO)</li>
</ol>
<ul>
<li>  - Automatische export bij "Vaststellen" status</li>
<li>  - Versioned exports: `definitie_{id}_v{version}.txt`</li>
<li>  - Metadata tracking: laatst ge√´xporteerde versie</li>
</ul>

<h2>üìà Lessons Learned</h2>

<h3>Do's ‚úÖ</h3>

<ol>
<li>**Export bestanden zijn goud waard** - TXT exports maakten recovery mogelijk</li>
<li>**Database uit git houden** - Voorkomt branch switch issues</li>
<li>**Gestructureerde recovery scripts** - Dry-run + verification essentieel</li>
<li>**Git reflog is je friend** - Precies kunnen traceren wat er gebeurde</li>
</ol>

<h3>Don'ts ‚ùå</h3>

<ol>
<li>**NOOIT binary data files in git** - Databases, images, etc. horen in .gitignore</li>
<li>**Niet aannemen dat backups compleet zijn** - Oude backup had zelfde probleem</li>
<li>**Geen silent partial regeneration** - Als voorbeelden verloren gaan, alert!</li>
</ol>

<h2>üîó Related Issues</h2>

<ul>
<li>**DEF-68:** Database tracking preventie (commit bbac2a71)</li>
<li>**EPIC-016:** Auto-backup systeem (commit 82e6a256)</li>
<li>**DEF-54:** Feature branch waar data loss begon</li>
</ul>

<h2>üìù Action Items</h2>

<ul>
<li>[x] Database uit git tracking halen</li>
<li>[x] Recovery script maken en uitvoeren</li>
<li>[x] Verificatie van herstel</li>
<li>[x] Documentatie van incident</li>
<li>[ ] Voorbeelden compleetheid check implementeren</li>
<li>[ ] Database integrity pre-commit hook</li>
<li>[ ] Enhanced export systeem met versioning</li>
<li>[ ] Monitoring dashboard voor data completeness</li>
</ul>

<h2>üîç Verification Commands</h2>

<pre><code># Check welke definities incomplete voorbeelden hebben
sqlite3 data/definities.db "
SELECT definitie_id, COUNT(DISTINCT voorbeeld_type) as types
FROM definitie_voorbeelden
WHERE actief = 1
GROUP BY definitie_id
HAVING types &lt; 6;
"

# Recovery script uitvoeren
python3 scripts/recover_voorbeelden.py

# Verificatie na recovery
sqlite3 data/definities.db "
SELECT definitie_id, voorbeeld_type, COUNT(*) as cnt
FROM definitie_voorbeelden
WHERE definitie_id IN (79, 82, 83, 84, 85, 86, 87, 88, 90, 91)
AND actief = 1
GROUP BY definitie_id, voorbeeld_type
ORDER BY definitie_id, voorbeeld_type;
"</code></pre>

<h2>üìö References</h2>

<ul>
<li>Recovery script: `scripts/recover_voorbeelden.py`</li>
<li>Export bestanden: `exports/definities_export_20251029_*.txt`</li>
<li>Git reflog: commits bbac2a71, 247af330, 82e6a256</li>
<li>Database schema: `src/database/schema.sql` (definitie_voorbeelden tabel)</li>
</ul>

  </div>
</body>
</html>