<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CONSENSUS RAPPORT: Prompt Optimalisatie Analyses</title>
  <link rel="stylesheet" href="../portal.css" />
  <style>
    .doc { max-width: 900px; margin: 16px auto 48px auto; padding: 0 16px; }
    .doc h1,.doc h2,.doc h3,.doc h4{ color:#223 }
    .doc p{ line-height:1.6; color:#222 }
    .doc a{ color:#1d4ed8; text-decoration: underline; }
    .doc pre{ background:#0b1020; color:#e6edf3; padding:12px; overflow:auto; border-radius:8px }
    .doc code{ background:#f0f2f5; padding:2px 6px; border-radius:4px }
    .back{ display:inline-block; margin:12px 0; padding:6px 10px; border:1px solid #ccd; border-radius:6px; text-decoration:none; color:#223; background:#f8f9fb }
  </style>
</head>
<body>
  <div class="doc">
    <a class="back" href="../../index.html">‚Üê Terug naar Portal</a>
    <h1>CONSENSUS RAPPORT: Prompt Optimalisatie Analyses</h1>
<p><strong>Datum:</strong> 2025-11-07</p>
<p><strong>Vergelijking:</strong> DEF-101 (prompt-6) vs Nieuwe Analyse (prompt-7)</p>
<p><strong>Doel:</strong> Identificeer consensus, unieke inzichten en samengesteld actieplan</p>

<p>---</p>

<h2>EXECUTIVE SUMMARY</h2>

<p>Beide analyses identificeren <strong>dezelfde fundamentele problemen</strong> maar vanuit verschillende invalshoeken:</p>
<ul>
<li>**DEF-101**: Focus op BLOCKING contradictions die prompt unusable maken</li>
<li>**Nieuwe Analyse**: Focus op architectuur (16 modules) + dubbel gebruik validatieregels</li>
</ul>

<p><strong>Kritieke consensus:</strong> Prompt is overengineered met ~65% redundantie en fundamentele conflicten.</p>
<p><strong>Verschil in aanpak:</strong> DEF-101 lost conflicten op, Nieuwe Analyse verwijdert validatieregels volledig.</p>

<p>---</p>

<h2>1. OVERLAPPENDE PROBLEMEN (CONSENSUS)</h2>

<h3>1.1 CONFLICT #1: "is" Paradox (IDENTIEK)</h3>

<p>| Aspect | DEF-101 (prompt-6) | Nieuwe Analyse (prompt-7) |</p>
<p>|--------|-------------------|---------------------------|</p>
<p>| <strong>Conflict</strong> | ESS-02 requires "is een activiteit" BUT Line 300 forbids "is" | Regel 323-325 ‚ùå "Start niet met 'is'" VS Regel 73-77 ‚úÖ "start met 'activiteit waarbij...'" |</p>
<p>| <strong>Impact</strong> | BLOCKING - NO VALID SOLUTION | AI krijgt tegengestelde instructies |</p>
<p>| <strong>Severity</strong> | üî¥ CRITICAL | üî¥ CRITICAL |</p>
<p>| <strong>Status</strong> | IDENTICAL ISSUE | IDENTICAL ISSUE |</p>

<p><strong>Consensus:</strong> Dit is het meest kritieke conflict dat beide analyses identificeren.</p>

<p>---</p>

<h3>1.2 CONFLICT #2: Containerbegrip Paradox (IDENTIEK)</h3>

<p>| Aspect | DEF-101 (prompt-6) | Nieuwe Analyse (prompt-7) |</p>
<p>|--------|-------------------|---------------------------|</p>
<p>| <strong>Conflict</strong> | ARAI-02 forbids "proces", "activiteit" BUT ESS-02 templates use them | ARAI-02: "Vermijd 'proces', 'activiteit'" BUT ESS-02: "MOET starten met 'proces', 'activiteit'" |</p>
<p>| <strong>Lines</strong> | Line 126 (ARAI-02) vs Line 75 (ESS-02) | ARAI-02 vs ESS-02 regel |</p>
<p>| <strong>Impact</strong> | BLOCKING - ESS-02 requires what ARAI-02 forbids | ESS-02 vereist wat ARAI-02 verbiedt |</p>
<p>| <strong>Status</strong> | IDENTICAL ISSUE | IDENTICAL ISSUE |</p>

<p><strong>Consensus:</strong> Beide analyses vinden exact hetzelfde conflict tussen ARAI-02 en ESS-02.</p>

<p>---</p>

<h3>1.3 REDUNDANTIE: Enkelvoud Regel (CONSENSUS)</h3>

<p>| Metric | DEF-101 (prompt-6) | Nieuwe Analyse (prompt-7) |</p>
<p>|--------|-------------------|---------------------------|</p>
<p>| <strong>Herhalingen</strong> | 5√ó (80% redundancy) | 5√ó (regels 26-31, 288-290, 299, 386) |</p>
<p>| <strong>Locations</strong> | Lines 26-31, 288, 289, 299, 386 | Exact dezelfde locaties |</p>
<p>| <strong>Impact</strong> | 80% redundant | 40% overall redundantie |</p>

<p><strong>Consensus:</strong> Enkelvoud regel is kritieke redundantie in beide versies.</p>

<p>---</p>

<h3>1.4 REDUNDANTIE: Koppelwerkwoord Verbod (CONSENSUS)</h3>

<p>| Metric | DEF-101 (prompt-6) | Nieuwe Analyse (prompt-7) |</p>
<p>|--------|-------------------|---------------------------|</p>
<p>| <strong>Herhalingen</strong> | 6√ó (83% redundancy) | 6√ó (regels 78, 134, 294, 301-318, 344) |</p>
<p>| <strong>Lines</strong> | 133, 150-156, 294, 300-316, 344, 386 | Exact dezelfde locaties |</p>
<p>| <strong>Impact</strong> | 83% redundant | Belangrijk onderdeel 40% totaal |</p>

<p><strong>Consensus:</strong> Koppelwerkwoord verbod is meest herhaalde regel.</p>

<p>---</p>

<h3>1.5 REDUNDANTIE: Ontologische Categorie (CONSENSUS)</h3>

<p>| Metric | DEF-101 (prompt-6) | Nieuwe Analyse (prompt-7) |</p>
<p>|--------|-------------------|---------------------------|</p>
<p>| <strong>Herhalingen</strong> | 5√ó (80% redundancy) | 3√ó (ESS-02, regel 141, STR-06) |</p>
<p>| <strong>Lines 71-108</strong> | 38 lines SHOULD BE 20 lines | Onderdeel van validatieregels |</p>
<p>| <strong>Impact</strong> | 80% redundant | Concept "essentie niet doel" 3√ó |</p>

<p><strong>Consensus:</strong> ESS-02 is te uitgebreid en herhaald, maar nieuwe analyse meet minder herhalingen.</p>

<p>---</p>

<h3>1.6 COGNITIEVE OVERLOAD (CONSENSUS)</h3>

<p>| Metric | DEF-101 (prompt-6) | Nieuwe Analyse (prompt-7) |</p>
<p>|--------|-------------------|---------------------------|</p>
<p>| <strong>Cognitive Load</strong> | 9/10 (CRITICAL) ‚Üí 4/10 | LLM Compliance ~60% ‚Üí ~90% |</p>
<p>| <strong>Forbidden Patterns</strong> | 42 bullets linear | 42 regels (294-335) |</p>
<p>| <strong>Individual Rules</strong> | 45+ (3√ó over limit) | 53 validatieregels |</p>
<p>| <strong>Impact</strong> | Impossible to memorize | Te veel voor consistent LLM gedrag |</p>

<p><strong>Consensus:</strong> Beide analyses identificeren severe cognitive overload door te veel regels.</p>

<p>---</p>

<h3>1.7 FLOW PROBLEMEN (CONSENSUS)</h3>

<p>| Aspect | DEF-101 (prompt-6) | Nieuwe Analyse (prompt-7) |</p>
<p>|--------|-------------------|---------------------------|</p>
<p>| <strong>Metadata Position</strong> | Lines 401-419 (END) | Should be line 10-15 |</p>
<p>| <strong>Ontological Category</strong> | Line 71 (BURIED) | Should be TOP 5 concepts |</p>
<p>| <strong>Flow Score</strong> | 4/10 ‚Üí 8/10 | N/A (geen score) |</p>

<p><strong>Consensus:</strong> Kritieke concepten zijn begraven, metadata komt te laat.</p>

<p>---</p>

<h2>2. UNIEKE INZICHTEN PER ANALYSE</h2>

<h3>2.1 DEF-101 UNIEK (prompt-6)</h3>

<h4>A. BLOCKING Contradictions Framework</h4>
<ul>
<li>**5 BLOCKING contradictions** expliciet gelabeld (DEF-101 priority)</li>
<li>**Real Impact Examples** met concrete scenario's:</li>
<pre><code>  Task: Define "vermogen" as RESULTAAT
  Attempt 1 (Following ESS-02): "is het resultaat van..." ‚ùå FAILS
  Attempt 2 (Following STR-01): "resultaat van processen..." ‚ùå FAILS
  Result: NO VALID SOLUTION</code></pre>
</ul>

<h4>B. Exception Clause Solutions</h4>
<ul>
<li>**Detailed fix strategies** met Python code examples:</li>
<pre><code>  # Add ESS-02 Exception in error_prevention_module.py
  exceptions_note = """
  ‚ö†Ô∏è EXCEPTION voor Ontologische Categorie (ESS-02):
  Bij het markeren van ontologische categorie MAG je starten met:
  - "activiteit waarbij..." (PROCES)
  - "resultaat van..." (RESULTAAT)
  """</code></pre>
</ul>

<h4>C. 3-Tier Priority System</h4>
<ul>
<li>**TIER 1 (10 rules):** ABSOLUTE REQUIREMENTS</li>
<li>**TIER 2 (20 rules):** STRONG RECOMMENDATIONS</li>
<li>**TIER 3 (15 rules):** QUALITY POLISH</li>
<li>Visuele badges: ‚ö†Ô∏è (TIER 1), ‚úÖ (TIER 2), ‚ÑπÔ∏è (TIER 3)</li>
</ul>

<h4>D. Module Sync Verification</h4>
<ul>
<li>‚úÖ **PERFECT SYNC** met codebase (16 modules)</li>
<li>Module mapping table (lines ‚Üí modules)</li>
<li>Bevestiging: "Prompt is complete and up-to-date with codebase"</li>
</ul>

<h4>E. Comprehensive Test Suite</h4>
<ul>
<li>`test_ess02_exception_clause_present()`</li>
<li>`test_no_blocking_contradictions()`</li>
<li>`test_redundancy_below_threshold()`</li>
<li>`test_forbidden_patterns_categorized()`</li>
</ul>

<h4>F. Risk Assessment & Rollback Plan</h4>
<ul>
<li>Risk matrix (probability √ó impact √ó mitigation)</li>
<li>Feature flags per module voor gradual rollout</li>
<li>Git rollback procedure</li>
</ul>

<p>---</p>

<h3>2.2 NIEUWE ANALYSE UNIEK (prompt-7)</h3>

<h4>A. DUBBEL GEBRUIK VALIDATIEREGELS (NIEUW!)</h4>
<p><strong>Kritiek inzicht:</strong> 48% van tokens (3.500) zijn regels die toch automatisch worden gevalideerd!</p>

<pre><code># In Prompt (3.500 tokens):
AraiRulesModule ‚Üí Voegt ARAI-01 t/m ARAI-06 toe aan prompt

# In Post-Processing (zelfde regels):
ModularValidationService ‚Üí Voert ARAI-01.py uit op output</code></pre>

<p><strong>Impact:</strong> Grootste optimalisatie kans (-3.500 tokens) die DEF-101 niet identificeert!</p>

<h4>B. Architectuur: 16 Modules Analysis</h4>
<p><strong>Probleem:</strong> Alle 16 modules draaien ALTIJD, ongeacht context of behoefte.</p>

<pre><code>PromptServiceV2.build_generation_prompt()
    ‚Üì
16 Prompt Modules (ALWAYS ACTIVE)
    ‚îú‚îÄ‚îÄ 6 Core Modules
    ‚îú‚îÄ‚îÄ 7 Validation Modules (3.500 tokens dubbel!)
    ‚îî‚îÄ‚îÄ 3 Support Modules
    ‚Üì
419 regels, 7.250 tokens</code></pre>

<p><strong>Oplossing:</strong> Conditional module loading + cache static modules</p>

<h4>C. Token Reduction Metrics</h4>
<ul>
<li>**Huidig:** 7.250 tokens</li>
<li>**Quick Wins:** 5.000 tokens (-31%)</li>
<li>**Volledig:** 2.650 tokens (-63%)</li>
<li>**DEF-101:** 419 ‚Üí 354 lines (-15.5%)</li>
</ul>

<p><strong>Nieuwe analyse heeft agressievere target!</strong></p>

<h4>D. Quick Wins Strategy (30 minuten)</h4>
<ol>
<li>**Verwijder validatieregels uit prompt** (-3.500 tokens)</li>
<li>**Consolideer verboden lijst** (-750 tokens)</li>
<li>**Fix conflicten** (0 tokens, +100% consistency)</li>
</ol>

<p><strong>Total: -4.250 tokens in 30 minuten werk!</strong></p>

<h4>E. Inverted Pyramid Structure (NIEUW!)</h4>
<pre><code>NIVEAU 1: MISSION (50 tokens)
NIVEAU 2: 3 GOLDEN RULES (300 tokens)
NIVEAU 3: TEMPLATES (400 tokens)
NIVEAU 4: REFINEMENT (800 tokens)
NIVEAU 5: CHECKLIST (100 tokens)</code></pre>

<p><strong>DEF-101 heeft linear restructure, nieuwe analyse heeft hierarchical pyramid.</strong></p>

<h4>F. Conditional Module Loading</h4>
<pre><code>class PromptOrchestrator:
    def _filter_modules(self, context):
        if not context.has_juridische_context:
            skip_modules.append("legal_module")</code></pre>

<p><strong>DEF-101 focus op reordering, nieuwe analyse op conditional execution.</strong></p>

<p>---</p>

<h2>3. OPLOSSINGEN VERGELIJKING</h2>

<h3>3.1 CONFLICT RESOLUTIE</h3>

<p>| Conflict | DEF-101 Oplossing | Nieuwe Analyse Oplossing | BESTE AANPAK |</p>
<p>|----------|-------------------|--------------------------|--------------|</p>
<p>| <strong>"is" Paradox</strong> | Add exception clause in <code>error_prevention_module.py</code> | Verduidelijk regel 323: "is een proces" vs "activiteit" | <strong>DEF-101</strong> (meer compleet) |</p>
<p>| <strong>Container Terms</strong> | Exempt ontological markers from ARAI-02 | Principle: ESS-02 vereist wat ARAI-02 verbiedt | <strong>DEF-101</strong> (concrete fix) |</p>
<p>| <strong>Relative Clauses</strong> | Replace "Vermijd bijzinnen" with "Minimize..." + exceptions | N/A (niet expliciet addressed) | <strong>DEF-101</strong> (alleen oplossing) |</p>
<p>| <strong>Article "een"</strong> | Add exception for ESS-02 ontological marking | N/A (niet expliciet addressed) | <strong>DEF-101</strong> (alleen oplossing) |</p>
<p>| <strong>Context Usage</strong> | Clarify "Implicit vs Explicit" context usage | N/A (niet expliciet addressed) | <strong>DEF-101</strong> (alleen oplossing) |</p>

<p><strong>Consensus:</strong> DEF-101 heeft completere conflict resolutie strategie.</p>

<p>---</p>

<h3>3.2 REDUNDANTIE ELIMINATIE</h3>

<p>| Type | DEF-101 Aanpak | Nieuwe Analyse Aanpak | BESTE AANPAK |</p>
<p>|------|----------------|----------------------|--------------|</p>
<p>| <strong>Enkelvoud</strong> | Keep Grammar module, delete VER-01/02/03, cross-reference | Consolideer naar 1 locatie | <strong>DEF-101</strong> (meer detail) |</p>
<p>| <strong>Koppelwerkwoord</strong> | Keep STR-01 (best examples), merge forbidden list into 5 categories | Consolideer naar 3 templates | <strong>NIEUWE</strong> (agressiever) |</p>
<p>| <strong>Ontologische</strong> | Reduce lines 71-108 from 38 to 20 lines | Principle: Regels in post-processing, summary in prompt | <strong>NIEUWE</strong> (meer reductie) |</p>
<p>| <strong>Forbidden Patterns</strong> | Categorize 42 bullets into 7 groups | Replace 42 regels with 3 templates | <strong>NIEUWE</strong> (drastischer) |</p>

<p><strong>Consensus:</strong> Nieuwe analyse heeft agressievere reductie, DEF-101 heeft veiligere incrementele aanpak.</p>

<p>---</p>

<h3>3.3 FLOW RESTRUCTURING</h3>

<p>| Aspect | DEF-101 Oplossing | Nieuwe Analyse Oplossing | BESTE AANPAK |</p>
<p>|--------|-------------------|--------------------------|--------------|</p>
<p>| <strong>Module Order</strong> | Reorder 16 modules (metadata first, ontological category #3) | N/A (niet expliciet) | <strong>DEF-101</strong> |</p>
<p>| <strong>Metadata Position</strong> | Move lines 401-419 to top (definition_task_module) | "Should be line 10-15" (geen implementatie) | <strong>DEF-101</strong> (concrete) |</p>
<p>| <strong>Structure</strong> | Hierarchical: TASK ‚Üí CRITICAL ‚Üí STRUCTURAL ‚Üí QUALITY ‚Üí VALIDATION | Inverted Pyramid: MISSION ‚Üí 3 GOLDEN RULES ‚Üí TEMPLATES ‚Üí REFINEMENT ‚Üí CHECKLIST | <strong>NIEUWE</strong> (innovatiever) |</p>

<p><strong>Consensus:</strong> DEF-101 heeft concrete module reordering, Nieuwe Analyse heeft innovatievere structuur.</p>

<p>---</p>

<h2>4. NIEUWE PROBLEMEN (prompt-7 vs prompt-6)</h2>

<h3>4.1 DUBBEL GEBRUIK VALIDATIEREGELS ‚≠ê GROOTSTE NIEUW INZICHT</h3>

<p><strong>Probleem:</strong> 53 validatieregels in prompt (7 modules: ARAI, CON, ESS, INT, SAM, STR, VER) EN in post-processing (ModularValidationService).</p>

<p><strong>Impact:</strong></p>
<ul>
<li>**3.500 tokens (48%)** zijn duplicate guidance</li>
<li>**7 modules** doen dubbel werk</li>
<li>**45+ regels** worden zowel geprompt als gevalideerd</li>
</ul>

<p><strong>DEF-101 Blind Spot:</strong> Gaat ervan uit dat validatieregels in prompt MOETEN blijven, focust op reducing redundancy binnen prompt.</p>

<p><strong>Nieuwe Analyse Inzicht:</strong> Validatieregels kunnen VOLLEDIG uit prompt gehaald worden ‚Üí -48% tokens!</p>

<p>---</p>

<h3>4.2 CONDITIONAL MODULE LOADING</h3>

<p><strong>Probleem:</strong> Alle 16 modules draaien ALTIJD, zelfs modules die niet relevant zijn voor context.</p>

<p><strong>Impact:</strong></p>
<ul>
<li>**Juridische modules** draaien voor niet-juridische termen</li>
<li>**Legal module** altijd actief</li>
<li>**Performance overhead** van irrelevante modules</li>
</ul>

<p><strong>DEF-101 Blind Spot:</strong> Focus op reordering modules, niet op conditional execution.</p>

<p><strong>Nieuwe Analyse Inzicht:</strong> Implementeer context-aware module filtering ‚Üí alleen relevante modules.</p>

<p>---</p>

<h3>4.3 STATIC MODULE CACHING</h3>

<p><strong>Probleem:</strong> Static modules (grammar, expertise) worden elke keer opnieuw gegeneerd.</p>

<p><strong>Nieuwe Analyse Oplossing:</strong></p>
<pre><code>@st.cache_data(ttl=3600)
def get_grammar_module_output():
    return GrammarModule().execute()</code></pre>

<p><strong>DEF-101 Blind Spot:</strong> Geen caching strategie voor static content.</p>

<p>---</p>

<h3>4.4 TOKEN COUNT METRICS</h3>

<p><strong>Nieuwe Analyse Insight:</strong> Concrete token counts ontbreken in DEF-101.</p>

<p>| Metric | DEF-101 (prompt-6) | Nieuwe Analyse (prompt-7) |</p>
<p>|--------|-------------------|---------------------------|</p>
<p>| <strong>Total Tokens</strong> | 419 lines (geen tokens) | <strong>7.250 tokens</strong> |</p>
<p>| <strong>Validation Rules</strong> | 45+ rules (geen tokens) | <strong>3.500 tokens (48%)</strong> |</p>
<p>| <strong>Forbidden Patterns</strong> | 42 bullets (geen tokens) | <strong>750 tokens</strong> |</p>
<p>| <strong>ESS-02</strong> | 38 lines (geen tokens) | Onderdeel van 3.500 tokens |</p>

<p><strong>Impact:</strong> Nieuwe analyse heeft meetbare optimalisatie targets, DEF-101 heeft line counts.</p>

<p>---</p>

<h2>5. GE√èNTEGREERD ACTIEPLAN</h2>

<h3>FASE 1: QUICK WINS (Week 1, 4 uur) - COMBINEER BEIDE</h3>

<h4>DEF-101 Quick Wins:</h4>
<ol>
<li>‚úÖ **Resolve BLOCKING contradictions** (3 uur)</li>
</ol>
<ul>
<li>  - Add ESS-02 exception clause (DEF-101 strategy)</li>
<li>  - Exempt ontological markers from ARAI-02</li>
<li>  - Clarify relative clause usage</li>
</ul>

<h4>Nieuwe Analyse Quick Wins:</h4>
<ol>
<li>‚úÖ **Remove validation rules from prompt** (30 min) ‚≠ê HOOGSTE IMPACT</li>
</ol>
<ul>
<li>  - Delete 7 validation modules from prompt generation</li>
<li>  - Keep only summary: "‚úÖ ARAI: Zelfstandig naamwoord, geen containerbegrippen"</li>
<li>  - **Impact:** -3.500 tokens (-48%)</li>
</ul>

<ol>
<li>‚úÖ **Consolidate forbidden list** (30 min)</li>
</ol>
<ul>
<li>  - Replace 42 bullets with 3 templates (Nieuwe Analyse strategy)</li>
<li>  - **Impact:** -750 tokens (-10%)</li>
</ul>

<p><strong>Total Week 1: -4.250 tokens (-58%) + 0 conflicts</strong></p>

<p>---</p>

<h3>FASE 2: STRUCTURELE REFACTOR (Week 2, 8 uur) - COMBINEER BEIDE</h3>

<h4>DEF-101 Structural Changes:</h4>
<ol>
<li>‚úÖ **Reorder modules** (1 uur)</li>
</ol>
<ul>
<li>  - Metadata first (definition_task)</li>
<li>  - Ontological category #3 (semantic_categorisation)</li>
<li>  - Templates AFTER rules</li>
</ul>

<h4>Nieuwe Analyse Structural Changes:</h4>
<ol>
<li>‚úÖ **Implement Inverted Pyramid structure** (3 uur)</li>
</ol>
<ul>
<li>  - NIVEAU 1: MISSION (50 tokens)</li>
<li>  - NIVEAU 2: 3 GOLDEN RULES (300 tokens)</li>
<li>  - NIVEAU 3: TEMPLATES (400 tokens)</li>
<li>  - NIVEAU 4: REFINEMENT (800 tokens)</li>
<li>  - NIVEAU 5: CHECKLIST (100 tokens)</li>
</ul>

<ol>
<li>‚úÖ **Conditional module loading** (2 uur)</li>
<pre><code>   def _filter_modules(self, context):
       if not context.has_juridische_context:
           skip_modules.append("legal_module")</code></pre>
</ol>

<ol>
<li>‚úÖ **Cache static modules** (1 uur)</li>
<pre><code>   @st.cache_data(ttl=3600)
   def get_grammar_module_output():
       return GrammarModule().execute()</code></pre>
</ol>

<ol>
<li>‚úÖ **Add visual hierarchy** (1 uur) - DEF-101 3-Tier System</li>
</ol>
<ul>
<li>  - ‚ö†Ô∏è TIER 1 (ABSOLUTE)</li>
<li>  - ‚úÖ TIER 2 (STRONG)</li>
<li>  - ‚ÑπÔ∏è TIER 3 (POLISH)</li>
</ul>

<p><strong>Total Week 2: Inverted Pyramid + Conditional Loading + Caching + Tiers</strong></p>

<p>---</p>

<h3>FASE 3: VALIDATIE & TESTING (Week 3, 4 uur) - DEF-101 STRATEGIE</h3>

<h4>DEF-101 Testing:</h4>
<ol>
<li>‚úÖ **Create PromptValidator** (2 uur)</li>
</ol>
<ul>
<li>  - `test_ess02_exception_clause_present()`</li>
<li>  - `test_no_blocking_contradictions()`</li>
<li>  - `test_redundancy_below_threshold()`</li>
<li>  - `test_forbidden_patterns_categorized()`</li>
</ul>

<ol>
<li>‚úÖ **Regression testing** (1 uur)</li>
</ol>
<ul>
<li>  - Use prompt-6 as golden reference</li>
<li>  - Compare key sections (ESS-02, ARAI)</li>
</ul>

<ol>
<li>‚úÖ **A/B test v7 vs v8** (1 uur)</li>
</ol>
<ul>
<li>  - Test with 50 begrippen (Nieuwe Analyse test set)</li>
<li>  - Measure quality + expert review</li>
</ul>

<p><strong>Total Week 3: Comprehensive test coverage + A/B validation</strong></p>

<p>---</p>

<h3>FASE 4: DOCUMENTATION (Optional, 2 uur) - DEF-101 STRATEGIE</h3>

<ol>
<li>‚úÖ **Document module dependencies** (1 uur)</li>
</ol>
<ul>
<li>  - `docs/architectuur/prompt_module_dependency_map.md`</li>
</ul>

<ol>
<li>‚úÖ **Create ADR** (30 min)</li>
</ol>
<ul>
<li>  - ADR-XXX: Removal of Validation Rules from Prompt</li>
</ul>

<ol>
<li>‚úÖ **Update EPIC-016** (30 min)</li>
</ol>
<ul>
<li>  - Link prompt optimization to Beheer & Configuratie Console</li>
</ul>

<p>---</p>

<h2>6. EFFORT VERGELIJKING</h2>

<p>| Fase | DEF-101 (prompt-6) | Nieuwe Analyse (prompt-7) | GE√èNTEGREERD |</p>
<p>|------|--------------------|---------------------------|--------------|</p>
<p>| <strong>Week 1: Quick Wins</strong> | 4 uur | 4 uur | <strong>4 uur</strong> |</p>
<p>| <strong>Week 2: Structural</strong> | 8 uur | 8 uur | <strong>8 uur</strong> |</p>
<p>| <strong>Week 3: Testing</strong> | 4 uur | 4 uur | <strong>4 uur</strong> |</p>
<p>| <strong>Total</strong> | <strong>16 uur</strong> | <strong>16 uur</strong> | <strong>16 uur</strong> |</p>

<p><strong>Consensus:</strong> Beide analyses hebben identieke effort estimate (16 uur / 2 sprint weken).</p>

<p>---</p>

<h2>7. SUCCESS METRICS VERGELIJKING</h2>

<p>| Metric | DEF-101 Target | Nieuwe Analyse Target | GE√èNTEGREERD |</p>
<p>|--------|----------------|----------------------|--------------|</p>
<p>| <strong>Usability</strong> | UNUSABLE ‚Üí USABLE | 4/10 ‚Üí 8/10 | ‚úÖ USABLE (0 blockers) |</p>
<p>| <strong>Cognitive Load</strong> | 9/10 ‚Üí 4/10 | LLM Compliance 60% ‚Üí 90% | <strong>4/10 + 90% compliance</strong> |</p>
<p>| <strong>Redundancy</strong> | 65% ‚Üí <30% | 40% ‚Üí <5% | <strong><5%</strong> (agressiever) |</p>
<p>| <strong>Flow Quality</strong> | 4/10 ‚Üí 8/10 | N/A | <strong>8/10</strong> |</p>
<p>| <strong>File Size</strong> | 419 ‚Üí 354 lines (-15.5%) | N/A | <strong>354 lines</strong> |</p>
<p>| <strong>Token Count</strong> | N/A | 7.250 ‚Üí 2.650 (-63%) | <strong>2.650 tokens</strong> |</p>
<p>| <strong>Conflicts</strong> | 5 ‚Üí 0 | 10 ‚Üí 0 | <strong>0 conflicts</strong> |</p>

<p><strong>Ge√Øntegreerd Target:</strong></p>
<ul>
<li>‚úÖ **0 BLOCKING contradictions** (DEF-101 + Nieuwe Analyse)</li>
<li>‚úÖ **2.650 tokens (-63%)** (Nieuwe Analyse target)</li>
<li>‚úÖ **Cognitive Load 4/10** (DEF-101 target)</li>
<li>‚úÖ **Flow 8/10** (DEF-101 target)</li>
<li>‚úÖ **<5% redundancy** (Nieuwe Analyse target)</li>
</ul>

<p>---</p>

<h2>8. PRIORITEITEN & TRADE-OFFS</h2>

<h3>8.1 CONFLICT RESOLUTIE vs TOKEN REDUCTION</h3>

<p><strong>Trade-off:</strong></p>
<ul>
<li>**DEF-101 aanpak:** Voeg exception clauses toe ‚Üí meer tokens, maar veiliger</li>
<li>**Nieuwe Analyse:** Verwijder validatieregels volledig ‚Üí minder tokens, maar risico</li>
</ul>

<p><strong>Aanbeveling:</strong> <strong>COMBINEER</strong></p>
<ol>
<li>**Week 1:** Voeg exception clauses toe (DEF-101) ‚Üí 0 conflicts</li>
<li>**Week 2:** Verwijder validatieregels (Nieuwe Analyse) ‚Üí -3.500 tokens</li>
<li>**Week 3:** Test beide aanpakken ‚Üí A/B validation</li>
</ol>

<p><strong>Rationale:</strong> Eerst conflicts fixen (veiligheid), dan token reduction (optimalisatie).</p>

<p>---</p>

<h3>8.2 INCREMENTAL vs AGGRESSIVE REDUCTION</h3>

<p><strong>Trade-off:</strong></p>
<ul>
<li>**DEF-101:** Incrementele reductie (65% ‚Üí <30%) ‚Üí veiliger</li>
<li>**Nieuwe Analyse:** Aggressive reductie (40% ‚Üí <5%) ‚Üí risicovol</li>
</ul>

<p><strong>Aanbeveling:</strong> <strong>GEFASEERD</strong></p>
<ul>
<li>**Fase 1 (Week 1):** Quick wins (DEF-101 + Nieuwe Analyse) ‚Üí -58% tokens</li>
<li>**Fase 2 (Week 2):** Structural refactor ‚Üí Inverted Pyramid + Conditional Loading</li>
<li>**Fase 3 (Week 3):** A/B test ‚Üí Meet impact op definitie kwaliteit</li>
</ul>

<p><strong>Rationale:</strong> Start met quick wins (hoogste ROI), test impact, dan verdere optimalisatie.</p>

<p>---</p>

<h3>8.3 MODULE REORDERING vs INVERTED PYRAMID</h3>

<p><strong>Trade-off:</strong></p>
<ul>
<li>**DEF-101:** Reorder bestaande modules ‚Üí backward compatible</li>
<li>**Nieuwe Analyse:** Nieuwe Inverted Pyramid structuur ‚Üí breaking change</li>
</ul>

<p><strong>Aanbeveling:</strong> <strong>HYBRIDE</strong></p>
<ol>
<li>**Week 2 Day 1:** Implementeer Inverted Pyramid structuur (Nieuwe Analyse)</li>
<li>**Week 2 Day 2:** Reorder modules binnen Pyramid levels (DEF-101)</li>
<li>**Week 3:** A/B test beide structuren</li>
</ol>

<p><strong>Rationale:</strong> Nieuwe structuur is innovatiever, maar DEF-101 module ordering binnen levels toevoegen.</p>

<p>---</p>

<h3>8.4 VALIDATION RULES: IN PROMPT vs POST-ONLY</h3>

<p><strong>Trade-off:</strong></p>
<ul>
<li>**DEF-101 assumptie:** Validatieregels blijven in prompt, reduce redundancy</li>
<li>**Nieuwe Analyse:** Validatieregels VOLLEDIG uit prompt ‚Üí -48% tokens</li>
</ul>

<p><strong>Aanbeveling:</strong> <strong>NIEUWE ANALYSE STRATEGIE</strong></p>

<p><strong>Rationale:</strong></p>
<ol>
<li>**Validatieregels worden toch gevalideerd** in post-processing (ModularValidationService)</li>
<li>**LLM compliance ~60%** betekent dat LLM regels vaak negeert anyway</li>
<li>**Post-validation is authoritative** - prompt guidance is redundant</li>
<li>**3.500 tokens (-48%)** is grootste optimalisatie kans</li>
</ol>

<p><strong>Implementatie:</strong></p>
<pre><code># VOOR: Volledige regel in prompt (7 modules)
AraiRulesModule ‚Üí ARAI-01 t/m ARAI-06 (detailed)

# NA: Alleen kernprincipes
"‚úÖ Algemene Regels: Begin met zelfstandig naamwoord, essentie niet doel"</code></pre>

<p><strong>Test strategie:</strong></p>
<ul>
<li>Week 1: Implementeer summary-only validation rules</li>
<li>Week 3: A/B test prompt-6 (full rules) vs prompt-8 (summary only)</li>
<li>Metric: Validatie success rate (moet ‚â•90% blijven)</li>
</ul>

<p>---</p>

<h2>9. KRITIEKE BESLISSINGEN</h2>

<h3>BESLISSING 1: Validatieregels Strategie ‚≠ê MEEST KRITIEK</h3>

<p><strong>Vraag:</strong> Houden we validatieregels in prompt of alleen in post-processing?</p>

<p>| Optie | Voordelen | Nadelen | Impact |</p>
<p>|-------|-----------|---------|--------|</p>
<p>| <strong>A. Keep in prompt (DEF-101 assumptie)</strong> | Veiliger, LLM heeft guidance | 3.500 tokens redundant, LLM compliance ~60% | Reduce redundancy 65% ‚Üí 30% |</p>
<p>| <strong>B. Remove from prompt (Nieuwe Analyse)</strong> | -48% tokens, focus op core principles | Risico: LLM maakt meer fouten, post-validation moet alles opvangen | -3.500 tokens (-48%) |</p>
<p>| <strong>C. Summary only (HYBRIDE)</strong> | Balance: high-level guidance + token reduction | Moet juiste balance vinden | -2.500 tokens (-34%) |</p>

<p><strong>AANBEVELING:</strong> <strong>OPTIE B - Remove from prompt</strong> ‚≠ê</p>

<p><strong>Rationale:</strong></p>
<ol>
<li>Post-validation is authoritative anyway (ModularValidationService)</li>
<li>LLM compliance ~60% betekent guidance vaak genegeerd wordt</li>
<li>Focus prompt op core principles (3 GOLDEN RULES) + templates</li>
<li>Test met A/B: meet impact op validatie success rate</li>
</ol>

<p><strong>Implementatie Week 1:</strong></p>
<ul>
<li>Delete 7 validation modules from prompt generation</li>
<li>Keep only: "‚úÖ ALGEMENE REGELS: Zelfstandig naamwoord, essentie niet doel, ontologische categorie expliciet"</li>
<li>Test: 50 begrippen, compare success rate prompt-6 vs prompt-8</li>
</ul>

<p><strong>Success Criteria:</strong></p>
<ul>
<li>Validatie success rate ‚â•90% (target: geen impact vs prompt-6)</li>
<li>Generatie tijd < 3 seconden (target: 25% sneller)</li>
<li>Expert score > 8/10 (target: kwaliteit behouden)</li>
</ul>

<p>---</p>

<h3>BESLISSING 2: Prompt Structuur</h3>

<p><strong>Vraag:</strong> Linear reordering (DEF-101) of Inverted Pyramid (Nieuwe Analyse)?</p>

<p><strong>AANBEVELING:</strong> <strong>Inverted Pyramid</strong> met DEF-101 module ordering binnen levels</p>

<p><strong>Implementatie:</strong></p>
<pre><code>NIVEAU 1: TASK &amp; CONTEXT (50 tokens)
‚îú‚îÄ‚îÄ definition_task module (DEF-101 #1)
‚îÇ
NIVEAU 2: CRITICAL REQUIREMENTS (300 tokens)
‚îú‚îÄ‚îÄ expertise module (DEF-101 #2)
‚îú‚îÄ‚îÄ semantic_categorisation module (DEF-101 #3) ‚Üê MOST CRITICAL
‚îú‚îÄ‚îÄ output_specification module (DEF-101 #4)
‚îÇ
NIVEAU 3: TEMPLATES (400 tokens)
‚îú‚îÄ‚îÄ template module (DEF-101 #8)
‚îÇ
NIVEAU 4: REFINEMENT (800 tokens)
‚îú‚îÄ‚îÄ grammar module (DEF-101 #5)
‚îú‚îÄ‚îÄ context_awareness module (DEF-101 #6)
‚îú‚îÄ‚îÄ structure_rules module (DEF-101 #7)
‚îÇ
NIVEAU 5: VALIDATION CHECKLIST (100 tokens)
‚îú‚îÄ‚îÄ Final checklist (DEF-101 checklist items)</code></pre>

<p><strong>Rationale:</strong> Nieuwe structuur is innovatiever EN incorporeert DEF-101 best practices.</p>

<p>---</p>

<h3>BESLISSING 3: Quick Wins Prioriteit</h3>

<p><strong>Vraag:</strong> Start met conflicts (DEF-101) of token reduction (Nieuwe Analyse)?</p>

<p><strong>AANBEVELING:</strong> <strong>HYBRIDE - Beide parallel</strong></p>

<p><strong>Week 1 Day 1 (3 uur):</strong></p>
<ol>
<li>Resolve BLOCKING contradictions (DEF-101) ‚Üí 0 conflicts</li>
<li>Remove validation rules from prompt (Nieuwe Analyse) ‚Üí -3.500 tokens</li>
</ol>

<p><strong>Week 1 Day 2 (1 uur):</strong></p>
<ol>
<li>Consolidate forbidden list (Nieuwe Analyse) ‚Üí -750 tokens</li>
</ol>

<p><strong>Rationale:</strong> Conflicten EN token reduction zijn beide quick wins, geen dependency.</p>

<p>---</p>

<h2>10. IMPLEMENTATIE ROADMAP - GE√èNTEGREERD</h2>

<h3>WEEK 1: QUICK WINS (4 uur)</h3>

<h4>Day 1 (3 uur)</h4>
<p><strong>09:00-10:30 | CONFLICTS (DEF-101 strategy)</strong></p>
<ul>
<li>‚úÖ Add ESS-02 exception clause in `error_prevention_module.py` (30 min)</li>
<li>‚úÖ Exempt ontological markers from ARAI-02 (30 min)</li>
<li>‚úÖ Clarify relative clause usage (30 min)</li>
</ul>

<p><strong>10:30-12:00 | TOKEN REDUCTION (Nieuwe Analyse strategy)</strong> ‚≠ê</p>
<ul>
<li>‚úÖ Remove validation rules from prompt (90 min)</li>
<li> - Delete 7 validation rule modules from prompt generation</li>
<li> - Keep summary: "‚úÖ ALGEMENE REGELS: ..."</li>
<li> - **Impact: -3.500 tokens (-48%)**</li>
</ul>

<h4>Day 2 (1 uur)</h4>
<p><strong>09:00-10:00 | FORBIDDEN PATTERNS (Nieuwe Analyse strategy)</strong></p>
<ul>
<li>‚úÖ Replace 42 bullets with 3 templates (1 uur)</li>
<li> - **Impact: -750 tokens (-10%)**</li>
</ul>

<p><strong>Week 1 Results:</strong></p>
<ul>
<li>‚úÖ **0 BLOCKING contradictions** (DEF-101 success)</li>
<li>‚úÖ **-4.250 tokens (-58%)** (Nieuwe Analyse success)</li>
<li>‚úÖ **Test:** Run 20 begrippen, verify validatie success rate ‚â•90%</li>
</ul>

<p>---</p>

<h3>WEEK 2: STRUCTURAL REFACTOR (8 uur)</h3>

<h4>Day 1 (4 uur)</h4>
<p><strong>09:00-12:00 | INVERTED PYRAMID (Nieuwe Analyse strategy)</strong></p>
<ul>
<li>‚úÖ Implement 5-level structure (3 uur)</li>
<li> - NIVEAU 1: TASK & CONTEXT (50 tokens)</li>
<li> - NIVEAU 2: CRITICAL REQUIREMENTS (300 tokens)</li>
<li> - NIVEAU 3: TEMPLATES (400 tokens)</li>
<li> - NIVEAU 4: REFINEMENT (800 tokens)</li>
<li> - NIVEAU 5: CHECKLIST (100 tokens)</li>
</ul>

<p><strong>13:00-14:00 | MODULE REORDERING (DEF-101 strategy)</strong></p>
<ul>
<li>‚úÖ Reorder modules within Pyramid levels (1 uur)</li>
<li> - Use DEF-101 optimal_modules order</li>
</ul>

<h4>Day 2 (4 uur)</h4>
<p><strong>09:00-11:00 | CONDITIONAL LOADING (Nieuwe Analyse strategy)</strong></p>
<ul>
<li>‚úÖ Implement context-aware module filtering (2 uur)</li>
<pre><code>  def _filter_modules(self, context):
      if not context.has_juridische_context:
          skip_modules.append("legal_module")</code></pre>
</ul>

<p><strong>11:00-12:00 | STATIC CACHING (Nieuwe Analyse strategy)</strong></p>
<ul>
<li>‚úÖ Cache static modules (1 uur)</li>
<pre><code>  @st.cache_data(ttl=3600)
  def get_grammar_module_output():
      return GrammarModule().execute()</code></pre>
</ul>

<p><strong>13:00-14:00 | VISUAL HIERARCHY (DEF-101 strategy)</strong></p>
<ul>
<li>‚úÖ Add 3-Tier badges (1 uur)</li>
<li> - ‚ö†Ô∏è TIER 1 (ABSOLUTE)</li>
<li> - ‚úÖ TIER 2 (STRONG)</li>
<li> - ‚ÑπÔ∏è TIER 3 (POLISH)</li>
</ul>

<p><strong>Week 2 Results:</strong></p>
<ul>
<li>‚úÖ **Inverted Pyramid structure** (Nieuwe Analyse)</li>
<li>‚úÖ **Conditional module loading** (Nieuwe Analyse)</li>
<li>‚úÖ **Static module caching** (Nieuwe Analyse)</li>
<li>‚úÖ **Visual hierarchy** (DEF-101)</li>
</ul>

<p>---</p>

<h3>WEEK 3: VALIDATIE & TESTING (4 uur)</h3>

<h4>Day 1 (2 uur)</h4>
<p><strong>09:00-11:00 | PROMPTVALIDATOR (DEF-101 strategy)</strong></p>
<ul>
<li>‚úÖ Create `src/services/prompts/prompt_validator.py` (2 uur)</li>
<li> - `test_ess02_exception_clause_present()`</li>
<li> - `test_no_blocking_contradictions()`</li>
<li> - `test_redundancy_below_threshold()`</li>
<li> - `test_forbidden_patterns_categorized()`</li>
</ul>

<h4>Day 2 (2 uur)</h4>
<p><strong>09:00-10:00 | REGRESSION TESTING (DEF-101 strategy)</strong></p>
<ul>
<li>‚úÖ Use prompt-6 as golden reference (1 uur)</li>
<li> - Compare key sections (ESS-02, ARAI)</li>
<li> - Check no contradictions introduced</li>
</ul>

<p><strong>10:00-11:00 | A/B TESTING (Nieuwe Analyse strategy)</strong></p>
<ul>
<li>‚úÖ Test prompt-6 vs prompt-8 with 50 begrippen (1 uur)</li>
<li> - Measure: validatie success rate, generatie tijd, expert score</li>
<li> - Target: success rate ‚â•90%, generatie tijd <3s, expert score >8/10</li>
</ul>

<p><strong>Week 3 Results:</strong></p>
<ul>
<li>‚úÖ **Comprehensive test coverage** (DEF-101)</li>
<li>‚úÖ **A/B validation** (Nieuwe Analyse)</li>
<li>‚úÖ **Metrics:** 0 conflicts, 2.650 tokens (-63%), success rate ‚â•90%</li>
</ul>

<p>---</p>

<h2>11. FILES TO MODIFY - GE√èNTEGREERD</h2>

<h3>Week 1 Files (Quick Wins):</h3>

<p><strong>Conflict Resolution (DEF-101):</strong></p>
<ul>
<li>`src/services/prompts/modules/error_prevention_module.py` - Add ESS-02 exception</li>
<li>`src/services/prompts/modules/arai_rules_module.py` - Exempt ontological markers</li>
<li>`src/services/prompts/modules/structure_rules_module.py` - Clarify relative clauses</li>
</ul>

<p><strong>Token Reduction (Nieuwe Analyse):</strong></p>
<ul>
<li>`src/services/prompts/modules/arai_rules_module.py` - DELETE (replace with summary)</li>
<li>`src/services/prompts/modules/con_rules_module.py` - DELETE (replace with summary)</li>
<li>`src/services/prompts/modules/ess_rules_module.py` - DELETE (replace with summary)</li>
<li>`src/services/prompts/modules/int_rules_module.py` - DELETE (replace with summary)</li>
<li>`src/services/prompts/modules/sam_rules_module.py` - DELETE (replace with summary)</li>
<li>`src/services/prompts/modules/str_rules_module.py` - DELETE (replace with summary)</li>
<li>`src/services/prompts/modules/ver_rules_module.py` - DELETE (replace with summary)</li>
<li>`src/services/prompts/modules/error_prevention_module.py` - Consolidate forbidden patterns</li>
</ul>

<h3>Week 2 Files (Structural):</h3>

<p><strong>Inverted Pyramid (Nieuwe Analyse):</strong></p>
<ul>
<li>`src/services/prompts/prompt_orchestrator.py` - Implement 5-level structure</li>
<li>`src/services/prompts/modules/definition_task_module.py` - NIVEAU 1</li>
<li>`src/services/prompts/modules/expertise_module.py` - NIVEAU 2</li>
<li>`src/services/prompts/modules/semantic_categorisation_module.py` - NIVEAU 2</li>
<li>`src/services/prompts/modules/template_module.py` - NIVEAU 3</li>
</ul>

<p><strong>Conditional Loading (Nieuwe Analyse):</strong></p>
<ul>
<li>`src/services/prompts/prompt_orchestrator.py` - Add `_filter_modules()` method</li>
</ul>

<p><strong>Caching (Nieuwe Analyse):</strong></p>
<ul>
<li>`src/services/prompts/modules/grammar_module.py` - Add `@st.cache_data`</li>
<li>`src/services/prompts/modules/expertise_module.py` - Add `@st.cache_data`</li>
</ul>

<p><strong>Visual Hierarchy (DEF-101):</strong></p>
<ul>
<li>`src/services/prompts/modules/structure_rules_module.py` - Add ‚ö†Ô∏è/‚úÖ/‚ÑπÔ∏è badges</li>
<li>`src/services/prompts/modules/integrity_rules_module.py` - Add badges</li>
</ul>

<h3>Week 3 Files (Testing):</h3>

<p><strong>Testing (DEF-101):</strong></p>
<ul>
<li>`src/services/prompts/prompt_validator.py` - **NEW FILE**</li>
<li>`tests/services/prompts/test_prompt_contradictions.py` - **NEW FILE**</li>
<li>`tests/services/prompts/test_prompt_v6_vs_v8_ab.py` - **NEW FILE** (Nieuwe Analyse)</li>
</ul>

<p>---</p>

<h2>12. SUCCESS CRITERIA - GE√èNTEGREERD</h2>

<h3>Week 1 Success Criteria:</h3>
<ul>
<li>‚úÖ **0 BLOCKING contradictions** (DEF-101 automated validator)</li>
<li>‚úÖ **-4.250 tokens (-58%)** (Nieuwe Analyse token count)</li>
<li>‚úÖ **Validatie success rate ‚â•90%** (test with 20 begrippen)</li>
<li>‚úÖ **Geen regressie** in definitie kwaliteit (expert review)</li>
</ul>

<h3>Week 2 Success Criteria:</h3>
<ul>
<li>‚úÖ **Inverted Pyramid implemented** (5 levels, 2.650 tokens total)</li>
<li>‚úÖ **Conditional loading works** (only relevant modules active)</li>
<li>‚úÖ **Static caching works** (grammar module cached, TTL 3600s)</li>
<li>‚úÖ **Visual hierarchy clear** (TIER badges on all rules)</li>
</ul>

<h3>Week 3 Success Criteria:</h3>
<ul>
<li>‚úÖ **All tests pass** (PromptValidator, contradiction tests, A/B tests)</li>
<li>‚úÖ **Regression tests pass** (vs prompt-6 golden reference)</li>
<li>‚úÖ **A/B validation:** prompt-8 ‚â• prompt-6 quality</li>
<li>‚úÖ **Metrics achieved:**</li>
<li> - Conflicts: 0</li>
<li> - Tokens: 2.650 (-63%)</li>
<li> - Cognitive Load: 4/10</li>
<li> - Flow: 8/10</li>
<li> - Redundancy: <5%</li>
<li> - Validatie success rate: ‚â•90%</li>
<li> - Generatie tijd: <3s</li>
<li> - Expert score: >8/10</li>
</ul>

<p>---</p>

<h2>13. RISK MITIGATION - GE√èNTEGREERD</h2>

<h3>RISK 1: Validatieregels Removal Breaks Quality</h3>

<p><strong>Probability:</strong> MEDIUM</p>
<p><strong>Impact:</strong> HIGH</p>
<p><strong>Mitigation (DEF-101 + Nieuwe Analyse):</strong></p>
<ol>
<li>A/B test prompt-6 vs prompt-8 with 50 begrippen (Week 3)</li>
<li>Rollback plan: Feature flag `USE_LEGACY_PROMPT=true` (DEF-101 strategy)</li>
<li>Gradual rollout: 10% traffic ‚Üí 50% ‚Üí 100% (DEF-101 strategy)</li>
<li>Monitoring: Track validatie success rate dashboard (Nieuwe Analyse metric)</li>
</ol>

<h3>RISK 2: Module Reordering Breaks Dependencies</h3>

<p><strong>Probability:</strong> LOW</p>
<p><strong>Impact:</strong> MEDIUM</p>
<p><strong>Mitigation (DEF-101):</strong></p>
<ol>
<li>Document module dependencies (Week 3, `prompt_module_dependency_map.md`)</li>
<li>Dependency graph validation in `prompt_orchestrator.py`</li>
<li>Integration tests for module execution order</li>
</ol>

<h3>RISK 3: Conditional Loading Skips Critical Modules</h3>

<p><strong>Probability:</strong> LOW</p>
<p><strong>Impact:</strong> HIGH</p>
<p><strong>Mitigation (Nieuwe Analyse):</strong></p>
<ol>
<li>Whitelist CRITICAL modules (never skip): expertise, semantic_categorisation, output_specification</li>
<li>Unit tests for `_filter_modules()` logic</li>
<li>Logging: track which modules skipped per request</li>
</ol>

<h3>RISK 4: Inverted Pyramid Confuses LLM</h3>

<p><strong>Probability:</strong> MEDIUM</p>
<p><strong>Impact:</strong> MEDIUM</p>
<p><strong>Mitigation (Nieuwe Analyse + DEF-101):</strong></p>
<ol>
<li>A/B test linear (DEF-101) vs pyramid (Nieuwe Analyse) structure</li>
<li>LLM compliance measurement (% rules followed)</li>
<li>Fallback: Use DEF-101 linear restructure if pyramid fails</li>
</ol>

<p>---</p>

<h2>14. ROLLBACK PLAN - DEF-101 STRATEGIE</h2>

<h3>Immediate Rollback (< 5 min):</h3>
<pre><code># Rollback laatste commit
git revert &lt;commit-hash&gt;
git push</code></pre>

<h3>Feature Flag Rollback:</h3>
<pre><code># In prompt_orchestrator.py
USE_LEGACY_PROMPT = os.getenv("USE_LEGACY_PROMPT", "false") == "true"

if USE_LEGACY_PROMPT:
    return read_file("prompts/legacy/_Definitie_Generatie_prompt-6.txt")</code></pre>

<h3>Gradual Rollback (A/B Testing):</h3>
<pre><code># 10% traffic to prompt-8, 90% to prompt-6
import random
if random.random() &lt; 0.10:
    use_prompt_v8()
else:
    use_prompt_v6()</code></pre>

<p>---</p>

<h2>15. DOCUMENTATION UPDATES</h2>

<h3>New Documentation (Week 3):</h3>
<ol>
<li>**`docs/architectuur/prompt_module_dependency_map.md`** (DEF-101)</li>
<li>**`docs/analyses/PROMPT_ANALYSIS_CONSENSUS_REPORT.md`** (THIS FILE)</li>
<li>**`docs/adr/ADR-XXX-remove-validation-rules-from-prompt.md`** (Nieuwe Analyse)</li>
</ol>

<h3>Update Documentation:</h3>
<ol>
<li>**`README.md`** - Prompt optimization section</li>
<li>**`CLAUDE.md`** - Prompt modules section</li>
<li>**`docs/backlog/EPIC-016/EPIC-016.md`** - Link to prompt optimization</li>
</ol>

<p>---</p>

<h2>16. NEXT STEPS (IMMEDIATE)</h2>

<h3>üî¥ VANDAAG (30 min):</h3>
<ol>
<li>‚úÖ Review this consensus report</li>
<li>‚¨ú **BESLISSING:** Approve Optie B (Remove validation rules from prompt)</li>
<li>‚¨ú **BESLISSING:** Approve Inverted Pyramid structure (Nieuwe Analyse)</li>
<li>‚¨ú Create GitHub issue: "DEF-101: Prompt Optimization - Integrated Plan"</li>
</ol>

<h3>üü° WEEK 1 (4 uur):</h3>
<ol>
<li>‚¨ú Implement Quick Wins (Day 1: conflicts + token reduction, Day 2: forbidden patterns)</li>
<li>‚¨ú Test with 20 begrippen</li>
<li>‚¨ú Measure: tokens, conflicts, validatie success rate</li>
</ol>

<h3>üü¢ WEEK 2-3 (12 uur):</h3>
<ol>
<li>‚¨ú Implement Inverted Pyramid + Conditional Loading + Caching + Visual Hierarchy</li>
<li>‚¨ú Create PromptValidator + test suite</li>
<li>‚¨ú A/B test prompt-6 vs prompt-8 with 50 begrippen</li>
<li>‚¨ú Deploy to production (gradual rollout)</li>
</ol>

<p>---</p>

<h2>17. CONCLUSIE</h2>

<h3>Consensus:</h3>
<ul>
<li>‚úÖ **Beide analyses identificeren DEZELFDE kernproblemen:**</li>
<li> - 5 BLOCKING contradictions (DEF-101) / 10 kritieke conflicten (Nieuwe Analyse)</li>
<li> - ~65% redundantie (DEF-101) / 40% redundantie (Nieuwe Analyse)</li>
<li> - Severe cognitive overload (9/10 ‚Üí 4/10)</li>
<li> - Poor flow (4/10 ‚Üí 8/10)</li>
</ul>

<h3>Unieke Inzichten:</h3>
<ul>
<li>‚úÖ **DEF-101 (prompt-6):**</li>
<li> - Completere conflict resolutie strategie (exception clauses, 3-Tier system)</li>
<li> - Concrete module reordering plan</li>
<li> - Comprehensive test suite + rollback plan</li>
</ul>

<ul>
<li>‚úÖ **Nieuwe Analyse (prompt-7):**</li>
<li> - **GROOTSTE INZICHT:** Dubbel gebruik validatieregels (-3.500 tokens = -48%)</li>
<li> - Conditional module loading + static caching</li>
<li> - Inverted Pyramid structure (innovatiever dan linear restructure)</li>
<li> - Aggressive token reduction target (7.250 ‚Üí 2.650 = -63%)</li>
</ul>

<h3>Beste Aanpak:</h3>
<p><strong>GE√èNTEGREERD PLAN - Combineer beste van beide:</strong></p>
<ol>
<li>**Week 1 Quick Wins:** DEF-101 conflict resolution + Nieuwe Analyse token reduction</li>
<li>**Week 2 Structural:** Nieuwe Analyse Inverted Pyramid + DEF-101 module ordering binnen levels</li>
<li>**Week 3 Testing:** DEF-101 test suite + Nieuwe Analyse A/B validation</li>
</ol>

<h3>Expected Results:</h3>
<ul>
<li>‚úÖ **0 BLOCKING contradictions** (DEF-101 success)</li>
<li>‚úÖ **2.650 tokens (-63%)** (Nieuwe Analyse success)</li>
<li>‚úÖ **Cognitive Load 4/10** (DEF-101 success)</li>
<li>‚úÖ **Flow 8/10** (DEF-101 success)</li>
<li>‚úÖ **<5% redundancy** (Nieuwe Analyse success)</li>
<li>‚úÖ **Validatie success rate ‚â•90%** (beide analyses success)</li>
</ul>

<h3>Total Effort:</h3>
<p><strong>16 uur (2 sprint weken)</strong> - Identiek aan beide analyses</p>

<p>---</p>

<p><strong>STATUS:</strong> ‚úÖ CONSENSUS BEREIKT</p>
<p><strong>AANBEVELING:</strong> Approve ge√Øntegreerd plan en start Week 1 Quick Wins</p>
<p><strong>NEXT ACTION:</strong> Review met stakeholder + create GitHub issue DEF-101</p>

<p>---</p>

<p><strong>Document Metadata:</strong></p>
<ul>
<li>**Created:** 2025-11-07</li>
<li>**Authors:** Consensus van DEF-101 (prompt-6) + Nieuwe Analyse (prompt-7)</li>
<li>**Review Status:** Pending approval</li>
<li>**Related Documents:**</li>
<li> - `docs/analyses/PROMPT_COMPREHENSIVE_ANALYSIS_AND_IMPROVEMENT_PLAN.md` (DEF-101)</li>
<li> - `docs/analyses/PROMPT_OPTIMIZATION_ANALYSIS.md` (Nieuwe Analyse)</li>
<li>**Related Issues:** DEF-101 (Linear), EPIC-016 (Beheer Console)</li>
</ul>

  </div>
</body>
</html>