<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Configuration Guide</title>
  <link rel="stylesheet" href="../portal.css" />
  <style>
    .doc { max-width: 900px; margin: 16px auto 48px auto; padding: 0 16px; }
    .doc h1,.doc h2,.doc h3,.doc h4{ color:#223 }
    .doc p{ line-height:1.6; color:#222 }
    .doc a{ color:#1d4ed8; text-decoration: underline; }
    .doc pre{ background:#0b1020; color:#e6edf3; padding:12px; overflow:auto; border-radius:8px }
    .doc code{ background:#f0f2f5; padding:2px 6px; border-radius:4px }
    .back{ display:inline-block; margin:12px 0; padding:6px 10px; border:1px solid #ccd; border-radius:6px; text-decoration:none; color:#223; background:#f8f9fb }
  </style>
</head>
<body>
  <div class="doc">
    <a class="back" href="../../index.html">← Terug naar Portal</a>
    <h1>AI Configuration Guide</h1>

<h2>Overzicht</h2>

<p>DefinitieAgent gebruikt een gecentraliseerd AI configuratie systeem via <code>ConfigManager</code> dat component-specifieke AI instellingen mogelijk maakt. Dit document beschrijft hoe het systeem werkt en hoe je het kunt configureren.</p>

<h2>Core Configuratie Systeem</h2>

<h3>ConfigManager (`src/config/config_manager.py`)</h3>

<p>Het centrale configuratie systeem beheert alle AI-gerelateerde instellingen:</p>

<pre><code>from src.config.config_manager import get_config_manager, get_component_config

# Globale config manager
config = get_config_manager()

# Component-specifieke config
voorbeelden_config = get_component_config('voorbeelden', 'synoniemen')</code></pre>

<h3>Standaard AI Configuratie</h3>

<pre><code>@dataclass
class APIConfig:
    default_model: str = "gpt-4.1"           # Stabiel voor juridische definities
    default_temperature: float = 0.0          # Deterministisch voor consistentie
    default_max_tokens: int = 300            # Standaard token limiet

    model_settings: dict = {
        "gpt-4": {
            "max_tokens": 300,
            "temperature": 0.01,              # Zeer lage temperatuur
            "cost_per_token": 0.00003
        },
        "gpt-4.1": {
            "max_tokens": 300,
            "temperature": 0.0,               # Volledig deterministisch
            "cost_per_token": 0.00003
        }
    }</code></pre>

<h2>Component-Specifieke Configuratie</h2>

<h3>Configuratie Hiërarchie</h3>

<p>Het systeem ondersteunt geneste component configuratie:</p>

<pre><code># config/config_default.yaml
ai_components:
  voorbeelden:
    synoniemen:
      model: "gpt-4.1"
      temperature: 0.2      # Iets creatiever voor synoniemen
      max_tokens: 150
    uitleg:
      model: "gpt-4.1"
      temperature: 0.0      # Exact voor uitleg
      max_tokens: 200

  expert_review:
    model: "gpt-4.1"
    temperature: 0.0        # Strikt voor reviews
    max_tokens: 500

  definition_generator:
    model: "gpt-4.1"
    temperature: 0.0        # Deterministisch voor definities
    max_tokens: 300</code></pre>

<h3>Component Config Ophalen</h3>

<pre><code># Hoofd component config
config = get_component_config('voorbeelden')

# Sub-component config
config = get_component_config('voorbeelden', 'synoniemen')

# Retourneert dict met:
# {
#   "model": "gpt-4.1",
#   "temperature": 0.2,
#   "max_tokens": 150
# }</code></pre>

<h2>Environment Variabelen</h2>

<p>De configuratie kan worden overschreven met environment variabelen:</p>

<pre><code># API configuratie
export OPENAI_API_KEY="sk-..."
export OPENAI_DEFAULT_MODEL="gpt-4.1"
export OPENAI_DEFAULT_TEMPERATURE="0.0"
export OPENAI_DEFAULT_MAX_TOKENS="300"

# Environment setting
export ENVIRONMENT="production"  # development, testing, staging, production

# Logging
export LOG_LEVEL="INFO"

# Rate limiting
export RATE_LIMIT_RPM="60"
export RATE_LIMIT_RPH="3000"</code></pre>

<h2>Gebruik in Services</h2>

<h3>AIServiceV2 Integratie</h3>

<pre><code>from src.config.config_manager import get_component_config

class AIServiceV2:
    async def generate_response(
        self,
        prompt: str,
        component: str = None,
        sub_component: str = None,
        **kwargs
    ):
        # Component-specifieke config ophalen
        if component:
            config = get_component_config(component, sub_component)
            model = kwargs.get("model", config["model"])
            temperature = kwargs.get("temperature", config["temperature"])
            max_tokens = kwargs.get("max_tokens", config["max_tokens"])
        else:
            # Gebruik defaults
            model = kwargs.get("model", self.config.api.default_model)
            temperature = kwargs.get("temperature", self.config.api.default_temperature)
            max_tokens = kwargs.get("max_tokens", self.config.api.default_max_tokens)</code></pre>

<h3>Voorbeelden Service</h3>

<pre><code>class UnifiedVoorbeelden:
    def __init__(self, ai_service):
        self.ai_service = ai_service

    async def genereer_synoniemen(self, definitie: str):
        # Component-specifieke config wordt automatisch gebruikt
        response = await self.ai_service.generate_response(
            prompt=prompt,
            component="voorbeelden",
            sub_component="synoniemen"
        )</code></pre>

<h2>Configuration Files</h2>

<h3>Structuur</h3>

<pre><code>config/
├── config_default.yaml        # Standaard configuratie
├── config_development.yaml    # Development overrides
├── config_testing.yaml        # Test configuratie
├── config_staging.yaml        # Staging configuratie
└── config_production.yaml     # Productie configuratie</code></pre>

<h3>Voorbeeld config_default.yaml</h3>

<pre><code>api:
  default_model: "gpt-4.1"
  default_temperature: 0.0
  default_max_tokens: 300
  request_timeout: 30.0
  max_retries: 3

ai_components:
  definition_generator:
    model: "gpt-4.1"
    temperature: 0.0
    max_tokens: 300

  validation:
    toetsregels:
      model: "gpt-4.1"
      temperature: 0.0
      max_tokens: 200
    expert_review:
      model: "gpt-4.1"
      temperature: 0.0
      max_tokens: 500

  voorbeelden:
    synoniemen:
      model: "gpt-4.1"
      temperature: 0.2
      max_tokens: 150
    uitleg:
      model: "gpt-4.1"
      temperature: 0.0
      max_tokens: 200

cache:
  enabled: true
  default_ttl: 3600
  definition_ttl: 3600
  examples_ttl: 1800
  validation_ttl: 900

rate_limiting:
  enabled: true
  requests_per_minute: 60
  requests_per_hour: 3000
  tokens_per_second: 1.0</code></pre>

<h2>Beveiliging Best Practices</h2>

<ol>
<li>**Nooit API keys in code**</li>
</ol>
<ul>
<li>  - Gebruik altijd environment variabelen</li>
<li>  - Configuratie files mogen GEEN secrets bevatten</li>
</ul>

<ol>
<li>**Environment-specifieke configs**</li>
</ol>
<ul>
<li>  - Development: Lagere rate limits</li>
<li>  - Production: Stricte security settings</li>
<li>  - Testen: Mock configuraties</li>
</ul>

<ol>
<li>**API Key Validatie**</li>
<pre><code>   config = get_config_manager()
   if not config.validate_api_key():
       raise ValueError("Invalid or missing API key")</code></pre>
</ol>

<h2>Monitoring & Metrics</h2>

<p>De configuratie bevat ook monitoring instellingen:</p>

<pre><code>@dataclass
class MonitoringConfig:
    enabled: bool = True
    collect_metrics: bool = True

    # Cost tracking
    cost_threshold_daily: float = 10.0
    cost_threshold_monthly: float = 300.0

    # OpenAI pricing (per 1K tokens)
    openai_pricing: dict = {
        "gpt-4": 0.03,
        "gpt-4.1": 0.03
    }</code></pre>

<h2>Troubleshooting</h2>

<h3>Check huidige configuratie</h3>

<pre><code>from src.config.config_manager import get_config_manager

config = get_config_manager()
print(config.get_environment_info())</code></pre>

<h3>Reload configuratie</h3>

<pre><code>from src.config.config_manager import reload_config

reload_config()  # Herlaad alle configuratie files</code></pre>

<h3>Configuratie callbacks</h3>

<pre><code>def on_config_change(section, key, old_value, new_value):
    print(f"Config changed: {section}.{key} from {old_value} to {new_value}")

config.register_change_callback("api", on_config_change)</code></pre>

<h2>Migration Guide</h2>

<p>Voor teams die migreren van hardcoded configuratie:</p>

<ol>
<li>**Identificeer hardcoded waarden**</li>
<pre><code>   grep -r "temperature=" src/
   grep -r "model=" src/</code></pre>
</ol>

<ol>
<li>**Vervang met config calls**</li>
<pre><code>   # Oud (hardcoded)
   temperature = 0.7

   # Nieuw (geconfigureerd)
   from src.config.config_manager import get_component_config
   config = get_component_config('my_component')
   temperature = config['temperature']</code></pre>
</ol>

<ol>
<li>**Voeg component config toe**</li>
<pre><code>   # config/config_default.yaml
   ai_components:
     my_component:
       model: "gpt-4.1"
       temperature: 0.7
       max_tokens: 200</code></pre>
</ol>

<ol>
<li>**Test met verschillende environments**</li>
<pre><code>   ENVIRONMENT=development python src/main.py
   ENVIRONMENT=production python src/main.py</code></pre>
</ol>

<h2>Component Configuratie Voorbeelden</h2>

<h3>Definition Generator</h3>
<pre><code>definition_generator:
  model: "gpt-4.1"
  temperature: 0.0    # Volledig deterministisch
  max_tokens: 300</code></pre>

<h3>Validation Service</h3>
<pre><code>validation:
  toetsregels:
    model: "gpt-4.1"
    temperature: 0.0  # Strikte validatie
    max_tokens: 200
  expert_review:
    model: "gpt-4.1"
    temperature: 0.0
    max_tokens: 500</code></pre>

<h3>Voorbeelden Generator</h3>
<pre><code>voorbeelden:
  synoniemen:
    model: "gpt-4.1"
    temperature: 0.2  # Licht creatief
    max_tokens: 150
  uitleg:
    model: "gpt-4.1"
    temperature: 0.0  # Exact
    max_tokens: 200
  gebruiksvoorbeelden:
    model: "gpt-4.1"
    temperature: 0.1  # Minimaal creatief
    max_tokens: 250</code></pre>

<h2>Toekomstige Uitbreidingen</h2>

<ul>
<li>[ ] Hot-reloading van configuratie zonder restart</li>
<li>[ ] A/B testing met verschillende model configuraties</li>
<li>[ ] Automatische fallback naar goedkopere modellen bij errors</li>
<li>[ ] Cost-based model selectie</li>
<li>[ ] Prestaties-based temperature tuning</li>
</ul>

  </div>
</body>
</html>