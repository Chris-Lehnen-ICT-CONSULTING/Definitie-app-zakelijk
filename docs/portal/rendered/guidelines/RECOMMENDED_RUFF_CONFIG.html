<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Recommended Ruff Configuration Update</title>
  <link rel="stylesheet" href="../portal.css" />
  <style>
    .doc { max-width: 900px; margin: 16px auto 48px auto; padding: 0 16px; }
    .doc h1,.doc h2,.doc h3,.doc h4{ color:#223 }
    .doc p{ line-height:1.6; color:#222 }
    .doc a{ color:#1d4ed8; text-decoration: underline; }
    .doc pre{ background:#0b1020; color:#e6edf3; padding:12px; overflow:auto; border-radius:8px }
    .doc code{ background:#f0f2f5; padding:2px 6px; border-radius:4px }
    .back{ display:inline-block; margin:12px 0; padding:6px 10px; border:1px solid #ccd; border-radius:6px; text-decoration:none; color:#223; background:#f8f9fb }
  </style>
</head>
<body>
  <div class="doc">
    <a class="back" href="../../index.html">← Terug naar Portal</a>
    <h1>Recommended Ruff Configuration Update</h1>
<p><strong>Based on Pragmatic Improvement Roadmap</strong></p>

<h2>Current State Analysis</h2>

<p>Your current <code>pyproject.toml</code> already has good pragmatic ignores:</p>
<ul>
<li>✅ PLC0415 (lazy imports) - Already ignored</li>
<li>✅ ARG002 (unused args) - Already ignored</li>
<li>✅ N999 (module naming) - Already ignored</li>
<li>✅ PLW0603 (global state) - Already ignored</li>
</ul>

<p><strong>Good work!</strong> Your configuration already reflects pragmatic solo-developer priorities.</p>

<h2>Recommended Additions</h2>

<p>Add these to your existing <code>ignore</code> list in <code>pyproject.toml</code>:</p>

<pre><code>[tool.ruff.lint]
ignore = [
    # Existing (keep these)
    "E402",    # Module level import not at top of file
    "E501",    # Line too long - handled by Black
    "PLR0913", # Too many arguments
    "PLR2004", # Magic value used in comparison
    "PGH003",  # Use specific rule codes when ignoring type issues
    "PLC0415", # Import outside top-level - intentional lazy loading
    "ARG002",  # Unused method argument - interface compliance
    "N999",    # Invalid module name - legacy naming
    "PLW0603", # Global statement - singleton patterns

    # NEW: Add these based on roadmap
    "PLC2401", # Non-ASCII variable names - Dutch domain terms are intentional
    "PLR0911", # Too many return statements - domain complexity is real
    "PLR0912", # Too many branches - domain complexity is real
    "PLR0915", # Too many statements - domain complexity is real
    "SIM102",  # Nested if statements - sometimes clearer than combined
    "RUF003",  # Ambiguous unicode in comments - doesn't affect functionality
    "PD901",   # Avoid using generic 'df' for pandas DataFrames - too strict
    "ARG001",  # Unused function argument - often interface requirements
]</code></pre>

<h2>Keep Enabled (These Catch Real Bugs)</h2>

<p>Make sure these are still in your <code>select</code> list:</p>

<pre><code>select = [
    "E",     # pycodestyle errors
    "F",     # pyflakes
    "B",     # flake8-bugbear (includes B904 - exception chaining)
    "DTZ",   # flake8-datetimez (timezone issues)
    "EM",    # flake8-errmsg (exception message format)
    "UP",    # pyupgrade
    "C4",    # flake8-comprehensions
    "ISC",   # flake8-implicit-str-concat
    "PIE",   # flake8-pie
    "RET",   # flake8-return
    "PGH",   # pygrep-hooks
    "RUF",   # ruff-specific rules (except ignored ones)
]</code></pre>

<h2>Updated Per-File Ignores</h2>

<p>Your current per-file ignores are good. Consider adding:</p>

<pre><code>[tool.ruff.lint.per-file-ignores]
# Existing (keep these)
"__init__.py" = ["F401", "E402"]
"test_*.py" = ["F401", "E402"]
"*_test.py" = ["F401", "E402"]
"**/archief/**/*.py" = ["ALL"]
"**/ARCHIEF/**/*.py" = ["ALL"]
"**/archive/**/*.py" = ["ALL"]

# NEW: Complex business logic files
"src/orchestration/definitie_agent.py" = ["PLR0912", "PLR0915"]
"src/document_processing/document_extractor.py" = ["PLR0911"]
"src/export/export_txt.py" = ["PLR0915"]
"src/hybrid_context/smart_source_selector.py" = ["PLR0912"]
"src/integration/definitie_checker.py" = ["PLR0915", "PLR0911"]

# Services with intentional patterns
"src/services/container.py" = ["PLC0415", "PLW0603"]
"src/api/feature_status_api.py" = ["PLW0603"]
"src/document_processing/document_processor.py" = ["PLW0603"]

# Domain model files (Dutch names are correct)
"src/domain/**/*.py" = ["PLC2401"]
"src/toetsregels/**/*.py" = ["PLC2401"]</code></pre>

<h2>Complete Recommended pyproject.toml Section</h2>

<pre><code>[tool.ruff.lint]
select = [
    "E",    # pycodestyle errors
    "F",    # pyflakes
    "I",    # isort
    "UP",   # pyupgrade
    "B",    # flake8-bugbear
    "C4",   # flake8-comprehensions
    "DTZ",  # flake8-datetimez
    "EM",   # flake8-errmsg
    "ISC",  # flake8-implicit-str-concat
    "PIE",  # flake8-pie
    "RET",  # flake8-return
    "PGH",  # pygrep-hooks
    "RUF",  # ruff-specific rules
]

ignore = [
    # Style (handled by Black or not important)
    "E402",    # Module level import not at top of file
    "E501",    # Line too long - handled by Black
    "PLR2004", # Magic value used in comparison
    "PGH003",  # Use specific rule codes when ignoring type issues

    # Intentional architecture patterns (single-user app)
    "PLC0415", # Import outside top-level - lazy loading for performance
    "PLW0603", # Global statement - singleton patterns for single-user

    # Interface &amp; domain design
    "ARG001",  # Unused function argument - interface requirements
    "ARG002",  # Unused method argument - interface requirements
    "N999",    # Invalid module name - legacy conventions work fine
    "PLC2401", # Non-ASCII names - Dutch legal domain terms

    # Complexity (domain complexity is real)
    "PLR0911", # Too many return statements
    "PLR0912", # Too many branches
    "PLR0913", # Too many arguments
    "PLR0915", # Too many statements

    # Simplification (sometimes wrong)
    "SIM102",  # Nested if - sometimes clearer

    # Low-value warnings
    "RUF003",  # Ambiguous unicode in comments
    "PD901",   # Generic DataFrame names
]

# Allow autofix for all enabled rules
fixable = ["ALL"]
unfixable = []

[tool.ruff.lint.per-file-ignores]
# Test files
"__init__.py" = ["F401", "E402"]
"test_*.py" = ["F401", "E402", "PLR2004"]
"*_test.py" = ["F401", "E402", "PLR2004"]

# Archive/legacy (ignore everything)
"**/archief/**/*.py" = ["ALL"]
"**/ARCHIEF/**/*.py" = ["ALL"]
"**/archive/**/*.py" = ["ALL"]

# Complex business logic (domain complexity)
"src/orchestration/definitie_agent.py" = ["PLR0912", "PLR0915"]
"src/document_processing/document_extractor.py" = ["PLR0911"]
"src/export/export_txt.py" = ["PLR0915"]
"src/hybrid_context/smart_source_selector.py" = ["PLR0912"]
"src/integration/definitie_checker.py" = ["PLR0915", "PLR0911"]

# Services with singleton patterns
"src/services/container.py" = ["PLC0415", "PLW0603"]
"src/api/feature_status_api.py" = ["PLW0603"]
"src/document_processing/document_processor.py" = ["PLW0603"]
"src/hybrid_context/hybrid_context_engine.py" = ["PLW0603"]
"src/monitoring/api_monitor.py" = ["PLW0603"]
"src/security/security_middleware.py" = ["PLW0603"]

# Domain models (Dutch terminology)
"src/domain/**/*.py" = ["PLC2401"]
"src/toetsregels/**/*.py" = ["PLC2401"]

[tool.ruff.lint.pylint]
max-args = 8          # Increased from 7 - some services need more
max-branches = 15     # Increased from 12 - domain complexity
max-returns = 8       # Increased from 6 - document processing
max-statements = 60   # Increased from 50 - complex workflows</code></pre>

<h2>Expected Results After Update</h2>

<p>Running <code>ruff check src config</code> should report:</p>

<p><strong>Before:</strong> 869 issues</p>
<p><strong>After:</strong> ~50-100 issues (mostly real bugs and opportunities)</p>

<p><strong>Breakdown:</strong></p>
<ul>
<li>~20 TIER 0 issues (fix now): B904, DTZ, EM</li>
<li>~30-80 TIER 1 issues (fix when touching): RUF012, PLW2901, etc.</li>
<li>~700+ false positives: Ignored via config ✅</li>
</ul>

<h2>Quick Test Commands</h2>

<pre><code># Check only critical security issues
ruff check src config --select B904,DTZ,EM

# Check with new config (should be much cleaner)
ruff check src config

# Auto-fix safe issues
ruff check src config --fix

# Generate clean report for CI
ruff check src config --output-format=github</code></pre>

<h2>CI Integration</h2>

<p>Update your CI workflow to focus on critical issues:</p>

<pre><code># .github/workflows/ci.yml
- name: Lint (Critical Only)
  run: |
    ruff check src config --select B904,DTZ,EM --output-format=github

- name: Lint (Full)
  run: |
    ruff check src config --output-format=github
  continue-on-error: true  # Don't block on style issues</code></pre>

<h2>Benefits of This Config</h2>

<ol>
<li>**Focus on Real Issues:** Catches bugs, not style preferences</li>
<li>**Respects Architecture:** Acknowledges intentional design decisions</li>
<li>**Solo-Developer Friendly:** Doesn't enforce team conventions unnecessarily</li>
<li>**Performance-Aware:** Keeps lazy loading and singleton patterns</li>
<li>**Domain-Appropriate:** Allows Dutch legal terminology</li>
<li>**Low Noise:** ~85% reduction in false positive warnings</li>
</ol>

<h2>Migration Plan</h2>

<ol>
<li>**Backup current config:** `cp pyproject.toml pyproject.toml.backup`</li>
<li>**Update pyproject.toml** with new ignore rules</li>
<li>**Run ruff:** `ruff check src config` - verify ~50-100 issues remain</li>
<li>**Fix TIER 0 issues:** `ruff check src config --select B904,DTZ,EM`</li>
<li>**Commit:** "config: update ruff to focus on pragmatic issues"</li>
</ol>

<h2>Maintenance</h2>

<p><strong>Monthly:</strong> Run <code>ruff check src config --statistics</code> to track trends</p>
<p><strong>When adding rules:</strong> Ask "Does this catch real bugs?" If no, ignore it</p>
<p><strong>When removing ignores:</strong> Ask "Will this waste my time?" If yes, keep it ignored</p>

<p>---</p>

<p><strong>Remember:</strong> The best linting config is one that helps you ship features faster, not one that follows every best practice. Your current config is already pretty good - these updates just make it excellent for solo development.</p>

  </div>
</body>
</html>