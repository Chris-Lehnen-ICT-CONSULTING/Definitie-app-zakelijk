<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Business Knowledge Extraction Document</title>
  <link rel="stylesheet" href="../portal.css" />
  <style>
    .doc { max-width: 900px; margin: 16px auto 48px auto; padding: 0 16px; }
    .doc h1,.doc h2,.doc h3,.doc h4{ color:#223 }
    .doc p{ line-height:1.6; color:#222 }
    .doc a{ color:#1d4ed8; text-decoration: underline; }
    .doc pre{ background:#0b1020; color:#e6edf3; padding:12px; overflow:auto; border-radius:8px }
    .doc code{ background:#f0f2f5; padding:2px 6px; border-radius:4px }
    .back{ display:inline-block; margin:12px 0; padding:6px 10px; border:1px solid #ccd; border-radius:6px; text-decoration:none; color:#223; background:#f8f9fb }
  </style>
</head>
<body>
  <div class="doc">
    <a class="back" href="../../index.html">‚Üê Terug naar Portal</a>
    <h1>Business Knowledge Extraction Document</h1>
<h2>US-061: Legacy Code Business Logic Documentation</h2>

<p>Dit document bevat alle ge√´xtraheerde business kennis uit de legacy code van het DefinitieAgent systeem. Deze kennis is kritiek voor het behoud van functionaliteit tijdens refactoring.</p>

<p>---</p>

<h2>1. FEEDBACKBUILDER ALGORITMES</h2>

<h3>1.1 Feedback Prioritering Algoritme</h3>

<p><strong>Locatie:</strong> <code>src/orchestration/definitie_agent.py:299-544</code></p>

<h4>Business Logica:</h4>
<ol>
<li>**Kritieke Violations Eerst** (regel 321-328)</li>
</ol>
<ul>
<li>  - Maximaal 3 kritieke issues tegelijk presenteren</li>
<li>  - Voorkomt overwhelming van AI model</li>
<li>  - Focus op meest impactvolle problemen eerst</li>
</ul>

<ol>
<li>**Violation Groepering** (regel 329-337)</li>
</ol>
<ul>
<li>  - Groepeer violations per type voor effici√´nte behandeling</li>
<li>  - Voorkomt duplicate feedback voor vergelijkbare problemen</li>
<li>  - Maakt feedback meer actionable</li>
</ul>

<ol>
<li>**Iteratie-Bewuste Feedback** (regel 437-444)</li>
</ol>
<ul>
<li>  - Eerste iteratie: directe instructies ("Vermijd deze patronen")</li>
<li>  - Latere iteraties: alternatieve suggesties ("Nog steeds aanwezig... probeer alternatieve formuleringen")</li>
<li>  - Voorkomt stagnatie door variatie in aanpak</li>
</ul>

<ol>
<li>**Lerende Feedback** (regel 469-496)</li>
</ol>
<ul>
<li>  - Detecteert stagnatie: scores die niet verbeteren</li>
<li>  - Detecteert regressie: huidige score < vorige score</li>
<li>  - Suggereert fundamentele herformulering bij stagnatie</li>
<li>  - Threshold: 0.05 score verschil voor stagnatie detectie</li>
</ul>

<ol>
<li>**Feedback Prioritering** (regel 511-544)</li>
</ol>
<ul>
<li>  - Volgorde: üö® Kritiek ‚Üí üí° Suggesties ‚Üí Overig</li>
<li>  - Maximum 5 feedback items per iteratie</li>
<li>  - Deduplicatie van feedback items</li>
<li>  - Behoud van meest actionable feedback</li>
</ul>

<h3>1.2 Violation-to-Feedback Mapping</h3>

<p><strong>Business Rules:</strong></p>
<pre><code>violation_feedback_mapping = {
    "CON-01": "Context-specifiek zonder expliciete vermelding",
    "CON-02": "Baseer op authentieke bronnen",
    "ESS-01": "Beschrijf WAT het is, niet waarvoor",
    "ESS-02": "Maak type/proces/resultaat expliciet",
    "ESS-03": "Voeg unieke identificerende kenmerken toe",
    "ESS-04": "Gebruik objectief meetbare criteria",
    "ESS-05": "Benadruk onderscheidende eigenschappen",
    "INT-01": "Formuleer als √©√©n zin zonder opsommingen",
    "INT-03": "Vervang onduidelijke verwijzingen",
    "STR-01": "Start met centraal zelfstandig naamwoord",
    "STR-02": "Gebruik concrete, specifieke terminologie"
}</code></pre>

<p>---</p>

<h2>2. STATUS BEPALING REGELS</h2>

<h3>2.1 Definitie Acceptatie Criteria</h3>

<p><strong>Locatie:</strong> <code>src/validation/definitie_validator.py:666-687</code></p>

<h4>Drie-Staps Acceptatie Logica:</h4>

<ol>
<li>**Critical Violations Check**</li>
</ol>
<ul>
<li>  - GEEN kritieke violations toegestaan</li>
<li>  - Direct reject als critical > 0</li>
<li>  - Business reden: Kritieke regels zijn juridisch verplicht</li>
</ul>

<ol>
<li>**Overall Score Check**</li>
</ol>
<ul>
<li>  - Minimum score: 0.8 (80%)</li>
<li>  - Weighted average van alle regel scores</li>
<li>  - Weging op basis van prioriteit √ó aanbeveling</li>
</ul>

<ol>
<li>**Category Compliance Check**</li>
</ol>
<ul>
<li>  - Minimum: 0.75 (75%) voor categorie-specifieke regels</li>
<li>  - Lager dan overall omdat categorie-specifiek</li>
<li>  - Zorgt voor flexibiliteit bij cross-categorie begrippen</li>
</ul>

<h3>2.2 Score Berekening Algoritme</h3>

<p><strong>Locatie:</strong> <code>src/validation/definitie_validator.py:635-654</code></p>

<h4>Weighted Scoring:</h4>
<pre><code>Score = Œ£(regel_score √ó regel_weight) / Œ£(regel_weight)

Waarbij:
- regel_weight = base_weight √ó requirement_multiplier
- base_weight: hoog=1.0, midden=0.7, laag=0.4
- requirement_multiplier: verplicht=1.5, aanbevolen=1.0, optioneel=0.8</code></pre>

<h4>Score Penalties:</h4>
<ul>
<li>Forbidden pattern: -0.3 √ó count √ó severity_multiplier</li>
<li>Missing element: -0.4 √ó severity_multiplier</li>
<li>Structure issue: -0.25 √ó severity_multiplier</li>
</ul>

<h4>Severity Multipliers:</h4>
<ul>
<li>CRITICAL: 2.0</li>
<li>HIGH: 1.5</li>
<li>MEDIUM: 1.0</li>
<li>LOW: 0.5</li>
</ul>

<p>---</p>

<h2>3. ITERATIVE IMPROVEMENT LOGICA</h2>

<h3>3.1 Iteratie Control Flow</h3>

<p><strong>Locatie:</strong> <code>src/orchestration/definitie_agent.py:644-683</code></p>

<h4>Business Rules:</h4>

<ol>
<li>**Maximum Iteraties:** 3 (configureerbaar)</li>
</ol>
<ul>
<li>  - Balans tussen kwaliteit en performance</li>
<li>  - Voorkomt infinite loops</li>
<li>  - Genoeg voor meeste verbeteringen</li>
</ul>

<ol>
<li>**Improvement Threshold:** 0.05</li>
</ol>
<ul>
<li>  - Minimum verbetering per iteratie</li>
<li>  - Voorkomt nutteloze iteraties</li>
<li>  - Detecteert stagnatie</li>
</ul>

<ol>
<li>**Best Iteration Tracking**</li>
</ol>
<ul>
<li>  - Houdt beste score bij over alle iteraties</li>
<li>  - Gebruikt beste resultaat als finale output</li>
<li>  - Voorkomt regressie in finale resultaat</li>
</ul>

<ol>
<li>**Voorbeelden Optimalisatie** (regel 739-758)</li>
</ol>
<ul>
<li>  - Genereer voorbeelden alleen in eerste iteratie</li>
<li>  - Hergebruik voorbeelden in volgende iteraties</li>
<li>  - Bespaart ~2-3 seconden per iteratie</li>
<li>  - Voorbeelden blijven consistent</li>
</ul>

<h3>3.2 Feedback History Management</h3>

<p><strong>Locatie:</strong> <code>src/orchestration/definitie_agent.py:869-883</code></p>

<h4>Business Logic:</h4>
<ul>
<li>Maximum 10 feedback items in history</li>
<li>FIFO: oudste feedback wordt verwijderd</li>
<li>Voorkomt prompt bloat</li>
<li>Houdt focus op recente issues</li>
</ul>

<p>---</p>

<h2>4. ENHANCEMENT STRATEGIE√ãN</h2>

<h3>4.1 Clarity Enhancement</h3>

<p><strong>Locatie:</strong> <code>src/services/definition_generator_enhancement.py:81-185</code></p>

<h4>Vagueness Detection:</h4>
<pre><code>unclear_patterns = [
    "enigszins|soms|wellicht|mogelijk|misschien",  # Vague terms
    "enzovoort|etc|enz",                           # Non-specific endings
    "diverse|verschillende|meerdere",              # Vague quantities
    "dergelijke|soortgelijke"                      # Vague references
]

vagueness_score = matches / words √ó 10 (max 1.0)
Threshold: &gt; 0.3 voor enhancement</code></pre>

<h4>Circular Reasoning Detection:</h4>
<ul>
<li>Check: begrip komt >1 keer voor in definitie</li>
<li>Fix: vervang 2e+ occurrence met "dit"</li>
<li>Voorkomt tautologie√´n</li>
</ul>

<h3>4.2 Context Integration</h3>

<p><strong>Locatie:</strong> <code>src/services/definition_generator_enhancement.py:188-231</code></p>

<h4>Business Rules:</h4>
<ul>
<li>Domein field verwijderd (EPIC-010/US-043)</li>
<li>Context alleen toevoegen als niet al aanwezig</li>
<li>Format: "... (binnen de context van X, Y)"</li>
<li>Alleen relevante context delen (>2 karakters)</li>
</ul>

<h3>4.3 Completeness Enhancement</h3>

<p><strong>Locatie:</strong> <code>src/services/definition_generator_enhancement.py:234-296</code></p>

<h4>Missing Aspects Detection:</h4>
<pre><code>completeness_aspects = {
    "doel": ["doel", "bedoeling", "functie", "nut"],
    "scope": ["omvang", "bereik", "toepassingsgebied"],
    "voorwaarden": ["voorwaarde", "vereiste", "criteria"],
    "proces": ["stap", "procedure", "methode", "proces"],
    "verantwoordelijk": ["verantwoordelijk", "bevoegd", "eigenaar"]
}</code></pre>

<p><strong>Trigger:</strong> ‚â•2 missing aspects</p>
<p><strong>Action:</strong> Voeg generieke completeness hints toe</p>

<h3>4.4 Linguistic Enhancement</h3>

<p><strong>Locatie:</strong> <code>src/services/definition_generator_enhancement.py:299-364</code></p>

<h4>Improvements:</h4>
<ol>
<li>**Passive to Active:** "wordt X" ‚Üí "X wordt"</li>
<li>**Redundancy Removal:** Detecteer word repetition</li>
<li>**Formality:** "je/jij/wij" ‚Üí "men"</li>
<li>**Begrip Simplification:** "het begrip X" ‚Üí "X"</li>
</ol>

<p>---</p>

<h2>5. PERFORMANCE OPTIMALISATIES</h2>

<h3>5.1 Voorbeelden Caching</h3>

<p><strong>Business Logic:</strong></p>
<ul>
<li>Genereer voorbeelden alleen in iteratie 1</li>
<li>Store in `_first_iteration_voorbeelden`</li>
<li>Reuse in iteraties 2-3</li>
<li>Besparing: ~2-3 sec per iteratie</li>
</ul>

<h3>5.2 Enhancement Confidence Threshold</h3>

<p><strong>Locatie:</strong> <code>src/services/definition_generator_enhancement.py:433</code></p>

<ul>
<li>Default threshold: 0.6</li>
<li>Alleen enhancements met confidence ‚â• threshold</li>
<li>Maximum 3 enhancements per definitie</li>
<li>Sorteer op confidence, pas hoogste toe eerst</li>
</ul>

<h3>5.3 Feedback Limiting</h3>

<p><strong>Business Rules:</strong></p>
<ul>
<li>Max 5 feedback items per iteratie</li>
</ul>


  </div>
</body>
</html>