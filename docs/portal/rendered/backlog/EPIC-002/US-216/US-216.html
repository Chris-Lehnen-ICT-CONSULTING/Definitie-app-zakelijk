<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>US-216 ‚Äî Cre√´er ValidationDisplayHelper Class voor UI Consistency</title>
  <link rel="stylesheet" href="../portal.css" />
  <style>
    .doc { max-width: 900px; margin: 16px auto 48px auto; padding: 0 16px; }
    .doc h1,.doc h2,.doc h3,.doc h4{ color:#223 }
    .doc p{ line-height:1.6; color:#222 }
    .doc a{ color:#1d4ed8; text-decoration: underline; }
    .doc pre{ background:#0b1020; color:#e6edf3; padding:12px; overflow:auto; border-radius:8px }
    .doc code{ background:#f0f2f5; padding:2px 6px; border-radius:4px }
    .back{ display:inline-block; margin:12px 0; padding:6px 10px; border:1px solid #ccd; border-radius:6px; text-decoration:none; color:#223; background:#f8f9fb }
  </style>
</head>
<body>
  <div class="doc">
    <a class="back" href="../../index.html">‚Üê Terug naar Portal</a>
    <p>---</p>
<p>id: US-216</p>
<p>epic: EPIC-002</p>
<p>status: open</p>
<p>prioriteit: MEDIUM</p>
<p>story_points: 8</p>
<p>sprint: next</p>
<p>owner: frontend</p>
<p>applies_to: definitie-app@current</p>
<p>canonical: false</p>
<p>last_verified: 2025-10-02</p>
<p>created_at: 2025-09-19</p>
<p>dependencies: [US-193, US-214]</p>
<p>---</p>

<h1>US-216 ‚Äî Cre√´er ValidationDisplayHelper Class voor UI Consistency</h1>

<h2>Doel</h2>
<p>Centraliseer alle validation display logica in een herbruikbare helper class om consistente weergave van validatie resultaten door de hele UI te garanderen.</p>

<h2>Context</h2>
<p>Uit de US-193 multi-agent review (P3-15) blijkt dat validation display logica verspreid is over meerdere UI componenten met inconsistente formatting, kleuren en berichten. Dit leidt tot een verwarrende gebruikerservaring.</p>

<h2>Scope</h2>

<h3>In scope</h3>
<ul>
<li>Cre√´er `ValidationDisplayHelper` class met alle display logica</li>
<li>Unificeer severity kleuren en icons</li>
<li>Standaardiseer validation message formatting</li>
<li>Centraliseer score visualisatie logica</li>
<li>Implementeer responsive validation summaries</li>
<li>Voeg i18n support voor validation messages</li>
</ul>

<h3>Niet in scope</h3>
<ul>
<li>Streamlit component redesign</li>
<li>Custom CSS framework</li>
<li>Validation business logic (alleen display)</li>
</ul>

<h2>Acceptance Criteria</h2>

<h3>Functioneel</h3>
<ul>
<li>[ ] Consistente kleuren voor severity levels (high=red, medium=orange, low=yellow)</li>
<li>[ ] Uniforme icons voor validation states</li>
<li>[ ] Standaard formatting voor alle validation messages</li>
<li>[ ] Score visualisatie consistent (progress bars, percentages)</li>
<li>[ ] Tooltips met uitleg over validation rules</li>
</ul>

<h3>Technisch</h3>
<ul>
<li>[ ] Single `ValidationDisplayHelper` class</li>
<li>[ ] Alle UI componenten gebruiken de helper</li>
<li>[ ] Geen duplicate display logic meer</li>
<li>[ ] Type-safe interfaces (gebruik US-214 types)</li>
<li>[ ] Unit tests voor alle display methods</li>
</ul>

<h2>Implementatie</h2>

<h3>1. ValidationDisplayHelper Class</h3>
<pre><code># src/ui/helpers/validation_display_helper.py
from typing import Dict, List, Optional, Tuple
from dataclasses import dataclass
import streamlit as st

@dataclass
class SeverityConfig:
    """Configuration for severity display."""
    color: str
    icon: str
    bg_color: str
    text_style: str

class ValidationDisplayHelper:
    """Centralized helper for consistent validation display."""

    # Severity configurations
    SEVERITY_CONFIGS = {
        "high": SeverityConfig(
            color="#FF4B4B",
            icon="üî¥",
            bg_color="#FFE6E6",
            text_style="color: #D32F2F; font-weight: bold;"
        ),
        "medium": SeverityConfig(
            color="#FFA726",
            icon="üü†",
            bg_color="#FFF3E0",
            text_style="color: #F57C00; font-weight: medium;"
        ),
        "low": SeverityConfig(
            color="#FFEB3B",
            icon="üü°",
            bg_color="#FFFDE7",
            text_style="color: #F9A825;"
        )
    }

    # Score thresholds and colors
    SCORE_THRESHOLDS = [
        (0.9, "#4CAF50", "Uitstekend"),
        (0.7, "#8BC34A", "Goed"),
        (0.5, "#FFC107", "Voldoende"),
        (0.3, "#FF9800", "Matig"),
        (0.0, "#F44336", "Onvoldoende")
    ]

    @classmethod
    def render_validation_summary(
        cls,
        validation_details: Dict,
        show_details: bool = True
    ) -&gt; None:
        """Render complete validation summary with consistent styling."""
        score = validation_details.get("overall_score", 0.0)
        is_acceptable = validation_details.get("is_acceptable", False)
        violations = validation_details.get("violations", [])

        # Score section
        cls._render_score_section(score, is_acceptable)

        # Statistics
        if show_details:
            cls._render_statistics(validation_details)

        # Violations
        if violations:
            cls._render_violations(violations)
        else:
            st.success("‚úÖ Geen validatieproblemen gevonden!")

    @classmethod
    def _render_score_section(cls, score: float, is_acceptable: bool) -&gt; None:
        """Render score with visual indicator."""
        color, label = cls.get_score_color_and_label(score)

        col1, col2, col3 = st.columns([2, 3, 1])

        with col1:
            st.metric(
                label="Validatie Score",
                value=f"{score:.1%}",
                delta=label
            )

        with col2:
            st.progress(score, text=f"Score: {score:.1%}")

        with col3:
            if is_acceptable:
                st.success("‚úÖ Acceptabel")
            else:
                st.error("‚ùå Niet acceptabel")

    @classmethod
    def _render_violations(cls, violations: List[Dict]) -&gt; None:
        """Render violations with consistent formatting."""
        st.subheader("üìã Validatieproblemen")

        # Group by severity
        grouped = cls._group_violations_by_severity(violations)

        for severity in ["high", "medium", "low"]:
            if severity in grouped:
                cls._render_severity_group(severity, grouped[severity])

    @classmethod
    def _render_severity_group(
        cls,
        severity: str,
        violations: List[Dict]
    ) -&gt; None:
        """Render a group of violations with same severity."""
        config = cls.SEVERITY_CONFIGS[severity]

        with st.expander(
            f"{config.icon} {severity.title()} ({len(violations)})",
            expanded=(severity == "high")
        ):
            for violation in violations:
                cls._render_single_violation(violation, config)

    @classmethod
    def _render_single_violation(
        cls,
        violation: Dict,
        config: SeverityConfig
    ) -&gt; None:
        """Render single violation with styling."""
        st.markdown(
            f"""
            &lt;div style="
                padding: 10px;
                margin: 5px 0;
                background-color: {config.bg_color};
                border-left: 4px solid {config.color};
                border-radius: 4px;
            "&gt;
                &lt;div style="{config.text_style}"&gt;
                    {violation.get('rule_id', 'UNKNOWN')}
                &lt;/div&gt;
                &lt;div style="margin-top: 5px;"&gt;
                    {violation.get('description', 'Geen beschrijving')}
                &lt;/div&gt;
                {cls._format_suggestion(violation.get('suggestion'))}
            &lt;/div&gt;
            """,
            unsafe_allow_html=True
        )

    @classmethod
    def _format_suggestion(cls, suggestion: Optional[str]) -&gt; str:
        """Format suggestion text if present."""
        if not suggestion:
            return ""
        return f"""
            &lt;div style="
                margin-top: 8px;
                padding-top: 8px;
                border-top: 1px solid #DDD;
                font-style: italic;
                color: #666;
            "&gt;
                üí° Suggestie: {suggestion}
            &lt;/div&gt;
        """

    @classmethod
    def format_violation_message(
        cls,
        violation: Dict,
        include_suggestion: bool = True
    ) -&gt; str:
        """Format violation message for display."""
        parts = [
            f"**{violation.get('rule_id', 'UNKNOWN')}**: ",
            violation.get('description', 'Geen beschrijving')
        ]

        if include_suggestion and violation.get('suggestion'):
            parts.append(f"\nüí° *{violation['suggestion']}*")

        return "".join(parts)

    @classmethod
    def get_score_color_and_label(cls, score: float) -&gt; Tuple[str, str]:
        """Get color and label for score value."""
        for threshold, color, label in cls.SCORE_THRESHOLDS:
            if score &gt;= threshold:
                return color, label
        return "#F44336", "Onvoldoende"

    @classmethod
    def render_score_badge(cls, score: float) -&gt; None:
        """Render a score badge with color coding."""
        color, label = cls.get_score_color_and_label(score)
        st.markdown(
            f"""
            &lt;span style="
                background-color: {color};
                color: white;
                padding: 4px 12px;
                border-radius: 20px;
                font-weight: bold;
            "&gt;
                {score:.0%} - {label}
            &lt;/span&gt;
            """,
            unsafe_allow_html=True
        )

    @classmethod
    def _group_violations_by_severity(
        cls,
        violations: List[Dict]
    ) -&gt; Dict[str, List[Dict]]:
        """Group violations by severity level."""
        grouped = {}
        for violation in violations:
            severity = violation.get('severity', 'low')
            if severity not in grouped:
                grouped[severity] = []
            grouped[severity].append(violation)
        return grouped

    @classmethod
    def _render_statistics(cls, validation_details: Dict) -&gt; None:
        """Render validation statistics."""
        violations = validation_details.get("violations", [])
        passed_rules = validation_details.get("passed_rules", [])

        col1, col2, col3 = st.columns(3)

        with col1:
            st.metric("Totaal Regels", len(violations) + len(passed_rules))

        with col2:
            st.metric("Geslaagd", len(passed_rules), delta="‚úÖ")

        with col3:
            st.metric("Gefaald", len(violations), delta="‚ö†Ô∏è" if violations else "‚úÖ")</code></pre>

<h3>2. Integration in UI Components</h3>
<pre><code># src/ui/components/definition_generator_tab.py
from ui.helpers.validation_display_helper import ValidationDisplayHelper

def render_validation_results(validation_details: dict) -&gt; None:
    """Render validation results using centralized helper."""
    # Replace all custom display logic with:
    ValidationDisplayHelper.render_validation_summary(
        validation_details,
        show_details=st.checkbox("Toon details", value=True)
    )

def show_validation_score(score: float) -&gt; None:
    """Show validation score badge."""
    ValidationDisplayHelper.render_score_badge(score)</code></pre>

<h3>3. Customization Support</h3>
<pre><code># src/ui/helpers/validation_theme.py
from dataclasses import dataclass
from typing import Dict

@dataclass
class ValidationTheme:
    """Theme configuration for validation display."""
    severity_configs: Dict[str, SeverityConfig]
    score_thresholds: List[Tuple[float, str, str]]
    locale: str = "nl"

    @classmethod
    def default(cls) -&gt; "ValidationTheme":
        """Get default theme."""
        return cls(
            severity_configs=ValidationDisplayHelper.SEVERITY_CONFIGS,
            score_thresholds=ValidationDisplayHelper.SCORE_THRESHOLDS
        )

    @classmethod
    def high_contrast(cls) -&gt; "ValidationTheme":
        """Get high contrast theme for accessibility."""
        # ... modified colors for better contrast
        pass</code></pre>

<h2>Migration Plan</h2>

<h3>Phase 1: Create Helper (Day 1)</h3>
<ul>
<li>Implement ValidationDisplayHelper class</li>
<li>Unit tests for all methods</li>
</ul>

<h3>Phase 2: Replace in Components (Day 2-3)</h3>
<ul>
<li>Update definition_generator_tab.py</li>
<li>Update validation results components</li>
<li>Update export displays</li>
</ul>

<h3>Phase 3: Remove Duplicates (Day 4)</h3>
<ul>
<li>Remove old display logic</li>
<li>Clean up redundant formatting code</li>
</ul>

<h3>Phase 4: Enhancement (Day 5)</h3>
<ul>
<li>Add theming support</li>
<li>Implement i18n</li>
<li>Add accessibility features</li>
</ul>

<h2>Test Strategy</h2>

<pre><code># tests/unit/test_validation_display_helper.py
def test_severity_config():
    """Test severity configurations are complete."""
    for severity in ["high", "medium", "low"]:
        config = ValidationDisplayHelper.SEVERITY_CONFIGS[severity]
        assert config.color
        assert config.icon
        assert config.bg_color

def test_score_thresholds():
    """Test score thresholds cover full range."""
    helper = ValidationDisplayHelper()
    assert helper.get_score_color_and_label(1.0)[1] == "Uitstekend"
    assert helper.get_score_color_and_label(0.0)[1] == "Onvoldoende"

def test_violation_formatting():
    """Test violation message formatting."""
    violation = {
        "rule_id": "TEST-01",
        "description": "Test description",
        "suggestion": "Test suggestion"
    }
    message = ValidationDisplayHelper.format_violation_message(violation)
    assert "TEST-01" in message
    assert "Test description" in message</code></pre>

<h2>Metrics</h2>

<h3>Before</h3>
<ul>
<li>Display logic locations: 15+ files</li>
<li>Inconsistent severity colors: Yes</li>
<li>Code duplication: ~500 lines</li>
<li>UI consistency issues: 10+</li>
</ul>

<h3>After</h3>
<ul>
<li>Display logic locations: 1 file</li>
<li>Consistent severity colors: Yes</li>
<li>Code duplication: 0 lines</li>
<li>UI consistency issues: 0</li>
</ul>

<h2>Dependencies</h2>
<ul>
<li>Streamlit 1.28+</li>
<li>Python 3.11+</li>
<li>US-214 (ValidationDetailsDict types)</li>
</ul>

<h2>Notities</h2>
<ul>
<li>P3-15 uit US-193 multi-agent review</li>
<li>Consider component library later</li>
<li>Coordinate met UX team voor styling</li>
<li>Support dark mode in future</li>
</ul>

<h2>Links</h2>
<ul>
<li>[Streamlit Components](https://docs.streamlit.io/library/components)</li>
<li>[Material Design Colors](https://material.io/design/color)</li>
<li>Parent: US-193</li>
</ul>
  </div>
</body>
</html>