<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Version Control Requirements</title>
  <link rel="stylesheet" href="../portal.css" />
  <style>
    .doc { max-width: 900px; margin: 16px auto 48px auto; padding: 0 16px; }
    .doc h1,.doc h2,.doc h3,.doc h4{ color:#223 }
    .doc p{ line-height:1.6; color:#222 }
    .doc a{ color:#1d4ed8; text-decoration: underline; }
    .doc pre{ background:#0b1020; color:#e6edf3; padding:12px; overflow:auto; border-radius:8px }
    .doc code{ background:#f0f2f5; padding:2px 6px; border-radius:4px }
    .back{ display:inline-block; margin:12px 0; padding:6px 10px; border:1px solid #ccd; border-radius:6px; text-decoration:none; color:#223; background:#f8f9fb }
  </style>
</head>
<body>
  <div class="doc">
    <a class="back" href="../../index.html">← Terug naar Portal</a>
    <p>---</p>
<p>id: REQ-101</p>
<p>titel: Version Control Requirements</p>
<p>status: Draft</p>
<p>prioriteit: HIGH</p>
<p>aangemaakt: 2025-09-29</p>
<p>bijgewerkt: 2025-09-29</p>
<p>owner: product</p>
<p>applies_to: definitie-app@current</p>
<p>canonical: true</p>
<p>last_verified: 2025-09-29</p>
<p>categorie: Data Management</p>
<p>versie: 1.0</p>
<p>eigenaar: technical-architect</p>
<p>gerelateerde_epics: </p>
<p>gerelateerde_stories: </p>
<p>---</p>

<h1>REQ-101: Version Control Requirements</h1>

<h2>1. Executive Summary</h2>

<p>Dit document specificeert de requirements voor een volledig version control systeem voor juridische definities. Het systeem moet de complete evolutie van definities tracken, vergelijking mogelijk maken, en rollback functionaliteit bieden.</p>

<h2>2. Business Requirements</h2>

<h3>2.1 Business Drivers</h3>

<ul>
<li>**Kwaliteitsborging**: Inzicht in evolutie van definities</li>
<li>**Risk Management**: Mogelijkheid om fouten terug te draaien</li>
<li>**Collaboration**: Meerdere juristen kunnen aan definities werken</li>
<li>**Compliance**: Aantonen van definitie evolutie voor juridische doeleinden</li>
<li>**Knowledge Management**: Leren van historische wijzigingen</li>
</ul>

<h3>2.2 Stakeholder Needs</h3>

<p>| Stakeholder | Need | Priority |</p>
<p>|-------------|------|----------|</p>
<p>| Juridisch professionals | Versie geschiedenis bekijken | HIGH |</p>
<p>| Content managers | Rollback naar eerdere versies | HIGH |</p>
<p>| Compliance officers | Definitie evolutie tracken | HIGH |</p>
<p>| Quality assurance | Versies vergelijken | MEDIUM |</p>
<p>| Management | Change metrics en reports | MEDIUM |</p>

<h2>3. Functional Requirements</h2>

<h3>3.1 Version Creation</h3>

<p><strong>[REQ-101.1]</strong> Automatische versioning:</p>
<ul>
<li>Nieuwe versie bij elke save operatie</li>
<li>Sequentiële versie nummering</li>
<li>Branch support voor experimenten</li>
<li>Tag support voor milestones</li>
<li>Parent-child relaties tussen versies</li>
</ul>

<p><strong>[REQ-101.2]</strong> Version metadata:</p>
<ul>
<li>Auteur identificatie (user ID, naam, rol)</li>
<li>Timestamp (created, modified)</li>
<li>Wijziging beschrijving/reden</li>
<li>Change type (create, update, rollback, merge)</li>
<li>Branch informatie</li>
<li>Content hash voor integriteit</li>
</ul>

<p><strong>[REQ-101.3]</strong> Version content:</p>
<ul>
<li>Complete snapshot van definitie</li>
<li>Alle velden inclusief metadata</li>
<li>Validatie resultaten op moment van save</li>
<li>Voorbeelden en opmerkingen</li>
<li>Bronnen en referenties</li>
</ul>

<h3>3.2 Version Storage</h3>

<p><strong>[REQ-101.4]</strong> Storage strategie:</p>
<ul>
<li>Full snapshots voor major versions</li>
<li>Delta storage voor minor changes</li>
<li>Compression voor oude versies</li>
<li>Deduplicatie van identieke content</li>
<li>Efficient storage (< 30% overhead)</li>
</ul>

<p><strong>[REQ-101.5]</strong> Storage limits:</p>
<ul>
<li>Minimum 100 versies per definitie</li>
<li>Geen harde limiet op totaal versies</li>
<li>Archivering na configureerbare periode</li>
<li>Warning bij excessive versioning</li>
</ul>

<h3>3.3 Version Retrieval</h3>

<p><strong>[REQ-101.6]</strong> Query capabilities:</p>
<ul>
<li>Get specific version by ID</li>
<li>List all versions voor definitie</li>
<li>Filter op datum range</li>
<li>Filter op auteur</li>
<li>Filter op branch</li>
<li>Search in version content</li>
</ul>

<p><strong>[REQ-101.7]</strong> Performance requirements:</p>
<ul>
<li>Single version retrieval < 200ms</li>
<li>Version list < 1s voor 1000 versies</li>
<li>Content search < 5s over alle versies</li>
</ul>

<h3>3.4 Version Comparison</h3>

<p><strong>[REQ-101.8]</strong> Comparison features:</p>
<ul>
<li>Side-by-side comparison</li>
<li>Inline diff view</li>
<li>Unified diff view</li>
<li>Word-level granularity</li>
<li>Multi-version comparison (3-way)</li>
<li>Change highlighting</li>
</ul>

<p><strong>[REQ-101.9]</strong> Diff types:</p>
<ul>
<li>Text content differences</li>
<li>Structural changes</li>
<li>Metadata changes</li>
<li>Validation result changes</li>
<li>Example changes</li>
</ul>

<h3>3.5 Version Rollback</h3>

<p><strong>[REQ-101.10]</strong> Rollback capabilities:</p>
<ul>
<li>Rollback naar any previous version</li>
<li>Selective field rollback</li>
<li>Rollback preview</li>
<li>Rollback met nieuwe versie</li>
<li>Rollback reason tracking</li>
<li>Undo rollback mogelijkheid</li>
</ul>

<p><strong>[REQ-101.11]</strong> Rollback safety:</p>
<ul>
<li>Validation check op target</li>
<li>Impact analysis</li>
<li>Dependency checking</li>
<li>Conflict detection</li>
<li>Approval workflow (optional)</li>
</ul>

<h3>3.6 Branching & Merging</h3>

<p><strong>[REQ-101.12]</strong> Branch operations:</p>
<ul>
<li>Create branch van any version</li>
<li>Switch tussen branches</li>
<li>List active branches</li>
<li>Delete unused branches</li>
<li>Branch protection rules</li>
</ul>

<p><strong>[REQ-101.13]</strong> Merge operations:</p>
<ul>
<li>Merge branch naar main</li>
<li>Conflict resolution UI</li>
<li>Three-way merge</li>
<li>Cherry-pick changes</li>
<li>Merge preview</li>
</ul>

<h2>4. Non-Functional Requirements</h2>

<h3>4.1 Performance</h3>

<p><strong>[REQ-101.14]</strong> Performance specs:</p>
<ul>
<li>Version creation < 500ms</li>
<li>Version retrieval < 200ms</li>
<li>Diff calculation < 2s</li>
<li>Rollback operation < 3s</li>
<li>No performance degradation tot 10K versies</li>
</ul>

<h3>4.2 Scalability</h3>

<p><strong>[REQ-101.15]</strong> Scalability requirements:</p>
<ul>
<li>Support voor 10K+ definities</li>
<li>100+ versies per definitie average</li>
<li>1M+ totale versies</li>
<li>Horizontal scaling ready</li>
</ul>

<h3>4.3 Reliability</h3>

<p><strong>[REQ-101.16]</strong> Reliability requirements:</p>
<ul>
<li>No data loss tijdens version operations</li>
<li>Atomic version creation</li>
<li>Consistent state bij failures</li>
<li>Automatic recovery mechanisms</li>
</ul>

<h3>4.4 Security</h3>

<p><strong>[REQ-101.17]</strong> Security requirements:</p>
<ul>
<li>Version tampering protection</li>
<li>Access control per version</li>
<li>Audit trail van version access</li>
<li>Encryption voor sensitive content</li>
</ul>

<h2>5. Technical Requirements</h2>

<h3>5.1 Database Schema</h3>

<p><strong>[REQ-101.18]</strong> Version table structuur:</p>

<pre><code>CREATE TABLE definitie_versies (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    definitie_id BIGINT NOT NULL,
    versie_nummer INT NOT NULL,
    versie_major INT NOT NULL,
    versie_minor INT NOT NULL,
    versie_patch INT NOT NULL,
    branch_naam VARCHAR(100) DEFAULT 'main',
    parent_versie_id BIGINT,

    -- Content
    content JSON NOT NULL,
    content_hash VARCHAR(64) NOT NULL,

    -- Metadata
    auteur_id VARCHAR(255) NOT NULL,
    auteur_naam VARCHAR(255),
    created_at TIMESTAMP(6) NOT NULL,
    wijziging_type VARCHAR(50),
    wijziging_reden TEXT,
    tags JSON,

    -- Status
    is_current BOOLEAN DEFAULT FALSE,
    is_published BOOLEAN DEFAULT FALSE,
    is_archived BOOLEAN DEFAULT FALSE,

    -- Relations
    FOREIGN KEY (definitie_id) REFERENCES definities(id),
    FOREIGN KEY (parent_versie_id) REFERENCES definitie_versies(id),
    UNIQUE KEY (definitie_id, versie_nummer, branch_naam),
    INDEX (definitie_id, branch_naam, created_at),
    INDEX (auteur_id, created_at),
    INDEX (content_hash)
);</code></pre>

<h3>5.2 API Specification</h3>

<p><strong>[REQ-101.19]</strong> REST endpoints:</p>

<pre><code>/api/definitions/{id}/versions:
  get:
    description: List all versions
    parameters:
      - branch: string
      - author: string
      - from_date: datetime
      - to_date: datetime
  post:
    description: Create new version

/api/versions/{version_id}:
  get:
    description: Get specific version
  patch:
    description: Update version metadata

/api/versions/compare:
  post:
    description: Compare two or more versions
    body:
      version_ids: array

/api/versions/{version_id}/rollback:
  post:
    description: Rollback to this version</code></pre>

<h3>5.3 Service Interface</h3>

<p><strong>[REQ-101.20]</strong> Version Control Service:</p>

<pre><code>class IVersionControlService:
    def create_version(definition_id: int, content: dict, metadata: dict) -&gt; Version
    def get_version(version_id: int) -&gt; Version
    def list_versions(definition_id: int, filters: dict) -&gt; List[Version]
    def compare_versions(version_ids: List[int]) -&gt; DiffResult
    def rollback_to_version(version_id: int, reason: str) -&gt; Version
    def branch_from_version(version_id: int, branch_name: str) -&gt; Version
    def merge_branch(branch_name: str, target_branch: str) -&gt; MergeResult
    def tag_version(version_id: int, tag: str) -&gt; bool
    def archive_old_versions(before_date: datetime) -&gt; int</code></pre>

<h2>6. Data Migration Requirements</h2>

<p><strong>[REQ-101.21]</strong> Migration from current system:</p>
<ul>
<li>Convert existing definities to versioned format</li>
<li>Preserve modification history where available</li>
<li>Create initial version for all definitions</li>
<li>Maintain referential integrity</li>
<li>Zero downtime migration</li>
</ul>

<h2>7. Testing Requirements</h2>

<p><strong>[REQ-101.22]</strong> Test coverage:</p>
<ul>
<li>Unit tests voor alle version operations</li>
<li>Integration tests voor complete flows</li>
<li>Performance tests met 10K+ versions</li>
<li>Concurrent modification tests</li>
<li>Rollback/recovery tests</li>
<li>Data integrity tests</li>
</ul>

<h2>8. User Interface Requirements</h2>

<p><strong>[REQ-101.23]</strong> UI components:</p>
<ul>
<li>Version timeline visualization</li>
<li>Version comparison viewer</li>
<li>Rollback confirmation dialog</li>
<li>Branch management interface</li>
<li>Version search/filter interface</li>
<li>Change statistics dashboard</li>
</ul>

<h2>9. Acceptance Criteria</h2>

<ul>
<li>[ ] Automatic versioning working (REQ-101.1)</li>
<li>[ ] Complete metadata captured (REQ-101.2)</li>
<li>[ ] Efficient storage implemented (REQ-101.4)</li>
<li>[ ] Version retrieval within performance specs (REQ-101.7)</li>
<li>[ ] Comparison features functional (REQ-101.8)</li>
<li>[ ] Rollback working safely (REQ-101.10)</li>
<li>[ ] Branching operational (REQ-101.12)</li>
<li>[ ] Performance requirements met (REQ-101.14)</li>
<li>[ ] API endpoints implemented (REQ-101.19)</li>
<li>[ ] Migration completed successfully (REQ-101.21)</li>
</ul>

<h2>10. Dependencies</h2>

<ul>
<li>Database with JSON support</li>
<li>Diff library (python-diff or similar)</li>
<li>Compression library</li>
<li>Storage solution for archives</li>
</ul>

<h2>11. Risks & Mitigations</h2>

<p>| Risk | Impact | Probability | Mitigation |</p>
<p>|------|--------|-------------|------------|</p>
<p>| Storage explosion | HIGH | HIGH | Delta storage, compression, archiving |</p>
<p>| Complex merges | MEDIUM | MEDIUM | Simple merge strategy initially |</p>
<p>| Performance degradation | HIGH | MEDIUM | Indexing, caching, pagination |</p>
<p>| Data corruption | CRITICAL | LOW | Checksums, backups, validation |</p>

<h2>12. Future Enhancements</h2>

<ul>
<li>Git backend integration</li>
<li>Collaborative editing with conflict resolution</li>
<li>AI-powered merge suggestions</li>
<li>Semantic versioning automation</li>
<li>Cross-definition dependency tracking</li>
<li>Version analytics and insights</li>
</ul>
  </div>
</body>
</html>