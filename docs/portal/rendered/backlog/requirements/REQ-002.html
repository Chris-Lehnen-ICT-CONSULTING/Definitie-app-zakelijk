<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>API Key beveiliging</title>
  <link rel="stylesheet" href="../portal.css" />
  <style>
    .doc { max-width: 900px; margin: 16px auto 48px auto; padding: 0 16px; }
    .doc h1,.doc h2,.doc h3,.doc h4{ color:#223 }
    .doc p{ line-height:1.6; color:#222 }
    .doc a{ color:#1d4ed8; text-decoration: underline; }
    .doc pre{ background:#0b1020; color:#e6edf3; padding:12px; overflow:auto; border-radius:8px }
    .doc code{ background:#f0f2f5; padding:2px 6px; border-radius:4px }
    .back{ display:inline-block; margin:12px 0; padding:6px 10px; border:1px solid #ccd; border-radius:6px; text-decoration:none; color:#223; background:#f8f9fb }
  </style>
</head>
<body>
  <div class="doc">
    <a class="back" href="../../index.html">← Terug naar Portal</a>
    <p>---</p>
<p>id: REQ-002</p>
<p>titel: API Key beveiliging</p>
<p>type: nonfunctional</p>
<p>status: completed</p>
<p>prioriteit: HOOG</p>
<p>aangemaakt: 08-09-2025</p>
<p>bijgewerkt: 08-09-2025</p>
<p>owner: architecture</p>
<p>applies_to: definitie-app@current</p>
<p>canonical: false</p>
<p>last_verified: 2025-09-29</p>
<p>epics: </p>
<p>stories: </p>
<p>links: </p>
<p>sources: </p>
<p>docs: </p>
<ul>
<li>line: API key configuration</li>
<p>path: config/config_development.yaml</p>
<p>---</p>
</ul>



<h1>Requirement REQ-002: API Key beveiliging</h1>

<h2>Beschrijving</h2>

<p>Alle API keys (OpenAI, externe services) moeten veilig worden opgeslagen en beheerd. Keys mogen nooit hardcoded in de broncode staan of in versiebeheer terechtkomen.</p>

<h2>Rationale</h2>

<p>API keys geven toegang tot betaalde services en kunnen misbruikt worden voor ongeautoriseerde toegang. Lekken van keys kan leiden tot financiële schade en beveiliging breaches.</p>

<h2>Acceptatiecriteria (SMART)</h2>

<ul>
<li>API keys worden uitsluitend via environment variables geladen</li>
<li>Geen API keys in configuratiebestEnen die in Git staan</li>
<li>Key rotation moet mogelijk zijn zonder code wijzigingen</li>
<li>Keys worden gemaskeerd in alle logging output</li>
<li>Fallback mechanisme wanneer keys ontbreken met duidelijke error messages</li>
</ul>


<h3>SMART Acceptatiecriteria</h3>

<ul>
<li>**Specifiek:** Implementeer veilige API key opslag via environment variables zonder hardcoding</li>
<li>**Meetbaar:**</li>
<li> - 0 API keys in Git repository (gescand door git-secrets)</li>
<li> - 100% keys geladen uit environment variables</li>
<li> - < 50ms overhead voor key retrieval</li>
<li> - 0 keys zichtbaar in logs (100% masking coverage)</li>
<li> - Key rotation binnen 5 minuten zonder downtime</li>
<li>**Acceptabel:** Gebruik standaard dotenv en vault integraties</li>
<li>**Relevant:** Kritiek voor beveiliging en compliance met ASTRA-SEC-002</li>
<li>**Tijdgebonden:** Operationeel voor Sprint 1 deployment (week 2)</li>
</ul>


<h2>BDD Test Scenario's</h2>

<pre><code>Scenario: API key laden uit environment variable
  Gegeven de environment variable OPENAI_API_KEY is gezet
  Wanneer de applicatie start
  Dan wordt de API key succesvol geladen
  En wordt de key niet gelogd in plain text
  En kan de OpenAI service calls maken

Scenario: Ontbrekende API key afhandeling
  Gegeven de OPENAI_API_KEY environment variable ontbreekt
  Wanneer de applicatie probeert een definitie te genereren
  Dan wordt een ConfigurationError gegooid
  En wordt een gebruiksvriendelijke foutmelding getoond
  En wordt het incident gelogd zonder de key te onthullen

Scenario: API key masking in logs
  Gegeven een API key "sk-abc123xyz789"
  Wanneer deze key in een log entry voorkomt
  Dan wordt de key gemaskeerd als "sk-***********"
  En blijven alleen de eerste 3 karakters zichtbaar
  En wordt de volledige key nooit opgeslagen

Scenario: Key rotation zonder downtime
  Gegeven de applicatie draait met API key A
  Wanneer een nieuwe key B wordt geconfigureerd
  Dan wordt key B geladen zonder restart
  En blijven actieve requests met key A werken
  En gebruiken nieuwe requests key B
  En is de transitie binnen 5 minuten compleet</code></pre>

<h2>Uitwerking / Notities</h2>

<ul>
<li>Gebruik van python-dotenv voor development</li>
<li>Production keys via secure vault (HashiCorp Vault, Azure Key Vault)</li>
<li>Separate keys voor dev/test/prod omgevingen</li>
<li>Rate limiting monitoring per API key</li>
<li>Automatische alerts bij abnormaal gebruik</li>
<li>Git-secrets pre-commit hook voor key detectie</li>
</ul>

<h2>Conflicten (indien van toepassing)</h2>

<p>Geen conflicten geïdentificeerd</p>
<h2>SMART Criteria</h2>

<ul>
<li>**Specifiek**: Implement complete api key beveiliging beveiliging control</li>
<li>**Meetbaar**: Geen kwetsbaarheden in beveiligingsscans, 100% testdekking</li>
<li>**Haalbaar**: Using established beveiliging libraries en patterns</li>
<li>**Relevant**: KRITIEK voor justitiesector gegevensbeschermingscompliance</li>
<li>**Tijdgebonden**: Must be operational before productie deployment</li>
</ul>


<h3>Compliance Referenties</h3>

<ul>
<li>**ASTRA Controls:**</li>
<li> - ASTRA-QUA-001: Kwaliteitsborging</li>
<li> - ASTRA-SEC-002: Beveiliging by Design</li>
<li>**NORA Principes:**</li>
<li> - NORA-BP-07: Herbruikbaarheid</li>
<li> - NORA-BP-12: Betrouwbaarheid</li>
<li>**GEMMA Referenties:**</li>
<li> - GEMMA-ARC-03: Architectuur patterns</li>
<li>**Justice Sector:**</li>
<li> - DJI/OM integratie vereisten</li>
<li> - Rechtspraak compatibiliteit</li>
</ul>

  </div>
</body>
</html>