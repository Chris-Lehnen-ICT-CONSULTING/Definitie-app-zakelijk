<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quick Fix Checklist - DEF-138 Bug Hunt</title>
  <link rel="stylesheet" href="../portal.css" />
  <style>
    .doc { max-width: 900px; margin: 16px auto 48px auto; padding: 0 16px; }
    .doc h1,.doc h2,.doc h3,.doc h4{ color:#223 }
    .doc p{ line-height:1.6; color:#222 }
    .doc a{ color:#1d4ed8; text-decoration: underline; }
    .doc pre{ background:#0b1020; color:#e6edf3; padding:12px; overflow:auto; border-radius:8px }
    .doc code{ background:#f0f2f5; padding:2px 6px; border-radius:4px }
    .back{ display:inline-block; margin:12px 0; padding:6px 10px; border:1px solid #ccd; border-radius:6px; text-decoration:none; color:#223; background:#f8f9fb }
  </style>
</head>
<body>
  <div class="doc">
    <a class="back" href="../../index.html">‚Üê Terug naar Portal</a>
    <h1>Quick Fix Checklist - DEF-138 Bug Hunt</h1>

<p><strong>Use this checklist to fix bugs in priority order</strong></p>

<p>---</p>

<h2>‚úÖ TODAY'S FIXES (3-4 hours)</h2>

<h3>üî¥ BUG-001: False Positive - "woordvoerder"</h3>

<p><strong>Status:</strong> [ ] Not Started | [ ] In Progress | [ ] Testing | [ ] Done</p>

<p><strong>Steps:</strong></p>

<ol>
<li>[ ] **Update YAML schema** (30 min)</li>
</ol>
<ul>
<li>  - File: `config/classification/term_patterns.yaml`</li>
<li>  - Add exclusions for -woord, -naam, -boek patterns</li>
<pre><code>   TYPE:
     woord:
       weight: 0.70
       exclusions:
         - "woordvoerder"
         - "woordbreuk"
     naam:
       weight: 0.65
       exclusions:
         - "naamsverminking"
         - "naamgeving"</code></pre>
</ul>

<ol>
<li>[ ] **Update TermPatternConfig** (30 min)</li>
</ol>
<ul>
<li>  - File: `src/services/classification/term_config.py`</li>
<li>  - Add `get_suffix_data()` method</li>
<li>  - Support both float and dict format</li>
</ul>

<ol>
<li>[ ] **Update pattern matching** (30 min)</li>
</ol>
<ul>
<li>  - File: `src/ontologie/improved_classifier.py:230-245`</li>
<li>  - Add exclusion check before pattern match</li>
<pre><code>   weight, exclusions = self.config.get_suffix_data(category_upper, suffix)
   if begrip_lower in exclusions:
       continue</code></pre>
</ul>

<ol>
<li>[ ] **Add tests** (30 min)</li>
</ol>
<ul>
<li>  - File: `tests/ontologie/test_classifier_exclusions.py`</li>
<li>  - Test werkwoord ‚Üí TYPE (correct)</li>
<li>  - Test woordvoerder ‚Üí PROCES (fixed)</li>
</ul>

<ol>
<li>[ ] **Run regression tests** (15 min)</li>
<pre><code>   pytest tests/ontologie/ -v</code></pre>
</ol>

<ol>
<li>[ ] **Manual QA** (15 min)</li>
</ol>
<ul>
<li>  - Test in UI: "werkwoord", "woordvoerder", "handboek", "voornaam"</li>
</ul>

<p><strong>Time Budget:</strong> 2.5 hours</p>

<p>---</p>

<h3>üü† BUG-004: Empty String Validation</h3>

<p><strong>Status:</strong> [ ] Not Started | [ ] In Progress | [ ] Testing | [ ] Done</p>

<p><strong>Steps:</strong></p>

<ol>
<li>[ ] **Add validation** (10 min)</li>
</ol>
<ul>
<li>  - File: `src/ontologie/improved_classifier.py:149`</li>
<pre><code>   def classify(self, begrip: str, ...) -&gt; ClassificationResult:
       if not begrip or not begrip.strip():
           raise ValueError("Cannot classify empty or whitespace-only begrip")
       begrip_lower = begrip.lower().strip()
       # ... rest</code></pre>
</ul>

<ol>
<li>[ ] **Add test** (10 min)</li>
</ol>
<ul>
<li>  - File: `tests/ontologie/test_classifier_edge_cases.py`</li>
<pre><code>   def test_empty_string_raises_error():
       classifier = ImprovedOntologyClassifier()
       with pytest.raises(ValueError, match="Cannot classify empty"):
           classifier.classify("")</code></pre>
</ul>

<ol>
<li>[ ] **Update UI error handling** (10 min)</li>
</ol>
<ul>
<li>  - File: `src/ui/tabbed_interface.py:268-277`</li>
<li>  - Ensure ValueError is caught and shown to user</li>
</ul>

<p><strong>Time Budget:</strong> 30 minutes</p>

<p>---</p>

<h2>‚úÖ THIS WEEK'S FIXES (2 hours)</h2>

<h3>üü† BUG-003: Division by Zero Optimization</h3>

<p><strong>Status:</strong> [ ] Not Started | [ ] In Progress | [ ] Testing | [ ] Done</p>

<p><strong>Steps:</strong></p>

<ol>
<li>[ ] **Optimize max() call** (15 min)</li>
</ol>
<ul>
<li>  - File: `src/ontologie/improved_classifier.py:327`</li>
<pre><code>   score_values = list(scores.values())
   max_score = max(score_values) if score_values and max(score_values) &gt; 0 else 1.0</code></pre>
</ul>

<ol>
<li>[ ] **Add edge case test** (15 min)</li>
<pre><code>   def test_all_zero_scores():
       # When all patterns score 0.0
       result = classifier.classify("xyz123")
       assert result.confidence == 0.0</code></pre>
</ol>

<p><strong>Time Budget:</strong> 30 minutes</p>

<p>---</p>

<h3>üü° BUG-008: Document Weight Choices</h3>

<p><strong>Status:</strong> [ ] Not Started | [ ] In Progress | [ ] Testing | [ ] Done</p>

<p><strong>Steps:</strong></p>

<ol>
<li>[ ] **Add comments to YAML** (15 min)</li>
</ol>
<ul>
<li>  - File: `config/classification/term_patterns.yaml:71-76`</li>
<pre><code>   # Compound word patterns - DEF-138 fix
   # Weights chosen based on semantic strength:
   # - 0.70: Strong TYPE signal (woord, boek) - grammatical/reference terms
   # - 0.65: Moderate TYPE signal (naam, lijst) - less consistent
   woord: 0.70
   naam: 0.65</code></pre>
</ul>

<p><strong>Time Budget:</strong> 15 minutes</p>

<p>---</p>

<h3>üü° BUG-007: SQL Injection Prevention</h3>

<p><strong>Status:</strong> [ ] Not Started | [ ] In Progress | [ ] Testing | [ ] Done</p>

<p><strong>Steps:</strong></p>

<ol>
<li>[ ] **Add table validation** (15 min)</li>
</ol>
<ul>
<li>  - File: `src/database/migrate_database.py:414`</li>
<pre><code>   ALLOWED_TABLES = {"definities", "synoniemen", "voorbeelden"}
   if table not in ALLOWED_TABLES:
       raise ValueError(f"Invalid table: {table}")
   c = conn.execute(f"PRAGMA table_info({table})")</code></pre>
</ul>

<p><strong>Time Budget:</strong> 15 minutes</p>

<p>---</p>

<h2>‚úÖ NEXT SPRINT FIXES (13-24 hours)</h2>

<h3>üü° BUG-006: Standardize YAML Loading</h3>

<p><strong>Status:</strong> [ ] Not Started | [ ] In Progress | [ ] Testing | [ ] Done</p>

<p><strong>Steps:</strong></p>

<ol>
<li>[ ] **Create helper function** (1 hour)</li>
</ol>
<ul>
<li>  - File: `src/utils/yaml_loader.py` (new file)</li>
<pre><code>   def load_yaml_config(path: Path, description: str = "config") -&gt; dict:
       if not path.exists():
           raise FileNotFoundError(f"{description} not found: {path}")
       # ... load with error handling</code></pre>
</ul>

<ol>
<li>[ ] **Refactor 11 call sites** (1-2 hours)</li>
</ol>
<ul>
<li>  - Replace raw yaml.safe_load with helper</li>
</ul>

<p><strong>Time Budget:</strong> 2-3 hours</p>

<p>---</p>

<h3>üü¢ BUG-010: Unicode Test Coverage</h3>

<p><strong>Status:</strong> [ ] Not Started | [ ] In Progress | [ ] Testing | [ ] Done</p>

<p><strong>Steps:</strong></p>

<ol>
<li>[ ] **Add test cases** (30 min)</li>
<pre><code>   def test_dutch_diacritics():
       assert classifier.classify("b√´loning").categorie
       assert classifier.classify("co√∂rdinatie").categorie</code></pre>
</ol>

<p><strong>Time Budget:</strong> 30 minutes</p>

<p>---</p>

<h3>üü° BUG-005: Exception Handling Audit (ONGOING)</h3>

<p><strong>Status:</strong> [ ] Not Started | [ ] In Progress | [ ] Testing | [ ] Done</p>

<p><strong>Steps:</strong></p>

<ol>
<li>[ ] **Audit phase 1** - Critical paths (4 hours)</li>
</ol>
<ul>
<li>  - Review exception handling in:</li>
<li>    - `src/ontologie/` (classifier)</li>
<li>    - `src/services/validation/` (validation)</li>
<li>    - `src/database/` (database access)</li>
</ul>

<ol>
<li>[ ] **Audit phase 2** - UI components (3 hours)</li>
</ol>
<ul>
<li>  - Review exception handling in:</li>
<li>    - `src/ui/components/` (100+ instances)</li>
</ul>

<ol>
<li>[ ] **Audit phase 3** - Services (3 hours)</li>
</ol>
<ul>
<li>  - Review exception handling in:</li>
<li>    - `src/services/` (50+ instances)</li>
</ul>

<p><strong>Time Budget:</strong> 10-20 hours (ongoing)</p>

<p>---</p>

<h2>Testing Checklist</h2>

<p>After each fix, run:</p>

<h3>Unit Tests</h3>
<pre><code># Test classifier
pytest tests/ontologie/ -v

# Test all services
pytest tests/services/ -v

# Full test suite
pytest -q</code></pre>

<h3>Manual QA</h3>
<pre><code># Start app
bash scripts/run_app.sh

# Test cases:
1. Enter "werkwoord" ‚Üí Should classify as TYPE
2. Enter "woordvoerder" ‚Üí Should classify as PROCES (fixed!)
3. Enter "" (empty) ‚Üí Should show error (fixed!)
4. Enter "b√´loning" ‚Üí Should handle unicode correctly</code></pre>

<h3>Regression Check</h3>
<pre><code># Run smoke tests
pytest -m smoke

# Run full validation suite
make validation-status</code></pre>

<p>---</p>

<h2>Commit Messages</h2>

<p>Use conventional commits:</p>

<pre><code># BUG-001
git commit -m "fix(classifier): add exclusion patterns to prevent false positives

- Add exclusion list support to term_patterns.yaml
- Extend TermPatternConfig with get_suffix_data()
- Update pattern matching to check exclusions
- Add test cases for woordvoerder, werkwoord

Fixes: BUG-138-001
Related: DEF-138"

# BUG-004
git commit -m "fix(classifier): validate empty string input

- Raise ValueError for empty/whitespace begrip
- Add test case for empty string validation
- Update UI error handling for ValueError

Fixes: BUG-138-004"

# BUG-003
git commit -m "perf(classifier): optimize max() call in score normalization

- Cache score_values to avoid duplicate max() call
- Add edge case test for all-zero scores

Fixes: BUG-138-003"</code></pre>

<p>---</p>

<h2>Success Criteria</h2>

<p>Before marking DONE:</p>

<h3>BUG-001</h3>
<ul>
<li>[ ] ‚úÖ `woordvoerder` ‚Üí PROCES (not TYPE)</li>
<li>[ ] ‚úÖ `werkwoord` ‚Üí TYPE (not broken)</li>
<li>[ ] ‚úÖ All existing tests pass</li>
<li>[ ] ‚úÖ New exclusion tests pass</li>
</ul>

<h3>BUG-004</h3>
<ul>
<li>[ ] ‚úÖ Empty string raises ValueError</li>
<li>[ ] ‚úÖ Whitespace-only raises ValueError</li>
<li>[ ] ‚úÖ UI shows user-friendly error message</li>
</ul>

<h3>BUG-003</h3>
<ul>
<li>[ ] ‚úÖ max() called only once</li>
<li>[ ] ‚úÖ Edge case tests pass</li>
<li>[ ] ‚úÖ No performance regression</li>
</ul>

<p>---</p>

<h2>Monitoring (48 Hours After Deploy)</h2>

<h3>Logs to Watch</h3>

<pre><code># Classification errors
grep "Ontologische classificatie gefaald" logs/*.log

# Validation failures
grep "ERROR" logs/*.log | grep -i "classificat"

# Performance issues
grep "SLOW" logs/*.log</code></pre>

<h3>Metrics to Track</h3>

<ul>
<li>[ ] Classification success rate: >95%</li>
<li>[ ] Average confidence score: >0.60</li>
<li>[ ] False positive rate: <5%</li>
<li>[ ] Response time: <500ms</li>
</ul>

<p>---</p>

<h2>Rollback Plan</h2>

<p>If critical issues emerge:</p>

<ol>
<li>**Revert BUG-001 fix:**</li>
<pre><code>   git revert &lt;commit-hash&gt;
   # Removes exclusions, falls back to old behavior</code></pre>
</ol>

<ol>
<li>**Disable validation (BUG-004):**</li>
<pre><code>   # Comment out ValueError raise
   # if not begrip or not begrip.strip():
   #     raise ValueError(...)</code></pre>
</ol>

<ol>
<li>**Restart app:**</li>
<pre><code>   pkill -f streamlit
   bash scripts/run_app.sh</code></pre>
</ol>

<p>---</p>

<h2>Questions / Issues</h2>

<p><strong>Who to contact:</strong></p>
<ul>
<li>Classification issues: @architect</li>
<li>Testing issues: @tester</li>
<li>Deployment issues: @devops</li>
</ul>

<p><strong>Slack channels:</strong></p>
<ul>
<li>#def-138-bug-fixes</li>
<li>#definitie-agent-dev</li>
</ul>

<p>---</p>

<p><strong>Created:</strong> 2025-11-10</p>
<p><strong>Last Updated:</strong> 2025-11-10</p>
<p><strong>Owner:</strong> Debug Specialist</p>
<p><strong>Status:</strong> Ready for implementation</p>

  </div>
</body>
</html>