<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Split God Class tabbed_interface.py</title>
  <link rel="stylesheet" href="../portal.css" />
  <style>
    .doc { max-width: 900px; margin: 16px auto 48px auto; padding: 0 16px; }
    .doc h1,.doc h2,.doc h3,.doc h4{ color:#223 }
    .doc p{ line-height:1.6; color:#222 }
    .doc a{ color:#1d4ed8; text-decoration: underline; }
    .doc pre{ background:#0b1020; color:#e6edf3; padding:12px; overflow:auto; border-radius:8px }
    .doc code{ background:#f0f2f5; padding:2px 6px; border-radius:4px }
    .back{ display:inline-block; margin:12px 0; padding:6px 10px; border:1px solid #ccd; border-radius:6px; text-decoration:none; color:#223; background:#f8f9fb }
  </style>
</head>
<body>
  <div class="doc">
    <a class="back" href="../../index.html">← Terug naar Portal</a>
    <p>---</p>
<p>id: US-205</p>
<p>title: Split God Class tabbed_interface.py</p>
<p>status: open</p>
<p>priority: HIGH</p>
<p>story_points: 13</p>
<p>owner: development-team</p>
<p>applies_to: definitie-app@current</p>
<p>canonical: false</p>
<p>last_verified: 2025-10-02</p>
<p>epic_id: EPIC-020-PHOENIX</p>
<p>assignee: team</p>
<p>created_date: 2025-01-18</p>
<p>updated_date: 2025-01-18</p>
<p>labels: [phoenix, refactoring, ui, code-quality, god-class]</p>
<p>acceptance_criteria:</p>
<ul>
<li> - tabbed_interface.py split into multiple focused modules</li>
<li> - No single file exceeds 300 lines</li>
<li> - Clear separation of concerns achieved</li>
<li> - All functionality preserved</li>
<li> - Tests coverage maintained or improved</li>
<p>definition_of_done:</p>
<li> - Code review completed</li>
<li> - All UI functionality working</li>
<li> - Unit tests for new modules</li>
<li> - Integration tests passing</li>
<li> - Documentation updated</li>
<p>dependencies:</p>
<li> - US-204 (V1 to V2 migration complete)</li>
<p>---</p>
</ul>

<h1>US-205: Split God Class tabbed_interface.py</h1>

<h2>User Story</h2>
<p><strong>Als</strong> ontwikkelaar</p>
<p><strong>Wil ik</strong> het god class <code>tabbed_interface.py</code> opsplitsen in kleinere, gefocuste modules</p>
<p><strong>Zodat</strong> de code beter onderhoudbaar, testbaar en begrijpelijk wordt</p>

<h2>Current State Analysis</h2>
<pre><code>src/ui/tabs/tabbed_interface.py: ~1500+ lines
- Tab rendering logic
- State management
- Event handling
- Business logic
- UI components
- Data transformation
- Validation logic
- Export functionality</code></pre>

<h2>Acceptance Criteria</h2>

<h3>File Size Constraints</h3>
<ul>
<li>[ ] Geen enkel UI bestand > 300 regels code</li>
<li>[ ] Gemiddelde bestandsgrootte < 150 regels</li>
<li>[ ] Maximaal 5 imports per module (exclusief standard library)</li>
</ul>

<h3>Module Organization</h3>
<ul>
<li>[ ] Aparte modules voor elke tab component</li>
<li>[ ] Gemeenschappelijke UI utilities geëxtraheerd</li>
<li>[ ] State management gecentraliseerd</li>
<li>[ ] Event handlers geïsoleerd van rendering</li>
</ul>

<h3>Code Quality</h3>
<ul>
<li>[ ] Single Responsibility Principle per module</li>
<li>[ ] DRY principe toegepast (geen code duplicatie)</li>
<li>[ ] Clear naming conventions</li>
<li>[ ] Type hints voor alle publieke functies</li>
</ul>

<h3>Functionality Preservation</h3>
<ul>
<li>[ ] Alle huidige features werken identiek</li>
<li>[ ] Geen UI regressies</li>
<li>[ ] Performance gelijk of beter</li>
<li>[ ] Gebruikerservaring onveranderd</li>
</ul>

<h2>Technical Implementation Notes</h2>

<h3>Target Architecture</h3>
<pre><code>src/ui/
├── components/           # Herbruikbare UI componenten
│   ├── __init__.py
│   ├── definition_card.py      # &lt; 150 lines
│   ├── validation_display.py   # &lt; 150 lines
│   ├── example_builder.py      # &lt; 150 lines
│   └── export_controls.py      # &lt; 100 lines
├── tabs/
│   ├── __init__.py
│   ├── base_tab.py            # &lt; 100 lines - Abstract base
│   ├── generate_tab.py         # &lt; 250 lines
│   ├── validate_tab.py         # &lt; 250 lines
│   ├── manage_tab.py           # &lt; 250 lines
│   ├── settings_tab.py         # &lt; 200 lines
│   └── tab_coordinator.py      # &lt; 150 lines - Orchestration
├── state/
│   ├── __init__.py
│   ├── session_manager.py      # &lt; 200 lines
│   └── state_validators.py     # &lt; 150 lines
├── handlers/
│   ├── __init__.py
│   ├── generation_handler.py   # &lt; 200 lines
│   ├── validation_handler.py   # &lt; 200 lines
│   ├── export_handler.py        # &lt; 150 lines
│   └── settings_handler.py      # &lt; 150 lines
└── utils/
    ├── __init__.py
    ├── ui_helpers.py           # &lt; 100 lines
    ├── formatters.py           # &lt; 100 lines
    └── validators.py           # &lt; 100 lines</code></pre>

<h3>Phase 1: Component Extraction (Day 1-2)</h3>
<pre><code># Extract reusable components
class DefinitionCard:
    """Displays a definition with metadata"""
    def render(self, definition: Definition) -&gt; None:
        pass

class ValidationDisplay:
    """Shows validation results"""
    def render(self, results: ValidationResults) -&gt; None:
        pass

class ExampleBuilder:
    """Interactive example sentence builder"""
    def render(self) -&gt; List[str]:
        pass</code></pre>

<h3>Phase 2: Tab Separation (Day 3-4)</h3>
<pre><code># Base class for all tabs
class BaseTab(ABC):
    def __init__(self, session_manager: SessionManager):
        self.session = session_manager

    @abstractmethod
    def render(self) -&gt; None:
        pass

    @abstractmethod
    def get_title(self) -&gt; str:
        pass

# Specific tab implementations
class GenerateTab(BaseTab):
    def __init__(self, session_manager, generation_handler):
        super().__init__(session_manager)
        self.handler = generation_handler

    def render(self):
        # Only rendering logic, no business logic
        pass</code></pre>

<h3>Phase 3: Handler Extraction (Day 5-6)</h3>
<pre><code># Business logic separated from UI
class GenerationHandler:
    def __init__(self, container: ServiceContainer):
        self.generator = container.get_generator()
        self.validator = container.get_validator()

    def generate_definition(self, term: str, context: str) -&gt; Definition:
        # Business logic here
        pass</code></pre>

<h3>Phase 4: State Management (Day 7)</h3>
<pre><code># Centralized state management
class SessionManager:
    def __init__(self):
        self._state = st.session_state

    def get(self, key: str, default=None):
        return self._state.get(key, default)

    def set(self, key: str, value: Any):
        self._state[key] = value

    def clear_namespace(self, namespace: str):
        # Clear all keys starting with namespace
        pass</code></pre>

<h3>Phase 5: Integration (Day 8-9)</h3>
<pre><code># Main app integration
def main():
    session = SessionManager()
    container = get_service_container()

    tabs = [
        GenerateTab(session, GenerationHandler(container)),
        ValidateTab(session, ValidationHandler(container)),
        ManageTab(session, container.get_repository()),
        SettingsTab(session, SettingsHandler())
    ]

    TabCoordinator(tabs).render()</code></pre>

<h2>Migration Strategy</h2>

<h3>Step 1: Create New Structure</h3>
<pre><code>mkdir -p src/ui/{components,state,handlers,utils}
touch src/ui/components/__init__.py
touch src/ui/state/__init__.py
touch src/ui/handlers/__init__.py
touch src/ui/utils/__init__.py</code></pre>

<h3>Step 2: Extract Without Breaking</h3>
<ol>
<li>Copy functions to new modules</li>
<li>Import from new locations in tabbed_interface.py</li>
<li>Gradually remove from tabbed_interface.py</li>
<li>Test after each extraction</li>
</ol>

<h3>Step 3: Refactor Incrementally</h3>
<pre><code># Old way (in tabbed_interface.py)
def render_definition_tab():
    # 500 lines of mixed logic
    pass

# New way
# In tabs/generate_tab.py
class GenerateTab(BaseTab):
    def render(self):
        # 50 lines of pure rendering
        pass

# In handlers/generation_handler.py
class GenerationHandler:
    def process(self):
        # 100 lines of business logic
        pass</code></pre>

<h2>Testing Strategy</h2>

<h3>Unit Tests per Module</h3>
<pre><code># tests/ui/components/test_definition_card.py
def test_definition_card_render():
    card = DefinitionCard()
    # Test isolated component
    pass

# tests/ui/handlers/test_generation_handler.py
def test_generation_handler():
    handler = GenerationHandler(mock_container)
    # Test business logic without UI
    pass</code></pre>

<h3>Integration Tests</h3>
<pre><code># tests/ui/test_tab_integration.py
def test_full_tab_flow():
    # Test complete user flow
    pass</code></pre>

<h2>Definition of Done</h2>

<ul>
<li>[ ] **Code Structure**:</li>
<li> - `tabbed_interface.py` < 100 lines (alleen orchestratie)</li>
<li> - Alle tab logica in aparte modules</li>
<li> - Geen enkel bestand > 300 lines</li>
<li> - Duidelijke module boundaries</li>
</ul>

<ul>
<li>[ ] **Code Quality**:</li>
<li> - Pylint score ≥ 9.0 voor alle nieuwe modules</li>
<li> - Type hints 100% coverage</li>
<li> - Docstrings voor alle publieke functies</li>
<li> - No cyclic dependencies</li>
</ul>

<ul>
<li>[ ] **Testing**:</li>
<li> - Unit tests voor elke nieuwe module</li>
<li> - Integration tests blijven groen</li>
<li> - UI smoke tests slagen</li>
<li> - Coverage ≥ 80% per module</li>
</ul>

<ul>
<li>[ ] **Documentation**:</li>
<li> - Module diagram bijgewerkt</li>
<li> - README voor ui/ directory</li>
<li> - Inline comments waar nodig</li>
<li> - CLAUDE.md bijgewerkt met nieuwe structuur</li>
</ul>

<ul>
<li>[ ] **Review**:</li>
<li> - Code review door 2 developers</li>
<li> - UI/UX review (geen regressies)</li>
<li> - Performance review (geen degradatie)</li>
</ul>

<h2>Metrics for Success</h2>

<h3>Before Refactoring</h3>
<ul>
<li>tabbed_interface.py: ~1500 lines</li>
<li>Cyclomatic complexity: >50</li>
<li>Test coverage: ~45%</li>
<li>Functions per file: >30</li>
</ul>

<h3>After Refactoring</h3>
<ul>
<li>Largest file: <300 lines</li>
<li>Avg cyclomatic complexity: <10</li>
<li>Test coverage: >80%</li>
<li>Functions per file: <10</li>
</ul>

<h2>Risks & Mitigations</h2>

<h3>Risk: Breaking Existing Functionality</h3>
<p><strong>Mitigation</strong>:</p>
<ul>
<li>Keep old file during transition</li>
<li>Feature flags for gradual rollout</li>
<li>Comprehensive integration tests</li>
</ul>

<h3>Risk: State Management Issues</h3>
<p><strong>Mitigation</strong>:</p>
<ul>
<li>Centralize all state access</li>
<li>Clear state ownership model</li>
<li>State validation layer</li>
</ul>

<h3>Risk: Performance Degradation</h3>
<p><strong>Mitigation</strong>:</p>
<ul>
<li>Profile before and after</li>
<li>Lazy loading where appropriate</li>
<li>Caching for expensive operations</li>
</ul>

<h2>Notes</h2>

<h3>Anti-patterns to Avoid</h3>
<ul>
<li>God objects (SessionManager becoming new god class)</li>
<li>Anemic domain models (handlers with no logic)</li>
<li>Over-engineering (too many abstractions)</li>
<li>Premature optimization</li>
</ul>

<h3>Best Practices to Follow</h3>
<ul>
<li>Composition over inheritance</li>
<li>Dependency injection</li>
<li>Interface segregation</li>
<li>Clear separation of concerns</li>
</ul>

<h2>Related Items</h2>
<ul>
<li>Parent: [[EPIC-020-PHOENIX]]</li>
<li>Depends on: [[US-204]] (V2 migration)</li>
<li>Related: [[US-206]] (business logic extraction)</li>
<li>Blocks: [[US-207]], [[US-208]]</li>
</ul>
  </div>
</body>
</html>