<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>US-203: Token Reductie Onderzoeksrapport</title>
  <link rel="stylesheet" href="../portal.css" />
  <style>
    .doc { max-width: 900px; margin: 16px auto 48px auto; padding: 0 16px; }
    .doc h1,.doc h2,.doc h3,.doc h4{ color:#223 }
    .doc p{ line-height:1.6; color:#222 }
    .doc a{ color:#1d4ed8; text-decoration: underline; }
    .doc pre{ background:#0b1020; color:#e6edf3; padding:12px; overflow:auto; border-radius:8px }
    .doc code{ background:#f0f2f5; padding:2px 6px; border-radius:4px }
    .back{ display:inline-block; margin:12px 0; padding:6px 10px; border:1px solid #ccd; border-radius:6px; text-decoration:none; color:#223; background:#f8f9fb }
  </style>
</head>
<body>
  <div class="doc">
    <a class="back" href="../../index.html">â† Terug naar Portal</a>
    <h1>US-203: Token Reductie Onderzoeksrapport</h1>

<p><strong>Datum</strong>: 2025-01-18</p>
<p><strong>Status</strong>: Onderzoek Afgerond</p>
<p><strong>Doel</strong>: Van 7.250 naar 3.000 tokens per prompt</p>

<h2>Executive Summary</h2>

<p>Onderzoek toont aan dat <strong>61% token reductie haalbaar</strong> is door consolidatie van 17 overlappende prompt modules naar 7 geoptimaliseerde modules. De huidige architectuur heeft significante duplicatie in validatieregels en context processing.</p>

<h2>1. Huidige Situatie Analyse</h2>

<h3>Token Distributie</h3>
<pre><code>Totaal: ~7.250 tokens per prompt generatie
â”œâ”€â”€ Validation Rules (45 regels): ~3.800 tokens (52%)
â”œâ”€â”€ Module Overhead (17 modules): ~1.500 tokens (21%)
â”œâ”€â”€ Context &amp; Examples: ~800 tokens (11%)
â”œâ”€â”€ Templates &amp; Structure: ~600 tokens (8%)
â””â”€â”€ Web Augmentation &amp; Misc: ~550 tokens (8%)</code></pre>

<h3>Probleem Identificatie</h3>

<h4>A. Module Proliferatie</h4>
<ul>
<li>**17 separate prompt modules** worden allemaal uitgevoerd</li>
<li>Elke module heeft eigen header, instructies, voorbeelden</li>
<li>Significante overlap tussen modules</li>
</ul>

<h4>B. Specifieke Duplicaties Gevonden</h4>

<p>| Overlappende Modules | Functie Duplicatie | Tokens |</p>
<p>|---------------------|-------------------|---------|</p>
<p>| <code>structure_rules</code> + <code>grammar</code> | Beide doen grammaticale structuur | ~600 |</p>
<p>| <code>integrity_rules</code> + <code>error_prevention</code> | Beide voor kwaliteitscontrole | ~500 |</p>
<p>| <code>context_awareness</code> + <code>con_rules</code> | Beide verwerken context | ~400 |</p>
<p>| <code>output_specification</code> + <code>template</code> | Beide definiÃ«ren output format | ~450 |</p>
<p>| <code>expertise</code> + <code>semantic_categorisation</code> | Beide voor domein kennis | ~350 |</p>
<p>| ARAI + ESS + SAM + VER rules | Kunnen gecombineerd worden | ~1.200 |</p>

<p><strong>Totale duplicatie: ~3.500 tokens (48%)</strong></p>

<h2>2. Gevonden Optimalisatie Mogelijkheden</h2>

<h3>Tier 1: Quick Wins (Week 1) âš¡</h3>
<p><strong>Geschatte besparing: 2.500 tokens</strong></p>

<ol>
<li>**Module Consolidatie**</li>
</ol>
<ul>
<li>  - Van 17 naar 7 modules</li>
<li>  - Elimineert duplicate headers/instructies</li>
<li>  - Besparing: ~1.500 tokens</li>
</ul>

<ol>
<li>**Validatieregel Deduplicatie**</li>
</ol>
<ul>
<li>  - Merge ARAI/ESS/SAM/VER â†’ 1 core module</li>
<li>  - Verwijder overlappende voorbeelden</li>
<li>  - Besparing: ~1.000 tokens</li>
</ul>

<h3>Tier 2: Smart Selection (Week 2) ğŸ¯</h3>
<p><strong>Geschatte besparing: 1.200 tokens</strong></p>

<ol>
<li>**Context-Aware Module Loading**</li>
<pre><code>   # Voorbeeld: Voor "proces" begrippen
   if ontologische_categorie == "proces":
       skip_modules = ["object_rules", "static_validation"]
       load_only = ["process_rules", "activity_patterns"]</code></pre>
</ol>
<ul>
<li>  - Laad alleen relevante modules per begrip type</li>
<li>  - Besparing: ~800 tokens</li>
</ul>

<ol>
<li>**Dynamic Example Selection**</li>
</ol>
<ul>
<li>  - Max 3 relevante voorbeelden ipv alle 15+</li>
<li>  - Semantic similarity matching</li>
<li>  - Besparing: ~400 tokens</li>
</ul>

<h3>Tier 3: Advanced Optimization (Week 3) ğŸš€</h3>
<p><strong>Geschatte besparing: 1.000 tokens</strong></p>

<ol>
<li>**Prompt Compression**</li>
</ol>
<ul>
<li>  - Compacte regel format (Ã©Ã©n-regel instructies)</li>
<li>  - Abbreviaties voor terugkerende patterns</li>
<li>  - Besparing: ~600 tokens</li>
</ul>

<ol>
<li>**Template Caching**</li>
</ol>
<ul>
<li>  - Cache static prompt sections</li>
<li>  - Reuse tussen requests</li>
<li>  - Besparing: ~400 tokens</li>
</ul>

<h2>3. Voorgestelde Nieuwe Module Architectuur</h2>

<h3>Van 17 naar 7 Modules</h3>

<pre><code>HUIDIGE STRUCTUUR (17 modules)          NIEUWE STRUCTUUR (7 modules)
================================         ================================
arai_rules_module                  â”
ess_rules_module                   â”œâ”€â”€â†’  core_validation_module
sam_rules_module                   â”‚
ver_rules_module                   â”˜

structure_rules_module             â”
integrity_rules_module             â”œâ”€â”€â†’  structure_quality_module
grammar_module                     â”˜

context_awareness_module           â”
con_rules_module                   â”œâ”€â”€â†’  context_processing_module
semantic_categorisation_module     â”˜

output_specification_module        â”
template_module                    â”œâ”€â”€â†’  output_format_module
                                  â”˜

definition_task_module             â”
expertise_module                   â”œâ”€â”€â†’  task_expertise_module
                                  â”˜

error_prevention_module            â”
metrics_module                     â”œâ”€â”€â†’  quality_control_module
                                  â”˜

base_module                        â”€â”€â”€â†’  base_module</code></pre>

<h2>4. Implementation Roadmap</h2>

<h3>Phase 1: Foundation (3-4 dagen)</h3>
<ul>
<li>[ ] CreÃ«er nieuwe geconsolideerde module structuur</li>
<li>[ ] Migreer business logic van oude naar nieuwe modules</li>
<li>[ ] Unit tests voor nieuwe modules</li>
</ul>

<h3>Phase 2: Smart Loading (2-3 dagen)</h3>
<ul>
<li>[ ] Implementeer ModuleSelector class</li>
<li>[ ] Context-aware loading logic</li>
<li>[ ] A/B testing framework</li>
</ul>

<h3>Phase 3: Optimization (2-3 dagen)</h3>
<ul>
<li>[ ] Prompt compression utilities</li>
<li>[ ] Template caching layer</li>
<li>[ ] Performance benchmarks</li>
</ul>

<h2>5. Risico's & Mitigatie</h2>

<p>| Risico | Impact | Kans | Mitigatie |</p>
<p>|--------|---------|------|-----------|</p>
<p>| Kwaliteitsverlies door compressie | Hoog | Medium | A/B testing, gradual rollout |</p>
<p>| Regressie in validatie coverage | Hoog | Laag | Comprehensive test suite |</p>
<p>| Complexiteit module selector | Medium | Medium | Start simpel, itereer |</p>

<h2>6. Success Metrics</h2>

<h3>Primary KPIs</h3>
<ul>
<li>âœ… Token count: 7.250 â†’ â‰¤3.000 (-59%)</li>
<li>âœ… API kosten: â‚¬0.15 â†’ â‚¬0.06 per generatie (-60%)</li>
<li>âœ… Response tijd: 5s â†’ <3s (-40%)</li>
</ul>

<h3>Quality Metrics</h3>
<ul>
<li>Validatie pass rate: â‰¥95% behouden</li>
<li>Definitie kwaliteit score: â‰¥4.5/5</li>
<li>Geen toename in error rate</li>
</ul>

<h2>7. Geschatte ROI</h2>

<pre><code>Huidige kosten:
- 1000 definities/maand Ã— â‚¬0.15 = â‚¬150/maand
- Jaarlijks: â‚¬1.800

Na optimalisatie:
- 1000 definities/maand Ã— â‚¬0.06 = â‚¬60/maand
- Jaarlijks: â‚¬720

Besparing:
- â‚¬90/maand
- â‚¬1.080/jaar (60% reductie)
- Break-even: 2 weken development tijd</code></pre>

<h2>8. Aanbevelingen</h2>

<h3>Prioriteit 1: DOEN âœ…</h3>
<ol>
<li>**Start met module consolidatie** - grootste quick win</li>
<li>**Implementeer context-aware loading** - direct 20% besparing</li>
<li>**A/B test framework** opzetten voor quality assurance</li>
</ol>

<h3>Prioriteit 2: OVERWEGEN ğŸ¤”</h3>
<ol>
<li>Dynamic example selection (complexer maar waardevol)</li>
<li>Template caching (performance boost)</li>
</ol>

<h3>Prioriteit 3: LATER ğŸ“…</h3>
<ol>
<li>Advanced compression techniques</li>
<li>Fine-tuning voor edge cases</li>
</ol>

<h2>9. Conclusie</h2>

<p>Het onderzoek toont aan dat <strong>61% token reductie haalbaar is</strong> zonder kwaliteitsverlies. De grootste winst komt van:</p>

<ol>
<li>**Module consolidatie** (17â†’7): -2.000 tokens</li>
<li>**Context-aware loading**: -1.200 tokens</li>
<li>**Smart example selection**: -800 tokens</li>
<li>**Format compression**: -600 tokens</li>
</ol>

<p><strong>Totaal potentieel: 4.600 tokens besparing</strong></p>

<p>Met de voorgestelde aanpak kunnen we van <strong>7.250 naar ~2.650 tokens</strong> gaan, ruim onder het target van 3.000 tokens.</p>

<p>---</p>

<p><strong>Next Steps:</strong></p>
<ol>
<li>Review dit rapport met team</li>
<li>Prioriteer welke optimalisaties eerst</li>
<li>Maak detailed implementation plan</li>
<li>Start met Phase 1 (module consolidatie)</li>
</ol>
  </div>
</body>
</html>