<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>US-421: titel: Database Health Monitoring Dashboard</title>
  <link rel="stylesheet" href="../portal.css" />
  <style>
    .doc { max-width: 900px; margin: 16px auto 48px auto; padding: 0 16px; }
    .doc h1,.doc h2,.doc h3,.doc h4{ color:#223 }
    .doc p{ line-height:1.6; color:#222 }
    .doc a{ color:#1d4ed8; text-decoration: underline; }
    .doc pre{ background:#0b1020; color:#e6edf3; padding:12px; overflow:auto; border-radius:8px }
    .doc code{ background:#f0f2f5; padding:2px 6px; border-radius:4px }
    .back{ display:inline-block; margin:12px 0; padding:6px 10px; border:1px solid #ccd; border-radius:6px; text-decoration:none; color:#223; background:#f8f9fb }
  </style>
</head>
<body>
  <div class="doc">
    <a class="back" href="../../index.html">â† Terug naar Portal</a>
    <p>---</p>
<p>id: US-421</p>
<p>epic: EPIC-007</p>
<p>titel: "US-421: titel: Database Health Monitoring Dashboard"</p>
<p>type: feature</p>
<p>status: proposed</p>
<p>prioriteit: MEDIUM</p>
<p>story_points: 8</p>
<p>sprint: backlog</p>
<p>aangemaakt: 2025-01-29</p>
<p>bijgewerkt: 2025-01-29</p>
<p>owner: database-admin</p>
<p>applies_to: definitie-app@current</p>
<p>canonical: false</p>
<p>last_verified: 2025-01-29</p>
<p>vereisten:</p>
<ul>
<li> - REQ-006</li>
<li> - REQ-007</li>
<li> - REQ-084</li>
<p>toegewezen_aan: development-team</p>
<p>---</p>
</ul>

<h1>US-421: Database Health Monitoring Dashboard</h1>

<p><strong>Epic:</strong> EPIC-007 - Performance & Scaling</p>

<h2>Gebruikersverhaal</h2>

<p><strong>Als een</strong> system administrator</p>
<p><strong>wil ik</strong> real-time database health metrics kunnen monitoren</p>
<p><strong>zodat</strong> ik proactief performance problemen kan detecteren en oplossen</p>

<h2>Probleembeschrijving</h2>

<p>Momenteel zijn er placeholders voor database health checks in <code>ui/components/export_tab.py</code> (regels 773-810) en <code>ui/components/management_tab.py</code> (regels 1162-1222), maar geen werkende implementatie. Dit maakt het onmogelijk om database problemen vroegtijdig te detecteren, wat kan leiden tot performance degradatie of data integriteit issues.</p>

<p>De applicatie heeft monitoring nodig voor:</p>
<ul>
<li>Database grootte en groei trends</li>
<li>Query performance metrics</li>
<li>Index fragmentatie status</li>
<li>Connection pool status</li>
<li>Cache hit rates</li>
</ul>

<h2>Acceptatiecriteria</h2>

<h3>Functionele Criteria</h3>
<ul>
<li>[ ] Real-time database metrics dashboard</li>
<li>[ ] Database size monitoring met trend grafiek</li>
<li>[ ] Query performance monitoring (slow queries > 1s)</li>
<li>[ ] Index health status (fragmentatie percentage)</li>
<li>[ ] Automatic alert thresholds configureerbaar</li>
<li>[ ] Export metrics naar CSV voor analyse</li>
<li>[ ] Historical data retention (30 dagen)</li>
</ul>

<h3>Technische Criteria</h3>
<ul>
<li>[ ] Non-blocking metrics collection</li>
<li>[ ] Maximum 1% overhead op database operations</li>
<li>[ ] Metrics refresh elke 60 seconden</li>
<li>[ ] Async data collection</li>
<li>[ ] Caching van metrics voor performance</li>
</ul>

<h3>UI Criteria</h3>
<ul>
<li>[ ] Dedicated "Health" tab in nieuwe Import/Export & Beheer tab</li>
<li>[ ] Traffic light indicators (groen/geel/rood)</li>
<li>[ ] Trend grafieken voor laatste 24 uur</li>
<li>[ ] Actionable recommendations bij problemen</li>
<li>[ ] One-click export van metrics</li>
</ul>

<h2>Implementatie Details</h2>

<h3>Health Monitoring Service</h3>
<pre><code>class DatabaseHealthMonitor:
    """Monitor database health metrics."""

    async def collect_metrics(self) -&gt; HealthMetrics:
        """Collect current health metrics."""
        return HealthMetrics(
            database_size=self._get_database_size(),
            connection_count=self._get_connection_count(),
            slow_queries=self._get_slow_queries(),
            index_health=self._check_index_fragmentation(),
            cache_stats=self._get_cache_statistics()
        )

    async def analyze_trends(self,
                           timeframe: timedelta) -&gt; TrendAnalysis:
        """Analyze metrics trends."""
        pass

    async def generate_recommendations(self,
                                      metrics: HealthMetrics) -&gt; List[Recommendation]:
        """Generate actionable recommendations."""
        pass

    def set_alert_thresholds(self, config: AlertConfig):
        """Configure alert thresholds."""
        pass</code></pre>

<h3>Metrics Storage</h3>
<pre><code>class MetricsRepository:
    """Store historical metrics data."""

    async def store_metrics(self, metrics: HealthMetrics):
        """Store metrics snapshot."""
        pass

    async def get_historical_metrics(self,
                                    start: datetime,
                                    end: datetime) -&gt; List[HealthMetrics]:
        """Retrieve historical metrics."""
        pass

    async def cleanup_old_metrics(self, retention_days: int = 30):
        """Remove metrics older than retention period."""
        pass</code></pre>

<h3>Alert Thresholds</h3>
<pre><code># config/health_monitoring.yaml
alerts:
  database_size:
    warning: 100MB
    critical: 500MB

  slow_queries:
    warning: 5/min
    critical: 20/min

  index_fragmentation:
    warning: 30%
    critical: 50%

  connection_pool:
    warning: 80%
    critical: 95%</code></pre>

<h2>Definition of Done</h2>

<ul>
<li>[ ] Health monitoring service geÃ¯mplementeerd</li>
<li>[ ] Metrics repository voor historical data</li>
<li>[ ] UI dashboard component</li>
<li>[ ] Alert threshold configuratie</li>
<li>[ ] Automated recommendations engine</li>
<li>[ ] Unit tests (>90% coverage)</li>
<li>[ ] Integration tests met test database</li>
<li>[ ] Performance test (overhead < 1%)</li>
<li>[ ] Documentatie voor administrators</li>
<li>[ ] Monitoring alerts geconfigureerd</li>
</ul>

<h2>Risico's</h2>

<p>| Risico | Impact | Kans | Mitigatie |</p>
<p>|--------|--------|------|-----------|</p>
<p>| Performance overhead | High | Medium | Async collection, caching |</p>
<p>| Storage voor metrics | Medium | Low | Automatic cleanup na 30 dagen |</p>
<p>| False positive alerts | Low | Medium | Configureerbare thresholds |</p>
<p>| Database locks tijdens check | High | Low | Read-only queries, NOWAIT |</p>

<h2>Dependencies</h2>

<ul>
<li>Database repository voor metrics queries</li>
<li>Streamlit caching voor UI performance</li>
<li>APScheduler voor periodic collection</li>
<li>SQLite PRAGMA statements voor health info</li>
</ul>

<h2>Notes</h2>

<ul>
<li>Begin met basis metrics, voeg advanced features later toe</li>
<li>Consider Prometheus/Grafana integratie voor productie</li>
<li>Implementeer eerst read-only monitoring, dan recommendations</li>
<li>Gebruik SQLite specifieke PRAGMA commands voor efficiency</li>
</ul>

<h2>Mockups</h2>

<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¥ Database Health Monitor              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ Overall Health: ğŸŸ¢ Good                â”‚
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Size     â”‚ Queries  â”‚ Index    â”‚    â”‚
â”‚ â”‚ 45.2 MB  â”‚ 12/min   â”‚ 15%      â”‚    â”‚
â”‚ â”‚ ğŸŸ¢        â”‚ ğŸŸ¢       â”‚ ğŸŸ¢       â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                         â”‚
â”‚ ğŸ“ˆ Trends (24h)                        â”‚
â”‚ [Database size graph]                  â”‚
â”‚                                         â”‚
â”‚ âš ï¸ Recommendations:                     â”‚
â”‚ â€¢ None - system healthy                â”‚
â”‚                                         â”‚
â”‚ [ğŸ“¥ Export Metrics] [âš™ï¸ Configure]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
  </div>
</body>
</html>