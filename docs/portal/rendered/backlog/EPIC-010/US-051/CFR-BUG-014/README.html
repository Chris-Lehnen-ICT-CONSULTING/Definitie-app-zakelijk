<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Synoniemen en Antoniemen Generatie Incorrect</title>
  <link rel="stylesheet" href="../portal.css" />
  <style>
    .doc { max-width: 900px; margin: 16px auto 48px auto; padding: 0 16px; }
    .doc h1,.doc h2,.doc h3,.doc h4{ color:#223 }
    .doc p{ line-height:1.6; color:#222 }
    .doc a{ color:#1d4ed8; text-decoration: underline; }
    .doc pre{ background:#0b1020; color:#e6edf3; padding:12px; overflow:auto; border-radius:8px }
    .doc code{ background:#f0f2f5; padding:2px 6px; border-radius:4px }
    .back{ display:inline-block; margin:12px 0; padding:6px 10px; border:1px solid #ccd; border-radius:6px; text-decoration:none; color:#223; background:#f8f9fb }
  </style>
</head>
<body>
  <div class="doc">
    <a class="back" href="../../index.html">‚Üê Terug naar Portal</a>
    <p>---</p>
<p>id: CFR-BUG-014</p>
<p>epic: EPIC-010</p>
<p>titel: Synoniemen en Antoniemen Generatie Incorrect</p>
<p>prioriteit: HOOG</p>
<p>status: RESOLVED</p>
<p>aangemaakt: 2025-09-10</p>
<p>bijgewerkt: 2025-09-11</p>
<p>gevonden_in: v1.0.1</p>
<p>component: voorbeelden_service</p>
<p>---</p>

<h1>CFR-BUG-014: Synoniemen en Antoniemen Generatie Incorrect (OPGELOST)</h1>

<h2>üêõ Bug Beschrijving</h2>

<p>De generatie van synoniemen en antoniemen werkt niet correct volgens de specificaties:</p>
<ul>
<li>**Synoniemen**: Genereert slechts 2 van de 5 vereiste items (met bullets)</li>
<li>**Antoniemen**: Genereert 5 items maar slechts 1 heeft een bullet</li>
</ul>

<h3>Verwacht Gedrag</h3>
<ul>
<li>Synoniemen: 5 items zonder bullets</li>
<li>Antoniemen: 5 items zonder bullets</li>
</ul>

<h3>Actueel Gedrag</h3>
<pre><code>‚ÜîÔ∏è Synoniemen
‚Ä¢ genootschap
‚Ä¢ organisatie

‚ÜîÔ∏è Antoniemen
‚Ä¢ scheiding
splitsing
verdeling
ontbinding
isolatie</code></pre>

<h2>üìä Impact Analyse</h2>

<ul>
<li>**Gebruikersimpact**: HOOG - Juridische professionals vertrouwen op complete synoniemen/antoniemen</li>
<li>**Business Impact**: MEDIUM - Verminderde kwaliteit van gegenereerde definities</li>
<li>**Technisch Risico**: LAAG - Waarschijnlijk een prompt/parsing issue</li>
</ul>

<h2>üîç Root Cause Analyse</h2>

<h3>Mogelijke Oorzaken</h3>
<ol>
<li>**Prompt Module Issue**: De prompts voor synoniemen/antoniemen specificeren mogelijk niet correct het aantal</li>
<li>**Parser Issue**: De response parser handelt bullets/formatting niet correct</li>
<li>**Model Response**: GPT-4 geeft inconsistente formatting terug</li>
<li>**Cache Issue**: Oude gecachte responses met verkeerde formatting</li>
</ol>

<h3>Te Onderzoeken</h3>
<ul>
<li>[ ] Check `src/services/prompts/modules/synoniemen_module.py`</li>
<li>[ ] Check `src/services/prompts/modules/antoniemen_module.py`</li>
<li>[ ] Check `src/voorbeelden/voorbeelden_service.py` parsing logic</li>
<li>[ ] Check `DEFAULT_EXAMPLE_COUNTS` configuratie</li>
<li>[ ] Test met cache disabled</li>
</ul>

<h2>üõ†Ô∏è Reproductie Stappen (historisch)</h2>

<ol>
<li>Start applicatie: `streamlit run src/main.py`</li>
<li>Vul begrip in: "verbinding"</li>
<li>Selecteer context (bijv. "Rechtspraak")</li>
<li>Genereer definitie</li>
<li>Observeer synoniemen/antoniemen sectie</li>
</ol>

<h2>üîß Fix Strategie</h2>

<h3>Fase 1: Diagnose</h3>
<pre><code># Test prompt modules direct
from services.prompts.modules.synoniemen_module import SynoniemenModule
module = SynoniemenModule()
prompt = module.build_prompt("verbinding", {})
print(prompt)  # Check of "EXACT 5" en "zonder bullets" er staat</code></pre>

<h3>Fase 2: Fix Prompts</h3>
<pre><code># In synoniemen_module.py en antoniemen_module.py
SYNONIEMEN_PROMPT = """
Geef EXACT 5 synoniemen voor het begrip '{begrip}'.
- Alleen de woorden, zonder bullets of nummering
- Elk synoniem op een nieuwe regel
- PRECIES 5, niet meer en niet minder
"""</code></pre>

<h3>Fase 3: Fix Parser</h3>
<pre><code># In voorbeelden_service.py
def _parse_synoniemen(self, response: str) -&gt; list[str]:
    lines = response.strip().split('\n')
    # Remove bullets and clean
    cleaned = []
    for line in lines:
        line = line.strip()
        if line.startswith('‚Ä¢') or line.startswith('-'):
            line = line[1:].strip()
        if line:
            cleaned.append(line)
    return cleaned[:5]  # Ensure max 5</code></pre>

<h2>‚úÖ Acceptance Criteria</h2>

<ul>
<li>[ ] Synoniemen: Altijd exact 5 items</li>
<li>[ ] Antoniemen: Altijd exact 5 items</li>
<li>[ ] Geen bullets of andere formatting</li>
<li>[ ] Consistent over meerdere runs</li>
<li>[ ] Unit tests voor parser functies</li>
<li>[ ] Integration test voor complete flow</li>
</ul>

<h2>üìù Test Cases</h2>

<h3>Test Case 1: Basis Generatie</h3>
<pre><code>def test_synoniemen_count():
    result = voorbeelden_service.genereer_synoniemen("verbinding")
    assert len(result) == 5
    assert all(not item.startswith('‚Ä¢') for item in result)</code></pre>

<h3>Test Case 2: Edge Cases</h3>
<pre><code>def test_synoniemen_with_rare_word():
    result = voorbeelden_service.genereer_synoniemen("xenofilie")
    assert len(result) &lt;= 5  # May be less for rare words</code></pre>

<h2>üîó Gerelateerde Issues</h2>

<ul>
<li>EPIC-010: Context Flow Refactoring (parent epic)</li>
<li>US-041: Fix Context Field Mapping (mogelijk gerelateerd)</li>
<li>Previous synoniemen/antoniemen fixes in commit history</li>
</ul>

<h2>üìå Notes</h2>

<ul>
<li>Dit probleem ontstond waarschijnlijk tijdens de EPIC-010 refactoring</li>
<li>De DEFAULT_EXAMPLE_COUNTS config suggereert 5 items maar wordt mogelijk niet correct toegepast</li>
<li>Debug logging in `DEBUG_EXAMPLES=true` mode kan helpen bij diagnose</li>
</ul>

  </div>
</body>
</html>