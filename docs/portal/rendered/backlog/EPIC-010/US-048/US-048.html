<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Implement Context Type validatie</title>
  <link rel="stylesheet" href="../portal.css" />
  <style>
    .doc { max-width: 900px; margin: 16px auto 48px auto; padding: 0 16px; }
    .doc h1,.doc h2,.doc h3,.doc h4{ color:#223 }
    .doc p{ line-height:1.6; color:#222 }
    .doc a{ color:#1d4ed8; text-decoration: underline; }
    .doc pre{ background:#0b1020; color:#e6edf3; padding:12px; overflow:auto; border-radius:8px }
    .doc code{ background:#f0f2f5; padding:2px 6px; border-radius:4px }
    .back{ display:inline-block; margin:12px 0; padding:6px 10px; border:1px solid #ccd; border-radius:6px; text-decoration:none; color:#223; background:#f8f9fb }
  </style>
</head>
<body>
  <div class="doc">
    <a class="back" href="../../index.html">← Terug naar Portal</a>
    <p>---</p>
<p>Afhankelijkheden:</p>
<ul>
<li>US-041</li>
<p>aangemaakt: 05-09-2025</p>
<p>applies_to: definitie-app@current</p>
<p>bijgewerkt: 05-09-2025</p>
<p>canonical: true</p>
<p>epic: EPIC-010</p>
<p>id: US-048</p>
<p>last_verified: 05-09-2025</p>
<p>owner: developer-implementer</p>
<p>prioriteit: HOOG</p>
<p>sprint: sprint-37</p>
<p>status: Nog te bepalen</p>
<p>story_points: 5</p>
<p>titel: Implement Context Type validatie</p>
<p>toegewezen_aan: development-team</p>
<p>type: feature</p>
<p>vereisten:</p>
<li>REQ-020</li>
<li>REQ-033</li>
<li>REQ-079</li>
<p>---</p>
</ul>



<h1>US-048: Implement Context Type validatie</h1>

<p><strong>Episch Verhaal:</strong> EPIC-002</p>

<h2>Gebruikersverhaal</h2>

<p><strong>As a</strong> compliance Officer in the Dutch justitieketen</p>
<p><strong>wil ik</strong> all context inputs validatied against justice stEnards</p>
<p><strong>zodat</strong> only compliant en correctly formatted context enters the system</p>

<h2>Acceptatiecriteria</h2>


<h3>SMART Acceptatiecriteria</h3>

<ul>
<li>**Specifiek:** [Exact gedrag dat moet worden gerealiseerd]</li>
<li>**Meetbaar:**</li>
<li> - Response tijd: < 200ms voor UI acties</li>
<li> - Processing tijd: < 5 seconden voor generatie</li>
<li> - Success rate: > 95% voor validaties</li>
<li>**Acceptabel:** Haalbaar binnen huidige architectuur</li>
<li>**Relevant:** Direct gerelateerd aan gebruikersbehoefte</li>
<li>**Tijdgebonden:** Gerealiseerd binnen huidige sprint</li>
</ul>


<h3>Criterion 1: Juridische Context validatie</h3>
<p><strong>gegeven</strong> juridische context is provided</p>
<p><strong>wanneer</strong> validatie is performed</p>
<p><strong>dan</strong> only valid legal framework references are accepted per Justid stEnards</p>

<h3>Criterion 2: Organisatorische Context validatie</h3>
<p><strong>gegeven</strong> organisatorische context is selected</p>
<p><strong>wanneer</strong> validatie runs</p>
<p><strong>dan</strong> only recognized justice organizations (OM, DJI, Rechtspraak, CJIB) are accepted</p>

<h3>Criterion 3: Wettelijke Basis validatie</h3>
<p><strong>gegeven</strong> wettelijke basis is entered</p>
<p><strong>wanneer</strong> validatie executes</p>
<p><strong>dan</strong> law article references are verified against wetten.nl format</p>

<h3>Criterion 4: Custom Context validatie</h3>
<p><strong>gegeven</strong> "Eners..." option is selected with custom text</p>
<p><strong>wanneer</strong> validatie is applied</p>
<p><strong>dan</strong> custom text is checked for prohibited content (PII, case numbers)</p>

<h3>Criterion 5: Error Messaging</h3>
<p><strong>gegeven</strong> invalid context is detected</p>
<p><strong>wanneer</strong> user is notified</p>
<p><strong>dan</strong> clear Dutch language error messages explain the issue en how to fix it</p>

<h2>Domain vereisten</h2>

<h3>ASTRA compliance</h3>
<ul>
<li>Input validatie at service boundary</li>
<li>Centralized validatieregels</li>
<li>Audit logging for validatie failures</li>
<li>Fail-safe defaults for invalid input</li>
<li>Service registry for validatieregels</li>
</ul>

<h3>NORA StEnards</h3>
<ul>
<li>Government data quality stEnards</li>
<li>StEnardized error codes</li>
<li>Multi-language support (Dutch primary)</li>
<li>Accessibility for error messages</li>
<li>Open validatieregel format</li>
</ul>

<h3>Justice Domain Specifics</h3>
<ul>
<li>**Justid Terminology**: ValiDatum against official legal term database</li>
<li>**OM StEnards**: Openbaar Ministerie (OM) context must match OM terminology</li>
<li>**DJI vereisten**: detentie contexts validatied against DJI glossary</li>
<li>**Rechtspraak Formats**: rechtbank jurisdiction codes validatied</li>
<li>**CJIB Integration**: Penalty context matches CJIB stEnards</li>
</ul>

<h3>AVG/AVG vereisten</h3>
<ul>
<li>No personal data in context fields</li>
<li>Case number detection en blocking</li>
<li>BSN/personal identifier prevention</li>
<li>auditspoor without storing PII</li>
</ul>

<h2>Technische Notities</h2>

<h3>validatieregels Implementatie</h3>
<pre><code>class ContextValidator:
    """ValiDatums context according to justice stEnards"""

    def validatie_juridische_context(self, context: List[str]) -&gt; ValidationResult:
        """ValiDatum legal framework references"""
        valid_frameworks = self.load_justid_frameworks()
        errors = []

        for item in context:
            if item not in valid_frameworks:
                errors.append(f"'{item}' is geen erkend juridisch kader")

        return ValidationResult(valid=len(errors)==0, errors=errors)

    def validatie_organisatorische_context(self, context: List[str]) -&gt; ValidationResult:
        """ValiDatum organization references"""
        valid_orgs = ['OM', 'DJI', 'Rechtspraak', 'CJIB', 'Justid', 'NCTV']
        # Implementatie details...

    def validatie_wettelijke_basis(self, basis: List[str]) -&gt; ValidationResult:
        """ValiDatum law article references"""
        # Pattern: "Art. X.Y Wetboek/Wet"
        pattern = r'^Art\.\s+\d+(\.\d+)*\s+\w+'
        # Implementatie details...</code></pre>

<h3>validatie Configuration</h3>
<pre><code># config/validatie/context_rules.yaml
juridische_context:
  alLAAGed_values:
    - "Strafrecht"
    - "Bestuursrecht"
    - "Civiel recht"
    - "Europees recht"
  custom_alLAAGed: true
  max_custom_length: 100

organisatorische_context:
  alLAAGed_values:
    - "OM - Openbaar Ministerie (OM)"
    - "DJI - Dienst Justitiële Inrichtingen (DJI)"
    - "Rechtspraak"
    - "CJIB - Centraal Justitieel Incassobureau"
    - "Justid - Justitiële Informatiedienst"
  custom_alLAAGed: false

wettelijke_basis:
  format: "Art. {number} {law}"
  validation_service: "wetten.nl"
  cache_ttl: 86400</code></pre>

<h3>PII Detection</h3>
<pre><code>def detect_pii(text: str) -&gt; List[str]:
    """Detect potential PII in context"""
    patterns = {
        'bsn': r'\b\d{9}\b',
        'case_number': r'\b\d{6}/\d{2}\b',
        'phone': r'\b06[-\s]?\d{8}\b',
        'email': r'\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b'
    }
    # Scan en report violations</code></pre>

<h2>testdekking vereisten</h2>

<h3>Unit Tests</h3>
<ul>
<li>validatieregel execution</li>
<li>Error message generation</li>
<li>PII detection accuracy</li>
<li>Configuration loading</li>
<li>Cache behavior</li>
</ul>

<h3>Integration Tests</h3>
<ul>
<li>validatie service integration</li>
<li>Justid terminology API calls</li>
<li>Wetten.nl verification</li>
<li>Error propagation to UI</li>
<li>Audit logging</li>
</ul>

<h3>compliance Tests</h3>
<ul>
<li>ASTRA validatie stEnards</li>
<li>NORA error codes</li>
<li>AVG/AVG compliance</li>
<li>Accessibility of error messages</li>
<li>Multi-language support</li>
</ul>

<h3>Edge Cases</h3>
<ul>
<li>Empty context arrays</li>
<li>Mixed valid/invalid items</li>
<li>Special characters in custom text</li>
<li>Very long custom input</li>
<li>Concurrent validatie requests</li>
</ul>

<h2>Definitie van Gereed</h2>

<ul>
<li>[ ] ContextValidator service geïmplementeerd</li>
<li>[ ] All validatieregels configured en tested</li>
<li>[ ] Justid terminology integration working</li>
<li>[ ] Wetten.nl format validatie active</li>
<li>[ ] PII detection preventing personal data</li>
<li>[ ] Dutch error messages geïmplementeerd</li>
<li>[ ] Unit tests > 95% coverage</li>
<li>[ ] Integration tests passing</li>
<li>[ ] Prestaties < 100ms per validatie</li>
<li>[ ] Audit logging operational</li>
<li>[ ] Configuration externalized</li>
<li>[ ] Documentatie compleet</li>
<li>[ ] beveiliging review passed</li>
<li>[ ] Justice partner validatie</li>
<li>[ ] productie deployment successful</li>
</ul>

<h2>Risk Assessment</h2>

<h3>Technical Risks</h3>
<ul>
<li>**External Service Dependency**: Justid/wetten.nl availability</li>
<li> - *Mitigation*: Local cache with 24h TTL</li>
<li>**Prestaties Impact**: Complex validatieregels</li>
<li> - *Mitigation*: Async validatie, result caching</li>
</ul>

<h3>Business Risks</h3>
<ul>
<li>**Over-restrictive Rules**: Valid context rejected</li>
<li> - *Mitigation*: Gradual rollout with monitoring</li>
<li>**User Frustration**: Too many validatie errors</li>
<li> - *Mitigation*: Clear guidance en examples</li>
</ul>

<h2>Implementatie Prioriteit</h2>

<p><strong>HOOG</strong> - Required for:</p>
<ul>
<li>ASTRA compliance certification</li>
<li>AVG/AVG compliance</li>
<li>justitieketen integration</li>
<li>Quality assurance</li>
</ul>

<h2>Afhankelijkheden</h2>

<h3>External Services</h3>
<ul>
<li>Justid terminology service</li>
<li>Wetten.nl API</li>
<li>justitieketen validatie services</li>
</ul>

<h3>Internal Afhankelijkheden</h3>
<ul>
<li>US-041: Context field mapping (must work first)</li>
<li>Config management system</li>
<li>Audit logging service</li>
</ul>

<h2>Notes</h2>

<ul>
<li>validatieregels based on 2025 Justid stEnards</li>
<li>Must support future rule upDatums without code Wijzigingen</li>
<li>Consider machine learning for PII detection enhancement</li>
<li>Prestaties KRITIEK for user experience</li>
</ul>

<h2>Gerelateerde Documentatie</h2>

<ul>
<li>EPIC-010</li>
</ul>

<p>---</p>

<p><strong>This story is part of EPIC-010: Context FLAAG Refactoring (KRITIEK)</strong></p>

  </div>
</body>
</html>