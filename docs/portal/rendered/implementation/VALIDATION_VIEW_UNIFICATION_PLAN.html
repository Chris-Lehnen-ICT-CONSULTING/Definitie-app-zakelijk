<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Validatie‑weergave Unificatie (V2) — Implementatieplan</title>
  <link rel="stylesheet" href="../portal.css" />
  <style>
    .doc { max-width: 900px; margin: 16px auto 48px auto; padding: 0 16px; }
    .doc h1,.doc h2,.doc h3,.doc h4{ color:#223 }
    .doc p{ line-height:1.6; color:#222 }
    .doc a{ color:#1d4ed8; text-decoration: underline; }
    .doc pre{ background:#0b1020; color:#e6edf3; padding:12px; overflow:auto; border-radius:8px }
    .doc code{ background:#f0f2f5; padding:2px 6px; border-radius:4px }
    .back{ display:inline-block; margin:12px 0; padding:6px 10px; border:1px solid #ccd; border-radius:6px; text-decoration:none; color:#223; background:#f8f9fb }
  </style>
</head>
<body>
  <div class="doc">
    <a class="back" href="../../index.html">← Terug naar Portal</a>
    <p>---</p>
<p>canonical: true</p>
<p>status: draft</p>
<p>owner: ui</p>
<p>last_verified: 2025-09-22</p>
<p>applies_to: definitie-app@current</p>
<p>links:</p>
<p>  stories:</p>
<ul>
<li>   - US-236</li>
<p>  epics:</p>
<li>   - EPIC-004</li>
<p>---</p>
</ul>

<h1>Validatie‑weergave Unificatie (V2) — Implementatieplan</h1>

<p>Doel: één gedeelde validatie‑renderer voor de drie tabbladen (Definitie‑generatie, Bewerk, Expert Review) met exact dezelfde inhoud en indeling als de bewezen Generatie‑weergave: Gate‑status, toggle voor details, gedetailleerde lijst met kleur/iconen en inline uitleg per regel.</p>

<h2>Scope & Niet‑Scope</h2>
<ul>
<li>In scope:</li>
<li> - Extractie van bestaande renderlogica uit Generatie naar `ui/components/validation_view.py`.</li>
<li> - Aansluiten van Generatie/ Edit/ Expert op de gedeelde renderer.</li>
<li> - Behoud huidige teksten, iconen, sorting, expanders en gate‑status.</li>
<li>Niet in scope:</li>
<li> - Wijzigingen aan validatie‑engine of V2‑contract.</li>
<li> - Aanpassing van gate‑policy of -berekening.</li>
<li> - Styling buiten de validatieblokjes.</li>
</ul>

<h2>API van de gedeelde renderer</h2>
<pre><code>render_validation_detailed_list(
  validation_result: dict,
  *,
  key_prefix: str,
  show_toggle: bool = True,
  gate: dict | None = None,
) -&gt; None</code></pre>
<ul>
<li>`validation_result`: V2 dict (overall_score, violations, passed_rules, …)</li>
<li>`key_prefix`: sessiesleutelprefix ("gen", "edit_{id}", "review_{id}")</li>
<li>`show_toggle`: of de details toggelbaar zijn (true voor consistentie)</li>
<li>`gate`: optionele gate‑dict (Generatie gebruikt dit al; Edit/Expert meestal `None`)</li>
</ul>

<h2>Stappenplan</h2>
<p>1) Extractie (zonder gedrag te wijzigen)</p>
<ul>
<li>  - Verplaats helpers uit Generatie:</li>
<li>    - `_rule_sort_key`, `_extract_rule_id_from_line`, `_build_rule_hint_markdown`</li>
<li>  - Implementeer `render_validation_detailed_list(...)` met de huidige bouw van regels/expanders.</li>
<li>  - Toon optioneel gate‑status bovenaan indien `gate` is opgegeven.</li>
<p>2) Generatie aansluiten</p>
<li>  - Vervang de huidige inline list‑render door `render_validation_detailed_list(..., key_prefix='gen', show_toggle=True, gate=gate)`.</li>
<li>  - Behoud: gate‑melding, toggle, sessiekeys, exacte teksten en expanders.</li>
<p>3) Edit aansluiten</p>
<li>  - Roep de renderer op met `key_prefix=f'edit_{id}'`, `show_toggle=True`, `gate=None`.</li>
<li>  - Header “Kwaliteitstoetsing” erboven tonen.</li>
<p>4) Expert aansluitingen</p>
<li>  - Bij Re‑validate: sla V2‑resultaat in session (`review_{id}`) en render full‑width onder de knoppen via de renderer.</li>
<p>5) Verificatie</p>
<li>  - Generatie vóór/na vergelijking (visueel 1:1; desnoods screenshot/regtest).</li>
<li>  - Edit/Expert tonen exact dezelfde regels en uitleg als Generatie.</li>
<p>6) Documentatie</p>
<li>  - Update US‑236 status naar “In uitvoering/Done” zodra afgerond.</li>
<li>  - Korte notitie in UI‑handleiding: ‘Validatieblok is overal uniform’.</li>
</ul>

<h2>Risico’s & Mitigatie</h2>
<ul>
<li>Visuele regressie → Gefaseerde aansluiting, 1:1 verificatie in Generatie vóór/na.</li>
<li>Statebotsingen → uniek `key_prefix` per context.</li>
<li>Performance → gebruik bestaande caching/paging; toggle uit bij default om flood te voorkomen.</li>
</ul>

<h2>Rollbackplan</h2>
<ul>
<li>Per tab kunnen we snel terug naar vorige inline render indien nodig (oude codepad behouden tot definitieve verificatie).</li>
</ul>

<h2>Definition of Done</h2>
<ul>
<li>Eén renderer, drie tabbladen consistent, geen informatieverlies, gate behouden, toggle identiek, verificaties OK.</li>
</ul>


  </div>
</body>
</html>