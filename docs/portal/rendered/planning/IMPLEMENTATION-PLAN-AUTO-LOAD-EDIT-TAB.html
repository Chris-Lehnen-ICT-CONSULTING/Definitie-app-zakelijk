<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Implementatieplan: Auto-load Gegenereerde Definitie in Bewerk Tab</title>
  <link rel="stylesheet" href="../portal.css" />
  <style>
    .doc { max-width: 900px; margin: 16px auto 48px auto; padding: 0 16px; }
    .doc h1,.doc h2,.doc h3,.doc h4{ color:#223 }
    .doc p{ line-height:1.6; color:#222 }
    .doc a{ color:#1d4ed8; text-decoration: underline; }
    .doc pre{ background:#0b1020; color:#e6edf3; padding:12px; overflow:auto; border-radius:8px }
    .doc code{ background:#f0f2f5; padding:2px 6px; border-radius:4px }
    .back{ display:inline-block; margin:12px 0; padding:6px 10px; border:1px solid #ccd; border-radius:6px; text-decoration:none; color:#223; background:#f8f9fb }
  </style>
</head>
<body>
  <div class="doc">
    <a class="back" href="../../index.html">‚Üê Terug naar Portal</a>
    <h1>Implementatieplan: Auto-load Gegenereerde Definitie in Bewerk Tab</h1>

<h2>Management Samenvatting</h2>
<p>Wanneer een gebruiker een definitie genereert en daarna naar het "Bewerk" tabblad navigeert, moet de zojuist gegenereerde definitie automatisch geladen worden zonder handmatig zoeken.</p>

<h2>Huidige Situatie</h2>

<h3>‚úÖ Wat werkt al:</h3>
<ol>
<li>**Edit tab heeft auto-load logica** (`definition_edit_tab.py` regel 54-66)</li>
<li>**SessionStateManager wordt correct gebruikt** overal in de code</li>
<li>**Tab navigatie werkt** via radio buttons</li>
<li>**Placeholder bug is al opgelost** (ik zie dat `_edit_definition` nu werkt)</li>
</ol>

<h3>‚ùå Wat ontbreekt:</h3>
<ol>
<li>**Session state keys niet gedefinieerd** in `DEFAULT_VALUES`</li>
<li>**Geen koppeling** tussen gegenereerde definitie ID en edit tab</li>
<li>**Geen auto-load trigger** bij tab switch</li>
</ol>

<h2>Voorgestelde Oplossing</h2>

<h3>Fase 1: Session State Keys Toevoegen (MINIMAAL - 2 minuten)</h3>

<p><strong>Bestand:</strong> <code>src/ui/session_state.py</code></p>
<p><strong>Locatie:</strong> In <code>DEFAULT_VALUES</code> dictionary (na regel 51)</p>

<pre><code># External sources manager
"external_source_manager": None,
# Edit tab state variables - NIEUW
"editing_definition_id": None,      # ID van definitie om te bewerken
"editing_definition": None,          # Definitie object
"edit_session": None,               # Edit sessie metadata
"edit_search_results": None,        # Zoekresultaten
"last_auto_save": None,             # Auto-save timestamp</code></pre>

<p><strong>Waarom:</strong> Zonder deze keys krijgt de edit tab <code>None</code> terug en kan niet detecteren dat er een definitie moet worden geladen.</p>

<h3>Fase 2: Koppeling bij Generatie (ESSENTIEEL - 5 minuten)</h3>

<p><strong>Bestand:</strong> <code>src/ui/tabbed_interface.py</code></p>
<p><strong>Locatie:</strong> Na regel 947 (waar <code>last_generation_result</code> wordt gezet)</p>

<pre><code># Store results voor display in tabs
SessionStateManager.set_value(
    "last_generation_result",
    { ... bestaande code ... }
)

# NIEUW: Koppel gegenereerde definitie aan edit tab
if saved_record and hasattr(saved_record, 'id'):
    SessionStateManager.set_value("editing_definition_id", saved_record.id)
    # Optional: Auto-navigate to edit tab
    # SessionStateManager.set_value("active_tab", "edit")</code></pre>

<p><strong>Waarom:</strong> Dit zorgt ervoor dat de edit tab weet welke definitie geladen moet worden.</p>

<h3>Fase 3: Verbeter Auto-load Detectie (OPTIONEEL - 10 minuten)</h3>

<p><strong>Bestand:</strong> <code>src/ui/components/definition_edit_tab.py</code></p>
<p><strong>Locatie:</strong> In <code>render()</code> method, voor regel 55</p>

<pre><code>def render(self):
    """Render de edit tab interface."""
    st.markdown("## ‚úèÔ∏è Definitie Editor")
    st.markdown("Bewerk definities met een rijke text editor...")

    # NIEUW: Check voor recent gegenereerde definitie
    last_result = SessionStateManager.get_value('last_generation_result')
    if last_result and last_result.get('saved_record'):
        saved_record = last_result['saved_record']
        if hasattr(saved_record, 'id'):
            current_edit_id = SessionStateManager.get_value('editing_definition_id')
            # Als er geen definitie geladen is, of het is een andere
            if not current_edit_id or current_edit_id != saved_record.id:
                SessionStateManager.set_value('editing_definition_id', saved_record.id)
                st.info(f"üìù Laatst gegenereerde definitie geladen (ID: {saved_record.id})")

    # Bestaande auto-start logica...</code></pre>

<h2>Implementatie Volgorde</h2>

<h3>Stap 1: Test Huidige Situatie</h3>
<pre><code># Start applicatie
make dev

# Test:
1. Genereer een definitie
2. Klik op Bewerk tab
3. Observeer: Definitie wordt NIET automatisch geladen</code></pre>

<h3>Stap 2: Implementeer Fase 1 (Session State Keys)</h3>
<ol>
<li>Open `src/ui/session_state.py`</li>
<li>Voeg de 5 nieuwe keys toe aan `DEFAULT_VALUES`</li>
<li>Herstart applicatie</li>
</ol>

<h3>Stap 3: Test Fase 1</h3>
<pre><code># Test of keys nu bestaan:
1. Genereer een definitie
2. Klik op Bewerk tab
3. Check developer tools voor errors (zouden weg moeten zijn)</code></pre>

<h3>Stap 4: Implementeer Fase 2 (Koppeling)</h3>
<ol>
<li>Open `src/ui/tabbed_interface.py`</li>
<li>Voeg koppeling code toe na regel 947</li>
<li>Herstart applicatie</li>
</ol>

<h3>Stap 5: Eindtest</h3>
<pre><code># Complete flow test:
1. Genereer definitie voor "authenticatie"
2. Klik op Bewerk tab
3. Definitie moet automatisch geladen zijn!</code></pre>

<h2>Risico's en Mitigaties</h2>

<h3>Risico 1: Overschrijven bestaand werk</h3>
<p><strong>Mitigatie:</strong> Check of er al een <code>editing_definition_id</code> is voordat auto-load gebeurt</p>

<h3>Risico 2: Race conditions</h3>
<p><strong>Mitigatie:</strong> Gebruik consequent SessionStateManager, geen directe st.session_state</p>

<h3>Risico 3: Memory leaks</h3>
<p><strong>Mitigatie:</strong> Clear oude <code>last_generation_result</code> na succesvolle load</p>

<h2>Alternatieve Aanpakken</h2>

<h3>Optie A: Query Parameters (Streamlit Native)</h3>
<pre><code># In generator tab:
st.query_params["edit_id"] = saved_record.id

# In edit tab:
if edit_id := st.query_params.get("edit_id"):
    load_definition(edit_id)</code></pre>
<p><strong>Pro:</strong> Bookmarkable URLs</p>
<p><strong>Con:</strong> Meer complexiteit</p>

<h3>Optie B: Event System</h3>
<pre><code># Publisher-Subscriber pattern
SessionStateManager.publish_event("definition_generated", {
    "id": saved_record.id
})</code></pre>
<p><strong>Pro:</strong> Losjes gekoppeld</p>
<p><strong>Con:</strong> Over-engineering voor dit probleem</p>

<h2>Aanbeveling</h2>

<p>‚úÖ <strong>Implementeer Fase 1 + 2</strong> (7 minuten werk)</p>
<ul>
<li>Lost het probleem direct op</li>
<li>Minimale code wijzigingen</li>
<li>Geen breaking changes</li>
<li>Makkelijk te testen</li>
</ul>

<p>‚è∏Ô∏è <strong>Wacht met Fase 3</strong></p>
<ul>
<li>Eerst zien of Fase 1+2 voldoende is</li>
<li>Fase 3 kan altijd later toegevoegd worden</li>
</ul>

<h2>Test Checklist</h2>

<ul>
<li>[ ] Genereer definitie ‚Üí Bewerk tab ‚Üí Auto-load werkt</li>
<li>[ ] Bestaande edit sessie wordt niet overschreven</li>
<li>[ ] Handmatige zoeken werkt nog steeds</li>
<li>[ ] Geen errors in console</li>
<li>[ ] Performance blijft goed</li>
</ul>

<h2>Code Review Vragen</h2>

<ol>
<li>Zijn de session state key namen duidelijk?</li>
<li>Is de koppeling logica op de juiste plek?</li>
<li>Moeten we auto-navigatie toevoegen of niet?</li>
<li>Zijn er edge cases die we missen?</li>
</ol>

<p>---</p>
<p><em>Document aangemaakt: 2025-09-22</em></p>
<p><em>Geschatte implementatietijd: 7-17 minuten</em></p>
<p><em>Risico niveau: LAAG</em></p>
  </div>
</body>
</html>