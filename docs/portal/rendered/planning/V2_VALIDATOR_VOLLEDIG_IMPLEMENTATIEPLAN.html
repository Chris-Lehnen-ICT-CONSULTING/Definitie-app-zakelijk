<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>V2 Validator Verbeterplan (JSON‑Centrisch) — Review Versie</title>
  <link rel="stylesheet" href="../portal.css" />
  <style>
    .doc { max-width: 900px; margin: 16px auto 48px auto; padding: 0 16px; }
    .doc h1,.doc h2,.doc h3,.doc h4{ color:#223 }
    .doc p{ line-height:1.6; color:#222 }
    .doc a{ color:#1d4ed8; text-decoration: underline; }
    .doc pre{ background:#0b1020; color:#e6edf3; padding:12px; overflow:auto; border-radius:8px }
    .doc code{ background:#f0f2f5; padding:2px 6px; border-radius:4px }
    .back{ display:inline-block; margin:12px 0; padding:6px 10px; border:1px solid #ccd; border-radius:6px; text-decoration:none; color:#223; background:#f8f9fb }
  </style>
</head>
<body>
  <div class="doc">
    <a class="back" href="../../index.html">← Terug naar Portal</a>
    <h1>V2 Validator Verbeterplan (JSON‑Centrisch) — Review Versie</h1>

<h2>Management Samenvatting</h2>

<p>Doel: V2‑validatie (ModularValidationService) inhoudelijk verbeteren met acceptatiegates, echte categorie‑scores en regelpariteit — zonder legacy .py‑regelmodules aan te roepen. Regels worden JSON‑leidend geëvalueerd, met kleine V2‑hooks waar nodig. UI blijft backwards‑compatibel.</p>

<p>Kernacties (op volgorde):</p>
<p>1) Acceptance gates + severity‑mapping</p>
<p>2) Echte category‑compliance berekenen</p>
<p>3) Pariteit port (JSON + V2‑hooks; additional_patterns centraal)</p>
<p>4) Violation‑metadata (optioneel/compatibel)</p>
<p>5) Pass‑uitleg voor JSON‑regels (UI‑heuristiek)</p>
<p>6) Micro‑performance tweaks</p>
<p>7) Legacy‑opschoning na pariteit</p>

<h2>Guiding Principles</h2>
<ul>
<li>JSON‑leidend: regels via ToetsregelManager en generieke evaluator.</li>
<li>Geen legacy calls: geen dynamische aanroep van `src/toetsregels/regels/*.py`.</li>
<li>Compatibele UI: nieuwe velden zijn optioneel; bestaande rendering blijft werken.</li>
</ul>

<h2>Fase 1 — Acceptance Gates + Severity (Dag 1)</h2>
<ul>
<li>Gates: `critical==0` ∧ `overall≥T_overall` ∧ `category≥T_cat`; thresholds via config/policy.</li>
<li>Severity: map JSON `aanbeveling/prioriteit` → critical/high/medium/low; toepassen als multipliers of gewichten.</li>
<li>Output: `is_acceptable` blijft, `acceptance_gate` (optioneel) met verklaring.</li>
</ul>

<h2>Fase 2 — Category‑Compliance (Dag 1–2)</h2>
<ul>
<li>Mapping: ESS/VAL→juridisch; STR/INT→structuur; CON/SAM→samenhang; ARAI/VER→taal.</li>
<li>Bereken gewogen gemiddelden per categorie uit rule_scores en gebruik in gates.</li>
</ul>

<h2>Fase 3 — Pariteit Port (Dag 2–3)</h2>
<ul>
<li>Additional patterns: centraal in `src/validation/additional_patterns.py` (uitgebreid waar nodig).</li>
<li>V2‑hooks: kleine regel‑specifieke checks (zoals ESS‑02, SAM‑02, SAM‑04).</li>
<li>Declaratief uitbreiden van JSON (required/forbidden patterns) voor ontbrekende signalen.</li>
<li>Volgorde: ARAI → STR → CON/SAM → VER.</li>
</ul>

<h2>Fase 4 — Violation‑Metadata (Dag 3)</h2>
<ul>
<li>Optionele velden: `detected_pattern`, `position`, `type` (forbidden_pattern/…); `rule_name`.</li>
<li>UI: geen wijziging vereist; velden zijn optioneel.</li>
</ul>

<h2>Fase 5 — Pass‑Uitleg JSON (Dag 3)</h2>
<ul>
<li>UI‑heuristiek uitbreiden: “waarom geslaagd” voor JSON‑regels o.b.v. drempels/afwezigheid patronen.</li>
</ul>

<h2>Fase 6 — Micro‑performance (Dag 4)</h2>
<ul>
<li>Early break bij harde fails; limiet op regex‑hits per regel; caching behouden.</li>
</ul>

<h2>Fase 7 — Legacy‑Opschoning (na pariteit)</h2>
<ul>
<li>Voorwaarden: goldens/gates groen; functionaliteit gedekt via JSON/V2‑hooks.</li>
<li>Acties: verwijder legacy .py‑regelmodules en `validation/definitie_validator.py` (of markeer deprecated → remove); update tests/docs.</li>
</ul>

<h2>Succescriteria & Verificatie</h2>
<ul>
<li>Gates: deterministisch; severity consistent.</li>
<li>Category‑scores: verschillen bij passende inputs en gebruikt in acceptatie.</li>
<li>Pariteit: goldens per cluster (ARAI/STR/CON/SAM/VER) met JSON‑voorbeelden groen.</li>
<li>UI: geen breuk; optionele metadata zichtbaar waar aanwezig.</li>
</ul>

<h2>Risico’s & Mitigatie</h2>
<ul>
<li>Score verschuift door multipliers → drempels config; tune‑pass op corpus.</li>
<li>Regex vals‑positief → additional_patterns beperkt/traceerbaar; goldens per regel.</li>
<li>Mapping‑fouten → centrale mapping + tests per prefix.</li>
</ul>

<h2>Tijdlijn (indicatief)</h2>
<ul>
<li>Dag 1: Gates + severity; tests.</li>
<li>Dag 1–2: Category scoring; tests.</li>
<li>Dag 2–3: Pariteit port (JSON + hooks) met goldens.</li>
<li>Dag 3: Metadata/pass‑uitleg JSON; tests.</li>
<li>Dag 4: Micro‑perf; docs bijwerken; voorbereiding legacy clean‑up.</li>
</ul>

<h2>Deliverables</h2>
<ul>
<li>Code: aanpassingen in `src/services/validation/modular_validation_service.py`, uitbreiding `src/validation/additional_patterns.py`, kleine UI‑heuristiek.</li>
<li>Tests: goldens per cluster; unit voor gates/severity/category.</li>
<li>Docs: bijgewerkt migratieplan/README/CLAUDE.</li>
</ul>

<h2>Review Checklist</h2>
<p>1) Sluit plan aan bij EPIC‑002 migratierichtlijn (geen legacy calls)?</p>
<p>2) Zijn gates en category‑scores concreet en testbaar beschreven?</p>
<p>3) Zijn pariteit‑stappen JSON‑centrisch en beheersbaar (patterns/hooks)?</p>
<p>4) Beperken we risico’s (opt. metadata, compatibele UI)?</p>

<h2>Beslissing</h2>
<ul>
<li>[ ] Goedgekeurd — Start met Fase 1 (Gates + Severity)</li>
<li>[ ] Aanpassingen nodig — Zie opmerkingen</li>
</ul>

<p>Document status: Review — Datum: 2025‑09‑22 — Versie: 2.0</p>

  </div>
</body>
</html>