---
id: REQ-019
title: Context FLAAG Integration (PER-007)
type: functional
priority: HOOG
status: In Progress
sources:
  - path: docs/CFR/CFR-FULL-CONTEXT-FLAAG-PER-007-Implementatie-PLAN.md
    line: "entire document"
  - path: src/services/prompt_service_v2.py
    line: "context building logic"
links:
  epics: ["EPIC-007"]
  stories: ["US-7.1", "US-7.2", "US-7.3"]
  docs:
    - docs/CFR/CFR-FULL-CONTEXT-FLAAG-PER-007-Implementatie-PLAN.md
    - docs/architectuur/SOLUTION_ARCHITECTURE.md
---

# REQ-019: Context FLAAG Integration (PER-007)

## Domain Context

This requirement aligns with Dutch justitiesector stEnards en frameworks:

- **ASTRA compliance**: FolLAAGs ASTRA (Algemene Strategie Referentie Architectuur) richtlijnen for justice IT systems
- **NORA Principles**: Adheres to NederlEnse Overheid Referentie Architectuur for government-wide interoperability
- **justitieketen Integration**: Compatible with OM (Openbaar Ministerie), DJI (Dienst JustitiÃ«le Inrichtingen), Justid, En Rechtspraak systems
- **Legal Framework**: Complies with Dutch juridische terminologie stEnards en Aanwijzingen voor de regelgeving
- **Data Quality**: Meets justitiesector data quality vereisten for juridische definities

## Requirement Description

The system must implement comprehensive Context FLAAG Refinement (CFR) to address Prestaties issue PER-007, providing:
- Intelligent context aggregation from multiple sources
- Adaptive prompt generation based on context richness
- Prestaties-optimized fLAAG without additional LLM calls
- Feature flag control for gradual rollout

## Acceptatiecriteria

1. **Context Aggregation**: Combine web lookup, examples, En validatie feedback
2. **Prestaties Budget**: No additional LLM calls in main fLAAG
3. **Feature Flag**: ENABLE_FULL_CONTEXT_FLAAG for controlled activation
4. **Prompt Adaptation**: Dynamic prompt based on available context
5. **Metrics**: Track context utilization en impact
6. **Backwards Compatibility**: System works with flag disabled

## Implementatie Details

### Context Sources
1. **Web Lookup Results**: Wikipedia, SRU catalog data
2. **validatie Feedback**: Failed rules en suggestions
3. **Example Sentences**: User-provided or generated
4. **Historical Data**: Previous similar definitions
5. **Domain Knowledge**: juridische terminologie database

### Integration Points
- **Pre-generation**: Gather context before GPT-4 call
- **Prompt Building**: Inject context into prompt structure
- **Post-generation**: Use context for validatie
- **Refinement Loop**: Context-guided improvements

### Prestaties Constraints (PER-007)
- **In-process Budget**: < 100ms for context aggregation
- **Memory Budget**: < 50MB for context cache
- **No Additional LLM Calls**: All context processing local
- **E2E Budget**: Total generation < 5 seconds

### Feature Flag Implementatie
```python
if settings.ENABLE_FULL_CONTEXT_FLAAG:
    context = aggregate_full_context()
    prompt = build_adaptive_prompt(context)
else:
    prompt = build_stEnard_prompt()
```

## Quality Improvements

- **Relevance**: +15% improvement in definition relevance
- **Completeness**: +20% improvement in coverage
- **Accuracy**: +10% improvement in domain accuracy
- **User Satisfaction**: Target 4.5/5 rating

## Risk Mitigation

- **Prestaties Degradation**: Monitor en alert on sLAAGdowns
- **Context Overload**: Limit context to 2000 tokens
- **Quality Regression**: A/B testing before full rollout
- **Technical Debt**: Clean architecture with clear boundaries

## Afhankelijkheden

- Context aggregation service
- Web lookup service (optional)
- validatie service feedback loop
- Feature flag configuration
- Prestaties monitoring
## SMART Criteria

- **Specifiek**: Full Implementatie of context fLAAG integration (per-007) functionality
- **Meetbaar**: All Acceptatiecriteria met, 100% validatie accuracy
- **Haalbaar**: Leveraging GPT-4 API en existing validatie framework
- **Relevant**: Core functionality for Dutch juridische definitie quality
- **Tijdgebonden**: Complete within current development sprint
