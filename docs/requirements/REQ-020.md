---
id: REQ-020
title: Validation Orchestrator V2
type: functional
priority: high
status: Done
sources:
  - path: src/services/validation_orchestrator_v2.py
    line: "ValidationOrchestratorV2 class"
  - path: docs/architectuur/validation_orchestrator_v2.md
    line: "entire document"
links:
  epics: ["EPIC-003"]
  stories: ["US-3.1", "US-3.2", "US-3.3"]
  docs:
    - docs/architectuur/validation_orchestrator_v2.md
    - docs/testing/validation_orchestrator_testplan.md
---

# REQ-020: Validation Orchestrator V2

## Domain Context

This requirement aligns with Dutch justice sector standards and frameworks:

- **ASTRA Compliance**: Follows ASTRA (Algemene Strategie Referentie Architectuur) guidelines for justice IT systems
- **NORA Principles**: Adheres to Nederlandse Overheid Referentie Architectuur for government-wide interoperability
- **Justice Chain Integration**: Compatible with OM (Openbaar Ministerie), DJI (Dienst JustitiÃ«le Inrichtingen), Justid, and Rechtspraak systems
- **Legal Framework**: Complies with Dutch legal terminology standards and Aanwijzingen voor de regelgeving
- **Data Quality**: Meets justice sector data quality requirements for legal definitions

## Requirement Description

The system must provide a modern, efficient validation orchestration service that:
- Coordinates execution of all 45 validation rules
- Implements parallel processing for performance
- Provides detailed feedback and suggestions
- Supports rule prioritization and filtering
- Enables incremental validation updates

## Acceptance Criteria

1. **Rule Coordination**: Execute all 45 rules in correct order
2. **Parallel Processing**: Run independent rules concurrently
3. **Performance**: Complete validation < 1 second
4. **Feedback Quality**: Specific, actionable feedback per rule
5. **Filtering**: Support category and priority-based filtering
6. **Caching**: Cache results for unchanged definitions
7. **Extensibility**: Easy addition of new rules

## Implementation Details

### Architecture Components
- **ValidationOrchestratorV2**: Main coordination service
- **ModularValidationService**: Rule execution engine
- **RuleRegistry**: Dynamic rule loading and management
- **ResultAggregator**: Combine and prioritize results
- **CacheManager**: Result caching layer

### Execution Flow
1. Load applicable rules based on context
2. Group rules by dependencies
3. Execute independent groups in parallel
4. Aggregate results with priority weighting
5. Generate improvement suggestions
6. Cache results with TTL

### Rule Management
```python
# Rule categories with parallel execution
RULE_GROUPS = {
    'independent': ['ARAI', 'ESS', 'STR'],  # Can run parallel
    'dependent': ['CON', 'SAM'],            # Sequential
    'verification': ['VER', 'INT']          # Final phase
}
```

### Performance Optimizations
- Thread pool for parallel execution (4-8 threads)
- Rule result caching (5-minute TTL)
- Lazy loading of rule implementations
- Short-circuit on critical failures
- Batch processing for multiple definitions

## Quality Metrics

- **Coverage**: 100% of rules executable
- **Performance**: P95 < 1 second
- **Accuracy**: 99% correct rule application
- **Availability**: 99.9% uptime
- **Scalability**: Handle 100 concurrent validations

## Error Handling

- **Rule Failures**: Graceful degradation, continue with other rules
- **Timeout**: Individual rule timeout of 100ms
- **Memory**: Circuit breaker at 100MB usage
- **Dependencies**: Fallback to basic validation if orchestrator fails

## Integration Points

- **Definition Generator**: Post-generation validation
- **UI Feedback**: Real-time validation updates
- **Export Service**: Include validation results
- **Monitoring**: Metrics and alerting integration

## Migration Strategy

- Feature flag for V1 vs V2 orchestrator
- Parallel run for comparison
- Gradual rollout by user segment
- Rollback capability maintained

## Dependencies

- Python 3.11+ for async support
- ThreadPoolExecutor for parallelization
- Redis/In-memory cache for results
- Validation rule implementations
- Monitoring infrastructure
## SMART Criteria

- **Specific**: Full implementation of validation orchestrator v2 functionality
- **Measurable**: All acceptance criteria met, 100% validation accuracy
- **Achievable**: Leveraging GPT-4 API and existing validation framework
- **Relevant**: Core functionality for Dutch legal definition quality
- **Time-bound**: Complete within current development sprint
