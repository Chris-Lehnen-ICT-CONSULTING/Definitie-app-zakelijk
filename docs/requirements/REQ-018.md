---
id: REQ-018
title: Core Definition Generation
type: functional
priority: high
status: Done
sources:
  - path: src/services/unified_definition_generator.py
    line: "UnifiedDefinitionGenerator class"
  - path: src/services/ai_service_v2.py
    line: "generate_with_validation method"
links:
  epics: ["EPIC-001"]
  stories: ["US-1.1", "US-1.2", "US-1.3"]
  docs:
    - docs/architectuur/SOLUTION_ARCHITECTURE.md
    - docs/architectuur/validation_orchestrator_v2.md
---

# REQ-018: Core Definition Generation

## Domain Context

This requirement aligns with Dutch justice sector standards and frameworks:

- **ASTRA Compliance**: Follows ASTRA (Algemene Strategie Referentie Architectuur) guidelines for justice IT systems
- **NORA Principles**: Adheres to Nederlandse Overheid Referentie Architectuur for government-wide interoperability
- **Justice Chain Integration**: Compatible with OM (Openbaar Ministerie), DJI (Dienst JustitiÃ«le Inrichtingen), Justid, and Rechtspraak systems
- **Legal Framework**: Complies with Dutch legal terminology standards and Aanwijzingen voor de regelgeving
- **Data Quality**: Meets justice sector data quality requirements for legal definitions

## Requirement Description

The system must provide core functionality to generate high-quality Dutch legal definitions using GPT-4, including:
- Input processing and validation
- Context-aware prompt construction
- GPT-4 API integration with retry logic
- Response parsing and formatting
- Quality assurance checks

## Acceptance Criteria

1. **Input Handling**: Accept legal terms with optional context
2. **Prompt Generation**: Build structured prompts with context and examples
3. **API Integration**: Reliable GPT-4 communication with error handling
4. **Response Quality**: Generated definitions meet legal standards
5. **Performance**: Generation completes within 5 seconds
6. **Formatting**: Output follows standardized definition format

## Implementation Details

### Components
- **UnifiedDefinitionGenerator**: Main orchestration service
- **AIServiceV2**: GPT-4 API wrapper with retry logic
- **PromptServiceV2**: Modular prompt builder
- **ResponseParser**: Extract and format definition from GPT response

### Process Flow
1. Receive term and optional context
2. Build structured prompt with templates
3. Call GPT-4 with appropriate parameters
4. Parse and validate response
5. Format definition according to standards
6. Return definition with metadata

### GPT-4 Configuration
- Model: gpt-4-turbo-preview or gpt-4
- Temperature: 0.3 for consistency
- Max tokens: 2000 for comprehensive definitions
- System prompt: Legal definition expert role

## Quality Requirements

- **Accuracy**: 95% accuracy on legal terminology
- **Completeness**: All essential elements present
- **Consistency**: Uniform style and formatting
- **Clarity**: Clear, unambiguous language
- **Legal Validity**: Compliant with Dutch legal standards

## Error Handling

- API timeout: Retry with exponential backoff
- Invalid response: Fallback to simplified prompt
- Rate limiting: Queue management
- Network errors: Graceful degradation

## Dependencies

- OpenAI GPT-4 API access
- Valid API key configuration
- Network connectivity
- Prompt templates in config/
## SMART Criteria

- **Specific**: Full implementation of core definition generation functionality
- **Measurable**: All acceptance criteria met, 100% validation accuracy
- **Achievable**: Leveraging GPT-4 API and existing validation framework
- **Relevant**: Core functionality for Dutch legal definition quality
- **Time-bound**: Complete within current development sprint
