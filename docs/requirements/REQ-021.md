---
id: REQ-021
title: Web Lookup Integration
type: functional
priority: medium
status: Done
sources:
  - path: src/services/modern_web_lookup_service.py
    line: "ModernWebLookupService class"
  - path: config/web_lookup_defaults.yaml
    line: "entire configuration"
links:
  epics: ["EPIC-004"]
  stories: ["US-4.1", "US-4.2"]
  docs:
    - docs/technisch/web_lookup_config.md
    - docs/architectuur/SOLUTION_ARCHITECTURE.md
---

# REQ-021: Web Lookup Integration

## Domain Context

This requirement aligns with Dutch justice sector standards and frameworks:

- **ASTRA Compliance**: Follows ASTRA (Algemene Strategie Referentie Architectuur) guidelines for justice IT systems
- **NORA Principles**: Adheres to Nederlandse Overheid Referentie Architectuur for government-wide interoperability
- **Justice Chain Integration**: Compatible with OM (Openbaar Ministerie), DJI (Dienst JustitiÃ«le Inrichtingen), Justid, and Rechtspraak systems
- **Legal Framework**: Complies with Dutch legal terminology standards and Aanwijzingen voor de regelgeving
- **Data Quality**: Meets justice sector data quality requirements for legal definitions

## Requirement Description

The system must integrate external web sources to enrich context for definition generation:
- Wikipedia API for general knowledge
- SRU protocol for library catalog data
- Configurable provider weights and priorities
- Fallback mechanisms for unavailable sources
- Result caching and deduplication

## Acceptance Criteria

1. **Wikipedia Integration**: Search and retrieve relevant articles
2. **SRU Integration**: Query library catalogs for legal sources
3. **Provider Management**: Configurable weights (0.0-1.0)
4. **Error Handling**: Graceful degradation when sources unavailable
5. **Performance**: Lookup completes within 2 seconds
6. **Caching**: Cache results for 15 minutes
7. **Relevance**: Filter irrelevant results

## Implementation Details

### Provider Configuration
```yaml
providers:
  wikipedia:
    enabled: true
    weight: 0.7
    timeout: 3
    max_results: 3

  sru:
    enabled: true
    weight: 1.0
    timeout: 5
    max_results: 5
    endpoint: "https://jsru.kb.nl/sru"
```

### Service Architecture
- **ModernWebLookupService**: Main coordination
- **WikipediaProvider**: Wikipedia API wrapper
- **SRUProvider**: SRU protocol implementation
- **ResultRanker**: Score and rank results
- **CacheManager**: LRU cache for results

### Lookup Flow
1. Parse search query from term
2. Query providers in parallel
3. Apply timeout constraints
4. Rank results by relevance and weight
5. Deduplicate similar content
6. Cache successful results
7. Return enriched context

### Wikipedia Integration
- Use Wikipedia API v2
- Search in Dutch (nl) primarily
- Fallback to English for Latin terms
- Extract summary and key sections
- Follow redirects automatically

### SRU Integration
- Query legal and academic sources
- Support Dublin Core metadata
- Filter by publication date and type
- Prioritize authoritative sources
- Handle MARC records

## Performance Requirements

- **Latency**: P95 < 2 seconds
- **Throughput**: 100 requests/minute
- **Cache Hit Rate**: > 60%
- **Availability**: Degrade gracefully, never block

## Quality Metrics

- **Relevance**: 80% of results relevant
- **Coverage**: Find context for 70% of terms
- **Accuracy**: 95% correct metadata
- **Freshness**: Update cache every 15 minutes

## Error Scenarios

1. **Provider Timeout**: Return partial results
2. **Network Error**: Use cached results if available
3. **API Limit**: Implement exponential backoff
4. **Invalid Response**: Log and skip provider
5. **No Results**: Return empty context gracefully

## Security Considerations

- Sanitize search queries
- Validate API responses
- Rate limit outgoing requests
- Use HTTPS for all connections
- No storage of sensitive data

## Dependencies

- requests library for HTTP
- wikipedia-api package
- SRU client library
- Redis or in-memory cache
- Network connectivity
