# Architectural Debt Visualization: The Three-Layer Problem

## The Problem in One Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PROMPT GENERATION SYSTEM                              â”‚
â”‚                           (10,508 tokens)                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ LAYER 1: STATIC MODULES (OLDEST - ~2024)                            â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ GrammarModule.py                                                     â”‚  â”‚
â”‚  â”‚ OutputSpecificationModule.py                                         â”‚  â”‚
â”‚  â”‚ SemanticCategorisationModule.py                                      â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ Content: HARDCODED RULES                                             â”‚  â”‚
â”‚  â”‚ Example: "ğŸ”¸ Enkelvoud als standaard"                                â”‚  â”‚
â”‚  â”‚          "- Gebruik enkelvoud tenzij..."                             â”‚  â”‚
â”‚  â”‚ Tokens: ~1,200                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                             â”‚
â”‚                        NOT DEPRECATED                                      â”‚
â”‚                              â†“                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ LAYER 2: JSON DATA FILES (MIDDLE - ~2024)                           â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ config/toetsregels/regels/ARAI.json                                  â”‚  â”‚
â”‚  â”‚ config/toetsregels/regels/VER.json                                   â”‚  â”‚
â”‚  â”‚ config/toetsregels/regels/ESS.json                                   â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ Content: STRUCTURED DATA                                             â”‚  â”‚
â”‚  â”‚ {                                                                    â”‚  â”‚
â”‚  â”‚   "VER_01": {                                                        â”‚  â”‚
â”‚  â”‚     "naam": "Gebruik enkelvoud",                                     â”‚  â”‚
â”‚  â”‚     "uitleg": "Gebruik enkelvoud tenzij...",                         â”‚  â”‚
â”‚  â”‚     "toetsvraag": "Is de definitie..."                               â”‚  â”‚
â”‚  â”‚   }                                                                  â”‚  â”‚
â”‚  â”‚ }                                                                    â”‚  â”‚
â”‚  â”‚ Cached by: RuleCache (singleton)                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                             â”‚
â”‚                        NO SYNC MECHANISM                                   â”‚
â”‚                              â†“                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ LAYER 3: JSON MODULE (NEWEST - 2025)                                â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ json_based_rules_module.py                                           â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ def execute():                                                       â”‚  â”‚
â”‚  â”‚   rules = manager.get_all_regels()  # Load from JSON files          â”‚  â”‚
â”‚  â”‚   for rule_key, rule_data in rules:                                  â”‚  â”‚
â”‚  â”‚     instruction = instruction_map.get(rule_key)  # DEF-126!         â”‚  â”‚
â”‚  â”‚     if instruction:                                                  â”‚  â”‚
â”‚  â”‚       output += f"Instructie: {instruction}"                         â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚ Content: DYNAMIC GENERATION                                          â”‚  â”‚
â”‚  â”‚ Example: "ğŸ”¹ VER-01 - Gebruik enkelvoud"                             â”‚  â”‚
â”‚  â”‚          "- Instructie: Gebruik enkelvoud, tenzij..."                â”‚  â”‚
â”‚  â”‚ Tokens: ~2,400                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ RESULT: ALL THREE LAYERS EMIT TO FINAL PROMPT                       â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ Overlap: ~1,630 tokens (15.5%)                                       â”‚  â”‚
â”‚  â”‚ Example:                                                             â”‚  â”‚
â”‚  â”‚   Line 27-31 (GrammarModule):     "Enkelvoud als standaard..."      â”‚  â”‚
â”‚  â”‚   Line 293 (JSONBasedRulesModule): "VER-01 - Gebruik enkelvoud..."  â”‚  â”‚
â”‚  â”‚   ğŸ‘‰ SAME CONTENT, DIFFERENT FORMAT                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Timeline: How We Got Here

```
2024-01-XX: LAYER 1 CREATED
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Static modules with hardcoded rules â”‚
â”‚ Everything in Python code           â”‚
â”‚ No data separation                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
              â†“ ADD JSON FILES (Layer 2)
              â†“
2024-XX-XX: LAYER 2 CREATED
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     âš ï¸ MISTAKE: Didn't remove
â”‚ JSON files with rule data           â”‚     duplicate content from
â”‚ RuleCache for performance           â”‚     Layer 1 modules!
â”‚ Layer 1 STILL ACTIVE âŒ             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
              â†“ ADD JSON MODULE (Layer 3)
              â†“
2025-XX-XX: LAYER 3 CREATED (DEF-156)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     âš ï¸ MISTAKE: Didn't deprecate
â”‚ JSONBasedRulesModule consolidates   â”‚     Layer 1 static modules OR
â”‚ 5 duplicate modules into 1 generic  â”‚     coordinate with Layer 2!
â”‚ Loads from Layer 2 (JSON files)     â”‚
â”‚ Layer 1 + 2 STILL ACTIVE âŒ         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
              â†“ TRANSFORM INSTRUCTIONS (DEF-126)
              â†“
2025-11-20: LAYER 3 TRANSFORMED
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     âš ï¸ FINAL MISTAKE: Only
â”‚ instruction_map added to Layer 3    â”‚     updated Layer 3, ignored
â”‚ 46/46 rules now have instructions   â”‚     Layer 1 & 2 completely!
â”‚ Layer 1 + 2 STILL EMIT OLD FORMATâŒ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
              â†“
           NOW: 3 LAYERS, 15.5% DUPLICATION
```

---

## The DEF-126 Scope Gap

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DEF-126 ACTUAL SCOPE (What was changed)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚ âœ… File: json_based_rules_module.py                             â”‚
â”‚ âœ… Lines: 255-312 (instruction_map dictionary)                  â”‚
â”‚ âœ… Impact: 46 rules transformed from "Toetsvraag:" to           â”‚
â”‚           "Instructie:" format                                   â”‚
â”‚ âœ… Result: 100% instruction coverage in JSON MODULE ONLY        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†‘
              â”‚ SCOPE BOUNDARY
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DEF-126 MISSED SCOPE (What should have been changed)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚ âŒ File: grammar_module.py                                       â”‚
â”‚    Problem: Still emits VER-01/02/03 equivalent content         â”‚
â”‚    Action needed: Remove overlap, defer to JSON module          â”‚
â”‚                                                                  â”‚
â”‚ âŒ File: output_specification_module.py                          â”‚
â”‚    Problem: Still emits STR rule equivalents                    â”‚
â”‚    Action needed: Remove overlap, defer to JSON module          â”‚
â”‚                                                                  â”‚
â”‚ âŒ File: semantic_categorisation_module.py                       â”‚
â”‚    Problem: Still emits ESS-02 equivalent content               â”‚
â”‚    Action needed: Remove overlap, defer to JSON module          â”‚
â”‚                                                                  â”‚
â”‚ âŒ All JSON files: config/toetsregels/regels/*.json              â”‚
â”‚    Problem: Still have "toetsvraag" field format                â”‚
â”‚    Action needed: Add "instructie" field for consistency        â”‚
â”‚                                                                  â”‚
â”‚ âŒ Documentation: No architecture doc updated                    â”‚
â”‚    Problem: No guidance on which module owns which content      â”‚
â”‚    Action needed: Create PROMPT_SYSTEM_ARCHITECTURE.md          â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Duplication Evidence: Side-by-Side Comparison

### Example 1: Enkelvoud (Singular Form)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 1: GrammarModule             â”‚ LAYER 3: JSONBasedRulesModule      â”‚
â”‚ (lines 27-31 in prompt.txt)        â”‚ (lines 293-294 in prompt.txt)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”¸ **Enkelvoud als standaard**     â”‚ ğŸ”¹ **VER-01 - Gebruik enkelvoud**  â”‚
â”‚ - Gebruik enkelvoud tenzij het     â”‚ - **Instructie:** Gebruik          â”‚
â”‚   begrip specifiek een meervoud    â”‚   enkelvoud, tenzij het begrip     â”‚
â”‚   aanduidt                         â”‚   een plurale-tantum is            â”‚
â”‚ - Bij twijfel: gebruik enkelvoud   â”‚   (alleen meervoud bestaat)        â”‚
â”‚   âœ… proces (niet: processen)      â”‚                                    â”‚
â”‚   âœ… maatregel (niet: maatregelen) â”‚                                    â”‚
â”‚                                    â”‚                                    â”‚
â”‚ Format: STATIC (hardcoded)         â”‚ Format: DYNAMIC (from JSON)        â”‚
â”‚ Tokens: ~80                        â”‚ Tokens: ~60                        â”‚
â”‚ Owner: grammar_module.py           â”‚ Owner: json_based_rules_module.py  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
              SEMANTIC OVERLAP: ~90%
              TOKEN WASTE: ~70 tokens
```

### Example 2: Containerbegrippen (Container Terms)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 1: OutputSpecificationModule â”‚ LAYER 3: JSONBasedRulesModule      â”‚
â”‚ (implied in output format section) â”‚ (lines 119-125 in prompt.txt)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ (No explicit rule, but examples    â”‚ ğŸ”¹ **ARAI-02 - Vermijd vage        â”‚
â”‚  implicitly teach this)            â”‚    containerbegrippen**            â”‚
â”‚                                    â”‚ - De definitie mag geen            â”‚
â”‚ Example patterns show:             â”‚   containerbegrippen bevatten die  â”‚
â”‚ - "proces dat..."                  â”‚   op zichzelf weinig verklarende   â”‚
â”‚ - "maatregel die..."               â”‚   waarde hebben                    â”‚
â”‚   (teaching by example)            â”‚ - Toetsvraag: Bevat de definitie   â”‚
â”‚                                    â”‚   containerbegrippen zonder        â”‚
â”‚                                    â”‚   verdere concretisering?          â”‚
â”‚                                    â”‚   âœ… proces dat gegevens verzamelt â”‚
â”‚ Format: IMPLICIT                   â”‚   âŒ proces ter ondersteuning      â”‚
â”‚ Tokens: ~40 (in examples)          â”‚                                    â”‚
â”‚                                    â”‚ Format: EXPLICIT RULE              â”‚
â”‚                                    â”‚ Tokens: ~120                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
              SEMANTIC OVERLAP: ~70%
              TOKEN WASTE: ~100 tokens (better to have ONE clear rule)
```

---

## Token Budget Breakdown: Where the Waste Is

```
CURRENT PROMPT: 10,508 tokens
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ COMPONENT                    â”‚ TOKENS â”‚ % TOTAL   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… UNIQUE CONTENT                                  â”‚
â”‚   - Role/Expertise           â”‚    150 â”‚   1.4%    â”‚
â”‚   - Context instructions     â”‚    180 â”‚   1.7%    â”‚
â”‚   - Ontological guidance     â”‚    520 â”‚   4.9%    â”‚
â”‚   - Templates                â”‚    340 â”‚   3.2%    â”‚
â”‚   - Output format            â”‚    280 â”‚   2.7%    â”‚
â”‚   - Final instructions       â”‚    120 â”‚   1.1%    â”‚
â”‚   Subtotal                   â”‚  1,590 â”‚  15.1%    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸŸ¡ VALUABLE BUT OPTIMIZABLE                        â”‚
â”‚   - Grammar guidance         â”‚    420 â”‚   4.0%    â”‚
â”‚   - Rule examples (Layer 3)  â”‚  2,400 â”‚  22.8%    â”‚
â”‚   - Semantic categorization  â”‚    680 â”‚   6.5%    â”‚
â”‚   Subtotal                   â”‚  3,500 â”‚  33.3%    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”´ PURE WASTE (DUPLICATION)                        â”‚
â”‚   - Layer 1 static rules     â”‚  1,200 â”‚  11.4%    â”‚
â”‚   - Validation "Toetsvraag:" â”‚  1,170 â”‚  11.1%    â”‚
â”‚   - Overlapping examples     â”‚    800 â”‚   7.6%    â”‚
â”‚   - Metadata/metrics         â”‚    640 â”‚   6.1%    â”‚
â”‚   Subtotal                   â”‚  3,810 â”‚  36.3%    â”‚ â† TARGET FOR REMOVAL
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸŸ¢ ACCEPTABLE OVERHEAD                             â”‚
â”‚   - Section headers/emoji    â”‚    280 â”‚   2.7%    â”‚
â”‚   - Formatting/whitespace    â”‚    328 â”‚   3.1%    â”‚
â”‚   - Structural markers       â”‚    200 â”‚   1.9%    â”‚
â”‚   Subtotal                   â”‚    808 â”‚   7.7%    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âš ï¸  UNDER INVESTIGATION                            â”‚
â”‚   - Context examples         â”‚    800 â”‚   7.6%    â”‚
â”‚   Subtotal                   â”‚    800 â”‚   7.6%    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TOTAL                        â”‚ 10,508 â”‚ 100.0%    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

POST-CLEANUP TARGET:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Remove ğŸ”´ PURE WASTE        â”‚ -3,810 â”‚  36.3%    â”‚
â”‚ Optimize ğŸŸ¡ OPTIMIZABLE     â”‚   -900 â”‚   8.6%    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ NEW TOTAL                   â”‚  5,798 â”‚  55.2%    â”‚ â† 44.8% REDUCTION
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## The Coordination Gap: What Was Missing

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WHAT DEF-126 NEEDED (but didn't have)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚ âŒ ARCHITECTURAL REVIEW                                         â”‚
â”‚    Question: "What OTHER modules emit validation content?"     â”‚
â”‚    Answer: GrammarModule, OutputSpecificationModule, etc.      â”‚
â”‚    Action: Flag for update in DEF-126 scope                    â”‚
â”‚                                                                 â”‚
â”‚ âŒ CROSS-LAYER IMPACT ANALYSIS                                  â”‚
â”‚    Question: "Does this change affect JSON files?"             â”‚
â”‚    Answer: Yes, should add 'instructie' field to JSON          â”‚
â”‚    Action: Update JSON schema + data files                     â”‚
â”‚                                                                 â”‚
â”‚ âŒ DUPLICATION DETECTION                                        â”‚
â”‚    Question: "Is this content duplicated elsewhere?"           â”‚
â”‚    Answer: Yes, VER-01 overlaps with GrammarModule             â”‚
â”‚    Action: Remove duplicate from static module                 â”‚
â”‚                                                                 â”‚
â”‚ âŒ OWNERSHIP DOCUMENTATION                                      â”‚
â”‚    Question: "Which module owns VER rules now?"                â”‚
â”‚    Answer: JSONBasedRulesModule (not GrammarModule)            â”‚
â”‚    Action: Document in architecture guide                      â”‚
â”‚                                                                 â”‚
â”‚ âŒ POST-CHANGE VALIDATION                                       â”‚
â”‚    Question: "Did we achieve full cleanup?"                    â”‚
â”‚    Answer: No test to verify this                              â”‚
â”‚    Action: Add integration test for duplication                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Recommended Fix: The Three-Phase Cleanup

```
PHASE 1: STOP THE BLEEDING (2 hours)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Add pre-commit hook: check_prompt_tokens.py                 â”‚
â”‚    - Hard limit: 8,000 tokens                                   â”‚
â”‚    - Fail build if exceeded                                     â”‚
â”‚                                                                 â”‚
â”‚ 2. Add integration test: test_no_cross_layer_duplication()     â”‚
â”‚    - Parse output from all modules                              â”‚
â”‚    - Detect semantic overlap                                    â”‚
â”‚    - Fail if >5% duplication found                              â”‚
â”‚                                                                 â”‚
â”‚ 3. Create: docs/architectuur/PROMPT_SYSTEM_ARCHITECTURE.md     â”‚
â”‚    - Document layer ownership                                   â”‚
â”‚    - Define deprecation policy                                  â”‚
â”‚    - Specify coordination process                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
PHASE 2: HEAL THE WOUNDS (4 hours)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Remove static duplication (1,200 tokens)                     â”‚
â”‚    - GrammarModule: remove VER rule equivalents                 â”‚
â”‚    - OutputSpecificationModule: remove STR overlaps             â”‚
â”‚    - SemanticCategorisationModule: remove ESS duplicates        â”‚
â”‚                                                                 â”‚
â”‚ 2. Remove validation content (1,170 tokens)                     â”‚
â”‚    - All "Toetsvraag:" sections â†’ kept only in JSON module      â”‚
â”‚    - Validation examples â†’ move to separate validation doc      â”‚
â”‚                                                                 â”‚
â”‚ 3. Update JSON files (consistency)                              â”‚
â”‚    - Add "instructie" field to all 46 rules                     â”‚
â”‚    - Deprecate "toetsvraag" field (mark as legacy)              â”‚
â”‚                                                                 â”‚
â”‚ 4. Verify with tests                                            â”‚
â”‚    - Run integration test suite                                 â”‚
â”‚    - Verify <8,000 token budget                                 â”‚
â”‚    - Check no regression in definition quality                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
PHASE 3: PREVENT RECURRENCE (future)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Implement layer responsibility contract (Protocol)          â”‚
â”‚    - Define get_content_domain() for each module                â”‚
â”‚    - Enforce non-overlap via contract validation                â”‚
â”‚                                                                 â”‚
â”‚ 2. Set up nightly health checks                                 â”‚
â”‚    - Automated token budget monitoring                          â”‚
â”‚    - Duplication detection alerts                               â”‚
â”‚    - Coverage gap detection                                     â”‚
â”‚                                                                 â”‚
â”‚ 3. Create auto-generated architecture diagrams                  â”‚
â”‚    - Parse module code to generate visual layer diagram         â”‚
â”‚    - Update on every commit (prevent doc drift)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Success Metrics

```
BEFORE CLEANUP:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Total Tokens:      10,508               â”‚
â”‚ Duplication:        3,810 (36.3%)       â”‚
â”‚ Static Modules:     3 with duplicates   â”‚
â”‚ JSON Module:        1 (complete)        â”‚
â”‚ Tests:              0 for duplication   â”‚
â”‚ Documentation:      None for ownership  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AFTER CLEANUP:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Total Tokens:       5,798 (45% â†“)      â”‚
â”‚ Duplication:          290 (<5%)         â”‚
â”‚ Static Modules:     3 refactored        â”‚
â”‚ JSON Module:        1 (single source)   â”‚
â”‚ Tests:              3 integration tests â”‚
â”‚ Documentation:      Full architecture   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

QUALITY ASSURANCE:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Pre-commit: Token budget enforced    â”‚
â”‚ âœ… CI/CD: Duplication detection         â”‚
â”‚ âœ… Nightly: Health check monitoring     â”‚
â”‚ âœ… Docs: Architecture up-to-date        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

*Generated by Debug Specialist*
*Companion to: DEF-171-root-cause-analysis.md*
