{
  "meta": {
    "timestamp": "2025-11-20T14:30:00Z",
    "analysis_type": "HERZIENE Bounded Analysis (60 min)",
    "prompt_file": "_Definitie_Generatie_prompt-23.txt",
    "baseline_metrics": {
      "lines": 536,
      "characters": 33298,
      "tokens_reported": 8325,
      "tokens_actual_measured": 10508,
      "note": "Discrepancy suggests baseline may have been from different version or encoding"
    },
    "new_context": {
      "def_126_completed": true,
      "commits": [
        "f020d970: 12 high-priority rules (ARAI, ESS, VER, CON, DUP) ‚Üí validation‚Üíinstruction",
        "458ad6fe: 16 medium-priority rules (INT, SAM) ‚Üí validation‚Üíinstruction",
        "ee0ff56f: 8 low-priority rules (STR) ‚Üí validation‚Üíinstruction"
      ],
      "transformation_coverage": "46/46 rules have Instructie: format in json_based_rules_module.py",
      "validation_module_separated": true,
      "ontology_provided_by_ui": true
    }
  },

  "constraints": {
    "constraint_1_no_validation": {
      "description": "Remove ALL validation-specific content",
      "rationale": "Separate validation module runs POST-generation",
      "actions": [
        "Remove all 'Toetsvraag:' sections (39 occurrences found)",
        "Remove validation-specific examples",
        "Retain ONLY generation-guiding instructions"
      ]
    },
    "constraint_2_no_ontology_determination": {
      "description": "Remove ontology category determination instructions",
      "rationale": "UI provides ontological category; LLM does not determine it",
      "actions": [
        "Remove 'Je **moet** √©√©n van de vier categorie√´n expliciet maken' (line 71)",
        "Remove 'BELANGRIJK: Bepaal de juiste categorie op basis van het BEGRIP zelf' (line 83-87)",
        "RETAIN: Kick-off terms PER category (category already known)"
      ]
    },
    "constraint_3_def_126_impact": {
      "description": "Leverage DEF-126 completion - JSON module is now single source",
      "rationale": "46 rules with Instructie: format in json_based_rules_module.py",
      "observations": [
        "JSON files do NOT have 'instructie' field in JSON data",
        "json_based_rules_module.py has HARDCODED instruction_map (310 lines)",
        "Prompt STILL has inline 'Instructie:' sections for SOME rules",
        "DUPLICATION between prompt's inline instructions and JSON module output"
      ]
    }
  },

  "mece_decomposition": {
    "description": "Mutually Exclusive, Collectively Exhaustive categorization of prompt issues WITH new constraints",
    "categories": [
      {
        "category": "VALIDATION_CONTENT",
        "definition": "Content specifically for post-generation validation (should be removed)",
        "instances": {
          "toetsvragen": {
            "count": 39,
            "location": "Scattered across ARAI, ESS, STR, INT, SAM, VER, CON sections",
            "lines": "156-433 (multiple)",
            "token_estimate": 780,
            "examples": [
              "- Toetsvraag: Bevat de definitie algemene containertermen...",
              "- Toetsvraag: Begint de definitie met een breder begrip..."
            ]
          },
          "validation_pattern_examples": {
            "count": 78,
            "description": "Good/bad examples specifically for VALIDATION (not generation)",
            "token_estimate": 390,
            "note": "Some examples guide generation, some are purely for validation checking"
          }
        },
        "total_tokens_removable": 1170,
        "percentage_of_prompt": "11.1%"
      },
      {
        "category": "ONTOLOGY_DETERMINATION",
        "definition": "Instructions for LLM to DETERMINE ontological category (obsolete - UI provides it)",
        "instances": {
          "ess_02_determination_block": {
            "location": "Lines 70-88",
            "content": "Je **moet** √©√©n van de vier categorie√´n... BELANGRIJK: Bepaal de juiste categorie...",
            "token_estimate": 340,
            "removal_action": "Remove determination instructions, KEEP kick-off patterns"
          },
          "category_detection_hints": {
            "location": "Lines 83-87",
            "content": "Eindigt op -ING of -TIE..., Is het een gevolg/uitkomst...",
            "token_estimate": 120,
            "removal_action": "Complete removal - UI knows category"
          }
        },
        "total_tokens_removable": 460,
        "percentage_of_prompt": "4.4%"
      },
      {
        "category": "DUPLICATION_WITH_JSON_MODULE",
        "definition": "Content duplicated between static prompt and dynamic JSON module output",
        "instances": {
          "inline_instructie_sections": {
            "description": "Prompt has 'Instructie:' for some rules, JSON module adds ALL",
            "affected_rules": [
              "ARAI-01 (lines 137-146): has Instructie in prompt + JSON module adds it",
              "ARAI-04 (lines 176-181): has Instructie in prompt + JSON module adds it",
              "ARAI-06 (lines 197-202): has Instructie in prompt + JSON module adds it",
              "ESS-01 (lines 228-232): has Instructie in prompt + JSON module adds it",
              "ESS-02 (line 235): has Instructie in prompt + JSON module adds it",
              "STR-01 (lines 267-271): has Instructie in prompt + JSON module adds it",
              "INT-01 (lines 328-330): has Instructie in prompt + JSON module adds it",
              "VER-01 (lines 450-454): has Instructie in prompt + JSON module adds it",
              "CON-01 (lines 207-213): has Instructie in prompt + JSON module adds it"
            ],
            "count": 9,
            "token_per_instruction_avg": 45,
            "total_tokens_removable": 405,
            "rationale": "JSON module already outputs these as Instructie: - no need in static prompt"
          },
          "rule_examples_duplication": {
            "description": "Both prompt and JSON module show good/bad examples",
            "token_estimate": 1200,
            "decision": "KEEP in JSON module (dynamic), REMOVE from static prompt",
            "exception": "Keep OUTPUT FORMAT examples (not rule-specific)"
          }
        },
        "total_tokens_removable": 1605,
        "percentage_of_prompt": "15.3%"
      },
      {
        "category": "STRUCTURAL_REDUNDANCY",
        "definition": "Repetitive explanations, overlapping sections, verbose phrasing",
        "instances": {
          "type_category_overexplanation": {
            "location": "Lines 89-118",
            "description": "30-line explanation of TYPE category with multiple warnings",
            "token_estimate": 520,
            "reduction_potential": 300,
            "rationale": "Can condense to 8-10 lines focusing on kick-off pattern"
          },
          "grammar_rules_verbosity": {
            "location": "Lines 23-61",
            "description": "39 lines of grammar rules with excessive examples",
            "token_estimate": 680,
            "reduction_potential": 280,
            "rationale": "Consolidate into 20 lines with fewer examples"
          },
          "definition_templates_redundancy": {
            "location": "Lines 119-133",
            "description": "Multiple template formats that overlap",
            "token_estimate": 240,
            "reduction_potential": 120,
            "rationale": "Single unified template sufficient"
          },
          "quality_metrics_section": {
            "location": "Lines 471-497",
            "description": "27 lines of quality metrics (character limits, complexity)",
            "token_estimate": 460,
            "reduction_potential": 380,
            "rationale": "These are POST-generation validation metrics, not generation guidance"
          }
        },
        "total_tokens_removable": 1080,
        "percentage_of_prompt": "10.3%"
      },
      {
        "category": "METADATA_NOISE",
        "definition": "Non-instructional metadata that doesn't guide generation",
        "instances": {
          "quality_metrics": {
            "location": "Lines 471-497",
            "token_estimate": 460,
            "removal_action": "Complete removal - belongs in validation"
          },
          "prompt_metadata": {
            "location": "Lines 519-537",
            "description": "Timestamp, builder version, metadata",
            "token_estimate": 180,
            "removal_action": "Move to system message or remove"
          }
        },
        "total_tokens_removable": 640,
        "percentage_of_prompt": "6.1%"
      }
    ],
    "total_removable_tokens": 4955,
    "total_removable_percentage": "47.2%",
    "post_reduction_estimate": 5553
  },

  "pareto_analysis": {
    "principle": "80/20 rule - 20% of changes yield 80% of improvement",
    "top_opportunities": [
      {
        "rank": 1,
        "action": "Remove ALL 'Toetsvraag:' sections (39 occurrences)",
        "category": "VALIDATION_CONTENT",
        "token_reduction": 1170,
        "effort": "LOW - simple grep/delete operation",
        "impact": "HIGH - eliminates validation/generation confusion",
        "percentage": "23.6% of total removable tokens"
      },
      {
        "rank": 2,
        "action": "Remove rule examples from static prompt (keep in JSON module only)",
        "category": "DUPLICATION_WITH_JSON_MODULE",
        "token_reduction": 1200,
        "effort": "MEDIUM - need to distinguish OUTPUT FORMAT examples from rule examples",
        "impact": "HIGH - eliminates duplication, single source of truth",
        "percentage": "24.2% of total removable tokens"
      },
      {
        "rank": 3,
        "action": "Remove quality metrics section (lines 471-497)",
        "category": "STRUCTURAL_REDUNDANCY + METADATA_NOISE",
        "token_reduction": 840,
        "effort": "LOW - simple block deletion",
        "impact": "MEDIUM - reduces noise, belongs in validation",
        "percentage": "16.9% of total removable tokens"
      },
      {
        "rank": 4,
        "action": "Remove ontology determination instructions (keep kick-off patterns)",
        "category": "ONTOLOGY_DETERMINATION",
        "token_reduction": 460,
        "effort": "LOW - targeted deletion with surgical retention",
        "impact": "HIGH - aligns with UI providing category",
        "percentage": "9.3% of total removable tokens"
      },
      {
        "rank": 5,
        "action": "Compress TYPE category explanation (30 lines ‚Üí 10 lines)",
        "category": "STRUCTURAL_REDUNDANCY",
        "token_reduction": 300,
        "effort": "MEDIUM - requires rewriting, not just deletion",
        "impact": "MEDIUM - improves clarity without losing information",
        "percentage": "6.1% of total removable tokens"
      }
    ],
    "pareto_subset": {
      "top_3_actions_tokens": 3210,
      "percentage_of_total_removable": "64.8%",
      "percentage_of_total_prompt": "30.6%",
      "recommendation": "Focus on Top 3 for maximum impact/effort ratio"
    }
  },

  "five_whys_root_cause": {
    "problem_statement": "After DEF-126 completion, prompt is still 10,508 tokens with validation content and duplication",
    "why_1": {
      "question": "Why does the prompt still contain validation content after DEF-126?",
      "answer": "DEF-126 transformed rules in JSON module but did NOT clean up the static prompt template",
      "evidence": "39 'Toetsvraag:' sections still present in prompt (lines 156-433)"
    },
    "why_2": {
      "question": "Why did DEF-126 not clean up the static prompt template?",
      "answer": "DEF-126 scope was limited to json_based_rules_module.py transformation (validation‚Üíinstruction in code), not prompt template cleanup",
      "evidence": "3 commits focused on _get_instruction_for_rule() method, no prompt file changes"
    },
    "why_3": {
      "question": "Why was the static prompt template excluded from DEF-126 scope?",
      "answer": "DEF-126 assumed the prompt template was separately maintained and would be updated by a different epic/task",
      "evidence": "No ticket exists for 'prompt template cleanup post-DEF-126'"
    },
    "why_4": {
      "question": "Why was there no coordination between JSON module transformation and prompt template?",
      "answer": "JSON module outputs are DYNAMIC (runtime-generated), while prompt template is STATIC (file-based), creating perception they're independent",
      "evidence": "json_based_rules_module.py generates sections at runtime, but prompt ALSO has inline rule text"
    },
    "why_5": {
      "question": "Why does the system have BOTH dynamic JSON module output AND static inline rules?",
      "answer": "HISTORICAL LAYERING - system evolved from static prompt ‚Üí JSON data ‚Üí JSON module, with incomplete cleanup at each stage",
      "evidence": "Prompt has ARAI-01 inline (lines 136-146) + JSON module ALSO outputs ARAI-01 from instruction_map"
    },
    "root_cause": "ARCHITECTURAL DEBT from incremental evolution without holistic cleanup - three layers exist simultaneously: (1) static prompt inline rules, (2) JSON rule files, (3) JSON module runtime generation"
  },

  "impact_effort_matrix": {
    "description": "Prioritize actions based on business impact vs implementation effort",
    "high_impact_low_effort": [
      {
        "action": "Remove all 39 'Toetsvraag:' sections",
        "impact": "HIGH - eliminates validation/generation confusion",
        "effort": "LOW - automated regex replacement",
        "token_reduction": 1170,
        "priority": "DO FIRST"
      },
      {
        "action": "Remove quality metrics section (lines 471-497)",
        "impact": "MEDIUM - reduces noise, improves clarity",
        "effort": "LOW - simple block deletion",
        "token_reduction": 840,
        "priority": "DO FIRST"
      },
      {
        "action": "Remove ontology determination instructions",
        "impact": "HIGH - aligns with UI providing category",
        "effort": "LOW - targeted deletion (lines 71, 83-87)",
        "token_reduction": 460,
        "priority": "DO FIRST"
      },
      {
        "action": "Remove metadata section (lines 519-537)",
        "impact": "LOW - minor noise reduction",
        "effort": "LOW - simple deletion",
        "token_reduction": 180,
        "priority": "DO SECOND"
      }
    ],
    "high_impact_medium_effort": [
      {
        "action": "Remove rule-specific examples from prompt (keep in JSON module only)",
        "impact": "HIGH - eliminates duplication, establishes single source",
        "effort": "MEDIUM - need to distinguish OUTPUT FORMAT examples from rule examples",
        "token_reduction": 1200,
        "priority": "DO SECOND",
        "risk": "Accidentally removing generation-guiding examples",
        "mitigation": "Keep examples in sections: OUTPUT FORMAT, Definitie Templates, Grammatica Regels"
      },
      {
        "action": "Compress TYPE category explanation (30 lines ‚Üí 10 lines)",
        "impact": "MEDIUM - improves readability",
        "effort": "MEDIUM - requires careful rewriting",
        "token_reduction": 300,
        "priority": "DO THIRD"
      },
      {
        "action": "Consolidate grammar rules (39 lines ‚Üí 20 lines)",
        "impact": "MEDIUM - reduces verbosity",
        "effort": "MEDIUM - requires rewriting with preserved meaning",
        "token_reduction": 280,
        "priority": "DO THIRD"
      }
    ],
    "medium_impact_high_effort": [
      {
        "action": "Eliminate all inline 'Instructie:' sections (9 rules)",
        "impact": "MEDIUM - reduces duplication",
        "effort": "HIGH - requires verifying JSON module outputs are identical",
        "token_reduction": 405,
        "priority": "DO LATER",
        "blocker": "Need to verify json_based_rules_module.py instruction_map has EXACT same text",
        "risk": "If instruction_map differs, may lose important guidance"
      }
    ],
    "low_impact_any_effort": [
      {
        "action": "Remove definition templates redundancy",
        "impact": "LOW - minor improvement",
        "effort": "MEDIUM - consolidation requires design decision",
        "token_reduction": 120,
        "priority": "SKIP FOR NOW"
      }
    ]
  },

  "expected_outcomes": {
    "phase_1_quick_wins": {
      "description": "High-impact, low-effort actions (DO FIRST category)",
      "actions": [
        "Remove 39 'Toetsvraag:' sections",
        "Remove quality metrics section",
        "Remove ontology determination instructions",
        "Remove metadata section"
      ],
      "token_reduction": 2650,
      "percentage_reduction": "25.2%",
      "new_token_count": 7858,
      "effort_hours": 1.5,
      "risks": "Minimal - pure deletion of validation-oriented content"
    },
    "phase_2_deduplication": {
      "description": "High-impact, medium-effort actions (DO SECOND category)",
      "actions": [
        "Remove rule-specific examples (keep OUTPUT FORMAT examples)",
        "Verify no duplication with JSON module outputs"
      ],
      "token_reduction": 1200,
      "percentage_reduction": "11.4% (additional)",
      "new_token_count": 6658,
      "effort_hours": 3,
      "risks": "Medium - need careful distinction between example types",
      "validation_required": "Compare generated prompt with/without examples to ensure no information loss"
    },
    "phase_3_compression": {
      "description": "Medium-impact, medium-effort actions (DO THIRD category)",
      "actions": [
        "Compress TYPE category explanation (30‚Üí10 lines)",
        "Consolidate grammar rules (39‚Üí20 lines)"
      ],
      "token_reduction": 580,
      "percentage_reduction": "5.5% (additional)",
      "new_token_count": 6078,
      "effort_hours": 4,
      "risks": "Medium - requires careful rewriting to preserve meaning"
    },
    "total_realistic_reduction": {
      "phases": "Phase 1 + Phase 2 + Phase 3",
      "token_reduction": 4430,
      "percentage_reduction": "42.2%",
      "final_token_count": 6078,
      "total_effort_hours": 8.5,
      "comparison_to_baseline": {
        "baseline_reported": 8325,
        "final_estimate": 6078,
        "reduction_from_baseline": 2247,
        "percentage_from_baseline": "27.0%"
      },
      "note": "Baseline (8,325 tokens) differs from measured (10,508 tokens) - using measured as source of truth"
    }
  },

  "specific_answers": {
    "question_1": {
      "question": "Hoeveel validatie-content zit er NOG in prompt NA DEF-126?",
      "answer": {
        "toetsvragen_count": 39,
        "toetsvragen_tokens": 780,
        "validation_examples_tokens": 390,
        "quality_metrics_tokens": 460,
        "total_validation_tokens": 1630,
        "percentage": "15.5% of prompt",
        "detail": "DEF-126 transformed JSON module code but did NOT touch static prompt template - all validation content remains"
      }
    },
    "question_2": {
      "question": "Hoeveel ontologie-bepaling content kan eruit?",
      "answer": {
        "removal_blocks": [
          {
            "location": "Line 71",
            "content": "Je **moet** √©√©n van de vier categorie√´n expliciet maken",
            "tokens": 20
          },
          {
            "location": "Lines 83-87",
            "content": "BELANGRIJK: Bepaal de juiste categorie op basis van het BEGRIP zelf (5 lines)",
            "tokens": 120
          },
          {
            "location": "Lines 89-118 (partial)",
            "content": "Remove 'Bepaal' language, KEEP kick-off patterns",
            "tokens": 320
          }
        ],
        "total_removable_tokens": 460,
        "percentage": "4.4% of prompt",
        "retention_strategy": "KEEP kick-off term patterns (proces‚Üí'activiteit waarbij', type‚Üí[kernwoord] dat), REMOVE determination logic"
      }
    },
    "question_3": {
      "question": "Is er duplicatie tussen prompt en json_based_rules_module.py?",
      "answer": {
        "duplication_exists": true,
        "type": "RUNTIME vs STATIC duplication",
        "details": {
          "inline_instructions": {
            "count": 9,
            "rules": ["ARAI-01", "ARAI-04", "ARAI-06", "ESS-01", "ESS-02", "STR-01", "INT-01", "VER-01", "CON-01"],
            "tokens_duplicated": 405,
            "mechanism": "Prompt has 'Instructie:' inline + JSON module adds same via instruction_map"
          },
          "examples_duplication": {
            "description": "Both prompt and JSON module show good/bad examples",
            "tokens_duplicated": 1200,
            "recommendation": "Remove from static prompt, keep in JSON module (single source)"
          }
        },
        "total_duplication_tokens": 1605,
        "percentage": "15.3% of prompt",
        "architectural_issue": "Three layers coexist: (1) static prompt, (2) JSON files, (3) JSON module runtime generation"
      }
    },
    "question_4": {
      "question": "Wat is nieuwe realistische token reductie (was 21%, nu met constraints)?",
      "answer": {
        "previous_estimate": "21% (before DEF-126 awareness)",
        "new_realistic_estimate": {
          "phase_1_quick_wins": "25.2% reduction (2,650 tokens) - 1.5 hours effort",
          "phase_2_deduplication": "+11.4% reduction (1,200 tokens) - 3 hours effort",
          "phase_3_compression": "+5.5% reduction (580 tokens) - 4 hours effort",
          "total_achievable": "42.2% reduction (4,430 tokens) - 8.5 hours total effort"
        },
        "conservative_recommendation": {
          "target": "Phase 1 + Phase 2 = 36.6% reduction (3,850 tokens)",
          "effort": "4.5 hours",
          "final_token_count": 6658,
          "rationale": "Phase 3 compression has diminishing returns (5.5% for 4 hours) - save for later iteration"
        },
        "comparison": {
          "baseline_reported": 8325,
          "baseline_measured": 10508,
          "conservative_target": 6658,
          "reduction_from_measured": "36.6%",
          "reduction_from_reported": "20.0%",
          "note": "Using measured (10,508) as source of truth - discrepancy may be from encoding or version differences"
        }
      }
    }
  },

  "implementation_roadmap": {
    "phase_1_quick_wins": {
      "duration": "1.5 hours",
      "priority": "IMMEDIATE",
      "actions": [
        {
          "step": 1,
          "action": "Remove all 'Toetsvraag:' sections",
          "command": "Delete lines containing '- Toetsvraag:' pattern (39 occurrences)",
          "validation": "grep -c 'Toetsvraag:' should return 0",
          "token_reduction": 1170
        },
        {
          "step": 2,
          "action": "Remove quality metrics section",
          "command": "Delete lines 471-497 (### üìä Kwaliteitsmetrieken:)",
          "validation": "Section should not exist in output",
          "token_reduction": 840
        },
        {
          "step": 3,
          "action": "Remove ontology determination instructions",
          "command": "Delete line 71, lines 83-87, modify lines 89-118 to remove 'Bepaal' language",
          "validation": "Should NOT contain 'Bepaal de juiste categorie'",
          "token_reduction": 460
        },
        {
          "step": 4,
          "action": "Remove metadata section",
          "command": "Delete lines 519-537 (#### üìä METADATA...)",
          "validation": "Prompt should end at line 518",
          "token_reduction": 180
        }
      ],
      "outcome": {
        "token_count": 7858,
        "reduction": "25.2%",
        "risk": "LOW"
      }
    },
    "phase_2_deduplication": {
      "duration": "3 hours",
      "priority": "HIGH",
      "actions": [
        {
          "step": 1,
          "action": "Identify rule-specific examples vs OUTPUT FORMAT examples",
          "method": "Examples under rule sections (ARAI, ESS, etc.) are rule-specific; examples under OUTPUT FORMAT/Grammar are generation-guiding",
          "retention": "Keep OUTPUT FORMAT examples, Grammar examples, Definitie Templates examples"
        },
        {
          "step": 2,
          "action": "Remove rule-specific good/bad examples",
          "command": "Delete '‚úÖ' and '‚ùå' lines under rule sections (ARAI-01 through SAM-08)",
          "validation": "Only OUTPUT FORMAT and Grammar sections should have examples",
          "token_reduction": 1200
        },
        {
          "step": 3,
          "action": "Verify JSON module outputs these examples",
          "method": "Run prompt generation, verify JSON module includes examples via _format_rule()",
          "validation": "Generated prompt should still have examples from JSON module"
        }
      ],
      "outcome": {
        "token_count": 6658,
        "reduction": "36.6% (cumulative)",
        "risk": "MEDIUM - requires careful distinction"
      }
    },
    "phase_3_compression": {
      "duration": "4 hours",
      "priority": "MEDIUM",
      "actions": [
        {
          "step": 1,
          "action": "Compress TYPE category explanation",
          "before": "30 lines (89-118)",
          "after": "10 lines with core pattern",
          "content": "Focus on kick-off pattern: [kernwoord] dat/die [kenmerk], remove repetitive warnings",
          "token_reduction": 300
        },
        {
          "step": 2,
          "action": "Consolidate grammar rules",
          "before": "39 lines (23-61)",
          "after": "20 lines with essential rules + 1-2 examples each",
          "token_reduction": 280
        }
      ],
      "outcome": {
        "token_count": 6078,
        "reduction": "42.2% (cumulative)",
        "risk": "MEDIUM - requires rewriting"
      }
    }
  },

  "recommendations": {
    "immediate_action": {
      "recommendation": "Execute Phase 1 (Quick Wins) immediately",
      "rationale": "25.2% reduction in 1.5 hours with minimal risk",
      "deliverable": "Cleaned prompt file with 7,858 tokens (down from 10,508)"
    },
    "short_term": {
      "recommendation": "Execute Phase 2 (Deduplication) within 1 week",
      "rationale": "Additional 11.4% reduction, establishes JSON module as single source of truth",
      "prerequisite": "Verify JSON module outputs include all necessary examples",
      "deliverable": "Prompt at 6,658 tokens (36.6% total reduction)"
    },
    "medium_term": {
      "recommendation": "Consider Phase 3 (Compression) in next iteration",
      "rationale": "Diminishing returns (5.5% for 4 hours effort), focus on higher-value work first",
      "alternative": "May be superseded by other prompt optimization work"
    },
    "architectural": {
      "recommendation": "Document the three-layer architecture and establish cleanup policy",
      "layers": [
        "Layer 1: Static prompt template (this file)",
        "Layer 2: JSON rule files (src/toetsregels/regels/*.json)",
        "Layer 3: JSON module runtime generation (json_based_rules_module.py)"
      ],
      "policy": "JSON module (Layer 3) is single source of truth for rules; static prompt should NOT duplicate rule content"
    }
  },

  "validation_checklist": {
    "before_implementation": [
      "Backup original prompt file",
      "Measure baseline tokens with tiktoken (cl100k_base encoding)",
      "Run test generation with current prompt, save output as baseline"
    ],
    "during_implementation": [
      "After each phase, measure tokens and verify reduction matches estimate",
      "After each phase, run test generation and compare output quality",
      "Verify no regression in definition quality (run existing test suite)"
    ],
    "after_implementation": [
      "Final token count measurement",
      "Side-by-side comparison of generated definitions (before/after)",
      "Validation module should show no change in behavior (operates post-generation)",
      "Document changes in CHANGELOG or commit message"
    ]
  }
}
