---
aangemaakt: '08-09-2025'
bijgewerkt: '08-09-2025'
id: REQ-005
links:
  docs:
  - TECHNICAL_ARCHITECTURE.md
  epics:
  - EPIC-001
  - EPIC-006
  stories:
  - US-1.1
prioriteit: HOOG
sources:
- line: Database query methods
  path: src/services/definition_repository.py
- line: Database schema definition
  path: src/database/schema.sql
status: GEREED
titel: SQL Injection Prevention
type: nonfunctional
---



# Requirement REQ-005: SQL Injection Prevention

## Beschrijving

Alle database queries moeten beschermd zijn tegen SQL injection aanvallen door gebruik van parameterized queries en stored procedures. Directe string concatenatie voor SQL queries is ten strengste verboden.

## Rationale

SQL injection is een van de meest voorkomende en gevaarlijke web application vulnerabilities. Het kan leiden tot complete database compromise, data verlies, en ongeautoriseerde toegang.

## Acceptatiecriteria (SMART)

- 100% van database queries gebruikt parameterized statements
- Geen string concatenatie of f-strings voor SQL query constructie
- Database gebruiker heeft minimale benodigde privileges (principle of least privilege)
- Prepared statements voor alle CRUD operaties
- Input sanitization voordat data de database laag bereikt
- Automated SQL injection testing in CI/CD


### SMART Acceptatiecriteria

- **Specifiek:** Gebruik parameterized queries voor alle database interacties zonder excepties
- **Meetbaar:**
  - 100% queries gebruik ? placeholders (0 string concatenatie)
  - 0 SQL injection vulnerabilities (SQLMap scan)
  - < 5ms overhead voor parameterization
  - 100% code coverage voor repository layer
  - 0 direct SQL execution toegestaan
  - Database response tijd < 50ms voor queries
- **Acceptabel:** SQLite3 parameterized statements standaard
- **Relevant:** Voorkomt database compromise en data breach
- **Tijdgebonden:** Geïmplementeerd voor database go-live (Sprint 1)


## BDD Test Scenario's

```gherkin
Scenario: Veilige definitie opslag met parameterized query
  Gegeven een definitie met SQL injection: "'; DROP TABLE definities; --"
  Wanneer deze wordt opgeslagen via repository.save()
  Dan gebruikt de query parameterized statement
  En wordt de string als data behandeld
  En blijft de database tabel intact
  En wordt de definitie correct opgeslagen als tekst

Scenario: Zoeken zonder SQL injection
  Gegeven een zoekterm: "vonnis' OR '1'='1"
  Wanneer repository.search() wordt aangeroepen
  Dan gebruikt de query: "SELECT * FROM definities WHERE term LIKE ?"
  En wordt de parameter veilig gebonden
  En retourneert alleen exacte matches op de zoekterm
  En wordt geen extra data gelekt

Scenario: Database privilege beperking
  Gegeven de applicatie database gebruiker
  Wanneer een DROP TABLE commando wordt geprobeerd
  Dan faalt dit door insufficient privileges
  En kan de gebruiker alleen SELECT/INSERT/UPDATE
  En wordt de poging gelogd
  En blijft de applicatie functioneel

Scenario: SQLMap penetratie test
  Gegeven SQLMap scanner tegen alle endpoints
  Wanneer de scan compleet is (niveau 5, risico 3)
  Dan worden 0 SQL injection punten gevonden
  En worden alle query parameters veilig afgehandeld
  En wordt het rapport opgeslagen voor audit

Scenario: Query performance met parameterization
  Gegeven 1000 database queries per minuut
  Wanneer alle queries parameterized zijn
  Dan is de gemiddelde query tijd < 50ms
  En is de 99e percentiel < 100ms
  En is er geen merkbaar performance verlies
```

## Uitwerking / Notities

- SQLite3 met ? placeholders voor alle parameters
- DefinitionRepository gebruikt uitsluitend safe query patterns
- Database connection in read-only mode waar mogelijk
- Separate database users voor read vs write operations (toekomstig)
- Query logging voor forensische analyse
- SQLMap testing tijdens security audits
- Prepared statement caching voor performance
- Database activity monitoring voor anomalie detectie

## Conflicten (indien van toepassing)

Geen conflicten geïdentificeerd
## SMART Criteria

- **Specifiek**: Implement complete sql injection prevention beveiliging control
- **Meetbaar**: Geen kwetsbaarheden in beveiligingsscans, 100% testdekking
- **Haalbaar**: Using established beveiliging libraries en patterns
- **Relevant**: KRITIEK voor justitiesector gegevensbeschermingscompliance
- **Tijdgebonden**: Must be operational before productie deployment


### Compliance Referenties

- **ASTRA Controls:**
  - ASTRA-QUA-001: Kwaliteitsborging
  - ASTRA-SEC-002: Beveiliging by Design
- **NORA Principes:**
  - NORA-BP-07: Herbruikbaarheid
  - NORA-BP-12: Betrouwbaarheid
- **GEMMA Referenties:**
  - GEMMA-ARC-03: Architectuur patterns
- **Justice Sector:**
  - DJI/OM integratie vereisten
  - Rechtspraak compatibiliteit
