# US-061: Extract en Documenteer Business Kennis uit Legacy

## Story Overview
**ID**: US-061
**Epic**: EPIC-012 - Legacy Orchestrator Refactoring
**Status**: TODO
**Priority**: CRITICAL
**Points**: 5
**Sprint**: Sprint 1

## User Story
**Als** developer
**Wil ik** alle business kennis uit legacy code extraheren en documenteren
**Zodat** geen waardevolle logica verloren gaat tijdens refactoring

## Business Context
De legacy code bevat jaren aan ontwikkelde business kennis die cruciaal is voor de werking van de applicatie. Deze kennis moet eerst volledig begrepen en gedocumenteerd worden voordat refactoring kan plaatsvinden.

## Acceptance Criteria
- [ ] Alle business rules uit FeedbackBuilder gedocumenteerd
- [ ] Status bepaling algoritme volledig beschreven
- [ ] Iterative improvement logica geanalyseerd
- [ ] Performance optimalisaties geïdentificeerd
- [ ] Update flow met selective validation gedocumenteerd
- [ ] Stats tracking algoritmes beschreven
- [ ] Business kennis document opgeleverd

## Technical Implementation

### 1. FeedbackBuilder Analyse
**Locatie**: `src/orchestration/definitie_agent.py` (regels 299-545)

**Te documenteren**:
- 11 violation-to-feedback mappings
- 4 pattern suggestion categorieën
- Feedback prioritering algoritme
- Learning feedback mechanisme
- Score stagnatie detectie

### 2. Status Bepaling Algoritme
**Locatie**: `src/services/definition_orchestrator.py` (regels 333-339)

```python
# Business Rule te behouden:
if validation_result.score >= 0.8:
    status = "established"
elif validation_result.score >= 0.6:
    status = "review"
else:
    status = "draft"
```

### 3. Iterative Improvement
**Locatie**: `src/orchestration/definitie_agent.py` (regels 547-899)

**Te documenteren**:
- Max 3 iteraties regel
- Acceptance threshold: 0.8
- Improvement threshold: 0.05
- Stop criteria logica
- Score history tracking

### 4. Performance Optimalisaties
**Te identificeren**:
- Voorbeelden caching tussen iteraties
- Parallel enrichment configuratie
- Average processing time berekening
- Retry mechanisme (max 3 retries)

### 5. Update Definition Flow
**Locatie**: `src/services/definition_orchestrator.py` (regels 225-295)

**Business logica**:
- Selectieve validatie alleen voor gewijzigde velden
- Quality gate bij updates
- Timestamp management

## Deliverables
1. **Business Knowledge Document** (`docs/backlog/epics/EPIC-011/business-knowledge.md`)
   - Alle geëxtraheerde business rules
   - Algoritmes en formules
   - Decision trees
   - Performance consideraties

2. **Mapping Document** (`docs/backlog/epics/EPIC-011/legacy-to-v2-mapping.md`)
   - Legacy locatie → V2 target service
   - Prioriteit per business rule
   - Dependencies

## Testing Requirements
- [ ] Geen code wijzigingen, alleen documentatie
- [ ] Review door senior developer
- [ ] Verificatie dat alle business logica gedekt is

## Dependencies
- Toegang tot alle legacy code
- Geen blocking dependencies

## Definition of Done
- [ ] Alle business kennis gedocumenteerd in markdown
- [ ] Mapping naar V2 services gemaakt
- [ ] Document reviewed en goedgekeurd
- [ ] Geen code gewijzigd (alleen analyse)

## Notes
- Dit is een analyse-only story
- Geen code refactoring in deze story
- Focus op BEGRIJPEN, niet veranderen
- Documentatie wordt basis voor volgende stories
