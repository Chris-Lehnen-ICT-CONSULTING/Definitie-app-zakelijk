# US-065: Moderniseer UI Dependencies

## Story Overview
**ID**: US-065
**Epic**: EPIC-012 - Legacy Orchestrator Refactoring
**Status**: TODO
**Priority**: MEDIUM
**Points**: 3
**Sprint**: Sprint 3

## User Story
**Als** developer
**Wil ik** UI dependencies moderniseren naar V2 services
**Zodat** de UI werkt met de gerefactorde services zonder legacy dependencies

## Business Context
De UI componenten gebruiken nog directe imports van legacy modules. Deze moeten geüpdatet worden naar de nieuwe V2 services terwijl alle functionaliteit behouden blijft.

## Acceptance Criteria
- [ ] Alle legacy imports in UI vervangen door V2
- [ ] UI functionaliteit volledig intact
- [ ] Geen user-facing changes
- [ ] RegenerationService werkend met V2
- [ ] Tab interfaces geüpdatet
- [ ] Tests voor UI integratie

## Technical Implementation

### 1. UI Components te Updaten
**Files**:
- `src/ui/components/definition_generator_tab.py`
- `src/ui/tabbed_interface.py`

### 2. Import Updates

**definition_generator_tab.py** (regels 39-44):
```python
# OUDE imports:
from services.definition_generator_config import UnifiedGeneratorConfig
from services.definition_generator_prompts import UnifiedPromptBuilder

# NIEUWE imports:
from services.interfaces import GeneratorConfigV2
from services.context_service_v2 import ContextServiceV2
from services.prompts.prompt_service_v2 import PromptServiceV2
```

**tabbed_interface.py** (regels 125-126):
```python
# OUDE imports:
from services.definition_generator_config import UnifiedGeneratorConfig
from services.definition_generator_prompts import UnifiedPromptBuilder

# NIEUWE imports:
from services.interfaces import GeneratorConfigV2
from services.feedback_service_v2 import FeedbackServiceV2
```

### 3. RegenerationService Update
```python
class DefinitionGeneratorTab:
    def __init__(self):
        # OUD:
        config = UnifiedGeneratorConfig()
        prompt_builder = UnifiedPromptBuilder(config)
        self.regeneration_service = RegenerationService(prompt_builder)

        # NIEUW:
        config = GeneratorConfigV2()
        context_service = ContextServiceV2(config)
        prompt_service = PromptServiceV2(context_service)
        self.regeneration_service = RegenerationService(prompt_service)
```

### 4. Service Container Integration
```python
def initialize_services():
    """Update service initialization voor UI."""
    container = ServiceContainer()

    # Nieuwe services registreren
    container.register('feedback_service', FeedbackServiceV2)
    container.register('context_service', ContextServiceV2)

    return container
```

### 5. Session State Management
```python
# Check en update session state usage
if 'generator_config' in st.session_state:
    # Migreer oude config naar nieuwe format
    old_config = st.session_state.generator_config
    new_config = GeneratorConfigV2(
        save_drafts=old_config.get('save_drafts', True),
        min_quality_score=old_config.get('min_quality_score', 0.6),
        # ... map alle parameters
    )
    st.session_state.generator_config = new_config
```

## Testing Requirements
```python
# tests/ui/test_ui_modernization.py
class TestUIModernization:
    def test_definition_generator_tab_with_v2()
    def test_tabbed_interface_with_v2()
    def test_regeneration_service_v2()
    def test_session_state_migration()
    def test_ui_functionality_preserved()
```

## UI Testing Checklist
- [ ] Definitie generatie werkt
- [ ] Regeneratie functionaliteit intact
- [ ] Voorbeelden generatie werkt
- [ ] Validatie feedback zichtbaar
- [ ] Export functionaliteit werkend
- [ ] Geen UI glitches of errors

## Migration Strategy
1. **Fase 1**: Update imports één voor één
2. **Fase 2**: Test elke UI component
3. **Fase 3**: Update service initialization
4. **Fase 4**: Verificatie met manual testing
5. **Fase 5**: Update UI tests

## Dependencies
- US-062, US-063, US-064 moeten compleet zijn
- V2 services moeten stabiel zijn
- ServiceContainer moet geüpdatet zijn

## Definition of Done
- [ ] Alle UI imports gemoderniseerd
- [ ] Geen legacy module dependencies in UI
- [ ] UI functionaliteit 100% intact
- [ ] Manual testing compleet
- [ ] Automated UI tests groen
- [ ] Geen user-facing changes
- [ ] Performance gelijk of beter

## Notes
- **GEEN UI redesign** - alleen dependency updates
- Test uitgebreid - UI is user-facing
- Rollback plan: oude imports tijdelijk behouden
- Focus op zero user impact
