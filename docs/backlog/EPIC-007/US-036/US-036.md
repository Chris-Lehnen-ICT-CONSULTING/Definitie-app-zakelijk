---
id: US-036
epic: EPIC-007
titel: Monitoring injectie + metrics export (durations/tokens/cache) met correlation id
status: Nog te bepalen
prioriteit: HOOG
story_points: 5
owner: platform-engineer
sprint: sprint-37
canonical: true
last_verified: 2025-09-12
applies_to: definitie-app@current
links:
- docs/backlog/DEEP_DIVE_IMPROVEMENT_PLAN.md#logging--monitoring
---

# US-036: Monitoring injectie + metrics export (durations/tokens/cache) met correlation id

## Gebruikersverhaal
Als platform engineer wil ik gestandaardiseerde monitoring op de V2‑orchestrator en export van kernmetrics, zodat prestaties en kosten zichtbaar zijn en regressies snel detecteerbaar.

## Acceptatiecriteria (SMART)
- Specifiek: `MonitoringServiceInterface` implementatie + injectie; events voor start/complete met `generation_id` (correlation id), duur, tokens, cache‑hit.
- Meetbaar: metrics‑bestand `logs/metrics.json` (of Prometheus endpoint) met ≥4 velden per generatie; 0% missings in happy path.
- Tijdgebonden: sprint‑37.

## Implementatienotities
- Wrapper klasse die in memory aggregates bijhoudt en periodiek wegschrijft.
- Hook in `AIServiceV2` om tokens/time door te geven (zonder tight coupling).

## Testplan
- Unit: verify event calls; JSON schema validatie van metrics.
- Integration: end‑to‑end generatie produceert metrics record.

## Definition of Done
- Metrics zichtbaar; eenvoudige grafiek of script in `scripts/analysis/` om trends te zien.

