---
id: US-030
epic: EPIC-006
titel: "US-030: titel: Logging‑redactie (PII masking) en retentiebeleid"
status: Nog te bepalen
prioriteit: HOOG
story_points: 3
sprint: sprint-37
owner: security-engineer
applies_to: definitie-app@current
canonical: false
last_verified: 2025-09-12
vereisten:
  - REQ-045
  - REQ-006
links:
  - docs/backlog/DEEP_DIVE_IMPROVEMENT_PLAN.md#security--privacy-req006-owasp
---

# US-030: Logging‑redactie (PII masking) en retentiebeleid

## Gebruikersverhaal
Als privacy officer wil ik dat logs geen PII bevatten en volgens een retentiebeleid worden beheerd, zodat privacywetgeving en interne policies worden nageleefd.

## Acceptatiecriteria (SMART)
- Specifiek: Logging‑filter/formatter die PII en secrets maskeert; retentieconfig (30/90 dagen) toepasbaar per omgeving.
- Meetbaar: 0 PII‑hits in gesynthetiseerde testlogs; logrotate/cleanup scripts aanwezig; documentatie van beleid.
- Acceptabel: integreer in bestaand loggingconfig (config_manager.logging/module levels).
- Relevant: REQ‑045.
- Tijdgebonden: sprint‑37.

## Implementatienotities
- Implementatie van `PIIRedactingFilter` + masker voor API keys (laatste 4 chars zichtbaar).
- Config via `config_manager` met per‑env retention.

## Refinement (2025-10-14)

### Doelen
- Masker mogelijk PII (namen, e-mail, BSN, telefoons, API-keys) uit alle logregels.
- Introduceer standaard retentie (30 dagen lokaal, 90 dagen productie) met rotatie.
- Documenteer hoe ontwikkelaar snel kan controleren of masking actief is.

### Buiten scope
- Geen SIEM integratie.
- Geen encryptie van logbestanden (valt buiten baseline).

### Definition of Ready
- [ ] Regexlijst voor PII types afgestemd (email, telefoon, BSN, IBAN, API key).
- [ ] Besluit over log retention mechanisme (Python `TimedRotatingFileHandler` vs. external script).
- [ ] Voorbeeldlogbestand met bekende PII aanwezig voor test.

### Werkpakketten
- [ ] Schrijf `PIIRedactingFormatter` (of filter) met tests per patroon; log placeholder `***masked***`.
- [ ] Pas loggingconfig aan zodat filter wordt toegepast op alle handlers (console + file).
- [ ] Configureer rotatie (bijv. `TimedRotatingFileHandler` + compressie) en cleanup script `scripts/logs/purge_old_logs.py`.
- [ ] Voeg CLI check `scripts/diagnostics/scan_logs_for_pii.py` (fail wanneer PII wordt gevonden).
- [ ] Update `.gitignore` + documentatie zodat logpad consistent is.
- [ ] Update README/security sectie met beleid en gebruik van tools.

## Testplan
- Unit: filter maskeert BSN/e‑mail/telefoon/API keys.
- Integration: produceer logs met voorbeeld PII; assert gemaskeerde output.

## Definition of Done
- [ ] Unit tests tonen correcte masking voor alle patronen.
- [ ] Integratietest genereert sample log en bevestigt masking + rotatie.
- [ ] Cleanup script verwijdert logs ouder dan beleid (test met tijdelijke map).
- [ ] Documentatie (`docs/security/logging-baseline.md`) beschrijft beleid en scripts.
- [ ] Security review bevestigt dat API keys/PII niet meer leesbaar zijn.
