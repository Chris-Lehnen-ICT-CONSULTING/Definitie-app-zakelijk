---
id: US-031
epic: EPIC-006
titel: "US-031: Als DevOps engineer wil ik secrets‑scans en dependency‑audits in CI, zodat lekken en kwetsbaarheden vroegtijdig worde..."
status: Nog te bepalen
prioriteit: HOOG
story_points: 3
sprint: sprint-37
owner: devops-engineer
applies_to: definitie-app@current
canonical: false
last_verified: 2025-09-12
vereisten:
  - REQ-006
links:
  - docs/backlog/DEEP_DIVE_IMPROVEMENT_PLAN.md#testing--cicd
---

# US-031: CI‑security: Secrets‑scan en dependency‑audit (pip‑audit/safety)

## Gebruikersverhaal
Als DevOps engineer wil ik secrets‑scans en dependency‑audits in CI, zodat lekken en kwetsbaarheden vroegtijdig worden gedetecteerd.

## Acceptatiecriteria (SMART)
- Specifiek: GitHub Actions job(s) voor detect‑secrets/ggshield en pip‑audit/safety.
- Meetbaar: pipeline faalt bij High severity; rapporten geüpload als artifacts.
- Acceptabel: extra jobtijd < 2m gemiddeld.
- Relevant: REQ‑006.
- Tijdgebonden: sprint‑37.

## Implementatienotities
- Workflow `.github/workflows/security.yml` met 2 jobs: `secrets-scan`, `deps-audit`.
- baseline file voor detect‑secrets in repo om false positives te whitelisten.

## Refinement (2025-10-14)

### Doelen
- Automatiseer secrets-scan en dependency-audit in de bestaande CI (GitHub Actions of lokaal `make ci`).
- Bied een lokale command (`make security-check`) zodat ontwikkelaar issues kan oplossen vóór commit.
- Bewaar rapporten zodat regressies traceerbaar zijn.

### Buiten scope
- Geen container image scans (kan later).
- Geen SAST/DAST tooling toevoegen binnen deze story.

### Definition of Ready
- [ ] Bestaande CI workflow geïdentificeerd (trunk/git actions) en klaar voor uitbreiding.
- [ ] Versies gekozen: `detect-secrets` en `pip-audit` (of `safety`).
- [ ] Baseline whitelist afgesproken (minimaal seeds).

### Werkpakketten
- [ ] Voeg GitHub Actions job `security` toe met stappen: install tools, run `detect-secrets scan --baseline .secrets.baseline`, run `pip-audit --output-format json`.
- [ ] Maak `make security-check` en `scripts/security/run_ci_checks.sh` voor lokale uitvoering.
- [ ] Configureer `.secrets.baseline` (geüpdatet via `detect-secrets audit`) en voeg documentatie toe hoe te onderhouden.
- [ ] Zorg dat audit resultaten opgeslagen worden als artifact (`pip-audit.json`).
- [ ] Voeg README sectie “Security Pipeline” met instructies.
- [ ] Update `CONTRIBUTING.md` met pre-commit hook instructie (optioneel).

## Testplan
- E2E: maak een testbranch met dummy secret → job moet falen.
- E2E: forceer kwetsbare dependency in virtualenv → audit moet detecteren.

## Definition of Done
- [ ] CI job faalt bij gedetecteerde secret of high-risk dependency.
- [ ] Artefacten beschikbaar (scanrapport).
- [ ] `make security-check` draait lokaal zonder handmatig setup.
- [ ] Documentatie (README/CONTRIBUTING) bijgewerkt met stappen.
- [ ] Badge of statusnotitie toegevoegd aan README.
