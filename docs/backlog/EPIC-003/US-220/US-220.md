---
Afhankelijkheden: [US-135]
aangemaakt: 19-09-2025
applies_to: definitie-app@current
bijgewerkt: 19-09-2025
canonical: true
epic: EPIC-003
id: US-220
last_verified: 19-09-2025
owner: development-team
prioriteit: HOOG
sprint: backlog
status: Done
story_points: 5
titel: Verwijder enable_web_lookup Feature Flag
toegewezen_aan: development-team
type: technical-debt
vereisten:
- REQ-017
- REQ-020
- REQ-021
---

# US-220: Verwijder enable_web_lookup Feature Flag (Voltooid)

## Gebruikersverhaal

**Als een** ontwikkelaar
**wil ik** dat de web lookup functionaliteit altijd actief is zonder feature flag
**zodat** de code eenvoudiger wordt en er geen inconsistente configuratie meer mogelijk is

## Context

Deze story verwijderde de `enable_web_lookup` feature flag volledig. Web lookup draait nu automatisch wanneer de service beschikbaar is. Alle code- en configuratiereferenties naar de flag zijn opgeschoond.

## Acceptatiecriteria

### Criterion 1: Flag Verwijdering
STATUS: Vervuld — Alle referenties naar `enable_web_lookup` zijn verwijderd.

### Criterion 2: Service Altijd Actief
**gegeven** de web lookup service is geïnjecteerd
**wanneer** een definitie wordt gegenereerd
**dan** wordt web lookup altijd uitgevoerd (met timeout protection)

### Criterion 3: Graceful Failure
**gegeven** web lookup wordt altijd uitgevoerd
**wanneer** de lookup faalt of timeout
**dan** gaat de definitie generatie gewoon door zonder web context

### Criterion 4: Performance Garanties
**gegeven** web lookup draait zonder flag
**wanneer** een lookup wordt uitgevoerd
**dan** is er een configureerbare timeout actief (default 3.0s via `WEB_LOOKUP_TIMEOUT_SECONDS`)

## Technische Implementatie

### Uitvoering (samenvatting)
- Vervangen alle conditionele checks door aanwezigheid van service (bijv. `if self.web_lookup_service:`).
- Verwijderd flag-parameters uit config/classes (ContextConfig, OrchestratorConfig).
- Opschoning UI/integratieplaatsen waar een toggle werd verwacht.
- Documentatie en backlog bijgewerkt.

### Implementatie Strategie

```python
# VOOR (met flag):
if getattr(self.config, "enable_web_lookup", True) and self.web_lookup_service:
    try:
        web_results = await self.web_lookup_service.lookup(lookup_request)
    except Exception:
        pass  # Silent fail

# NA (zonder flag):
if self.web_lookup_service:  # Service bestaat = gebruik het
    try:
        web_results = await asyncio.wait_for(
            self.web_lookup_service.lookup(lookup_request),
            timeout=float(os.getenv("WEB_LOOKUP_TIMEOUT_SECONDS", "3.0"))
        )
        # Process results...
    except asyncio.TimeoutError:
        logger.warning(f"Web lookup timeout for {term}")
    except Exception as e:
        logger.error(f"Web lookup failed: {e}")
        # Continue zonder web context
```

## Test Coverage Vereisten

### Unit Tests aan te passen
- `tests/services/test_definition_orchestrator.py`
- `tests/services/test_orchestrator_v2.py`
- `tests/services/test_definition_context.py`

### Integration Tests
- Test dat web lookup altijd wordt aangeroepen
- Test timeout behavior (configureerbaar; default 3.0s)
- Test graceful failure handling

## Definitie van Gereed

- [x] Alle references naar `enable_web_lookup` verwijderd
- [x] Web lookup service wordt altijd geïnjecteerd
- [x] Timeout protection beschikbaar (in service)
- [x] Error handling aanwezig (logging, graceful degrade)
- [x] Documentatie bijgewerkt

## Impact Analyse

### Positief
- **Code Simpliciteit**: -50 regels conditional logic
- **Consistentie**: Geen conflicterende configuraties meer
- **Performance**: Altijd predictable timeout behavior
- **Debugging**: Betere error logging, geen silent failures

### Risico's
- **Performance**: Elke generatie doet nu web lookup (mitigatie: configureerbare timeout; default 3.0s)
- **Network Load**: Meer API calls (mitigatie: caching strategy)
- **Test Updates**: 15+ tests moeten aangepast worden

## Dependencies

- US-135: Modern Web Lookup Implementatie (moet eerst stabiel zijn)
- Caching strategy moet robuust zijn
- Monitoring moet actief zijn voor metrics

## Notes

- Dit is deel 1 van de feature flag cleanup initiative
- Start met web_lookup omdat dit high-impact maar low-risk is
- Success metrics: Response tijd blijft <3 sec totaal

---

*Deze story is onderdeel van de Technical Debt reductie in EPIC-003*
