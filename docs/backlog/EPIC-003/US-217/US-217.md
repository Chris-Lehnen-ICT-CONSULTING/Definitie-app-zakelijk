---
id: US-217
epic: EPIC-003
titel: Web Lookup Dependency Injection Implementation
status: open
prioriteit: P2
story_points: 5
aangemaakt: 2025-09-30
bijgewerkt: 2025-09-30
owner: tbd
applies_to: definitie-app@current
canonical: false
last_verified: 2025-09-30
---

# US-217: Web Lookup Dependency Injection Implementation

## User Story
**Als** ontwikkelaar van de DefinitieAgent applicatie
**Wil ik** proper dependency injection voor web lookup services
**Zodat** code testbaar wordt en dependencies expliciet zijn

## Context
Huidige problemen:
- Hard dependencies in code (`self.calculator = BetrouwbaarheidsCalculator()`)
- Moeilijk te testen door tight coupling
- Geen mogelijkheid om mocks te injecteren
- Service initialization verspreid door codebase

## Acceptatiecriteria
- [ ] DI container geïmplementeerd voor web lookup
- [ ] Alle web lookup services gebruiken DI
- [ ] Dependencies zijn expliciet in constructors
- [ ] Services kunnen gemockt worden voor tests
- [ ] Geen hardcoded instantiaties meer
- [ ] Container setup in één centrale plek

## Technische Details

### Simpele DI Container (voor single-user)
```python
class DIContainer:
    """Simplified DI for single-user app"""
    def __init__(self):
        self._services = {}
        self._singletons = {}

    def register(self, interface: Type, implementation: Any):
        self._services[interface] = implementation

    def get(self, interface: Type) -> Any:
        if interface not in self._singletons:
            self._singletons[interface] = self._services[interface]()
        return self._singletons[interface]

# Setup
container = DIContainer()
container.register(WebLookupConfig, WebLookupConfig)
container.register(WikipediaProvider, WikipediaProvider)
```

### Service Constructor met DI
```python
class ModernWebLookupService:
    def __init__(
        self,
        config: WebLookupConfig,
        providers: List[WebLookupProvider],
        cache: Optional[CacheService] = None
    ):
        self.config = config
        self.providers = providers
        self.cache = cache or SimpleCache()
```

## Geschatte Effort
**1-2 dagen**

## Dependencies
- US-214 (canonical interfaces)
- US-215 (unified config)

## Testing
- Unit tests met mock injection
- Verify singleton behavior
- Test container registration

## Notes
- Vereenvoudigde versie voor single-user
- Geen complexe DI framework nodig
- Focus op testability

## Definition of Done
- [ ] DI container geïmplementeerd
- [ ] Services gebruik DI voor dependencies
- [ ] Hardcoded instantiaties verwijderd
- [ ] Tests kunnen mocks injecteren
- [ ] Container setup gecentraliseerd
- [ ] Unit tests voor DI container

## Linked Items
- Epic: [[EPIC-003]] - Content Verrijking / Web Lookup
- Depends on: US-214, US-215
- Enables: US-219 (better testing)