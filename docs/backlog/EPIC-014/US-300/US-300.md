---
id: US-300
epic: EPIC-014
titel: Automatische bepaling van UFO‚Äëcategorie (OntoUML/UFO)
status: open
prioriteit: HOOG
story_points: 5
owner: developer-implementer
applies_to: definitie-app@current
canonical: false
last_verified: 2025-09-23
links:
  - docs/guidelines/CANONICAL_LOCATIONS.md
  - docs/guidelines/DOCUMENTATION_POLICY.md
---

# US-300: Automatische bepaling van UFO‚Äëcategorie

## Gebruikersverhaal
Als expert‚Äëgebruiker wil ik dat de applicatie automatisch de juiste UFO‚Äëcategorie (OntoUML/UFO) voor een begrip voorstelt, zodat ik minder handmatig werk heb en de classificatie consistenter wordt.

## Context
- UFO‚Äëcategorie (OntoUML/UFO metamodel) is nu handmatig selecteerbaar in Generator, Bewerk en Expert‚Äëreview tabs
- De dataset bevat nog geen betrouwbare trainingslabels; start met heuristieken/detector + fallback naar handmatige keuze
- 16 UFO-categorie√´n gedefinieerd in database schema, vrijwel ongebruikt (0% van actieve definities heeft categorie)
- 80+ voorbeelddefinities beschikbaar voor initial testing

## Acceptatiecriteria (SMART)
- [ ] De app toont automatisch een voorstel voor `ufo_categorie` bij generatie of laden in edit/review, met confidence‚Äëindicatie
- [ ] Gebruiker kan het voorstel overschrijven (manual > auto)
- [ ] Minimaal **95% precisie** op interne validatieset voor duidelijke gevallen (‚â•0.8 confidence)
- [ ] Fallback: bij lage confidence (<0.6) verplichte handmatige review
- [ ] Logging: gekozen waarde (auto of handmatig) wordt opgeslagen (auditbaar) zonder PII
- [ ] Performance: <500ms per detectie is acceptabel (focus op kwaliteit, niet snelheid)
- [ ] Batch processing: Voor initi√´le 80+ definities (geen performance vereiste)

## Technische Implementatie

### Service Architectuur (Single-User Focus)
- **UFOClassificationService**: Simpele service ge√Øntegreerd met ServiceContainer
- **Rule Engine**: 100+ zorgvuldig gecureerde regels voor Nederlandse juridische context
- **Kwaliteit over snelheid**: Grondige analyse met alle 16 UFO categorie√´n
- **Performance**: ~100-200ms is prima (gebruiker merkt dit niet bij single-user)

### Interface Design
```python
class UFOClassificationService:
    def classify(self, term: str, definition: str, context: Optional[Dict] = None) -> UFOClassification:
        """
        Grondige UFO classificatie met focus op correctheid.

        Returns:
        - primary_category: Een van de 16 UFO categorie√´n
        - secondary_tags: Alle relevante subcategorie√´n voor volledigheid
        - confidence: 0.0-1.0 score (hoe zeker de classificatie is)
        - detailed_explanation: Uitgebreide uitleg van ALLE overwegingen
        - matched_patterns: Alle gematchte patronen (niet alleen top-3)
        """
```

### Beslislogica (Volledig & Zorgvuldig)
**ALLE 9 stappen worden ALTIJD doorlopen voor maximale accuratesse:**

1. Is het zelfstandig, substantieel "ding" (kan zonder drager bestaan)? ‚Üí **Kind**
2. Is het tijdsgebonden (gebeurtenis/proces)? ‚Üí **Event**
3. Is het een rol die een entiteit kan aannemen? ‚Üí **Role**
4. Is het een levensfase van een entiteit? ‚Üí **Phase**
5. Medieert het een relatie tussen entiteiten? ‚Üí **Relator**
6. Is het een intrinsieke eigenschap met drager? ‚Üí **Mode**
7. Is het een meetbare grootheid? ‚Üí **Quantity**
8. Is het een kwalitatieve eigenschap? ‚Üí **Quality**
9. Verfijn met subcategorie√´n: **Subkind**, **Category**, **Mixin**, **RoleMixin**, **PhaseMixin**, **Collective**, **VariableCollection**, **FixedCollection**

**Disambiguatie voor complexe termen** wordt altijd toegepast bij termen zoals "zaak", "huwelijk", "overeenkomst"

## Nederlandse Juridische Domeinkennis

### Domeinspecifieke Woordenlijsten (500+ termen)
- **Strafrecht** (150+ termen): verdachte, dader, slachtoffer, aanhouding, inverzekeringstelling, dagvaarding, proces-verbaal
- **Bestuursrecht** (120+ termen): burger, bestuursorgaan, beschikking, vergunning, bezwaar, beroep, handhaving
- **Civiel recht** (100+ termen): koper, verkoper, eigenaar, koopovereenkomst, huurovereenkomst, vorderingsrecht
- **Algemeen juridisch** (130+ termen): rechtspersoon, natuurlijk persoon, rechtsverhouding, bevoegdheid

### Signalen per categorie (NL‚Äëspecifiek)
- **Kind**: zelfstandige naamwoorden die zelfstandig bestaan (mens, auto, zaak, organisatie); definities zonder drager/relatie
- **Event**: werkwoorden/nominalisaties (arrestatie, zitting, beoordeling); tijd/duur indicaties (op, tijdens, van‚Äëtot)
- **Role**: contextuele termen (als, in de rol van; verdachte, werknemer, rechter); vereist drager (mens/organisatie)
- **Phase**: stadia (in onderzoek, gesloten, actief, voorlopig, concept, definitief); overgang binnen zelfde individu
- **Relator**: contract/legale binding (overeenkomst, huwelijk, dagvaarding, vergunning, mandaat); ‚â•2 deelnemers
- **Mode**: toestanden/attributen (gezondheid, locatie, kleur, gemoedstoestand, adres); vereist drager
- **Quantity**: eenheden/meetbaarheid (‚Ç¨/%/km/kg; aantal, duur, percentage)
- **Quality**: gradaties/schalen (betrouwbaarheid, zwaarte, kwaliteit, ernst, waarschijnlijkheid)
- **Subkind/Category/Mixin**: groeperend/afgeleid; subkind behoudt essentie; abstracte types zonder instanties
- **Relatie/Event Composition**: predicaten ("X arresteert Y"); samengestelde processen (strafproces = opsporing + vervolging + berechting)

### Feature‚Äëextractie Pipeline (Grondig & Volledig)
- **Lingu√Østisch** (alle features extraheren):
  - POS‚Äëtags met spaCy nl_core_news_lg model (fallback: regex patterns)
  - ALLE lemmata, niet alleen top matches
  - ALLE patronen checken: "X als Y", "X van Y", temporele markers, etc.
  - Volledige morfologische analyse
- **Semantisch** (diepgaande analyse):
  - Uitgebreide drager analyse met meerdere checks
  - Complete deelnemers detectie (niet alleen ‚â•2)
  - Volledige lifecycle analyse
  - Context-aware disambiguatie voor ALLE ambigue termen
- **Domeinwoordenlijsten** (alles in geheugen voor snelle toegang):
  - 500+ juridische termen volledig geladen
  - Geen lazy loading - alles direct beschikbaar
  - Rijke metadata per term (domein, frequentie, ambigu√Øteit)
- **Relationele hints** (uitgebreid):
  - Volledige relationele analyse
  - Participatie analyse voor alle aantallen
  - Directionaliteit van relaties

## UX Implementatie

```python
# In Generator/Edit/Expert tabs - met focus op transparantie:
with st.spinner("üîç Grondige UFO-analyse bezig (alle 16 categorie√´n)..."):
    suggestion = classifier.classify(term, definition)

st.info(f"ü§ñ Voorgestelde categorie: {suggestion.primary_category} ({suggestion.confidence:.0%})")

# Altijd uitgebreide uitleg tonen voor juridische verantwoording
with st.expander("üìã Volledige analyse", expanded=True):
    st.write("**Alle overwogen categorie√´n:**")
    for category, score in suggestion.all_scores.items():
        st.write(f"- {category}: {score:.2f}")

    st.write("\n**Gematchte patronen:**")
    for pattern in suggestion.matched_patterns:  # Alle patronen, niet top-3
        st.write(f"- {pattern}")

    st.write("\n**Disambiguatie overwegingen:**")
    for consideration in suggestion.disambiguation_notes:
        st.write(f"- {consideration}")

# Manual override altijd mogelijk
selected = st.selectbox("UFO Categorie (u kunt wijzigen)",
                        options=UFO_CATEGORIES,
                        index=UFO_CATEGORIES.index(suggestion.primary_category))
```

- **Verplichte review**: Bij confidence <0.6 wordt manual review afgedwongen
- **Transparantie**: ALLE overwegingen zijn zichtbaar voor juridische verantwoording
- **Geen haast**: Gebruiker kan rustig alle details bekijken

## Integratiepunten & Dependencies (Vereenvoudigd)

- **ServiceContainer**: Simpele integratie via `container.ufo_classifier()`
- **Database updates**: Synchrone updates (geen async nodig voor single-user)
- **Approval flow**: gebruiker bevestigt/overschrijft; simpele audit trail
- **Initi√´le classificatie**:
  - Classificeer bestaande 80+ definities bij eerste run
  - Markeer items met lage confidence voor review
  - Geen performance vereisten - mag enkele seconden duren
- **Database schema updates**:
  ```sql
  ALTER TABLE definitions ADD COLUMN ufo_suggestion VARCHAR(50);
  ALTER TABLE definitions ADD COLUMN ufo_confidence REAL;
  ALTER TABLE definitions ADD COLUMN ufo_source VARCHAR(20) DEFAULT 'manual';
  CREATE TABLE definition_ufo_history (
    id INTEGER PRIMARY KEY,
    definition_id INTEGER,
    old_category VARCHAR(50),
    new_category VARCHAR(50),
    confidence REAL,
    source VARCHAR(20),
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
  );
  ```

## Regels & Configuratie

```yaml
# config/ufo_rules.yaml
rules:
  - id: kind_substantive
    category: Kind
    patterns:
      - "een [NOUN] is"
      - "de [NOUN] die"
    weight: 0.8

  - id: event_temporal
    category: Event
    patterns:
      - "tijdens|gedurende|na afloop"
      - "[VERB]ing van"
    weight: 0.7

  - id: role_context
    category: Role
    patterns:
      - "in de hoedanigheid van"
      - "als [NOUN]"
    weight: 0.6
```

Score berekening: `score[cat] = Œ£(weight √ó match) - conflicts`

## Test Strategie & Kwaliteitsborging

### Kwaliteit Tests (Focus op Correctheid)
```python
# tests/services/test_ufo_classifier_service.py
def test_all_16_categories():
    """Test dat ALLE 16 UFO categorie√´n correct gedetecteerd worden."""
    test_cases = load_annotated_test_set()  # 100+ handmatig geannoteerde cases

    for term, definition, expected_category in test_cases:
        result = classify(term, definition)
        assert result.primary_category == expected_category
        # Controleer dat ALLE relevante patronen gevonden zijn
        assert len(result.matched_patterns) > 0
        assert len(result.all_scores) == 16  # Alle categorie√´n overwogen

def test_disambiguation():
    """Test disambiguatie voor complexe juridische termen."""
    # Test "zaak" in verschillende contexten
    assert classify("zaak", "Een rechtszaak voor de rechter").primary_category == "Event"
    assert classify("zaak", "Een roerende zaak zoals een auto").primary_category == "Kind"
    assert classify("zaak", "De zaak van de verdachte").primary_category == "Abstract"
```

### Kwaliteitsmetrics (Single-User Focus)
| Metric | Target | Prioriteit |
|--------|--------|------------|
| **Precisie alle categorie√´n** | ‚â•95% | KRITIEK |
| **Disambiguatie correctheid** | ‚â•90% | KRITIEK |
| **Uitleg volledigheid** | 100% | HOOG |
| Classificatie tijd | <500ms | LAAG |
| Memory usage | <500MB | LAAG |

### Kwaliteitsmetrics
- **Validatieset**: 100+ zorgvuldig geannoteerde Nederlandse juridische definities
- **Precisie**: ‚â•95% voor alle categorie√´n (geen shortcuts)
- **Disambiguatie**: ‚â•90% correct voor ambigue termen
- **Uitleg kwaliteit**: Elke classificatie volledig verantwoord
- **Gebruikerstevredenheid**: Correctheid > Snelheid

## Implementatie Strategie (Single-User)

### Direct Live (Week 1)
- Implementeer volledige UFOClassificationService
- Integreer direct in alle tabs (Generator/Edit/Expert)
- Classificeer bestaande 80+ definities
- **Focus**: Kwaliteit van classificatie, niet rollout complexity

### Iteratieve Verbetering (Ongoing)
- Gebruiker geeft feedback via UI
- Regel updates via config files
- Continue verbetering van patterns
- **Success**: Gebruiker vertrouwt de suggesties

### Impact voor Gebruiker
- **Tijdsbesparing**: Minder handmatig categoriseren
- **Consistentie**: Elke definitie krijgt dezelfde grondige analyse
- **Leercurve**: Gebruiker leert UFO-categorie√´n via uitgebreide uitleg
- **Kwaliteit**: Betere juridische onderbouwing door volledige analyse

## Risico's & Mitigatie (Vereenvoudigd)

### Technische Risico's
- **Ambigue termen**: Uitgebreide disambiguatie regels + altijd manual override
- **Missende categorie√´n**: Alle 16 UFO categorie√´n ge√Ømplementeerd
- **Onjuiste classificatie**: Transparante uitleg + gebruiker kan altijd wijzigen

### Maintenance
- **Rule updates**: Simpele YAML config files
- **Feedback verwerking**: Direct in config aanpassen
- **Geen monitoring overhead**: Single-user heeft geen monitoring nodig

## Verbetering Process (Pragmatisch)

1. **Gebruiker feedback**: Direct via UI wanneer classificatie niet klopt
2. **Rule updates**: Aanpassen in YAML wanneer nodig
3. **Testen**: Rerun op test set van 100+ definities
4. **Deploy**: Direct live (geen staged rollout nodig)

## Definition of Done

- [ ] UFOClassificationService met alle 16 categorie√´n
- [ ] Grondige test coverage (focus op correctheid, niet performance)
- [ ] UI integratie in alle drie tabs met uitgebreide uitleg
- [ ] Disambiguatie voor complexe juridische termen
- [ ] 500+ Nederlandse juridische termen ge√Ømplementeerd
- [ ] Initi√´le classificatie van 80+ bestaande definities
- [ ] YAML config voor rule updates
- [ ] `last_verified` timestamp bijgewerkt