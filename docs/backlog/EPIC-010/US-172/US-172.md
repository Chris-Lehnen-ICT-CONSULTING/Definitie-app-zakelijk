---
id: US-172
titel: UI-laaggrenzen afdwingen (geen Streamlit/UI-imports buiten src/ui)
epic: EPIC-010
status: TODO
prioriteit: HIGH
story_points: 5
sprint: 2025-09
type: refactor
applies_to: definitie-app@current
canonical: true
owner: platform-team
---

# US-172: UI-laaggrenzen afdwingen (geen Streamlit/UI-imports buiten src/ui)

Doel: strikt scheiden van UI en services/config; geen UI/Streamlit afhankelijkheden buiten `src/ui/**`.

## Scope
- `src/config/feature_flags.py`: verwijder `show_legacy_warning` (verplaats naar `src/ui/helpers/feature_toggle.py`).
- `src/services/category_state_manager.py`: maak pure dict-mutator; verwijder `ui.session_state`-import.
- `src/services/container.py`: verwijder UI-service creatie; verplaats naar `src/ui/container.py`.
- `src/services/__init__.py`: verwijder compat-UI stub `render_feature_flag_toggle`.
- `src/utils/voorbeelden_debug.py`: verplaats naar UI of maak Streamlit optioneel (lazy import/guard).
- `src/integration/definitie_checker.py`: verwijder UI-imports; V2-only.

## Acceptatiecriteria
- `rg -n "\b(import|from)\s+streamlit" src | grep -v '^src/ui/' | grep -v '^src/main.py'` → 0 matches
- `rg -n "\bfrom\s+ui\.|\bimport\s+ui\b" src | grep -v '^src/ui/' | grep -v '^src/main.py'` → 0 matches
- Services en config importeerbaar zonder UI.

## Taken
1) Verplaats UI-renders naar `src/ui/helpers/feature_toggle.py`; update callsites.
2) Refactor CategoryStateManager naar pure helpers en pas UI aan om session state te schrijven.
3) Introduceer `src/ui/container.py` en laat services-container UI-los.
4) Voorbeelden-debug: UI-only of guarded import.
5) Opschonen compat-stubs in services.

## Testplan
- Unit: import-tests services zonder UI dependencies.
- Unit: CategoryStateManager verandert alleen dict; geen UI import.
- Regex-acceptatie (zie boven) als test/gate.

## Risks & Mitigatie
- Breuk in UI imports → mechanische refactor met zoek/vervang en smoke-test.

