---
id: US-239
titel: Eén bronsectie — geen duplicatie (Context vs Web‑augmentatie)
canonical: true
status: proposed
priority: P0
owner: architecture
applies_to: definitie-app@v2
last_verified: 2025-09-22
links:
  - EPIC-019
  - EPIC-018
---

# US-019-02 — Eén bronsectie

Als gebruiker wil ik dat bronnen/context maar één keer zichtbaar zijn in de prompt, zodat er geen doublures zijn en tokens bespaard blijven.

## As‑Is
- ContextAwarenessModule toont “ADDITIONELE BRONNEN”.
- PromptServiceV2 kan óók een aparte sectie injecteren “Contextinformatie uit bronnen” (augmentatie).
- Resultaat: dubbele bronnensecties in rijke contextcases.

Bronnen:
- src/services/prompts/modules/context_awareness_module.py:240
- src/services/prompts/prompt_service_v2.py:196

## To‑Be
- Als ContextAwarenessModule reeds bronnen toont, wordt web‑augmentatie overgeslagen.
- Slechts één bronnensectie zichtbaar (uniforme titel/format).

## Acceptance Criteria
- AC1: Prompt bevat maximaal één bronnensectie.
- AC2: Bij rijke context is augmentatie uitgeschakeld; bij arme context kan augmentatie aan staan binnen budgetten.
- AC3: Aantal tokens voor bronnen ≤ vastgesteld budget.

## Implementatie (richting)
1) ContextAwarenessModule: zet `enriched_context.metadata["sources_in_prompt"]=True` wanneer bronnen zijn toegevoegd
   - src/services/prompts/modules/context_awareness_module.py: in _build_* paths vlak vóór return.
2) PromptServiceV2._maybe_augment_with_web_context: skip als `metadata.sources_in_prompt` true
   - src/services/prompts/prompt_service_v2.py:196 (check vóór selectie/injectie)
3) Uniformeer header (gebruik “Contextinformatie uit bronnen:”)
   - kies één header in ContextAwareness; laat augmentatie dezelfde header gebruiken indien actief.

## Testplan
- Case rijk: context met sources → exact één sectie, augmentatie geskipt.
- Case arm: geen sources → augmentatie voegt maximaal N korte bronnen toe; binnen budget.
- Snapshot tests + tokencount vergelijking.

## Risks / Mitigations
- Risico: metadata‑flag niet zichtbaar in PromptServiceV2
  - Mitigatie: set op `enriched_context.metadata` (niet alleen ModuleOutput.metadata).
