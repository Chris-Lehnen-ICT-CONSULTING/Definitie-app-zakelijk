---
id: US-241
titel: Relevantie‑filtering (Top‑N) per regelssectie
canonical: true
status: proposed
priority: P0
owner: architecture
applies_to: definitie-app@v2
last_verified: 2025-09-22
links:
  - EPIC-019
---

# US-019-04 — Top‑N regels per categorie

Als lezer wil ik alleen de meest relevante regels zien, zodat de prompt compact blijft en focust op wat nodig is voor het begrip/context.

## As‑Is
- Alle regels (ARAI/CON/ESS/STR/INT/SAM/VER) worden getoond, ongeacht context/categorie.

Bronnen:
- src/services/prompts/modules/arai_rules_module.py:64 (execute)
- idem: con_rules_module.py, ess_rules_module.py, structure_rules_module.py, integrity_rules_module.py, sam_rules_module.py, ver_rules_module.py

## To‑Be
- Toon per sectie slechts Top‑N regels (N instelbaar) op basis van begripstype/ontologische categorie/context.

## Acceptance Criteria
- AC1: N is centraal configureerbaar (ENV/Config), default N=5.
- AC2: Filtering gebruikt metadata/shared_state (bijv. ontologische categorie, contextscore, woordsoort).
- AC3: Secties tonen maximaal N regels; tokencount reductie zichtbaar.

## Implementatie (richting)
1) Voeg helper ‘select_relevant_rules(context, all_rules, N)’ toe (shared util of in module)
2) Heuristieken (voorbeeld):
   - Voor ‘proces’: prioriteit aan STR‑01/ESS‑02/ARAI‑01/ARAI‑04/CON‑01
   - Voor ‘type’: prioriteit aan ESS‑05/STR‑01/ARAI‑02/CON‑01
   - Context rijk → meer nadruk op CON/ESS, arm → ARAI/STR basis
3) Pas execute() per module aan om ‘sorted(all_rules, key=score)[:N]’ te formatteren

## Testplan
- Unit: mock context (proces/type), assert selectie van regels (IDs) en max N output.
- Snapshot: tokens dalen duidelijk t.o.v. baseline.

## Risks / Mitigations
- Risico: we laten relevante regel weg
  - Mitigatie: N verhoogbaar via config; documenteer prioriteitsmatrix.
