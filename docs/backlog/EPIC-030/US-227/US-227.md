---
id: US-227
epic: EPIC-030
titel: "US-227: Als gebruiker wil ik dat de door mij geselecteerde documenten daadwerkelijk worden gebruikt in de prompt, zodat de de..."
status: proposed
prioriteit: HOOG
story_points: 5
aangemaakt: 2025-09-22
bijgewerkt: 2025-09-22
owner: architecture
applies_to: definitie-app@current
canonical: false
last_verified: 2025-09-22
---

# US-227: Documentcontext doorgeven aan service (GenerationRequest)

## Gebruikersverhaal
Als gebruiker wil ik dat de door mij geselecteerde documenten daadwerkelijk worden gebruikt in de prompt, zodat de definitie contextspecifiek is.

## Acceptatiecriteria
- [ ] UI aggregeert documentcontext (keywords/concepten/juridische verwijzingen)
- [ ] `GenerationRequest` bevat `document_context` (samenvatting)
- [ ] HybridContextManager voegt een ‚Äúdocument‚Äù bron toe met hoge confidence
- [ ] Prompt‚Äëcontextsectie toont documentcontext aanwezig

## Refinement (2025-10-14)

### Doelen
- Gebruik geselecteerde documenten om een compacte samenvatting (max 3 bulletpoints) aan de prompt toe te voegen.
- Zorg voor zichtbare bronvermelding zodat gebruiker weet welke documenten verwerkt zijn.
- Houd het pad enkel binnen bestaande services (geen extra AI-calls).

### Buiten scope
- Geen automatische documentselectie of ranking; gebruiker kiest handmatig.
- Geen opslag van volledige documenten in de database binnen deze US.
- Geen additionele validatieregels; focus ligt op promptverrijking.

### Definition of Ready
- [ ] Document aggregatie helper (`get_aggregated_context`) levert keywords + citaten.
- [ ] Duidelijke limiet afgesproken: max 500 tokens documentcontext.
- [ ] Voorbeeldset van 3 documenten beschikbaar voor test.
- [ ] UI ontwerp (positie van context in preview) afgestemd.

### Werkpakketten
- [ ] Aggregatie: voeg functie toe die top 5 keywords + √©√©n citaat per document selecteert.
- [ ] Request object: breid `GenerationRequest` uit met veld `document_context`.
- [ ] HybridContextManager: merge documentbron met weight > 0.8; fallback wanneer leeg.
- [ ] Prompt-template: voeg sectie ‚ÄúüìÑ Documentcontext‚Äù toe die lijst toont (max 3 bullets).
- [ ] UI: update preview pane zodat gebruiker context kan zien voordat hij genereert.
- [ ] Tests: integratietest die bevestigt dat context doorsijpelt tot prompt + metadata; unit test voor aggregator.
- [ ] Logging: noteer welke document-ids gebruikt zijn per generatie.

## Technisch
- UI: bouw korte samenvatting uit `get_aggregated_context(selected_ids)`
- ServiceFactory: zet samenvatting door in request
- Geen wijzigingen aan web_lookup pad

## Tests
- Integratietest verifieert presence van documentcontext in prompt/metadata
- Unit test voor aggregator garandeert limieten en unieke items.
- Handmatig: genereer definitie met 2 documenten, controleer weergave en logging.

## Definition of Done
- [ ] Documentcontextveld verschijnt in `GenerationRequest` en prompt.
- [ ] UI toont overzicht van gebruikte documenten v√≥√≥r verzending.
- [ ] Logging bevat document-ids + samenvatting.
- [ ] Tests dekken aggregator en end-to-end flow.
- [ ] Documentatie aangevuld in `docs/implementation/document-context.md`.
