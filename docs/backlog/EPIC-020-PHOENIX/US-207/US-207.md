---
id: US-207
epic: EPIC-020
title: Create reusable UI component library
status: open
priority: HIGH
created: 2025-01-18
updated: 2025-01-18
owner: development-team
applies_to: definitie-app@current
canonical: false
last_verified: 2025-10-02
tags:
  - phoenix
  - ui
  - components
  - streamlit
  - refactoring
estimated_hours: 16
actual_hours: 0
---

# US-207: Create reusable UI component library

## User Story
Als een **ontwikkelaar** wil ik een **gestructureerde bibliotheek van herbruikbare UI componenten** zodat ik **consistente interfaces kan bouwen zonder code duplicatie**.

## Context
Het huidige Streamlit UI systeem bevat veel gedupliceerde code en ad-hoc componenten verspreid over verschillende modules. Door een centrale component library te creëren kunnen we:
- Code duplicatie elimineren
- Consistente styling garanderen
- Sneller nieuwe features ontwikkelen
- Makkelijker UI tests schrijven

## Acceptance Criteria
1. **Component Library Structure**
   - [ ] Directory `src/ui/components/` aangemaakt met subdirectories voor component categorieën
   - [ ] Base component klasse voor gemeenschappelijke functionaliteit
   - [ ] Type hints en docstrings voor alle componenten

2. **Core Components Geïmplementeerd**
   - [ ] ValidationResultCard component (vervangt inline rendering)
   - [ ] DefinitionDisplay component (met syntax highlighting)
   - [ ] MetricsDisplay component (voor stats en scores)
   - [ ] ConfigurationPanel component (voor settings)
   - [ ] ProgressIndicator component (voor lange operaties)
   - [ ] ErrorBoundary component (voor foutafhandeling)

3. **Component Registry**
   - [ ] Centraal register voor alle UI componenten
   - [ ] Lazy loading mechanisme voor performance
   - [ ] Component versioning voor backwards compatibility tijdens migratie

4. **Styling System**
   - [ ] Centrale CSS/styling configuratie
   - [ ] Theme support (light/dark mode voorbereid)
   - [ ] Responsive design utilities

5. **Migration Path**
   - [ ] Alle bestaande UI code geïdentificeerd voor migratie
   - [ ] Component usage map gecreëerd
   - [ ] Deprecation warnings voor oude patterns

## Technical Design

### Directory Structure
```
src/ui/components/
├── __init__.py
├── base.py                  # BaseComponent class
├── registry.py              # Component registry
├── display/
│   ├── __init__.py
│   ├── definition.py        # DefinitionDisplay
│   ├── validation.py        # ValidationResultCard
│   └── metrics.py          # MetricsDisplay
├── input/
│   ├── __init__.py
│   ├── text_input.py       # Enhanced text inputs
│   └── selectors.py        # Dropdowns, multiselects
├── layout/
│   ├── __init__.py
│   ├── containers.py       # Reusable containers
│   └── navigation.py       # Navigation components
└── feedback/
    ├── __init__.py
    ├── progress.py         # Progress indicators
    └── errors.py           # Error displays
```

### Base Component Pattern
```python
from abc import ABC, abstractmethod
from typing import Any, Dict, Optional
import streamlit as st

class BaseComponent(ABC):
    """Base class for all UI components."""

    def __init__(self, key: Optional[str] = None):
        self.key = key or self._generate_key()
        self._container = None

    @abstractmethod
    def render(self, **kwargs) -> Any:
        """Render the component."""
        pass

    def with_container(self, container):
        """Set the Streamlit container for rendering."""
        self._container = container
        return self

    def _generate_key(self) -> str:
        """Generate unique component key."""
        return f"{self.__class__.__name__}_{id(self)}"
```

### Example Component Implementation
```python
class ValidationResultCard(BaseComponent):
    """Reusable card for displaying validation results."""

    def render(
        self,
        result: ValidationResult,
        expanded: bool = False,
        show_details: bool = True
    ) -> None:
        """Render validation result card."""
        container = self._container or st

        with container.expander(
            f"{result.icon} {result.rule_name}",
            expanded=expanded
        ):
            # Render score
            cols = container.columns([2, 1])
            with cols[0]:
                container.markdown(f"**Score:** {result.score}/10")
            with cols[1]:
                container.markdown(f"**Prioriteit:** {result.priority}")

            # Render feedback
            if show_details and result.feedback:
                container.info(result.feedback)

            # Render suggestions
            if result.suggestions:
                container.markdown("**Suggesties:**")
                for suggestion in result.suggestions:
                    container.markdown(f"- {suggestion}")
```

## Implementation Notes

1. **Streamlit Integration**
   - Components moeten native Streamlit widgets wrappen, niet vervangen
   - Session state management moet transparent zijn
   - Component keys moeten uniek en stabiel zijn

2. **Performance Considerations**
   - Gebruik `@st.cache_data` waar mogelijk
   - Minimaliseer re-renders door slimme key management
   - Lazy load zware componenten

3. **Testing Strategy**
   - Unit tests voor component logic
   - Snapshot tests voor rendered output
   - Integration tests met Streamlit app

4. **Migration Strategy**
   - Start met meest gebruikte componenten
   - Gebruik feature flags tijdens transitie
   - Behoud oude code tot volledige migratie

## Dependencies
- Streamlit >= 1.29.0
- Python typing extensions
- Optional: streamlit-elements voor geavanceerde componenten

## Definition of Done
- [ ] Alle componenten geïmplementeerd volgens design pattern
- [ ] Unit tests voor elk component (>80% coverage)
- [ ] Documentatie voor component gebruik
- [ ]Voorbeeld applicatie met alle componenten
- [ ] Code review door senior developer
- [ ] Performance benchmarks uitgevoerd
- [ ] Migration guide geschreven
- [ ] Oude UI code gemarkeerd voor deprecation

## Notes
- Coordinate met US-210 (business logic refactoring) voor clean interfaces
- Component library kan later uitgebreid worden voor andere projecten
- Overweeg publicatie als open source Streamlit component library