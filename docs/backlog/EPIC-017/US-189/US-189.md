---
id: US-189
titel: FeedbackBuilder V2 (Violation→Feedback mapping)
epic: EPIC-017
status: Backlog
prioriteit: KRITIEK
story_points: 8
aangemaakt: 2025-09-15
bijgewerkt: 2025-09-15
owner: architecture
type: feature
applies_to: definitie-app@current
canonical: true
last_verified: 2025-09-15
vereisten:
- REQ-097
---

# US-189: FeedbackBuilder V2 (Violation→Feedback mapping)

## Doel
Port en moderniseer de 11+ violation→feedback mappings (uit US‑061) naar een deterministische V2‑service met prioritering (kritiek → suggesties → overig), deduplicatie, max 5 items per iteratie en eenvoudige telemetrie.

## Acceptatiecriteria
- [ ] Mappingtabel(len) geconfigureerd (code/YAML), met tests.
- [ ] Prioritering en deduplicatie toegepast; max 5 feedbackitems per iteratie.
- [ ] API: `get_feedback_for(violations, iteration, history)` levert stabiele, deterministische output.
- [ ] Telemetrie: counters per type (kritiek/suggestie/overig), coverage per iteratie.
- [ ] Geen legacy imports; pure service met type hints.

## Definition of Done
- [ ] Service/module + tests (unit) met golden inputs (uit US‑061 voorbeelden).
- [ ] Integratie in iteratieloop (US‑188) via orchestrator hook.
- [ ] Documentatie: mappingoverzicht en rationale.

## Technical Notes
- Input: ValidationDetailsDict. Normalize severities (high/critical → kritiek; warning → suggestie; rest → overig).
- Determinisme: stabiele sortkey (severity weight, rule_id, message), geen random.
- Extensibility: config‑gedreven (optioneel) met default fallback in code.

## Testplan
- Unit: mapping per rule_id; prioritering; deduplicatie; max 5; determinisme.
- Integratie: iteratie 1 vs 2 (andere feedback mix), stagnatie detectie interactie met US‑188.

## Risico’s
- Overfit/te algemene feedback → mappingreview en code comments.
- Niet‑determinisme → forced stable sort + fixed seeds (indien van toepassing).

