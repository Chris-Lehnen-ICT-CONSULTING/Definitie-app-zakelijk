"""
Side-by-side vergelijking van legacy vs nieuwe services.
"""
import os
import sys
from pathlib import Path
import time

# Voeg src toe aan path
sys.path.insert(0, str(Path(__file__).parent / "src"))

print("üîÑ Side-by-side Feature Comparison\n")

def test_definition_generation(use_new_services):
    """Test definitie generatie in beide modes."""
    os.environ["USE_NEW_SERVICES"] = str(use_new_services).lower()
    
    # Reset imports to force reload
    if 'services.service_factory' in sys.modules:
        del sys.modules['services.service_factory']
    
    from services.service_factory import get_definition_service
    
    service = get_definition_service()
    mode = "NEW" if use_new_services else "LEGACY"
    
    print(f"\n{'='*50}")
    print(f"Testing {mode} services")
    print('='*50)
    
    # Test 1: Basic generation
    try:
        start = time.time()
        result = service.genereer_definitie(
            begrip="algoritme",
            context="software development"
        )
        elapsed = time.time() - start
        
        print(f"‚úÖ Generation: {elapsed:.2f}s")
        print(f"   - Definitie length: {len(result.get('definitie', ''))} chars")
        print(f"   - Has metadata: {'metadata' in result}")
        print(f"   - Has scores: {'scores' in result}")
    except Exception as e:
        print(f"‚ùå Generation failed: {e}")
    
    # Test 2: Validation
    try:
        if result and 'definitie' in result:
            val_result = service.valideer_definitie(
                result['definitie'],
                "algoritme"
            )
            print(f"‚úÖ Validation: score={val_result.get('score', 0):.2f}")
            print(f"   - Passed rules: {val_result.get('passed_count', 0)}")
            print(f"   - Failed rules: {val_result.get('failed_count', 0)}")
    except Exception as e:
        print(f"‚ùå Validation failed: {e}")
    
    # Test 3: Check duplicates
    try:
        duplicates = service.check_duplicates("algoritme")
        print(f"‚úÖ Duplicate check: {len(duplicates)} found")
    except Exception as e:
        print(f"‚ùå Duplicate check failed: {e}")
    
    return result

# Run comparison
print("Running comparison tests...")

# Test legacy
legacy_result = test_definition_generation(False)

# Test new
new_result = test_definition_generation(True)

# Compare results
print(f"\n{'='*50}")
print("COMPARISON SUMMARY")
print('='*50)

if legacy_result and new_result:
    legacy_def = legacy_result.get('definitie', '')
    new_def = new_result.get('definitie', '')
    
    print(f"Definition length: Legacy={len(legacy_def)}, New={len(new_def)}")
    print(f"Metadata present: Legacy={'metadata' in legacy_result}, New={'metadata' in new_result}")
    print(f"Scores present: Legacy={'scores' in legacy_result}, New={'scores' in new_result}")
    
    # Check if definitions are similar (first 100 chars)
    if legacy_def and new_def:
        print(f"\nFirst 100 chars similar: {legacy_def[:100] == new_def[:100]}")

print("\n‚úÖ Comparison completed!")